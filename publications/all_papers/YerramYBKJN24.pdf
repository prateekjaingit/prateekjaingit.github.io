<!DOCTYPE html>

<html lang="en">
<head>
<meta content="text/html; charset=utf-8" http-equiv="content-type"/>
<title>HiRE: High Recall Approximate Top-𝑘 Estimation for Efficient LLM Inference</title>
<!--Generated on Wed Feb 14 18:00:25 2024 by LaTeXML (version 0.8.7) http://dlmf.nist.gov/LaTeXML/.-->
<meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport"/>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" type="text/css"/>
<link href="/static/browse/0.3.4/css/ar5iv_0.7.4.min.css" rel="stylesheet" type="text/css"/>
<link href="/static/browse/0.3.4/css/latexml_styles.css" rel="stylesheet" type="text/css"/>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.3.3/html2canvas.min.js"></script>
<script src="/static/browse/0.3.4/js/addons.js"></script>
<script src="/static/browse/0.3.4/js/feedbackOverlay.js"></script>
<meta content="Machine Learning,  ICML" lang="en" name="keywords"/>
<base href="/html/2402.09360v1/"/></head>
<body>
<nav class="ltx_page_navbar">
<nav class="ltx_TOC">
<ol class="ltx_toclist">
<li class="ltx_tocentry ltx_tocentry_section"><a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#S1" title="1 Introduction ‣ HiRE: High Recall Approximate Top-𝑘 Estimation for Efficient LLM Inference"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">1 </span>Introduction</span></a></li>
<li class="ltx_tocentry ltx_tocentry_section"><a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#S2" title="2 Related Work ‣ HiRE: High Recall Approximate Top-𝑘 Estimation for Efficient LLM Inference"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">2 </span>Related Work</span></a></li>
<li class="ltx_tocentry ltx_tocentry_section">
<a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#S3" title="3 Main Ideas ‣ HiRE: High Recall Approximate Top-𝑘 Estimation for Efficient LLM Inference"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">3 </span>Main Ideas</span></a>
<ol class="ltx_toclist ltx_toclist_section">
<li class="ltx_tocentry ltx_tocentry_subsection">
<a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#S3.SS1" title="3.1 Problem Setup ‣ 3 Main Ideas ‣ HiRE: High Recall Approximate Top-𝑘 Estimation for Efficient LLM Inference"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">3.1 </span>Problem Setup</span></a>
<ol class="ltx_toclist ltx_toclist_subsection">
<li class="ltx_tocentry ltx_tocentry_paragraph"><a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#S3.SS1.SSS0.Px1" title="Theoretical proxy for quantifying efficiency ‣ 3.1 Problem Setup ‣ 3 Main Ideas ‣ HiRE: High Recall Approximate Top-𝑘 Estimation for Efficient LLM Inference"><span class="ltx_text ltx_ref_title">Theoretical proxy for quantifying efficiency</span></a></li>
</ol>
</li>
<li class="ltx_tocentry ltx_tocentry_subsection">
<a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#S3.SS2" title="3.2 HiRE: Overall Approach ‣ 3 Main Ideas ‣ HiRE: High Recall Approximate Top-𝑘 Estimation for Efficient LLM Inference"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">3.2 </span>HiRE: Overall Approach</span></a>
<ol class="ltx_toclist ltx_toclist_subsection">
<li class="ltx_tocentry ltx_tocentry_subsubsection">
<a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#S3.SS2.SSS1" title="3.2.1 Solving equation 5 accurately and efficiently ‣ 3.2 HiRE: Overall Approach ‣ 3 Main Ideas ‣ HiRE: High Recall Approximate Top-𝑘 Estimation for Efficient LLM Inference"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">3.2.1 </span>Solving equation <span class="ltx_text ltx_ref_tag">5</span> accurately and efficiently</span></a>
<ol class="ltx_toclist ltx_toclist_subsubsection">
<li class="ltx_tocentry ltx_tocentry_paragraph"><a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#S3.SS2.SSS1.Px1" title="HiRE-LR ‣ 3.2.1 Solving equation 5 accurately and efficiently ‣ 3.2 HiRE: Overall Approach ‣ 3 Main Ideas ‣ HiRE: High Recall Approximate Top-𝑘 Estimation for Efficient LLM Inference"><span class="ltx_text ltx_ref_title">HiRE-LR</span></a></li>
<li class="ltx_tocentry ltx_tocentry_paragraph"><a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#S3.SS2.SSS1.Px2" title="HiRE-Q ‣ 3.2.1 Solving equation 5 accurately and efficiently ‣ 3.2 HiRE: Overall Approach ‣ 3 Main Ideas ‣ HiRE: High Recall Approximate Top-𝑘 Estimation for Efficient LLM Inference"><span class="ltx_text ltx_ref_title">HiRE-Q</span></a></li>
</ol>
</li>
<li class="ltx_tocentry ltx_tocentry_subsubsection"><a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#S3.SS2.SSS2" title='3.2.2 "DA-TOP-"⁢𝑘: Multi-device serving with approximate distributed top-𝑘 operation ‣ 3.2 HiRE: Overall Approach ‣ 3 Main Ideas ‣ HiRE: High Recall Approximate Top-𝑘 Estimation for Efficient LLM Inference'><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">3.2.2 </span><math alttext="\textrm{DA-TOP-}k" class="ltx_Math" display="inline"><semantics><mrow><mtext>DA-TOP-</mtext><mo>⁢</mo><mi>k</mi></mrow><annotation-xml encoding="MathML-Content"><apply><times></times><ci><mtext>DA-TOP-</mtext></ci><ci>𝑘</ci></apply></annotation-xml><annotation encoding="application/x-tex">\textrm{DA-TOP-}k</annotation><annotation encoding="application/x-llamapun">DA-TOP- italic_k</annotation></semantics></math>: Multi-device serving with approximate distributed top-<math alttext="k" class="ltx_Math" display="inline"><semantics><mi>k</mi><annotation-xml encoding="MathML-Content"><ci>𝑘</ci></annotation-xml><annotation encoding="application/x-tex">k</annotation><annotation encoding="application/x-llamapun">italic_k</annotation></semantics></math> operation</span></a></li>
</ol>
</li>
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#S3.SS3" title="3.3 HiRE-SoftMax: Efficient Softmax using HiRE ‣ 3 Main Ideas ‣ HiRE: High Recall Approximate Top-𝑘 Estimation for Efficient LLM Inference"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">3.3 </span>HiRE-SoftMax: Efficient Softmax using HiRE</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection">
<a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#S3.SS4" title="3.4 HiRE-FFN: Efficient FFN using HiRE ‣ 3 Main Ideas ‣ HiRE: High Recall Approximate Top-𝑘 Estimation for Efficient LLM Inference"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">3.4 </span>HiRE-FFN: Efficient FFN using HiRE</span></a>
<ol class="ltx_toclist ltx_toclist_subsection">
<li class="ltx_tocentry ltx_tocentry_subsubsection">
<a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#S3.SS4.SSS1" title="3.4.1 Enhancing sparsity further by exploiting static and dynamic activation overlap ‣ 3.4 HiRE-FFN: Efficient FFN using HiRE ‣ 3 Main Ideas ‣ HiRE: High Recall Approximate Top-𝑘 Estimation for Efficient LLM Inference"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">3.4.1 </span>Enhancing sparsity further by exploiting static and dynamic activation overlap</span></a>
<ol class="ltx_toclist ltx_toclist_subsubsection">
<li class="ltx_tocentry ltx_tocentry_paragraph"><a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#S3.SS4.SSS1.Px1" title="Static overlap ‣ 3.4.1 Enhancing sparsity further by exploiting static and dynamic activation overlap ‣ 3.4 HiRE-FFN: Efficient FFN using HiRE ‣ 3 Main Ideas ‣ HiRE: High Recall Approximate Top-𝑘 Estimation for Efficient LLM Inference"><span class="ltx_text ltx_ref_title">Static overlap</span></a></li>
<li class="ltx_tocentry ltx_tocentry_paragraph"><a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#S3.SS4.SSS1.Px2" title="Dynamic overlap ‣ 3.4.1 Enhancing sparsity further by exploiting static and dynamic activation overlap ‣ 3.4 HiRE-FFN: Efficient FFN using HiRE ‣ 3 Main Ideas ‣ HiRE: High Recall Approximate Top-𝑘 Estimation for Efficient LLM Inference"><span class="ltx_text ltx_ref_title">Dynamic overlap</span></a></li>
</ol>
</li>
</ol>
</li>
</ol>
</li>
<li class="ltx_tocentry ltx_tocentry_section">
<a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#S4" title="4 Experiments ‣ HiRE: High Recall Approximate Top-𝑘 Estimation for Efficient LLM Inference"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">4 </span>Experiments</span></a>
<ol class="ltx_toclist ltx_toclist_section">
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#S4.SS1" title="4.1 Training details ‣ 4 Experiments ‣ HiRE: High Recall Approximate Top-𝑘 Estimation for Efficient LLM Inference"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">4.1 </span>Training details</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#S4.SS2" title="4.2 Evaluation ‣ 4 Experiments ‣ HiRE: High Recall Approximate Top-𝑘 Estimation for Efficient LLM Inference"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">4.2 </span>Evaluation</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#S4.SS3" title="4.3 Results ‣ 4 Experiments ‣ HiRE: High Recall Approximate Top-𝑘 Estimation for Efficient LLM Inference"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">4.3 </span>Results</span></a></li>
</ol>
</li>
<li class="ltx_tocentry ltx_tocentry_appendix"><a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#A1" title="Appendix A Dataset details ‣ HiRE: High Recall Approximate Top-𝑘 Estimation for Efficient LLM Inference"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">A </span>Dataset details</span></a></li>
<li class="ltx_tocentry ltx_tocentry_appendix"><a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#A2" title="Appendix B Additional Results ‣ HiRE: High Recall Approximate Top-𝑘 Estimation for Efficient LLM Inference"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">B </span>Additional Results</span></a></li>
</ol></nav>
</nav>
<div class="ltx_page_main">
<div class="ltx_page_content"><div class="section" id="target-section"><div id="license-tr">License: arXiv.org perpetual non-exclusive license</div><div id="watermark-tr">arXiv:2402.09360v1 [cs.LG] 14 Feb 2024</div></div>
<article class="ltx_document ltx_pruned_first">
<h1 class="ltx_title ltx_title_document">HiRE: High Recall Approximate Top-<math alttext="k" class="ltx_Math" display="inline" id="id1.m1.1"><semantics id="id1.m1.1b"><mi id="id1.m1.1.1" xref="id1.m1.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="id1.m1.1c"><ci id="id1.m1.1.1.cmml" xref="id1.m1.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="id1.m1.1d">k</annotation><annotation encoding="application/x-llamapun" id="id1.m1.1e">italic_k</annotation></semantics></math> Estimation for Efficient LLM Inference</h1>
<div class="ltx_authors">
<span class="ltx_creator ltx_role_author">
<span class="ltx_personname">Yashas Samaga B L
</span></span>
<span class="ltx_author_before">  </span><span class="ltx_creator ltx_role_author">
<span class="ltx_personname">Varun Yerram
</span></span>
<span class="ltx_author_before">  </span><span class="ltx_creator ltx_role_author">
<span class="ltx_personname">Chong You
</span></span>
<span class="ltx_author_before">  </span><span class="ltx_creator ltx_role_author">
<span class="ltx_personname">Srinadh Bhojanapalli
</span></span>
<span class="ltx_author_before">  </span><span class="ltx_creator ltx_role_author">
<span class="ltx_personname">Sanjiv Kumar
</span></span>
<span class="ltx_author_before">  </span><span class="ltx_creator ltx_role_author">
<span class="ltx_personname">Prateek Jain
</span></span>
<span class="ltx_author_before">  </span><span class="ltx_creator ltx_role_author">
<span class="ltx_personname">Praneeth Netrapalli
</span></span>
</div>
<div class="ltx_abstract">
<h6 class="ltx_title ltx_title_abstract">Abstract</h6>
<p class="ltx_p" id="id7.6">Autoregressive decoding with generative Large Language Models (LLMs) on accelerators (GPUs/TPUs) is often memory-bound where most of the time is spent on transferring model parameters from high bandwidth memory (HBM) to cache.
On the other hand, recent works show that LLMs can maintain quality with significant sparsity/redundancy in the feedforward (FFN) layers by appropriately training the model to operate on a top-<math alttext="k" class="ltx_Math" display="inline" id="id2.1.m1.1"><semantics id="id2.1.m1.1a"><mi id="id2.1.m1.1.1" xref="id2.1.m1.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="id2.1.m1.1b"><ci id="id2.1.m1.1.1.cmml" xref="id2.1.m1.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="id2.1.m1.1c">k</annotation><annotation encoding="application/x-llamapun" id="id2.1.m1.1d">italic_k</annotation></semantics></math> fraction of rows/columns (where <math alttext="k\approx 0.05" class="ltx_Math" display="inline" id="id3.2.m2.1"><semantics id="id3.2.m2.1a"><mrow id="id3.2.m2.1.1" xref="id3.2.m2.1.1.cmml"><mi id="id3.2.m2.1.1.2" xref="id3.2.m2.1.1.2.cmml">k</mi><mo id="id3.2.m2.1.1.1" xref="id3.2.m2.1.1.1.cmml">≈</mo><mn id="id3.2.m2.1.1.3" xref="id3.2.m2.1.1.3.cmml">0.05</mn></mrow><annotation-xml encoding="MathML-Content" id="id3.2.m2.1b"><apply id="id3.2.m2.1.1.cmml" xref="id3.2.m2.1.1"><approx id="id3.2.m2.1.1.1.cmml" xref="id3.2.m2.1.1.1"></approx><ci id="id3.2.m2.1.1.2.cmml" xref="id3.2.m2.1.1.2">𝑘</ci><cn id="id3.2.m2.1.1.3.cmml" type="float" xref="id3.2.m2.1.1.3">0.05</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="id3.2.m2.1c">k\approx 0.05</annotation><annotation encoding="application/x-llamapun" id="id3.2.m2.1d">italic_k ≈ 0.05</annotation></semantics></math>), there by suggesting a way to reduce the transfer of model parameters, and hence latency. However, exploiting this sparsity for improving latency is hindered by the fact that
identifying top rows/columns is data-dependent and is usually performed using full matrix operations, severely limiting potential gains. To address these issues, we introduce HiRE (<span class="ltx_text ltx_font_bold" id="id7.6.1">Hi</span>gh <span class="ltx_text ltx_font_bold" id="id7.6.2">R</span>ecall Approximate Top-<math alttext="k" class="ltx_Math" display="inline" id="id4.3.m3.1"><semantics id="id4.3.m3.1a"><mi id="id4.3.m3.1.1" xref="id4.3.m3.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="id4.3.m3.1b"><ci id="id4.3.m3.1.1.cmml" xref="id4.3.m3.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="id4.3.m3.1c">k</annotation><annotation encoding="application/x-llamapun" id="id4.3.m3.1d">italic_k</annotation></semantics></math> <span class="ltx_text ltx_font_bold" id="id7.6.3">E</span>stimation). HiRE comprises of two novel components: (i) a compression scheme to cheaply predict top-<math alttext="k" class="ltx_Math" display="inline" id="id5.4.m4.1"><semantics id="id5.4.m4.1a"><mi id="id5.4.m4.1.1" xref="id5.4.m4.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="id5.4.m4.1b"><ci id="id5.4.m4.1.1.cmml" xref="id5.4.m4.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="id5.4.m4.1c">k</annotation><annotation encoding="application/x-llamapun" id="id5.4.m4.1d">italic_k</annotation></semantics></math> rows/columns with high recall, followed by full computation restricted to the predicted subset, and (ii) <math alttext="\textrm{DA-TOP-}k" class="ltx_Math" display="inline" id="id6.5.m5.1"><semantics id="id6.5.m5.1a"><mrow id="id6.5.m5.1.1" xref="id6.5.m5.1.1.cmml"><mtext id="id6.5.m5.1.1.2" xref="id6.5.m5.1.1.2a.cmml">DA-TOP-</mtext><mo id="id6.5.m5.1.1.1" xref="id6.5.m5.1.1.1.cmml">⁢</mo><mi id="id6.5.m5.1.1.3" xref="id6.5.m5.1.1.3.cmml">k</mi></mrow><annotation-xml encoding="MathML-Content" id="id6.5.m5.1b"><apply id="id6.5.m5.1.1.cmml" xref="id6.5.m5.1.1"><times id="id6.5.m5.1.1.1.cmml" xref="id6.5.m5.1.1.1"></times><ci id="id6.5.m5.1.1.2a.cmml" xref="id6.5.m5.1.1.2"><mtext id="id6.5.m5.1.1.2.cmml" xref="id6.5.m5.1.1.2">DA-TOP-</mtext></ci><ci id="id6.5.m5.1.1.3.cmml" xref="id6.5.m5.1.1.3">𝑘</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="id6.5.m5.1c">\textrm{DA-TOP-}k</annotation><annotation encoding="application/x-llamapun" id="id6.5.m5.1d">DA-TOP- italic_k</annotation></semantics></math>: an efficient multi-device approximate top-k operator. We demonstrate that on a one billion parameter model, HiRE applied to both the softmax as well as feedforward layers, achieves almost matching pretraining and downstream accuracy, and speeds up inference latency by <math alttext="1.47\times" class="ltx_math_unparsed" display="inline" id="id7.6.m6.1"><semantics id="id7.6.m6.1a"><mrow id="id7.6.m6.1b"><mn id="id7.6.m6.1.1">1.47</mn><mo id="id7.6.m6.1.2" lspace="0.222em">×</mo></mrow><annotation encoding="application/x-tex" id="id7.6.m6.1c">1.47\times</annotation><annotation encoding="application/x-llamapun" id="id7.6.m6.1d">1.47 ×</annotation></semantics></math> on a single TPUv5e device <cite class="ltx_cite ltx_citemacro_citep">(<a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#bib.bib13" title="">Cloud, </a>)</cite>.
</p>
</div>
<div class="ltx_keywords">Machine Learning, ICML
</div>
<div class="ltx_para" id="p2">
<br class="ltx_break"/>
</div>
<section class="ltx_section" id="S1">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">1 </span>Introduction</h2>
<div class="ltx_para" id="S1.p1">
<p class="ltx_p" id="S1.p1.1">Deploying large language models (LLMs) is almost prohibitively expensive due to cost of running inference on accelerators and also has significant environmental costs. For example, <cite class="ltx_cite ltx_citemacro_citep">(Patterson et al., <a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#bib.bib42" title="">2021</a>)</cite> attribute <math alttext="80-90\%" class="ltx_Math" display="inline" id="S1.p1.1.m1.1"><semantics id="S1.p1.1.m1.1a"><mrow id="S1.p1.1.m1.1.1" xref="S1.p1.1.m1.1.1.cmml"><mn id="S1.p1.1.m1.1.1.2" xref="S1.p1.1.m1.1.1.2.cmml">80</mn><mo id="S1.p1.1.m1.1.1.1" xref="S1.p1.1.m1.1.1.1.cmml">−</mo><mrow id="S1.p1.1.m1.1.1.3" xref="S1.p1.1.m1.1.1.3.cmml"><mn id="S1.p1.1.m1.1.1.3.2" xref="S1.p1.1.m1.1.1.3.2.cmml">90</mn><mo id="S1.p1.1.m1.1.1.3.1" xref="S1.p1.1.m1.1.1.3.1.cmml">%</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S1.p1.1.m1.1b"><apply id="S1.p1.1.m1.1.1.cmml" xref="S1.p1.1.m1.1.1"><minus id="S1.p1.1.m1.1.1.1.cmml" xref="S1.p1.1.m1.1.1.1"></minus><cn id="S1.p1.1.m1.1.1.2.cmml" type="integer" xref="S1.p1.1.m1.1.1.2">80</cn><apply id="S1.p1.1.m1.1.1.3.cmml" xref="S1.p1.1.m1.1.1.3"><csymbol cd="latexml" id="S1.p1.1.m1.1.1.3.1.cmml" xref="S1.p1.1.m1.1.1.3.1">percent</csymbol><cn id="S1.p1.1.m1.1.1.3.2.cmml" type="integer" xref="S1.p1.1.m1.1.1.3.2">90</cn></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S1.p1.1.m1.1c">80-90\%</annotation><annotation encoding="application/x-llamapun" id="S1.p1.1.m1.1d">80 - 90 %</annotation></semantics></math> of the total carbon emissions during the life cycle of an LLM to running inference. </p>
</div>
<div class="ltx_para" id="S1.p2">
<p class="ltx_p" id="S1.p2.1">Latency/cost of generative LLMs is dominated by the autoregressive next-token generation which in-turn is memory-bound on standard accelerators (GPU/TPUs) due to shuttling large matrices from high-bandwidth memory (HBM) to the accelerator cache. Several recent approaches seek to address this challenge by using block parallel decoding <cite class="ltx_cite ltx_citemacro_citep">(Stern et al., <a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#bib.bib52" title="">2018</a>)</cite>, speculative decoding <cite class="ltx_cite ltx_citemacro_citep">(Leviathan et al., <a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#bib.bib30" title="">2023</a>)</cite>, mixture of experts <cite class="ltx_cite ltx_citemacro_citep">(Du et al., <a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#bib.bib17" title="">2022</a>)</cite>, more efficient architectures <cite class="ltx_cite ltx_citemacro_citep">(Gu &amp; Dao, <a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#bib.bib20" title="">2023</a>)</cite> as well as by using classical methods such as distillation <cite class="ltx_cite ltx_citemacro_citep">(Liang et al., <a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#bib.bib33" title="">2021</a>)</cite>.</p>
</div>
<div class="ltx_para" id="S1.p3">
<p class="ltx_p" id="S1.p3.14">Despite these techniques, generative LLM inference is still primarily memory-bound, indicating significant room for latency/cost reduction. Furthermore, for typical input length (e.g. <math alttext="\lessapprox 2000" class="ltx_Math" display="inline" id="S1.p3.1.m1.1"><semantics id="S1.p3.1.m1.1a"><mrow id="S1.p3.1.m1.1.1" xref="S1.p3.1.m1.1.1.cmml"><mi id="S1.p3.1.m1.1.1.2" xref="S1.p3.1.m1.1.1.2.cmml"></mi><mo id="S1.p3.1.m1.1.1.1" xref="S1.p3.1.m1.1.1.cmml">⪅</mo><mn id="S1.p3.1.m1.1.1.3" xref="S1.p3.1.m1.1.1.3.cmml">2000</mn></mrow><annotation-xml encoding="MathML-Content" id="S1.p3.1.m1.1b"><or id="S1.p3.1.m1.1.1.cmml" xref="S1.p3.1.m1.1.1"><apply id="S1.p3.1.m1.1.1a.cmml" xref="S1.p3.1.m1.1.1"><lt id="S1.p3.1.m1.1.1b.cmml" xref="S1.p3.1.m1.1.1"></lt><csymbol cd="latexml" id="S1.p3.1.m1.1.1.2.cmml" xref="S1.p3.1.m1.1.1.2">absent</csymbol><cn id="S1.p3.1.m1.1.1.3.cmml" type="integer" xref="S1.p3.1.m1.1.1.3">2000</cn></apply><apply id="S1.p3.1.m1.1.1c.cmml" xref="S1.p3.1.m1.1.1"><approx id="S1.p3.1.m1.1.1d.cmml" xref="S1.p3.1.m1.1.1"></approx><share href="#S1.p3.1.m1.1.1.2.cmml" id="S1.p3.1.m1.1.1e.cmml" xref="S1.p3.1.m1.1.1"></share><share href="#S1.p3.1.m1.1.1.3.cmml" id="S1.p3.1.m1.1.1f.cmml" xref="S1.p3.1.m1.1.1"></share></apply></or></annotation-xml><annotation encoding="application/x-tex" id="S1.p3.1.m1.1c">\lessapprox 2000</annotation><annotation encoding="application/x-llamapun" id="S1.p3.1.m1.1d">⪅ 2000</annotation></semantics></math>), and even for models with up to one billion parameters, softmax and feedforwad (FFN) layers account for <math alttext="\geq 90\%" class="ltx_Math" display="inline" id="S1.p3.2.m2.1"><semantics id="S1.p3.2.m2.1a"><mrow id="S1.p3.2.m2.1.1" xref="S1.p3.2.m2.1.1.cmml"><mi id="S1.p3.2.m2.1.1.2" xref="S1.p3.2.m2.1.1.2.cmml"></mi><mo id="S1.p3.2.m2.1.1.1" xref="S1.p3.2.m2.1.1.1.cmml">≥</mo><mrow id="S1.p3.2.m2.1.1.3" xref="S1.p3.2.m2.1.1.3.cmml"><mn id="S1.p3.2.m2.1.1.3.2" xref="S1.p3.2.m2.1.1.3.2.cmml">90</mn><mo id="S1.p3.2.m2.1.1.3.1" xref="S1.p3.2.m2.1.1.3.1.cmml">%</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S1.p3.2.m2.1b"><apply id="S1.p3.2.m2.1.1.cmml" xref="S1.p3.2.m2.1.1"><geq id="S1.p3.2.m2.1.1.1.cmml" xref="S1.p3.2.m2.1.1.1"></geq><csymbol cd="latexml" id="S1.p3.2.m2.1.1.2.cmml" xref="S1.p3.2.m2.1.1.2">absent</csymbol><apply id="S1.p3.2.m2.1.1.3.cmml" xref="S1.p3.2.m2.1.1.3"><csymbol cd="latexml" id="S1.p3.2.m2.1.1.3.1.cmml" xref="S1.p3.2.m2.1.1.3.1">percent</csymbol><cn id="S1.p3.2.m2.1.1.3.2.cmml" type="integer" xref="S1.p3.2.m2.1.1.3.2">90</cn></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S1.p3.2.m2.1c">\geq 90\%</annotation><annotation encoding="application/x-llamapun" id="S1.p3.2.m2.1d">≥ 90 %</annotation></semantics></math> of the latency. So in this work, we primarily focus on these two components<span class="ltx_note ltx_role_footnote" id="footnote1"><sup class="ltx_note_mark">1</sup><span class="ltx_note_outer"><span class="ltx_note_content"><sup class="ltx_note_mark">1</sup><span class="ltx_tag ltx_tag_note">1</span>while our ideas are applicable to the attention layer as well, we leave a more detailed investigation of that to future work.</span></span></span>. Multiple recent works show that LLMs have inherent “sparsity” or redundancy which seem to actually grow with larger models. For example, <cite class="ltx_cite ltx_citemacro_citep">(Li et al., <a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#bib.bib32" title="">2022</a>; Mirzadeh et al., <a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#bib.bib38" title="">2023</a>)</cite> show that the feedforward (FFN) layers activations – with ReLU based activation functions – are very sparse. More concretely, for a <math alttext="1" class="ltx_Math" display="inline" id="S1.p3.3.m3.1"><semantics id="S1.p3.3.m3.1a"><mn id="S1.p3.3.m3.1.1" xref="S1.p3.3.m3.1.1.cmml">1</mn><annotation-xml encoding="MathML-Content" id="S1.p3.3.m3.1b"><cn id="S1.p3.3.m3.1.1.cmml" type="integer" xref="S1.p3.3.m3.1.1">1</cn></annotation-xml><annotation encoding="application/x-tex" id="S1.p3.3.m3.1c">1</annotation><annotation encoding="application/x-llamapun" id="S1.p3.3.m3.1d">1</annotation></semantics></math>-hidden layer FFN: <math alttext="\overrightarrow{\mathbf{x}}_{\textrm{out}}=\sum_{j=1}^{m}\phi(\langle%
\overrightarrow{\mathbf{u}}_{j},\overrightarrow{\mathbf{x}}\rangle)%
\overrightarrow{\mathbf{v}}_{j}" class="ltx_Math" display="inline" id="S1.p3.4.m4.2"><semantics id="S1.p3.4.m4.2a"><mrow id="S1.p3.4.m4.2.2" xref="S1.p3.4.m4.2.2.cmml"><msub id="S1.p3.4.m4.2.2.3" xref="S1.p3.4.m4.2.2.3.cmml"><mover accent="true" id="S1.p3.4.m4.2.2.3.2" xref="S1.p3.4.m4.2.2.3.2.cmml"><mi id="S1.p3.4.m4.2.2.3.2.2" xref="S1.p3.4.m4.2.2.3.2.2.cmml">𝐱</mi><mo id="S1.p3.4.m4.2.2.3.2.1" stretchy="false" xref="S1.p3.4.m4.2.2.3.2.1.cmml">→</mo></mover><mtext id="S1.p3.4.m4.2.2.3.3" xref="S1.p3.4.m4.2.2.3.3a.cmml">out</mtext></msub><mo id="S1.p3.4.m4.2.2.2" rspace="0.111em" xref="S1.p3.4.m4.2.2.2.cmml">=</mo><mrow id="S1.p3.4.m4.2.2.1" xref="S1.p3.4.m4.2.2.1.cmml"><msubsup id="S1.p3.4.m4.2.2.1.2" xref="S1.p3.4.m4.2.2.1.2.cmml"><mo id="S1.p3.4.m4.2.2.1.2.2.2" xref="S1.p3.4.m4.2.2.1.2.2.2.cmml">∑</mo><mrow id="S1.p3.4.m4.2.2.1.2.2.3" xref="S1.p3.4.m4.2.2.1.2.2.3.cmml"><mi id="S1.p3.4.m4.2.2.1.2.2.3.2" xref="S1.p3.4.m4.2.2.1.2.2.3.2.cmml">j</mi><mo id="S1.p3.4.m4.2.2.1.2.2.3.1" xref="S1.p3.4.m4.2.2.1.2.2.3.1.cmml">=</mo><mn id="S1.p3.4.m4.2.2.1.2.2.3.3" xref="S1.p3.4.m4.2.2.1.2.2.3.3.cmml">1</mn></mrow><mi id="S1.p3.4.m4.2.2.1.2.3" xref="S1.p3.4.m4.2.2.1.2.3.cmml">m</mi></msubsup><mrow id="S1.p3.4.m4.2.2.1.1" xref="S1.p3.4.m4.2.2.1.1.cmml"><mi id="S1.p3.4.m4.2.2.1.1.3" xref="S1.p3.4.m4.2.2.1.1.3.cmml">ϕ</mi><mo id="S1.p3.4.m4.2.2.1.1.2" xref="S1.p3.4.m4.2.2.1.1.2.cmml">⁢</mo><mrow id="S1.p3.4.m4.2.2.1.1.1.1" xref="S1.p3.4.m4.2.2.1.1.cmml"><mo id="S1.p3.4.m4.2.2.1.1.1.1.2" stretchy="false" xref="S1.p3.4.m4.2.2.1.1.cmml">(</mo><mrow id="S1.p3.4.m4.2.2.1.1.1.1.1.1" xref="S1.p3.4.m4.2.2.1.1.1.1.1.2.cmml"><mo id="S1.p3.4.m4.2.2.1.1.1.1.1.1.2" stretchy="false" xref="S1.p3.4.m4.2.2.1.1.1.1.1.2.cmml">⟨</mo><msub id="S1.p3.4.m4.2.2.1.1.1.1.1.1.1" xref="S1.p3.4.m4.2.2.1.1.1.1.1.1.1.cmml"><mover accent="true" id="S1.p3.4.m4.2.2.1.1.1.1.1.1.1.2" xref="S1.p3.4.m4.2.2.1.1.1.1.1.1.1.2.cmml"><mi id="S1.p3.4.m4.2.2.1.1.1.1.1.1.1.2.2" xref="S1.p3.4.m4.2.2.1.1.1.1.1.1.1.2.2.cmml">𝐮</mi><mo id="S1.p3.4.m4.2.2.1.1.1.1.1.1.1.2.1" stretchy="false" xref="S1.p3.4.m4.2.2.1.1.1.1.1.1.1.2.1.cmml">→</mo></mover><mi id="S1.p3.4.m4.2.2.1.1.1.1.1.1.1.3" xref="S1.p3.4.m4.2.2.1.1.1.1.1.1.1.3.cmml">j</mi></msub><mo id="S1.p3.4.m4.2.2.1.1.1.1.1.1.3" xref="S1.p3.4.m4.2.2.1.1.1.1.1.2.cmml">,</mo><mover accent="true" id="S1.p3.4.m4.1.1" xref="S1.p3.4.m4.1.1.cmml"><mi id="S1.p3.4.m4.1.1.2" xref="S1.p3.4.m4.1.1.2.cmml">𝐱</mi><mo id="S1.p3.4.m4.1.1.1" stretchy="false" xref="S1.p3.4.m4.1.1.1.cmml">→</mo></mover><mo id="S1.p3.4.m4.2.2.1.1.1.1.1.1.4" stretchy="false" xref="S1.p3.4.m4.2.2.1.1.1.1.1.2.cmml">⟩</mo></mrow><mo id="S1.p3.4.m4.2.2.1.1.1.1.3" stretchy="false" xref="S1.p3.4.m4.2.2.1.1.cmml">)</mo></mrow><mo id="S1.p3.4.m4.2.2.1.1.2a" xref="S1.p3.4.m4.2.2.1.1.2.cmml">⁢</mo><msub id="S1.p3.4.m4.2.2.1.1.4" xref="S1.p3.4.m4.2.2.1.1.4.cmml"><mover accent="true" id="S1.p3.4.m4.2.2.1.1.4.2" xref="S1.p3.4.m4.2.2.1.1.4.2.cmml"><mi id="S1.p3.4.m4.2.2.1.1.4.2.2" xref="S1.p3.4.m4.2.2.1.1.4.2.2.cmml">𝐯</mi><mo id="S1.p3.4.m4.2.2.1.1.4.2.1" stretchy="false" xref="S1.p3.4.m4.2.2.1.1.4.2.1.cmml">→</mo></mover><mi id="S1.p3.4.m4.2.2.1.1.4.3" xref="S1.p3.4.m4.2.2.1.1.4.3.cmml">j</mi></msub></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="S1.p3.4.m4.2b"><apply id="S1.p3.4.m4.2.2.cmml" xref="S1.p3.4.m4.2.2"><eq id="S1.p3.4.m4.2.2.2.cmml" xref="S1.p3.4.m4.2.2.2"></eq><apply id="S1.p3.4.m4.2.2.3.cmml" xref="S1.p3.4.m4.2.2.3"><csymbol cd="ambiguous" id="S1.p3.4.m4.2.2.3.1.cmml" xref="S1.p3.4.m4.2.2.3">subscript</csymbol><apply id="S1.p3.4.m4.2.2.3.2.cmml" xref="S1.p3.4.m4.2.2.3.2"><ci id="S1.p3.4.m4.2.2.3.2.1.cmml" xref="S1.p3.4.m4.2.2.3.2.1">→</ci><ci id="S1.p3.4.m4.2.2.3.2.2.cmml" xref="S1.p3.4.m4.2.2.3.2.2">𝐱</ci></apply><ci id="S1.p3.4.m4.2.2.3.3a.cmml" xref="S1.p3.4.m4.2.2.3.3"><mtext id="S1.p3.4.m4.2.2.3.3.cmml" mathsize="70%" xref="S1.p3.4.m4.2.2.3.3">out</mtext></ci></apply><apply id="S1.p3.4.m4.2.2.1.cmml" xref="S1.p3.4.m4.2.2.1"><apply id="S1.p3.4.m4.2.2.1.2.cmml" xref="S1.p3.4.m4.2.2.1.2"><csymbol cd="ambiguous" id="S1.p3.4.m4.2.2.1.2.1.cmml" xref="S1.p3.4.m4.2.2.1.2">superscript</csymbol><apply id="S1.p3.4.m4.2.2.1.2.2.cmml" xref="S1.p3.4.m4.2.2.1.2"><csymbol cd="ambiguous" id="S1.p3.4.m4.2.2.1.2.2.1.cmml" xref="S1.p3.4.m4.2.2.1.2">subscript</csymbol><sum id="S1.p3.4.m4.2.2.1.2.2.2.cmml" xref="S1.p3.4.m4.2.2.1.2.2.2"></sum><apply id="S1.p3.4.m4.2.2.1.2.2.3.cmml" xref="S1.p3.4.m4.2.2.1.2.2.3"><eq id="S1.p3.4.m4.2.2.1.2.2.3.1.cmml" xref="S1.p3.4.m4.2.2.1.2.2.3.1"></eq><ci id="S1.p3.4.m4.2.2.1.2.2.3.2.cmml" xref="S1.p3.4.m4.2.2.1.2.2.3.2">𝑗</ci><cn id="S1.p3.4.m4.2.2.1.2.2.3.3.cmml" type="integer" xref="S1.p3.4.m4.2.2.1.2.2.3.3">1</cn></apply></apply><ci id="S1.p3.4.m4.2.2.1.2.3.cmml" xref="S1.p3.4.m4.2.2.1.2.3">𝑚</ci></apply><apply id="S1.p3.4.m4.2.2.1.1.cmml" xref="S1.p3.4.m4.2.2.1.1"><times id="S1.p3.4.m4.2.2.1.1.2.cmml" xref="S1.p3.4.m4.2.2.1.1.2"></times><ci id="S1.p3.4.m4.2.2.1.1.3.cmml" xref="S1.p3.4.m4.2.2.1.1.3">italic-ϕ</ci><list id="S1.p3.4.m4.2.2.1.1.1.1.1.2.cmml" xref="S1.p3.4.m4.2.2.1.1.1.1.1.1"><apply id="S1.p3.4.m4.2.2.1.1.1.1.1.1.1.cmml" xref="S1.p3.4.m4.2.2.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S1.p3.4.m4.2.2.1.1.1.1.1.1.1.1.cmml" xref="S1.p3.4.m4.2.2.1.1.1.1.1.1.1">subscript</csymbol><apply id="S1.p3.4.m4.2.2.1.1.1.1.1.1.1.2.cmml" xref="S1.p3.4.m4.2.2.1.1.1.1.1.1.1.2"><ci id="S1.p3.4.m4.2.2.1.1.1.1.1.1.1.2.1.cmml" xref="S1.p3.4.m4.2.2.1.1.1.1.1.1.1.2.1">→</ci><ci id="S1.p3.4.m4.2.2.1.1.1.1.1.1.1.2.2.cmml" xref="S1.p3.4.m4.2.2.1.1.1.1.1.1.1.2.2">𝐮</ci></apply><ci id="S1.p3.4.m4.2.2.1.1.1.1.1.1.1.3.cmml" xref="S1.p3.4.m4.2.2.1.1.1.1.1.1.1.3">𝑗</ci></apply><apply id="S1.p3.4.m4.1.1.cmml" xref="S1.p3.4.m4.1.1"><ci id="S1.p3.4.m4.1.1.1.cmml" xref="S1.p3.4.m4.1.1.1">→</ci><ci id="S1.p3.4.m4.1.1.2.cmml" xref="S1.p3.4.m4.1.1.2">𝐱</ci></apply></list><apply id="S1.p3.4.m4.2.2.1.1.4.cmml" xref="S1.p3.4.m4.2.2.1.1.4"><csymbol cd="ambiguous" id="S1.p3.4.m4.2.2.1.1.4.1.cmml" xref="S1.p3.4.m4.2.2.1.1.4">subscript</csymbol><apply id="S1.p3.4.m4.2.2.1.1.4.2.cmml" xref="S1.p3.4.m4.2.2.1.1.4.2"><ci id="S1.p3.4.m4.2.2.1.1.4.2.1.cmml" xref="S1.p3.4.m4.2.2.1.1.4.2.1">→</ci><ci id="S1.p3.4.m4.2.2.1.1.4.2.2.cmml" xref="S1.p3.4.m4.2.2.1.1.4.2.2">𝐯</ci></apply><ci id="S1.p3.4.m4.2.2.1.1.4.3.cmml" xref="S1.p3.4.m4.2.2.1.1.4.3">𝑗</ci></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S1.p3.4.m4.2c">\overrightarrow{\mathbf{x}}_{\textrm{out}}=\sum_{j=1}^{m}\phi(\langle%
\overrightarrow{\mathbf{u}}_{j},\overrightarrow{\mathbf{x}}\rangle)%
\overrightarrow{\mathbf{v}}_{j}</annotation><annotation encoding="application/x-llamapun" id="S1.p3.4.m4.2d">over→ start_ARG bold_x end_ARG start_POSTSUBSCRIPT out end_POSTSUBSCRIPT = ∑ start_POSTSUBSCRIPT italic_j = 1 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_m end_POSTSUPERSCRIPT italic_ϕ ( ⟨ over→ start_ARG bold_u end_ARG start_POSTSUBSCRIPT italic_j end_POSTSUBSCRIPT , over→ start_ARG bold_x end_ARG ⟩ ) over→ start_ARG bold_v end_ARG start_POSTSUBSCRIPT italic_j end_POSTSUBSCRIPT</annotation></semantics></math> with input <math alttext="\overrightarrow{\mathbf{x}}_{\textrm{in}}" class="ltx_Math" display="inline" id="S1.p3.5.m5.1"><semantics id="S1.p3.5.m5.1a"><msub id="S1.p3.5.m5.1.1" xref="S1.p3.5.m5.1.1.cmml"><mover accent="true" id="S1.p3.5.m5.1.1.2" xref="S1.p3.5.m5.1.1.2.cmml"><mi id="S1.p3.5.m5.1.1.2.2" xref="S1.p3.5.m5.1.1.2.2.cmml">𝐱</mi><mo id="S1.p3.5.m5.1.1.2.1" stretchy="false" xref="S1.p3.5.m5.1.1.2.1.cmml">→</mo></mover><mtext id="S1.p3.5.m5.1.1.3" xref="S1.p3.5.m5.1.1.3a.cmml">in</mtext></msub><annotation-xml encoding="MathML-Content" id="S1.p3.5.m5.1b"><apply id="S1.p3.5.m5.1.1.cmml" xref="S1.p3.5.m5.1.1"><csymbol cd="ambiguous" id="S1.p3.5.m5.1.1.1.cmml" xref="S1.p3.5.m5.1.1">subscript</csymbol><apply id="S1.p3.5.m5.1.1.2.cmml" xref="S1.p3.5.m5.1.1.2"><ci id="S1.p3.5.m5.1.1.2.1.cmml" xref="S1.p3.5.m5.1.1.2.1">→</ci><ci id="S1.p3.5.m5.1.1.2.2.cmml" xref="S1.p3.5.m5.1.1.2.2">𝐱</ci></apply><ci id="S1.p3.5.m5.1.1.3a.cmml" xref="S1.p3.5.m5.1.1.3"><mtext id="S1.p3.5.m5.1.1.3.cmml" mathsize="70%" xref="S1.p3.5.m5.1.1.3">in</mtext></ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S1.p3.5.m5.1c">\overrightarrow{\mathbf{x}}_{\textrm{in}}</annotation><annotation encoding="application/x-llamapun" id="S1.p3.5.m5.1d">over→ start_ARG bold_x end_ARG start_POSTSUBSCRIPT in end_POSTSUBSCRIPT</annotation></semantics></math>, output <math alttext="\overrightarrow{\mathbf{x}}_{\textrm{out}}" class="ltx_Math" display="inline" id="S1.p3.6.m6.1"><semantics id="S1.p3.6.m6.1a"><msub id="S1.p3.6.m6.1.1" xref="S1.p3.6.m6.1.1.cmml"><mover accent="true" id="S1.p3.6.m6.1.1.2" xref="S1.p3.6.m6.1.1.2.cmml"><mi id="S1.p3.6.m6.1.1.2.2" xref="S1.p3.6.m6.1.1.2.2.cmml">𝐱</mi><mo id="S1.p3.6.m6.1.1.2.1" stretchy="false" xref="S1.p3.6.m6.1.1.2.1.cmml">→</mo></mover><mtext id="S1.p3.6.m6.1.1.3" xref="S1.p3.6.m6.1.1.3a.cmml">out</mtext></msub><annotation-xml encoding="MathML-Content" id="S1.p3.6.m6.1b"><apply id="S1.p3.6.m6.1.1.cmml" xref="S1.p3.6.m6.1.1"><csymbol cd="ambiguous" id="S1.p3.6.m6.1.1.1.cmml" xref="S1.p3.6.m6.1.1">subscript</csymbol><apply id="S1.p3.6.m6.1.1.2.cmml" xref="S1.p3.6.m6.1.1.2"><ci id="S1.p3.6.m6.1.1.2.1.cmml" xref="S1.p3.6.m6.1.1.2.1">→</ci><ci id="S1.p3.6.m6.1.1.2.2.cmml" xref="S1.p3.6.m6.1.1.2.2">𝐱</ci></apply><ci id="S1.p3.6.m6.1.1.3a.cmml" xref="S1.p3.6.m6.1.1.3"><mtext id="S1.p3.6.m6.1.1.3.cmml" mathsize="70%" xref="S1.p3.6.m6.1.1.3">out</mtext></ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S1.p3.6.m6.1c">\overrightarrow{\mathbf{x}}_{\textrm{out}}</annotation><annotation encoding="application/x-llamapun" id="S1.p3.6.m6.1d">over→ start_ARG bold_x end_ARG start_POSTSUBSCRIPT out end_POSTSUBSCRIPT</annotation></semantics></math>, <math alttext="\phi(\cdot)" class="ltx_Math" display="inline" id="S1.p3.7.m7.1"><semantics id="S1.p3.7.m7.1a"><mrow id="S1.p3.7.m7.1.2" xref="S1.p3.7.m7.1.2.cmml"><mi id="S1.p3.7.m7.1.2.2" xref="S1.p3.7.m7.1.2.2.cmml">ϕ</mi><mo id="S1.p3.7.m7.1.2.1" xref="S1.p3.7.m7.1.2.1.cmml">⁢</mo><mrow id="S1.p3.7.m7.1.2.3.2" xref="S1.p3.7.m7.1.2.cmml"><mo id="S1.p3.7.m7.1.2.3.2.1" stretchy="false" xref="S1.p3.7.m7.1.2.cmml">(</mo><mo id="S1.p3.7.m7.1.1" lspace="0em" rspace="0em" xref="S1.p3.7.m7.1.1.cmml">⋅</mo><mo id="S1.p3.7.m7.1.2.3.2.2" stretchy="false" xref="S1.p3.7.m7.1.2.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S1.p3.7.m7.1b"><apply id="S1.p3.7.m7.1.2.cmml" xref="S1.p3.7.m7.1.2"><times id="S1.p3.7.m7.1.2.1.cmml" xref="S1.p3.7.m7.1.2.1"></times><ci id="S1.p3.7.m7.1.2.2.cmml" xref="S1.p3.7.m7.1.2.2">italic-ϕ</ci><ci id="S1.p3.7.m7.1.1.cmml" xref="S1.p3.7.m7.1.1">⋅</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S1.p3.7.m7.1c">\phi(\cdot)</annotation><annotation encoding="application/x-llamapun" id="S1.p3.7.m7.1d">italic_ϕ ( ⋅ )</annotation></semantics></math> a ReLU based activation function and <math alttext="\overrightarrow{\mathbf{u}}_{j}" class="ltx_Math" display="inline" id="S1.p3.8.m8.1"><semantics id="S1.p3.8.m8.1a"><msub id="S1.p3.8.m8.1.1" xref="S1.p3.8.m8.1.1.cmml"><mover accent="true" id="S1.p3.8.m8.1.1.2" xref="S1.p3.8.m8.1.1.2.cmml"><mi id="S1.p3.8.m8.1.1.2.2" xref="S1.p3.8.m8.1.1.2.2.cmml">𝐮</mi><mo id="S1.p3.8.m8.1.1.2.1" stretchy="false" xref="S1.p3.8.m8.1.1.2.1.cmml">→</mo></mover><mi id="S1.p3.8.m8.1.1.3" xref="S1.p3.8.m8.1.1.3.cmml">j</mi></msub><annotation-xml encoding="MathML-Content" id="S1.p3.8.m8.1b"><apply id="S1.p3.8.m8.1.1.cmml" xref="S1.p3.8.m8.1.1"><csymbol cd="ambiguous" id="S1.p3.8.m8.1.1.1.cmml" xref="S1.p3.8.m8.1.1">subscript</csymbol><apply id="S1.p3.8.m8.1.1.2.cmml" xref="S1.p3.8.m8.1.1.2"><ci id="S1.p3.8.m8.1.1.2.1.cmml" xref="S1.p3.8.m8.1.1.2.1">→</ci><ci id="S1.p3.8.m8.1.1.2.2.cmml" xref="S1.p3.8.m8.1.1.2.2">𝐮</ci></apply><ci id="S1.p3.8.m8.1.1.3.cmml" xref="S1.p3.8.m8.1.1.3">𝑗</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S1.p3.8.m8.1c">\overrightarrow{\mathbf{u}}_{j}</annotation><annotation encoding="application/x-llamapun" id="S1.p3.8.m8.1d">over→ start_ARG bold_u end_ARG start_POSTSUBSCRIPT italic_j end_POSTSUBSCRIPT</annotation></semantics></math> and <math alttext="\overrightarrow{\mathbf{v}}_{j}" class="ltx_Math" display="inline" id="S1.p3.9.m9.1"><semantics id="S1.p3.9.m9.1a"><msub id="S1.p3.9.m9.1.1" xref="S1.p3.9.m9.1.1.cmml"><mover accent="true" id="S1.p3.9.m9.1.1.2" xref="S1.p3.9.m9.1.1.2.cmml"><mi id="S1.p3.9.m9.1.1.2.2" xref="S1.p3.9.m9.1.1.2.2.cmml">𝐯</mi><mo id="S1.p3.9.m9.1.1.2.1" stretchy="false" xref="S1.p3.9.m9.1.1.2.1.cmml">→</mo></mover><mi id="S1.p3.9.m9.1.1.3" xref="S1.p3.9.m9.1.1.3.cmml">j</mi></msub><annotation-xml encoding="MathML-Content" id="S1.p3.9.m9.1b"><apply id="S1.p3.9.m9.1.1.cmml" xref="S1.p3.9.m9.1.1"><csymbol cd="ambiguous" id="S1.p3.9.m9.1.1.1.cmml" xref="S1.p3.9.m9.1.1">subscript</csymbol><apply id="S1.p3.9.m9.1.1.2.cmml" xref="S1.p3.9.m9.1.1.2"><ci id="S1.p3.9.m9.1.1.2.1.cmml" xref="S1.p3.9.m9.1.1.2.1">→</ci><ci id="S1.p3.9.m9.1.1.2.2.cmml" xref="S1.p3.9.m9.1.1.2.2">𝐯</ci></apply><ci id="S1.p3.9.m9.1.1.3.cmml" xref="S1.p3.9.m9.1.1.3">𝑗</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S1.p3.9.m9.1c">\overrightarrow{\mathbf{v}}_{j}</annotation><annotation encoding="application/x-llamapun" id="S1.p3.9.m9.1d">over→ start_ARG bold_v end_ARG start_POSTSUBSCRIPT italic_j end_POSTSUBSCRIPT</annotation></semantics></math> being the first and second layer weights of the FFN respectively, for any input <math alttext="\overrightarrow{\mathbf{x}}_{\textrm{in}}" class="ltx_Math" display="inline" id="S1.p3.10.m10.1"><semantics id="S1.p3.10.m10.1a"><msub id="S1.p3.10.m10.1.1" xref="S1.p3.10.m10.1.1.cmml"><mover accent="true" id="S1.p3.10.m10.1.1.2" xref="S1.p3.10.m10.1.1.2.cmml"><mi id="S1.p3.10.m10.1.1.2.2" xref="S1.p3.10.m10.1.1.2.2.cmml">𝐱</mi><mo id="S1.p3.10.m10.1.1.2.1" stretchy="false" xref="S1.p3.10.m10.1.1.2.1.cmml">→</mo></mover><mtext id="S1.p3.10.m10.1.1.3" xref="S1.p3.10.m10.1.1.3a.cmml">in</mtext></msub><annotation-xml encoding="MathML-Content" id="S1.p3.10.m10.1b"><apply id="S1.p3.10.m10.1.1.cmml" xref="S1.p3.10.m10.1.1"><csymbol cd="ambiguous" id="S1.p3.10.m10.1.1.1.cmml" xref="S1.p3.10.m10.1.1">subscript</csymbol><apply id="S1.p3.10.m10.1.1.2.cmml" xref="S1.p3.10.m10.1.1.2"><ci id="S1.p3.10.m10.1.1.2.1.cmml" xref="S1.p3.10.m10.1.1.2.1">→</ci><ci id="S1.p3.10.m10.1.1.2.2.cmml" xref="S1.p3.10.m10.1.1.2.2">𝐱</ci></apply><ci id="S1.p3.10.m10.1.1.3a.cmml" xref="S1.p3.10.m10.1.1.3"><mtext id="S1.p3.10.m10.1.1.3.cmml" mathsize="70%" xref="S1.p3.10.m10.1.1.3">in</mtext></ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S1.p3.10.m10.1c">\overrightarrow{\mathbf{x}}_{\textrm{in}}</annotation><annotation encoding="application/x-llamapun" id="S1.p3.10.m10.1d">over→ start_ARG bold_x end_ARG start_POSTSUBSCRIPT in end_POSTSUBSCRIPT</annotation></semantics></math>, only a small fraction of weight vectors <math alttext="\overrightarrow{\mathbf{u}}_{j}" class="ltx_Math" display="inline" id="S1.p3.11.m11.1"><semantics id="S1.p3.11.m11.1a"><msub id="S1.p3.11.m11.1.1" xref="S1.p3.11.m11.1.1.cmml"><mover accent="true" id="S1.p3.11.m11.1.1.2" xref="S1.p3.11.m11.1.1.2.cmml"><mi id="S1.p3.11.m11.1.1.2.2" xref="S1.p3.11.m11.1.1.2.2.cmml">𝐮</mi><mo id="S1.p3.11.m11.1.1.2.1" stretchy="false" xref="S1.p3.11.m11.1.1.2.1.cmml">→</mo></mover><mi id="S1.p3.11.m11.1.1.3" xref="S1.p3.11.m11.1.1.3.cmml">j</mi></msub><annotation-xml encoding="MathML-Content" id="S1.p3.11.m11.1b"><apply id="S1.p3.11.m11.1.1.cmml" xref="S1.p3.11.m11.1.1"><csymbol cd="ambiguous" id="S1.p3.11.m11.1.1.1.cmml" xref="S1.p3.11.m11.1.1">subscript</csymbol><apply id="S1.p3.11.m11.1.1.2.cmml" xref="S1.p3.11.m11.1.1.2"><ci id="S1.p3.11.m11.1.1.2.1.cmml" xref="S1.p3.11.m11.1.1.2.1">→</ci><ci id="S1.p3.11.m11.1.1.2.2.cmml" xref="S1.p3.11.m11.1.1.2.2">𝐮</ci></apply><ci id="S1.p3.11.m11.1.1.3.cmml" xref="S1.p3.11.m11.1.1.3">𝑗</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S1.p3.11.m11.1c">\overrightarrow{\mathbf{u}}_{j}</annotation><annotation encoding="application/x-llamapun" id="S1.p3.11.m11.1d">over→ start_ARG bold_u end_ARG start_POSTSUBSCRIPT italic_j end_POSTSUBSCRIPT</annotation></semantics></math> have <math alttext="\phi(\langle\overrightarrow{\mathbf{u}}_{j},\overrightarrow{\mathbf{x}}\rangle%
)\neq 0" class="ltx_Math" display="inline" id="S1.p3.12.m12.2"><semantics id="S1.p3.12.m12.2a"><mrow id="S1.p3.12.m12.2.2" xref="S1.p3.12.m12.2.2.cmml"><mrow id="S1.p3.12.m12.2.2.1" xref="S1.p3.12.m12.2.2.1.cmml"><mi id="S1.p3.12.m12.2.2.1.3" xref="S1.p3.12.m12.2.2.1.3.cmml">ϕ</mi><mo id="S1.p3.12.m12.2.2.1.2" xref="S1.p3.12.m12.2.2.1.2.cmml">⁢</mo><mrow id="S1.p3.12.m12.2.2.1.1.1" xref="S1.p3.12.m12.2.2.1.cmml"><mo id="S1.p3.12.m12.2.2.1.1.1.2" stretchy="false" xref="S1.p3.12.m12.2.2.1.cmml">(</mo><mrow id="S1.p3.12.m12.2.2.1.1.1.1.1" xref="S1.p3.12.m12.2.2.1.1.1.1.2.cmml"><mo id="S1.p3.12.m12.2.2.1.1.1.1.1.2" stretchy="false" xref="S1.p3.12.m12.2.2.1.1.1.1.2.cmml">⟨</mo><msub id="S1.p3.12.m12.2.2.1.1.1.1.1.1" xref="S1.p3.12.m12.2.2.1.1.1.1.1.1.cmml"><mover accent="true" id="S1.p3.12.m12.2.2.1.1.1.1.1.1.2" xref="S1.p3.12.m12.2.2.1.1.1.1.1.1.2.cmml"><mi id="S1.p3.12.m12.2.2.1.1.1.1.1.1.2.2" xref="S1.p3.12.m12.2.2.1.1.1.1.1.1.2.2.cmml">𝐮</mi><mo id="S1.p3.12.m12.2.2.1.1.1.1.1.1.2.1" stretchy="false" xref="S1.p3.12.m12.2.2.1.1.1.1.1.1.2.1.cmml">→</mo></mover><mi id="S1.p3.12.m12.2.2.1.1.1.1.1.1.3" xref="S1.p3.12.m12.2.2.1.1.1.1.1.1.3.cmml">j</mi></msub><mo id="S1.p3.12.m12.2.2.1.1.1.1.1.3" xref="S1.p3.12.m12.2.2.1.1.1.1.2.cmml">,</mo><mover accent="true" id="S1.p3.12.m12.1.1" xref="S1.p3.12.m12.1.1.cmml"><mi id="S1.p3.12.m12.1.1.2" xref="S1.p3.12.m12.1.1.2.cmml">𝐱</mi><mo id="S1.p3.12.m12.1.1.1" stretchy="false" xref="S1.p3.12.m12.1.1.1.cmml">→</mo></mover><mo id="S1.p3.12.m12.2.2.1.1.1.1.1.4" stretchy="false" xref="S1.p3.12.m12.2.2.1.1.1.1.2.cmml">⟩</mo></mrow><mo id="S1.p3.12.m12.2.2.1.1.1.3" stretchy="false" xref="S1.p3.12.m12.2.2.1.cmml">)</mo></mrow></mrow><mo id="S1.p3.12.m12.2.2.2" xref="S1.p3.12.m12.2.2.2.cmml">≠</mo><mn id="S1.p3.12.m12.2.2.3" xref="S1.p3.12.m12.2.2.3.cmml">0</mn></mrow><annotation-xml encoding="MathML-Content" id="S1.p3.12.m12.2b"><apply id="S1.p3.12.m12.2.2.cmml" xref="S1.p3.12.m12.2.2"><neq id="S1.p3.12.m12.2.2.2.cmml" xref="S1.p3.12.m12.2.2.2"></neq><apply id="S1.p3.12.m12.2.2.1.cmml" xref="S1.p3.12.m12.2.2.1"><times id="S1.p3.12.m12.2.2.1.2.cmml" xref="S1.p3.12.m12.2.2.1.2"></times><ci id="S1.p3.12.m12.2.2.1.3.cmml" xref="S1.p3.12.m12.2.2.1.3">italic-ϕ</ci><list id="S1.p3.12.m12.2.2.1.1.1.1.2.cmml" xref="S1.p3.12.m12.2.2.1.1.1.1.1"><apply id="S1.p3.12.m12.2.2.1.1.1.1.1.1.cmml" xref="S1.p3.12.m12.2.2.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S1.p3.12.m12.2.2.1.1.1.1.1.1.1.cmml" xref="S1.p3.12.m12.2.2.1.1.1.1.1.1">subscript</csymbol><apply id="S1.p3.12.m12.2.2.1.1.1.1.1.1.2.cmml" xref="S1.p3.12.m12.2.2.1.1.1.1.1.1.2"><ci id="S1.p3.12.m12.2.2.1.1.1.1.1.1.2.1.cmml" xref="S1.p3.12.m12.2.2.1.1.1.1.1.1.2.1">→</ci><ci id="S1.p3.12.m12.2.2.1.1.1.1.1.1.2.2.cmml" xref="S1.p3.12.m12.2.2.1.1.1.1.1.1.2.2">𝐮</ci></apply><ci id="S1.p3.12.m12.2.2.1.1.1.1.1.1.3.cmml" xref="S1.p3.12.m12.2.2.1.1.1.1.1.1.3">𝑗</ci></apply><apply id="S1.p3.12.m12.1.1.cmml" xref="S1.p3.12.m12.1.1"><ci id="S1.p3.12.m12.1.1.1.cmml" xref="S1.p3.12.m12.1.1.1">→</ci><ci id="S1.p3.12.m12.1.1.2.cmml" xref="S1.p3.12.m12.1.1.2">𝐱</ci></apply></list></apply><cn id="S1.p3.12.m12.2.2.3.cmml" type="integer" xref="S1.p3.12.m12.2.2.3">0</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S1.p3.12.m12.2c">\phi(\langle\overrightarrow{\mathbf{u}}_{j},\overrightarrow{\mathbf{x}}\rangle%
)\neq 0</annotation><annotation encoding="application/x-llamapun" id="S1.p3.12.m12.2d">italic_ϕ ( ⟨ over→ start_ARG bold_u end_ARG start_POSTSUBSCRIPT italic_j end_POSTSUBSCRIPT , over→ start_ARG bold_x end_ARG ⟩ ) ≠ 0</annotation></semantics></math>. In fact, the sparsity level can be further enhanced (<math alttext="\lessapprox 5\%" class="ltx_Math" display="inline" id="S1.p3.13.m13.1"><semantics id="S1.p3.13.m13.1a"><mrow id="S1.p3.13.m13.1.1" xref="S1.p3.13.m13.1.1.cmml"><mi id="S1.p3.13.m13.1.1.2" xref="S1.p3.13.m13.1.1.2.cmml"></mi><mo id="S1.p3.13.m13.1.1.1" xref="S1.p3.13.m13.1.1.cmml">⪅</mo><mrow id="S1.p3.13.m13.1.1.3" xref="S1.p3.13.m13.1.1.3.cmml"><mn id="S1.p3.13.m13.1.1.3.2" xref="S1.p3.13.m13.1.1.3.2.cmml">5</mn><mo id="S1.p3.13.m13.1.1.3.1" xref="S1.p3.13.m13.1.1.3.1.cmml">%</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S1.p3.13.m13.1b"><or id="S1.p3.13.m13.1.1.cmml" xref="S1.p3.13.m13.1.1"><apply id="S1.p3.13.m13.1.1a.cmml" xref="S1.p3.13.m13.1.1"><lt id="S1.p3.13.m13.1.1b.cmml" xref="S1.p3.13.m13.1.1"></lt><csymbol cd="latexml" id="S1.p3.13.m13.1.1.2.cmml" xref="S1.p3.13.m13.1.1.2">absent</csymbol><apply id="S1.p3.13.m13.1.1.3.cmml" xref="S1.p3.13.m13.1.1.3"><csymbol cd="latexml" id="S1.p3.13.m13.1.1.3.1.cmml" xref="S1.p3.13.m13.1.1.3.1">percent</csymbol><cn id="S1.p3.13.m13.1.1.3.2.cmml" type="integer" xref="S1.p3.13.m13.1.1.3.2">5</cn></apply></apply><apply id="S1.p3.13.m13.1.1c.cmml" xref="S1.p3.13.m13.1.1"><approx id="S1.p3.13.m13.1.1d.cmml" xref="S1.p3.13.m13.1.1"></approx><share href="#S1.p3.13.m13.1.1.2.cmml" id="S1.p3.13.m13.1.1e.cmml" xref="S1.p3.13.m13.1.1"></share><share href="#S1.p3.13.m13.1.1.3.cmml" id="S1.p3.13.m13.1.1f.cmml" xref="S1.p3.13.m13.1.1"></share></apply></or></annotation-xml><annotation encoding="application/x-tex" id="S1.p3.13.m13.1c">\lessapprox 5\%</annotation><annotation encoding="application/x-llamapun" id="S1.p3.13.m13.1d">⪅ 5 %</annotation></semantics></math> non-zeros) by using explicit top-<math alttext="k" class="ltx_Math" display="inline" id="S1.p3.14.m14.1"><semantics id="S1.p3.14.m14.1a"><mi id="S1.p3.14.m14.1.1" xref="S1.p3.14.m14.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="S1.p3.14.m14.1b"><ci id="S1.p3.14.m14.1.1.cmml" xref="S1.p3.14.m14.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="S1.p3.14.m14.1c">k</annotation><annotation encoding="application/x-llamapun" id="S1.p3.14.m14.1d">italic_k</annotation></semantics></math> procedure in the FFN layer computation during training. Similarly, softmax layers usually need to focus only on tokens corresponding to the highest magnitude outputs (logits).</p>
</div>
<div class="ltx_para" id="S1.p4">
<p class="ltx_p" id="S1.p4.1">This raises the following question that we seek to answer: <span class="ltx_text ltx_font_italic" id="S1.p4.1.1">can we compute top elements of softmax output and/or FFN activations efficiently (on accelerators) and accurately?</span> </p>
</div>
<div class="ltx_para" id="S1.p5">
<p class="ltx_p" id="S1.p5.1"><span class="ltx_text ltx_font_bold" id="S1.p5.1.1">Challenges with top-k computation in softmax/FFN</span>: Firstly, the top-k elements can be input dependent, so the challenge is to estimate top elements without fully evaluating the softmax/FFN layer. Second, even after estimating the top elements’ coordinates, it is challenging to gather the top elements efficiently on standard accelerators (GPUs/TPUs). </p>
</div>
<div class="ltx_para" id="S1.p6">
<p class="ltx_p" id="S1.p6.1"><span class="ltx_text ltx_font_bold" id="S1.p6.1.1">Contributions</span>: In this work, we propose ideas to overcome these challenges and show that they substantially improve the inference latency of autoregressive LLMs.</p>
</div>
<div class="ltx_para" id="S1.p7">
<p class="ltx_p" id="S1.p7.4"><span class="ltx_text ltx_font_bold" id="S1.p7.1.1">Estimating top-<math alttext="k" class="ltx_Math" display="inline" id="S1.p7.1.1.m1.1"><semantics id="S1.p7.1.1.m1.1a"><mi id="S1.p7.1.1.m1.1.1" xref="S1.p7.1.1.m1.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="S1.p7.1.1.m1.1b"><ci id="S1.p7.1.1.m1.1.1.cmml" xref="S1.p7.1.1.m1.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="S1.p7.1.1.m1.1c">k</annotation><annotation encoding="application/x-llamapun" id="S1.p7.1.1.m1.1d">italic_k</annotation></semantics></math> elements efficiently</span>: We propose using an <span class="ltx_text ltx_font_bold" id="S1.p7.4.2">approximate</span> but <span class="ltx_text ltx_font_bold" id="S1.p7.4.3">high recall</span> procedure to estimate the indices of top-<math alttext="k" class="ltx_Math" display="inline" id="S1.p7.2.m1.1"><semantics id="S1.p7.2.m1.1a"><mi id="S1.p7.2.m1.1.1" xref="S1.p7.2.m1.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="S1.p7.2.m1.1b"><ci id="S1.p7.2.m1.1.1.cmml" xref="S1.p7.2.m1.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="S1.p7.2.m1.1c">k</annotation><annotation encoding="application/x-llamapun" id="S1.p7.2.m1.1d">italic_k</annotation></semantics></math> outputs of FFN/softmax layers. In particular, we employ a smaller dimensional/low rank projection as well as aggressive quantization for doing this approximate estimation, but the framework is more general. While there are a few recent works <cite class="ltx_cite ltx_citemacro_citep">(Liu et al., <a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#bib.bib35" title="">2023</a>; Csordás et al., <a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#bib.bib14" title="">2023</a>; Alizadeh et al., <a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#bib.bib2" title="">2023</a>)</cite> which employ an approximate top-<math alttext="k" class="ltx_Math" display="inline" id="S1.p7.3.m2.1"><semantics id="S1.p7.3.m2.1a"><mi id="S1.p7.3.m2.1.1" xref="S1.p7.3.m2.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="S1.p7.3.m2.1b"><ci id="S1.p7.3.m2.1.1.cmml" xref="S1.p7.3.m2.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="S1.p7.3.m2.1c">k</annotation><annotation encoding="application/x-llamapun" id="S1.p7.3.m2.1d">italic_k</annotation></semantics></math> estimation procedure, they suffer a loss in performance due to the approximation. One of our key ideas is to identify that if this approximate procedure has <em class="ltx_emph ltx_font_italic" id="S1.p7.4.4">high recall</em>, then following it by exact computation on the predicted set can regain the lost performance. We call this approach HiRE, standing for <span class="ltx_text ltx_font_bold" id="S1.p7.4.5">Hi</span>gh <span class="ltx_text ltx_font_bold" id="S1.p7.4.6">R</span>ecall Approximate Top-<math alttext="k" class="ltx_Math" display="inline" id="S1.p7.4.m3.1"><semantics id="S1.p7.4.m3.1a"><mi id="S1.p7.4.m3.1.1" xref="S1.p7.4.m3.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="S1.p7.4.m3.1b"><ci id="S1.p7.4.m3.1.1.cmml" xref="S1.p7.4.m3.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="S1.p7.4.m3.1c">k</annotation><annotation encoding="application/x-llamapun" id="S1.p7.4.m3.1d">italic_k</annotation></semantics></math> <span class="ltx_text ltx_font_bold" id="S1.p7.4.7">E</span>stimation.</p>
</div>
<div class="ltx_para" id="S1.p8">
<p class="ltx_p" id="S1.p8.8"><span class="ltx_text ltx_font_bold" id="S1.p8.1.1">Distributed approximate top-<math alttext="k" class="ltx_Math" display="inline" id="S1.p8.1.1.m1.1"><semantics id="S1.p8.1.1.m1.1a"><mi id="S1.p8.1.1.m1.1.1" xref="S1.p8.1.1.m1.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="S1.p8.1.1.m1.1b"><ci id="S1.p8.1.1.m1.1.1.cmml" xref="S1.p8.1.1.m1.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="S1.p8.1.1.m1.1c">k</annotation><annotation encoding="application/x-llamapun" id="S1.p8.1.1.m1.1d">italic_k</annotation></semantics></math> (</span>DA-TOP-<span class="ltx_text ltx_font_bold" id="S1.p8.8.3">k)</span>: Due to the size of LLMs, even during inference, the models are sharded onto multiple devices (say <math alttext="\ell" class="ltx_Math" display="inline" id="S1.p8.2.m1.1"><semantics id="S1.p8.2.m1.1a"><mi id="S1.p8.2.m1.1.1" mathvariant="normal" xref="S1.p8.2.m1.1.1.cmml">ℓ</mi><annotation-xml encoding="MathML-Content" id="S1.p8.2.m1.1b"><ci id="S1.p8.2.m1.1.1.cmml" xref="S1.p8.2.m1.1.1">ℓ</ci></annotation-xml><annotation encoding="application/x-tex" id="S1.p8.2.m1.1c">\ell</annotation><annotation encoding="application/x-llamapun" id="S1.p8.2.m1.1d">roman_ℓ</annotation></semantics></math> devices), and similarly computations (and outputs/activations) in each of the softmax/FFN layers are also distributed across the devices. In this context, a vanilla application of the top-<math alttext="k" class="ltx_Math" display="inline" id="S1.p8.3.m2.1"><semantics id="S1.p8.3.m2.1a"><mi id="S1.p8.3.m2.1.1" xref="S1.p8.3.m2.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="S1.p8.3.m2.1b"><ci id="S1.p8.3.m2.1.1.cmml" xref="S1.p8.3.m2.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="S1.p8.3.m2.1c">k</annotation><annotation encoding="application/x-llamapun" id="S1.p8.3.m2.1d">italic_k</annotation></semantics></math> operator turns out to be very expensive since parameters stored on all the different devices are collected into a central location before performing the top-<math alttext="k" class="ltx_Math" display="inline" id="S1.p8.4.m3.1"><semantics id="S1.p8.4.m3.1a"><mi id="S1.p8.4.m3.1.1" xref="S1.p8.4.m3.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="S1.p8.4.m3.1b"><ci id="S1.p8.4.m3.1.1.cmml" xref="S1.p8.4.m3.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="S1.p8.4.m3.1c">k</annotation><annotation encoding="application/x-llamapun" id="S1.p8.4.m3.1d">italic_k</annotation></semantics></math> operation. To overcome this, we propose a <em class="ltx_emph ltx_font_italic" id="S1.p8.5.2">distributed, approximate top-<math alttext="k" class="ltx_Math" display="inline" id="S1.p8.5.2.m1.1"><semantics id="S1.p8.5.2.m1.1a"><mi id="S1.p8.5.2.m1.1.1" xref="S1.p8.5.2.m1.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="S1.p8.5.2.m1.1b"><ci id="S1.p8.5.2.m1.1.1.cmml" xref="S1.p8.5.2.m1.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="S1.p8.5.2.m1.1c">k</annotation><annotation encoding="application/x-llamapun" id="S1.p8.5.2.m1.1d">italic_k</annotation></semantics></math></em> operator which performs the top-<math alttext="\frac{k}{\ell}" class="ltx_Math" display="inline" id="S1.p8.6.m4.1"><semantics id="S1.p8.6.m4.1a"><mfrac id="S1.p8.6.m4.1.1" xref="S1.p8.6.m4.1.1.cmml"><mi id="S1.p8.6.m4.1.1.2" xref="S1.p8.6.m4.1.1.2.cmml">k</mi><mi id="S1.p8.6.m4.1.1.3" mathvariant="normal" xref="S1.p8.6.m4.1.1.3.cmml">ℓ</mi></mfrac><annotation-xml encoding="MathML-Content" id="S1.p8.6.m4.1b"><apply id="S1.p8.6.m4.1.1.cmml" xref="S1.p8.6.m4.1.1"><divide id="S1.p8.6.m4.1.1.1.cmml" xref="S1.p8.6.m4.1.1"></divide><ci id="S1.p8.6.m4.1.1.2.cmml" xref="S1.p8.6.m4.1.1.2">𝑘</ci><ci id="S1.p8.6.m4.1.1.3.cmml" xref="S1.p8.6.m4.1.1.3">ℓ</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S1.p8.6.m4.1c">\frac{k}{\ell}</annotation><annotation encoding="application/x-llamapun" id="S1.p8.6.m4.1d">divide start_ARG italic_k end_ARG start_ARG roman_ℓ end_ARG</annotation></semantics></math> operation on each of the <math alttext="\ell" class="ltx_Math" display="inline" id="S1.p8.7.m5.1"><semantics id="S1.p8.7.m5.1a"><mi id="S1.p8.7.m5.1.1" mathvariant="normal" xref="S1.p8.7.m5.1.1.cmml">ℓ</mi><annotation-xml encoding="MathML-Content" id="S1.p8.7.m5.1b"><ci id="S1.p8.7.m5.1.1.cmml" xref="S1.p8.7.m5.1.1">ℓ</ci></annotation-xml><annotation encoding="application/x-tex" id="S1.p8.7.m5.1c">\ell</annotation><annotation encoding="application/x-llamapun" id="S1.p8.7.m5.1d">roman_ℓ</annotation></semantics></math> devices, and then uses a union of these to approximate the overall top-<math alttext="k" class="ltx_Math" display="inline" id="S1.p8.8.m6.1"><semantics id="S1.p8.8.m6.1a"><mi id="S1.p8.8.m6.1.1" xref="S1.p8.8.m6.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="S1.p8.8.m6.1b"><ci id="S1.p8.8.m6.1.1.cmml" xref="S1.p8.8.m6.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="S1.p8.8.m6.1c">k</annotation><annotation encoding="application/x-llamapun" id="S1.p8.8.m6.1d">italic_k</annotation></semantics></math> operator.</p>
</div>
<div class="ltx_para" id="S1.p9">
<p class="ltx_p" id="S1.p9.2">HiRE<span class="ltx_text ltx_font_bold" id="S1.p9.2.1">-</span>Softmax: In the softmax layer, we are interested only in the top few (<math alttext="k\lessapprox 32" class="ltx_Math" display="inline" id="S1.p9.1.m1.1"><semantics id="S1.p9.1.m1.1a"><mrow id="S1.p9.1.m1.1.1" xref="S1.p9.1.m1.1.1.cmml"><mi id="S1.p9.1.m1.1.1.2" xref="S1.p9.1.m1.1.1.2.cmml">k</mi><mo id="S1.p9.1.m1.1.1.1" xref="S1.p9.1.m1.1.1.cmml">⪅</mo><mn id="S1.p9.1.m1.1.1.3" xref="S1.p9.1.m1.1.1.3.cmml">32</mn></mrow><annotation-xml encoding="MathML-Content" id="S1.p9.1.m1.1b"><or id="S1.p9.1.m1.1.1.cmml" xref="S1.p9.1.m1.1.1"><apply id="S1.p9.1.m1.1.1a.cmml" xref="S1.p9.1.m1.1.1"><lt id="S1.p9.1.m1.1.1b.cmml" xref="S1.p9.1.m1.1.1"></lt><ci id="S1.p9.1.m1.1.1.2.cmml" xref="S1.p9.1.m1.1.1.2">𝑘</ci><cn id="S1.p9.1.m1.1.1.3.cmml" type="integer" xref="S1.p9.1.m1.1.1.3">32</cn></apply><apply id="S1.p9.1.m1.1.1c.cmml" xref="S1.p9.1.m1.1.1"><approx id="S1.p9.1.m1.1.1d.cmml" xref="S1.p9.1.m1.1.1"></approx><share href="#S1.p9.1.m1.1.1.2.cmml" id="S1.p9.1.m1.1.1e.cmml" xref="S1.p9.1.m1.1.1"></share><share href="#S1.p9.1.m1.1.1.3.cmml" id="S1.p9.1.m1.1.1f.cmml" xref="S1.p9.1.m1.1.1"></share></apply></or></annotation-xml><annotation encoding="application/x-tex" id="S1.p9.1.m1.1c">k\lessapprox 32</annotation><annotation encoding="application/x-llamapun" id="S1.p9.1.m1.1d">italic_k ⪅ 32</annotation></semantics></math>) outputs from a very large output space with hundreds of thousands of tokens. On a model with about one billion parameters, our implementation of HiRE gives an end-to-end latency improvement of about <math alttext="1.22\textrm{x}" class="ltx_Math" display="inline" id="S1.p9.2.m2.1"><semantics id="S1.p9.2.m2.1a"><mrow id="S1.p9.2.m2.1.1" xref="S1.p9.2.m2.1.1.cmml"><mn id="S1.p9.2.m2.1.1.2" xref="S1.p9.2.m2.1.1.2.cmml">1.22</mn><mo id="S1.p9.2.m2.1.1.1" xref="S1.p9.2.m2.1.1.1.cmml">⁢</mo><mtext id="S1.p9.2.m2.1.1.3" xref="S1.p9.2.m2.1.1.3a.cmml">x</mtext></mrow><annotation-xml encoding="MathML-Content" id="S1.p9.2.m2.1b"><apply id="S1.p9.2.m2.1.1.cmml" xref="S1.p9.2.m2.1.1"><times id="S1.p9.2.m2.1.1.1.cmml" xref="S1.p9.2.m2.1.1.1"></times><cn id="S1.p9.2.m2.1.1.2.cmml" type="float" xref="S1.p9.2.m2.1.1.2">1.22</cn><ci id="S1.p9.2.m2.1.1.3a.cmml" xref="S1.p9.2.m2.1.1.3"><mtext id="S1.p9.2.m2.1.1.3.cmml" xref="S1.p9.2.m2.1.1.3">x</mtext></ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S1.p9.2.m2.1c">1.22\textrm{x}</annotation><annotation encoding="application/x-llamapun" id="S1.p9.2.m2.1d">1.22 x</annotation></semantics></math> without any quality drop.
</p>
</div>
<div class="ltx_para" id="S1.p10">
<p class="ltx_p" id="S1.p10.8">HiRE<span class="ltx_text ltx_font_bold" id="S1.p10.8.1">-</span>FFN: While LLMs trained with a top-<math alttext="k" class="ltx_Math" display="inline" id="S1.p10.1.m1.1"><semantics id="S1.p10.1.m1.1a"><mi id="S1.p10.1.m1.1.1" xref="S1.p10.1.m1.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="S1.p10.1.m1.1b"><ci id="S1.p10.1.m1.1.1.cmml" xref="S1.p10.1.m1.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="S1.p10.1.m1.1c">k</annotation><annotation encoding="application/x-llamapun" id="S1.p10.1.m1.1d">italic_k</annotation></semantics></math> operation have relatively sparse activations, <math alttext="k\gtrapprox 5\%" class="ltx_Math" display="inline" id="S1.p10.2.m2.1"><semantics id="S1.p10.2.m2.1a"><mrow id="S1.p10.2.m2.1.1" xref="S1.p10.2.m2.1.1.cmml"><mi id="S1.p10.2.m2.1.1.2" xref="S1.p10.2.m2.1.1.2.cmml">k</mi><mo id="S1.p10.2.m2.1.1.1" xref="S1.p10.2.m2.1.1.1.cmml">⪆</mo><mrow id="S1.p10.2.m2.1.1.3" xref="S1.p10.2.m2.1.1.3.cmml"><mn id="S1.p10.2.m2.1.1.3.2" xref="S1.p10.2.m2.1.1.3.2.cmml">5</mn><mo id="S1.p10.2.m2.1.1.3.1" xref="S1.p10.2.m2.1.1.3.1.cmml">%</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S1.p10.2.m2.1b"><apply id="S1.p10.2.m2.1.1.cmml" xref="S1.p10.2.m2.1.1"><csymbol cd="latexml" id="S1.p10.2.m2.1.1.1.cmml" xref="S1.p10.2.m2.1.1.1">greater-than-or-approximately-equals</csymbol><ci id="S1.p10.2.m2.1.1.2.cmml" xref="S1.p10.2.m2.1.1.2">𝑘</ci><apply id="S1.p10.2.m2.1.1.3.cmml" xref="S1.p10.2.m2.1.1.3"><csymbol cd="latexml" id="S1.p10.2.m2.1.1.3.1.cmml" xref="S1.p10.2.m2.1.1.3.1">percent</csymbol><cn id="S1.p10.2.m2.1.1.3.2.cmml" type="integer" xref="S1.p10.2.m2.1.1.3.2">5</cn></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S1.p10.2.m2.1c">k\gtrapprox 5\%</annotation><annotation encoding="application/x-llamapun" id="S1.p10.2.m2.1d">italic_k ⪆ 5 %</annotation></semantics></math> is usually required to ensure that there is no loss in accuracy (in contrast to the softmax layer, where the effective sparsity is <math alttext="\lessapprox 0.3\%" class="ltx_Math" display="inline" id="S1.p10.3.m3.1"><semantics id="S1.p10.3.m3.1a"><mrow id="S1.p10.3.m3.1.1" xref="S1.p10.3.m3.1.1.cmml"><mi id="S1.p10.3.m3.1.1.2" xref="S1.p10.3.m3.1.1.2.cmml"></mi><mo id="S1.p10.3.m3.1.1.1" xref="S1.p10.3.m3.1.1.cmml">⪅</mo><mrow id="S1.p10.3.m3.1.1.3" xref="S1.p10.3.m3.1.1.3.cmml"><mn id="S1.p10.3.m3.1.1.3.2" xref="S1.p10.3.m3.1.1.3.2.cmml">0.3</mn><mo id="S1.p10.3.m3.1.1.3.1" xref="S1.p10.3.m3.1.1.3.1.cmml">%</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S1.p10.3.m3.1b"><or id="S1.p10.3.m3.1.1.cmml" xref="S1.p10.3.m3.1.1"><apply id="S1.p10.3.m3.1.1a.cmml" xref="S1.p10.3.m3.1.1"><lt id="S1.p10.3.m3.1.1b.cmml" xref="S1.p10.3.m3.1.1"></lt><csymbol cd="latexml" id="S1.p10.3.m3.1.1.2.cmml" xref="S1.p10.3.m3.1.1.2">absent</csymbol><apply id="S1.p10.3.m3.1.1.3.cmml" xref="S1.p10.3.m3.1.1.3"><csymbol cd="latexml" id="S1.p10.3.m3.1.1.3.1.cmml" xref="S1.p10.3.m3.1.1.3.1">percent</csymbol><cn id="S1.p10.3.m3.1.1.3.2.cmml" type="float" xref="S1.p10.3.m3.1.1.3.2">0.3</cn></apply></apply><apply id="S1.p10.3.m3.1.1c.cmml" xref="S1.p10.3.m3.1.1"><approx id="S1.p10.3.m3.1.1d.cmml" xref="S1.p10.3.m3.1.1"></approx><share href="#S1.p10.3.m3.1.1.2.cmml" id="S1.p10.3.m3.1.1e.cmml" xref="S1.p10.3.m3.1.1"></share><share href="#S1.p10.3.m3.1.1.3.cmml" id="S1.p10.3.m3.1.1f.cmml" xref="S1.p10.3.m3.1.1"></share></apply></or></annotation-xml><annotation encoding="application/x-tex" id="S1.p10.3.m3.1c">\lessapprox 0.3\%</annotation><annotation encoding="application/x-llamapun" id="S1.p10.3.m3.1d">⪅ 0.3 %</annotation></semantics></math>). Now, the amount of time taken to gather the relevant top-<math alttext="k" class="ltx_Math" display="inline" id="S1.p10.4.m4.1"><semantics id="S1.p10.4.m4.1a"><mi id="S1.p10.4.m4.1.1" xref="S1.p10.4.m4.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="S1.p10.4.m4.1b"><ci id="S1.p10.4.m4.1.1.cmml" xref="S1.p10.4.m4.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="S1.p10.4.m4.1c">k</annotation><annotation encoding="application/x-llamapun" id="S1.p10.4.m4.1d">italic_k</annotation></semantics></math> columns of the weight matrix from HBM to cache turns out to be substantially more than that required to bring an equivalently sized dense matrix. To overcome this hardware limitation, we propose a group sparse top-<math alttext="k" class="ltx_Math" display="inline" id="S1.p10.5.m5.1"><semantics id="S1.p10.5.m5.1a"><mi id="S1.p10.5.m5.1.1" xref="S1.p10.5.m5.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="S1.p10.5.m5.1b"><ci id="S1.p10.5.m5.1.1.cmml" xref="S1.p10.5.m5.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="S1.p10.5.m5.1c">k</annotation><annotation encoding="application/x-llamapun" id="S1.p10.5.m5.1d">italic_k</annotation></semantics></math> operation, where columns of the weight matrix are grouped into groups of small sizes (<math alttext="8" class="ltx_Math" display="inline" id="S1.p10.6.m6.1"><semantics id="S1.p10.6.m6.1a"><mn id="S1.p10.6.m6.1.1" xref="S1.p10.6.m6.1.1.cmml">8</mn><annotation-xml encoding="MathML-Content" id="S1.p10.6.m6.1b"><cn id="S1.p10.6.m6.1.1.cmml" type="integer" xref="S1.p10.6.m6.1.1">8</cn></annotation-xml><annotation encoding="application/x-tex" id="S1.p10.6.m6.1c">8</annotation><annotation encoding="application/x-llamapun" id="S1.p10.6.m6.1d">8</annotation></semantics></math> in our experiments) which significantly improves the efficiency of memory transfers. Second, motivated by the observation that there is substantial overlap in non-zero activations across tokens, we propose two approaches to further enhance sparsity levels. For exploiting static overlap (i.e., activations that are common to most tokens), we propose to use a hybrid FFN layer which combines a standard/dense (but small) FFN, together with a sparse/top-<math alttext="k" class="ltx_Math" display="inline" id="S1.p10.7.m7.1"><semantics id="S1.p10.7.m7.1a"><mi id="S1.p10.7.m7.1.1" xref="S1.p10.7.m7.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="S1.p10.7.m7.1b"><ci id="S1.p10.7.m7.1.1.cmml" xref="S1.p10.7.m7.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="S1.p10.7.m7.1c">k</annotation><annotation encoding="application/x-llamapun" id="S1.p10.7.m7.1d">italic_k</annotation></semantics></math> FFN layer. For exploiting dynamic overlap (i.e., activations
that are common to related responses), while doing inference with a larger batch size or generating multiple parallel responses for the same query, we propose to select sparsity depending on the size of <em class="ltx_emph ltx_font_italic" id="S1.p10.8.2">union of non-zero activation indices</em> for each of the tokens, instead of using a fixed level of sparsity. On the same model as above, HiRE-FFN gives an end-to-end latency improvement of about <math alttext="1.16\textrm{x}" class="ltx_Math" display="inline" id="S1.p10.8.m8.1"><semantics id="S1.p10.8.m8.1a"><mrow id="S1.p10.8.m8.1.1" xref="S1.p10.8.m8.1.1.cmml"><mn id="S1.p10.8.m8.1.1.2" xref="S1.p10.8.m8.1.1.2.cmml">1.16</mn><mo id="S1.p10.8.m8.1.1.1" xref="S1.p10.8.m8.1.1.1.cmml">⁢</mo><mtext id="S1.p10.8.m8.1.1.3" xref="S1.p10.8.m8.1.1.3a.cmml">x</mtext></mrow><annotation-xml encoding="MathML-Content" id="S1.p10.8.m8.1b"><apply id="S1.p10.8.m8.1.1.cmml" xref="S1.p10.8.m8.1.1"><times id="S1.p10.8.m8.1.1.1.cmml" xref="S1.p10.8.m8.1.1.1"></times><cn id="S1.p10.8.m8.1.1.2.cmml" type="float" xref="S1.p10.8.m8.1.1.2">1.16</cn><ci id="S1.p10.8.m8.1.1.3a.cmml" xref="S1.p10.8.m8.1.1.3"><mtext id="S1.p10.8.m8.1.1.3.cmml" xref="S1.p10.8.m8.1.1.3">x</mtext></ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S1.p10.8.m8.1c">1.16\textrm{x}</annotation><annotation encoding="application/x-llamapun" id="S1.p10.8.m8.1d">1.16 x</annotation></semantics></math>, again without any quality drop.</p>
</div>
<div class="ltx_para" id="S1.p11">
<p class="ltx_p" id="S1.p11.1"><span class="ltx_text ltx_font_bold" id="S1.p11.1.1">Putting together</span>: A combination of all the ideas discussed above give an end-to-end latency improvement of about <math alttext="1.47\textrm{x}" class="ltx_Math" display="inline" id="S1.p11.1.m1.1"><semantics id="S1.p11.1.m1.1a"><mrow id="S1.p11.1.m1.1.1" xref="S1.p11.1.m1.1.1.cmml"><mn id="S1.p11.1.m1.1.1.2" xref="S1.p11.1.m1.1.1.2.cmml">1.47</mn><mo id="S1.p11.1.m1.1.1.1" xref="S1.p11.1.m1.1.1.1.cmml">⁢</mo><mtext id="S1.p11.1.m1.1.1.3" xref="S1.p11.1.m1.1.1.3a.cmml">x</mtext></mrow><annotation-xml encoding="MathML-Content" id="S1.p11.1.m1.1b"><apply id="S1.p11.1.m1.1.1.cmml" xref="S1.p11.1.m1.1.1"><times id="S1.p11.1.m1.1.1.1.cmml" xref="S1.p11.1.m1.1.1.1"></times><cn id="S1.p11.1.m1.1.1.2.cmml" type="float" xref="S1.p11.1.m1.1.1.2">1.47</cn><ci id="S1.p11.1.m1.1.1.3a.cmml" xref="S1.p11.1.m1.1.1.3"><mtext id="S1.p11.1.m1.1.1.3.cmml" xref="S1.p11.1.m1.1.1.3">x</mtext></ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S1.p11.1.m1.1c">1.47\textrm{x}</annotation><annotation encoding="application/x-llamapun" id="S1.p11.1.m1.1d">1.47 x</annotation></semantics></math> compared to the fully dense model.</p>
</div>
<div class="ltx_para" id="S1.p12">
<p class="ltx_p" id="S1.p12.1">We note that concurrent to our work,  <cite class="ltx_cite ltx_citemacro_citep">(Alizadeh et al., <a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#bib.bib2" title="">2023</a>)</cite> also proposes an efficient, approximate procedure to estimate non-zero activations. While this approach is similar to our “estimating top activations cheaply” contribution, we note that emphasis of the two works is quite different. In particular, we demonstrate that along with estimation of top activations, we also need to adjust thresholds for high recall, implement DA-TOP-k style operator, and promote group sparsity+overlap to provide compelling end-to-end latency reduction on accelerators. </p>
</div>
<div class="ltx_para" id="S1.p13">
<p class="ltx_p" id="S1.p13.1"><span class="ltx_text ltx_font_bold" id="S1.p13.1.1">Outline</span>: In Section <a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#S2" title="2 Related Work ‣ HiRE: High Recall Approximate Top-𝑘 Estimation for Efficient LLM Inference"><span class="ltx_text ltx_ref_tag">2</span></a>, we describe some closely related works. In Section <a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#S3" title="3 Main Ideas ‣ HiRE: High Recall Approximate Top-𝑘 Estimation for Efficient LLM Inference"><span class="ltx_text ltx_ref_tag">3</span></a>, we explain the key ideas. In Section <a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#S4" title="4 Experiments ‣ HiRE: High Recall Approximate Top-𝑘 Estimation for Efficient LLM Inference"><span class="ltx_text ltx_ref_tag">4</span></a> we present the experiment setting and our main results, and provide additional results in appendix.</p>
</div>
<div class="ltx_para" id="S1.p14">
<p class="ltx_p" id="S1.p14.7"><span class="ltx_text ltx_font_bold" id="S1.p14.7.1">Notation</span>: We use non-bold letters <math alttext="a,A" class="ltx_Math" display="inline" id="S1.p14.1.m1.2"><semantics id="S1.p14.1.m1.2a"><mrow id="S1.p14.1.m1.2.3.2" xref="S1.p14.1.m1.2.3.1.cmml"><mi id="S1.p14.1.m1.1.1" xref="S1.p14.1.m1.1.1.cmml">a</mi><mo id="S1.p14.1.m1.2.3.2.1" xref="S1.p14.1.m1.2.3.1.cmml">,</mo><mi id="S1.p14.1.m1.2.2" xref="S1.p14.1.m1.2.2.cmml">A</mi></mrow><annotation-xml encoding="MathML-Content" id="S1.p14.1.m1.2b"><list id="S1.p14.1.m1.2.3.1.cmml" xref="S1.p14.1.m1.2.3.2"><ci id="S1.p14.1.m1.1.1.cmml" xref="S1.p14.1.m1.1.1">𝑎</ci><ci id="S1.p14.1.m1.2.2.cmml" xref="S1.p14.1.m1.2.2">𝐴</ci></list></annotation-xml><annotation encoding="application/x-tex" id="S1.p14.1.m1.2c">a,A</annotation><annotation encoding="application/x-llamapun" id="S1.p14.1.m1.2d">italic_a , italic_A</annotation></semantics></math> etc. for scalars, <math alttext="\overrightarrow{\mathbf{a}},\overrightarrow{\mathbf{b}}" class="ltx_Math" display="inline" id="S1.p14.2.m2.2"><semantics id="S1.p14.2.m2.2a"><mrow id="S1.p14.2.m2.2.3.2" xref="S1.p14.2.m2.2.3.1.cmml"><mover accent="true" id="S1.p14.2.m2.1.1" xref="S1.p14.2.m2.1.1.cmml"><mi id="S1.p14.2.m2.1.1.2" xref="S1.p14.2.m2.1.1.2.cmml">𝐚</mi><mo id="S1.p14.2.m2.1.1.1" stretchy="false" xref="S1.p14.2.m2.1.1.1.cmml">→</mo></mover><mo id="S1.p14.2.m2.2.3.2.1" xref="S1.p14.2.m2.2.3.1.cmml">,</mo><mover accent="true" id="S1.p14.2.m2.2.2" xref="S1.p14.2.m2.2.2.cmml"><mi id="S1.p14.2.m2.2.2.2" xref="S1.p14.2.m2.2.2.2.cmml">𝐛</mi><mo id="S1.p14.2.m2.2.2.1" stretchy="false" xref="S1.p14.2.m2.2.2.1.cmml">→</mo></mover></mrow><annotation-xml encoding="MathML-Content" id="S1.p14.2.m2.2b"><list id="S1.p14.2.m2.2.3.1.cmml" xref="S1.p14.2.m2.2.3.2"><apply id="S1.p14.2.m2.1.1.cmml" xref="S1.p14.2.m2.1.1"><ci id="S1.p14.2.m2.1.1.1.cmml" xref="S1.p14.2.m2.1.1.1">→</ci><ci id="S1.p14.2.m2.1.1.2.cmml" xref="S1.p14.2.m2.1.1.2">𝐚</ci></apply><apply id="S1.p14.2.m2.2.2.cmml" xref="S1.p14.2.m2.2.2"><ci id="S1.p14.2.m2.2.2.1.cmml" xref="S1.p14.2.m2.2.2.1">→</ci><ci id="S1.p14.2.m2.2.2.2.cmml" xref="S1.p14.2.m2.2.2.2">𝐛</ci></apply></list></annotation-xml><annotation encoding="application/x-tex" id="S1.p14.2.m2.2c">\overrightarrow{\mathbf{a}},\overrightarrow{\mathbf{b}}</annotation><annotation encoding="application/x-llamapun" id="S1.p14.2.m2.2d">over→ start_ARG bold_a end_ARG , over→ start_ARG bold_b end_ARG</annotation></semantics></math> etc. for vectors and <math alttext="\mathbf{A},\mathbf{B}" class="ltx_Math" display="inline" id="S1.p14.3.m3.2"><semantics id="S1.p14.3.m3.2a"><mrow id="S1.p14.3.m3.2.3.2" xref="S1.p14.3.m3.2.3.1.cmml"><mi id="S1.p14.3.m3.1.1" xref="S1.p14.3.m3.1.1.cmml">𝐀</mi><mo id="S1.p14.3.m3.2.3.2.1" xref="S1.p14.3.m3.2.3.1.cmml">,</mo><mi id="S1.p14.3.m3.2.2" xref="S1.p14.3.m3.2.2.cmml">𝐁</mi></mrow><annotation-xml encoding="MathML-Content" id="S1.p14.3.m3.2b"><list id="S1.p14.3.m3.2.3.1.cmml" xref="S1.p14.3.m3.2.3.2"><ci id="S1.p14.3.m3.1.1.cmml" xref="S1.p14.3.m3.1.1">𝐀</ci><ci id="S1.p14.3.m3.2.2.cmml" xref="S1.p14.3.m3.2.2">𝐁</ci></list></annotation-xml><annotation encoding="application/x-tex" id="S1.p14.3.m3.2c">\mathbf{A},\mathbf{B}</annotation><annotation encoding="application/x-llamapun" id="S1.p14.3.m3.2d">bold_A , bold_B</annotation></semantics></math> etc. for matrices. Given a set <math alttext="S" class="ltx_Math" display="inline" id="S1.p14.4.m4.1"><semantics id="S1.p14.4.m4.1a"><mi id="S1.p14.4.m4.1.1" xref="S1.p14.4.m4.1.1.cmml">S</mi><annotation-xml encoding="MathML-Content" id="S1.p14.4.m4.1b"><ci id="S1.p14.4.m4.1.1.cmml" xref="S1.p14.4.m4.1.1">𝑆</ci></annotation-xml><annotation encoding="application/x-tex" id="S1.p14.4.m4.1c">S</annotation><annotation encoding="application/x-llamapun" id="S1.p14.4.m4.1d">italic_S</annotation></semantics></math> of coordinates, we also use <math alttext="\overrightarrow{\mathbf{x}}|_{S}" class="ltx_Math" display="inline" id="S1.p14.5.m5.2"><semantics id="S1.p14.5.m5.2a"><msub id="S1.p14.5.m5.2.3.2" xref="S1.p14.5.m5.2.3.1.cmml"><mrow id="S1.p14.5.m5.2.3.2.2" xref="S1.p14.5.m5.2.3.1.cmml"><mover accent="true" id="S1.p14.5.m5.1.1" xref="S1.p14.5.m5.1.1.cmml"><mi id="S1.p14.5.m5.1.1.2" xref="S1.p14.5.m5.1.1.2.cmml">𝐱</mi><mo id="S1.p14.5.m5.1.1.1" stretchy="false" xref="S1.p14.5.m5.1.1.1.cmml">→</mo></mover><mo id="S1.p14.5.m5.2.3.2.2.1" stretchy="false" xref="S1.p14.5.m5.2.3.1.1.cmml">|</mo></mrow><mi id="S1.p14.5.m5.2.2.1" xref="S1.p14.5.m5.2.2.1.cmml">S</mi></msub><annotation-xml encoding="MathML-Content" id="S1.p14.5.m5.2b"><apply id="S1.p14.5.m5.2.3.1.cmml" xref="S1.p14.5.m5.2.3.2"><csymbol cd="latexml" id="S1.p14.5.m5.2.3.1.1.cmml" xref="S1.p14.5.m5.2.3.2.2.1">evaluated-at</csymbol><apply id="S1.p14.5.m5.1.1.cmml" xref="S1.p14.5.m5.1.1"><ci id="S1.p14.5.m5.1.1.1.cmml" xref="S1.p14.5.m5.1.1.1">→</ci><ci id="S1.p14.5.m5.1.1.2.cmml" xref="S1.p14.5.m5.1.1.2">𝐱</ci></apply><ci id="S1.p14.5.m5.2.2.1.cmml" xref="S1.p14.5.m5.2.2.1">𝑆</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S1.p14.5.m5.2c">\overrightarrow{\mathbf{x}}|_{S}</annotation><annotation encoding="application/x-llamapun" id="S1.p14.5.m5.2d">over→ start_ARG bold_x end_ARG | start_POSTSUBSCRIPT italic_S end_POSTSUBSCRIPT</annotation></semantics></math> to denote the restriction of <math alttext="\overrightarrow{\mathbf{x}}" class="ltx_Math" display="inline" id="S1.p14.6.m6.1"><semantics id="S1.p14.6.m6.1a"><mover accent="true" id="S1.p14.6.m6.1.1" xref="S1.p14.6.m6.1.1.cmml"><mi id="S1.p14.6.m6.1.1.2" xref="S1.p14.6.m6.1.1.2.cmml">𝐱</mi><mo id="S1.p14.6.m6.1.1.1" stretchy="false" xref="S1.p14.6.m6.1.1.1.cmml">→</mo></mover><annotation-xml encoding="MathML-Content" id="S1.p14.6.m6.1b"><apply id="S1.p14.6.m6.1.1.cmml" xref="S1.p14.6.m6.1.1"><ci id="S1.p14.6.m6.1.1.1.cmml" xref="S1.p14.6.m6.1.1.1">→</ci><ci id="S1.p14.6.m6.1.1.2.cmml" xref="S1.p14.6.m6.1.1.2">𝐱</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S1.p14.6.m6.1c">\overrightarrow{\mathbf{x}}</annotation><annotation encoding="application/x-llamapun" id="S1.p14.6.m6.1d">over→ start_ARG bold_x end_ARG</annotation></semantics></math> to the coordinates in <math alttext="S" class="ltx_Math" display="inline" id="S1.p14.7.m7.1"><semantics id="S1.p14.7.m7.1a"><mi id="S1.p14.7.m7.1.1" xref="S1.p14.7.m7.1.1.cmml">S</mi><annotation-xml encoding="MathML-Content" id="S1.p14.7.m7.1b"><ci id="S1.p14.7.m7.1.1.cmml" xref="S1.p14.7.m7.1.1">𝑆</ci></annotation-xml><annotation encoding="application/x-tex" id="S1.p14.7.m7.1c">S</annotation><annotation encoding="application/x-llamapun" id="S1.p14.7.m7.1d">italic_S</annotation></semantics></math>.</p>
</div>
</section>
<section class="ltx_section" id="S2">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">2 </span>Related Work</h2>
<div class="ltx_para" id="S2.p1">
<p class="ltx_p" id="S2.p1.1"><span class="ltx_text ltx_font_bold" id="S2.p1.1.1">Sparsity of activations</span>: As mentioned earlier, recent works <cite class="ltx_cite ltx_citemacro_citep">(Li et al., <a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#bib.bib32" title="">2022</a>)</cite> have demonstrated that large language models have highly sparse activation patterns with ReLU based activation functions. <cite class="ltx_cite ltx_citemacro_citep">(Mirzadeh et al., <a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#bib.bib38" title="">2023</a>)</cite> show that using ReLU activation indeed achieves comparable performance to and argue for reinstating the ReLU activation function instead of more popular alternatives such as GeLU. There have been several recent attempts to exploit activation sparsity for faster inference such as <cite class="ltx_cite ltx_citemacro_citep">(Liu et al., <a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#bib.bib35" title="">2023</a>; Grimaldi et al., <a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#bib.bib19" title="">2023</a>; Piórczyński et al., <a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#bib.bib44" title="">2023</a>; Csordás et al., <a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#bib.bib14" title="">2023</a>; Alizadeh et al., <a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#bib.bib2" title="">2023</a>)</cite>, but all of them suffer some loss in quality since the activation pattern cannot be predicted exactly. In contrast, one of our key insights is that estimating activation sparsity with <em class="ltx_emph ltx_font_italic" id="S2.p1.1.2">high recall</em> can ensure matching quality, since exact computation can be performed on all of the activations that are estimated to be non-zero, and even if some of them later turn out to be zero, it doesn’t affect the actual output. We also note that we introduce several new ideas such as group sparsity with very small group sizes, using a common dense path, exploiting activation overlap across tokens, and distributed gathering of weights, which are critical to improving efficiency without loss in accuracy and in extending this approach to larger batch sizes, larger number of samples and larger models with model partitioning.</p>
</div>
<div class="ltx_para" id="S2.p2">
<p class="ltx_p" id="S2.p2.1"><span class="ltx_text ltx_font_bold" id="S2.p2.1.1">Sparse attention</span>: There have also been several approaches to <em class="ltx_emph ltx_font_italic" id="S2.p2.1.2">enforce</em> and exploit sparsity in the attention layers <cite class="ltx_cite ltx_citemacro_citep">(Wang et al., <a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#bib.bib55" title="">2021</a>; Madaan et al., <a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#bib.bib36" title="">2023</a>)</cite>. In particular, they directly approximate full all-to-all attention with sparse attention and we believe that similar to what we do for activation sparsity in this paper, estimating a high recall set of non-zero attention weights and performing exact attention computation on them can ensure that there is no loss in quality with sparse attention.</p>
</div>
<div class="ltx_para" id="S2.p3">
<p class="ltx_p" id="S2.p3.3"><span class="ltx_text ltx_font_bold" id="S2.p3.3.1">Structured sparsity and hardware support</span>: From the hardware/systems point of view, there have been several works developing efficient sparse operations on GPUs and TPUs such as <cite class="ltx_cite ltx_citemacro_citep">(Gale et al., <a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#bib.bib18" title="">2020</a>)</cite>. Since unstructured sparsity is not supported with efficient execution on GPUs, there have been works that try either different forms of structured sparsity such as <math alttext="1" class="ltx_Math" display="inline" id="S2.p3.1.m1.1"><semantics id="S2.p3.1.m1.1a"><mn id="S2.p3.1.m1.1.1" xref="S2.p3.1.m1.1.1.cmml">1</mn><annotation-xml encoding="MathML-Content" id="S2.p3.1.m1.1b"><cn id="S2.p3.1.m1.1.1.cmml" type="integer" xref="S2.p3.1.m1.1.1">1</cn></annotation-xml><annotation encoding="application/x-tex" id="S2.p3.1.m1.1c">1</annotation><annotation encoding="application/x-llamapun" id="S2.p3.1.m1.1d">1</annotation></semantics></math> in <math alttext="4" class="ltx_Math" display="inline" id="S2.p3.2.m2.1"><semantics id="S2.p3.2.m2.1a"><mn id="S2.p3.2.m2.1.1" xref="S2.p3.2.m2.1.1.cmml">4</mn><annotation-xml encoding="MathML-Content" id="S2.p3.2.m2.1b"><cn id="S2.p3.2.m2.1.1.cmml" type="integer" xref="S2.p3.2.m2.1.1">4</cn></annotation-xml><annotation encoding="application/x-tex" id="S2.p3.2.m2.1c">4</annotation><annotation encoding="application/x-llamapun" id="S2.p3.2.m2.1d">4</annotation></semantics></math> sparsity <cite class="ltx_cite ltx_citemacro_citep">(Jaszczur et al., <a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#bib.bib24" title="">2021</a>)</cite>, group sparsity with large group sizes <cite class="ltx_cite ltx_citemacro_citep">(Dong et al., <a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#bib.bib16" title="">2023</a>)</cite> or explore the efficiency of sparse transformers on CPUs <cite class="ltx_cite ltx_citemacro_citep">(Song et al., <a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#bib.bib51" title="">2023</a>; Zeng et al., <a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#bib.bib59" title="">2023</a>)</cite>. In this work, we show that while fully unstructured sparsity is not efficiently supported on TPUs, surprisingly, group structured sparsity with even small group sizes like <math alttext="8" class="ltx_Math" display="inline" id="S2.p3.3.m3.1"><semantics id="S2.p3.3.m3.1a"><mn id="S2.p3.3.m3.1.1" xref="S2.p3.3.m3.1.1.cmml">8</mn><annotation-xml encoding="MathML-Content" id="S2.p3.3.m3.1b"><cn id="S2.p3.3.m3.1.1.cmml" type="integer" xref="S2.p3.3.m3.1.1">8</cn></annotation-xml><annotation encoding="application/x-tex" id="S2.p3.3.m3.1c">8</annotation><annotation encoding="application/x-llamapun" id="S2.p3.3.m3.1d">8</annotation></semantics></math>, is efficiently supported on TPUs (see Figure <a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#A2.F3" title="Figure 3 ‣ Appendix B Additional Results ‣ HiRE: High Recall Approximate Top-𝑘 Estimation for Efficient LLM Inference"><span class="ltx_text ltx_ref_tag">3</span></a>), while not losing in terms of pretraining or downstream quality.</p>
</div>
<div class="ltx_para" id="S2.p4">
<p class="ltx_p" id="S2.p4.1"><span class="ltx_text ltx_font_bold" id="S2.p4.1.1">Mixture of experts (MoE)</span>: MoE <cite class="ltx_cite ltx_citemacro_citep">(Du et al., <a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#bib.bib17" title="">2022</a>)</cite> can be thought of as an extreme version of structured sparsity, where the group size is very large, and have been explored both for training <cite class="ltx_cite ltx_citemacro_citep">(Li et al., <a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#bib.bib32" title="">2022</a>)</cite> as well as inference <cite class="ltx_cite ltx_citemacro_citep">(Yi et al., <a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#bib.bib57" title="">2023</a>)</cite> efficiency. However, MoE models are usually harder to train, since one needs to both learn a gating mechanism, as well as ensure that tokens are roughly equally distributed across experts. In contrast, small group sizes (or experts) are much easier to train, particularly with the Top-<math alttext="k" class="ltx_Math" display="inline" id="S2.p4.1.m1.1"><semantics id="S2.p4.1.m1.1a"><mi id="S2.p4.1.m1.1.1" xref="S2.p4.1.m1.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="S2.p4.1.m1.1b"><ci id="S2.p4.1.m1.1.1.cmml" xref="S2.p4.1.m1.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.p4.1.m1.1c">k</annotation><annotation encoding="application/x-llamapun" id="S2.p4.1.m1.1d">italic_k</annotation></semantics></math> operation.</p>
</div>
<div class="ltx_para" id="S2.p5">
<p class="ltx_p" id="S2.p5.1"><span class="ltx_text ltx_font_bold" id="S2.p5.1.1">Complementary approaches for inference efficiency</span>: There have been several complementary approaches for speeding up LLM inference such as model compression <cite class="ltx_cite ltx_citemacro_citep">(Han et al., <a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#bib.bib21" title="">2015</a>; Jaiswal et al., <a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#bib.bib23" title="">2023</a>; Xia et al., <a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#bib.bib56" title="">2023</a>)</cite>, quantization <cite class="ltx_cite ltx_citemacro_citep">(Li et al., <a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#bib.bib31" title="">2023</a>; Ahmadian et al., <a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#bib.bib1" title="">2023</a>; Lin et al., <a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#bib.bib34" title="">2023</a>; Zhao et al., <a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#bib.bib62" title="">2023</a>)</cite>, speculative decoding <cite class="ltx_cite ltx_citemacro_citep">(Leviathan et al., <a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#bib.bib30" title="">2023</a>; He et al., <a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#bib.bib22" title="">2023</a>)</cite>, early exit and parallel decoding <cite class="ltx_cite ltx_citemacro_citep">(Bae et al., <a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#bib.bib5" title="">2023</a>)</cite>, structured matrices in FFN layers <cite class="ltx_cite ltx_citemacro_citep">(Baykal et al., <a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#bib.bib6" title="">2023</a>)</cite>, other systems aspects such as effective partitioning of the model <cite class="ltx_cite ltx_citemacro_citep">(Pope et al., <a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#bib.bib45" title="">2023</a>)</cite>, communication protocols across multiple devices <cite class="ltx_cite ltx_citemacro_citep">(Aminabadi et al., <a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#bib.bib3" title="">2022</a>; Sheng et al., <a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#bib.bib50" title="">2023</a>)</cite> etc.</p>
</div>
</section>
<section class="ltx_section" id="S3">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">3 </span>Main Ideas</h2>
<div class="ltx_para" id="S3.p1">
<p class="ltx_p" id="S3.p1.1">In this section, we will introduce the precise setting and present the main ideas behind HiRE more rigorously.</p>
</div>
<section class="ltx_subsection" id="S3.SS1">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">3.1 </span>Problem Setup</h3>
<div class="ltx_para" id="S3.SS1.p1">
<p class="ltx_p" id="S3.SS1.p1.1">A transformer begins with an <em class="ltx_emph ltx_font_italic" id="S3.SS1.p1.1.1">embedding</em> layer which produces the representation for the input tokens, then processes them through a sequence of alternating <em class="ltx_emph ltx_font_italic" id="S3.SS1.p1.1.2">attention</em> and <em class="ltx_emph ltx_font_italic" id="S3.SS1.p1.1.3">feed forward</em> layers, and finally ends with a <em class="ltx_emph ltx_font_italic" id="S3.SS1.p1.1.4">softmax</em> layer that produces the output probabilities <cite class="ltx_cite ltx_citemacro_citep">(Vaswani et al., <a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#bib.bib53" title="">2017</a>)</cite>. In this work, we will be primarily concerned with the <em class="ltx_emph ltx_font_italic" id="S3.SS1.p1.1.5">softmax</em> and <em class="ltx_emph ltx_font_italic" id="S3.SS1.p1.1.6">feed forward (FFN)</em> layers, which we now describe.</p>
</div>
<div class="ltx_para" id="S3.SS1.p2">
<p class="ltx_p" id="S3.SS1.p2.1">The <span class="ltx_text ltx_font_bold" id="S3.SS1.p2.1.1">softmax</span> layer takes an input <math alttext="\overrightarrow{\mathbf{x}}\in\mathbb{R}^{d}" class="ltx_Math" display="inline" id="S3.SS1.p2.1.m1.1"><semantics id="S3.SS1.p2.1.m1.1a"><mrow id="S3.SS1.p2.1.m1.1.1" xref="S3.SS1.p2.1.m1.1.1.cmml"><mover accent="true" id="S3.SS1.p2.1.m1.1.1.2" xref="S3.SS1.p2.1.m1.1.1.2.cmml"><mi id="S3.SS1.p2.1.m1.1.1.2.2" xref="S3.SS1.p2.1.m1.1.1.2.2.cmml">𝐱</mi><mo id="S3.SS1.p2.1.m1.1.1.2.1" stretchy="false" xref="S3.SS1.p2.1.m1.1.1.2.1.cmml">→</mo></mover><mo id="S3.SS1.p2.1.m1.1.1.1" xref="S3.SS1.p2.1.m1.1.1.1.cmml">∈</mo><msup id="S3.SS1.p2.1.m1.1.1.3" xref="S3.SS1.p2.1.m1.1.1.3.cmml"><mi id="S3.SS1.p2.1.m1.1.1.3.2" xref="S3.SS1.p2.1.m1.1.1.3.2.cmml">ℝ</mi><mi id="S3.SS1.p2.1.m1.1.1.3.3" xref="S3.SS1.p2.1.m1.1.1.3.3.cmml">d</mi></msup></mrow><annotation-xml encoding="MathML-Content" id="S3.SS1.p2.1.m1.1b"><apply id="S3.SS1.p2.1.m1.1.1.cmml" xref="S3.SS1.p2.1.m1.1.1"><in id="S3.SS1.p2.1.m1.1.1.1.cmml" xref="S3.SS1.p2.1.m1.1.1.1"></in><apply id="S3.SS1.p2.1.m1.1.1.2.cmml" xref="S3.SS1.p2.1.m1.1.1.2"><ci id="S3.SS1.p2.1.m1.1.1.2.1.cmml" xref="S3.SS1.p2.1.m1.1.1.2.1">→</ci><ci id="S3.SS1.p2.1.m1.1.1.2.2.cmml" xref="S3.SS1.p2.1.m1.1.1.2.2">𝐱</ci></apply><apply id="S3.SS1.p2.1.m1.1.1.3.cmml" xref="S3.SS1.p2.1.m1.1.1.3"><csymbol cd="ambiguous" id="S3.SS1.p2.1.m1.1.1.3.1.cmml" xref="S3.SS1.p2.1.m1.1.1.3">superscript</csymbol><ci id="S3.SS1.p2.1.m1.1.1.3.2.cmml" xref="S3.SS1.p2.1.m1.1.1.3.2">ℝ</ci><ci id="S3.SS1.p2.1.m1.1.1.3.3.cmml" xref="S3.SS1.p2.1.m1.1.1.3.3">𝑑</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p2.1.m1.1c">\overrightarrow{\mathbf{x}}\in\mathbb{R}^{d}</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p2.1.m1.1d">over→ start_ARG bold_x end_ARG ∈ blackboard_R start_POSTSUPERSCRIPT italic_d end_POSTSUPERSCRIPT</annotation></semantics></math> and outputs:</p>
<table class="ltx_equationgroup ltx_eqn_align ltx_eqn_table" id="A2.EGx1">
<tbody id="S3.E1"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_align_right ltx_eqn_cell"><math alttext="\displaystyle\textrm{Softmax}\left(\overrightarrow{\mathbf{x}}\right):=\frac{%
\exp({\mathbf{W}}\overrightarrow{\mathbf{x}})}{\left\|\exp({\mathbf{W}}%
\overrightarrow{\mathbf{x}})\right\|_{1}}\in\mathbb{R}^{c}," class="ltx_Math" display="inline" id="S3.E1.m1.6"><semantics id="S3.E1.m1.6a"><mrow id="S3.E1.m1.6.6.1" xref="S3.E1.m1.6.6.1.1.cmml"><mrow id="S3.E1.m1.6.6.1.1" xref="S3.E1.m1.6.6.1.1.cmml"><mrow id="S3.E1.m1.6.6.1.1.2" xref="S3.E1.m1.6.6.1.1.2.cmml"><mtext id="S3.E1.m1.6.6.1.1.2.2" xref="S3.E1.m1.6.6.1.1.2.2a.cmml">Softmax</mtext><mo id="S3.E1.m1.6.6.1.1.2.1" xref="S3.E1.m1.6.6.1.1.2.1.cmml">⁢</mo><mrow id="S3.E1.m1.6.6.1.1.2.3.2" xref="S3.E1.m1.5.5.cmml"><mo id="S3.E1.m1.6.6.1.1.2.3.2.1" xref="S3.E1.m1.5.5.cmml">(</mo><mover accent="true" id="S3.E1.m1.5.5" xref="S3.E1.m1.5.5.cmml"><mi id="S3.E1.m1.5.5.2" xref="S3.E1.m1.5.5.2.cmml">𝐱</mi><mo id="S3.E1.m1.5.5.1" stretchy="false" xref="S3.E1.m1.5.5.1.cmml">→</mo></mover><mo id="S3.E1.m1.6.6.1.1.2.3.2.2" rspace="0.278em" xref="S3.E1.m1.5.5.cmml">)</mo></mrow></mrow><mo id="S3.E1.m1.6.6.1.1.3" rspace="0.278em" xref="S3.E1.m1.6.6.1.1.3.cmml">:=</mo><mstyle displaystyle="true" id="S3.E1.m1.4.4" xref="S3.E1.m1.4.4.cmml"><mfrac id="S3.E1.m1.4.4a" xref="S3.E1.m1.4.4.cmml"><mrow id="S3.E1.m1.2.2.2.2" xref="S3.E1.m1.2.2.2.3.cmml"><mi id="S3.E1.m1.1.1.1.1" xref="S3.E1.m1.1.1.1.1.cmml">exp</mi><mo id="S3.E1.m1.2.2.2.2a" xref="S3.E1.m1.2.2.2.3.cmml">⁡</mo><mrow id="S3.E1.m1.2.2.2.2.1" xref="S3.E1.m1.2.2.2.3.cmml"><mo id="S3.E1.m1.2.2.2.2.1.2" stretchy="false" xref="S3.E1.m1.2.2.2.3.cmml">(</mo><mrow id="S3.E1.m1.2.2.2.2.1.1" xref="S3.E1.m1.2.2.2.2.1.1.cmml"><mi id="S3.E1.m1.2.2.2.2.1.1.2" xref="S3.E1.m1.2.2.2.2.1.1.2.cmml">𝐖</mi><mo id="S3.E1.m1.2.2.2.2.1.1.1" xref="S3.E1.m1.2.2.2.2.1.1.1.cmml">⁢</mo><mover accent="true" id="S3.E1.m1.2.2.2.2.1.1.3" xref="S3.E1.m1.2.2.2.2.1.1.3.cmml"><mi id="S3.E1.m1.2.2.2.2.1.1.3.2" xref="S3.E1.m1.2.2.2.2.1.1.3.2.cmml">𝐱</mi><mo id="S3.E1.m1.2.2.2.2.1.1.3.1" stretchy="false" xref="S3.E1.m1.2.2.2.2.1.1.3.1.cmml">→</mo></mover></mrow><mo id="S3.E1.m1.2.2.2.2.1.3" stretchy="false" xref="S3.E1.m1.2.2.2.3.cmml">)</mo></mrow></mrow><msub id="S3.E1.m1.4.4.4" xref="S3.E1.m1.4.4.4.cmml"><mrow id="S3.E1.m1.4.4.4.2.1" xref="S3.E1.m1.4.4.4.2.2.cmml"><mo id="S3.E1.m1.4.4.4.2.1.2" xref="S3.E1.m1.4.4.4.2.2.1.cmml">‖</mo><mrow id="S3.E1.m1.4.4.4.2.1.1.1" xref="S3.E1.m1.4.4.4.2.1.1.2.cmml"><mi id="S3.E1.m1.3.3.3.1" xref="S3.E1.m1.3.3.3.1.cmml">exp</mi><mo id="S3.E1.m1.4.4.4.2.1.1.1a" xref="S3.E1.m1.4.4.4.2.1.1.2.cmml">⁡</mo><mrow id="S3.E1.m1.4.4.4.2.1.1.1.1" xref="S3.E1.m1.4.4.4.2.1.1.2.cmml"><mo id="S3.E1.m1.4.4.4.2.1.1.1.1.2" stretchy="false" xref="S3.E1.m1.4.4.4.2.1.1.2.cmml">(</mo><mrow id="S3.E1.m1.4.4.4.2.1.1.1.1.1" xref="S3.E1.m1.4.4.4.2.1.1.1.1.1.cmml"><mi id="S3.E1.m1.4.4.4.2.1.1.1.1.1.2" xref="S3.E1.m1.4.4.4.2.1.1.1.1.1.2.cmml">𝐖</mi><mo id="S3.E1.m1.4.4.4.2.1.1.1.1.1.1" xref="S3.E1.m1.4.4.4.2.1.1.1.1.1.1.cmml">⁢</mo><mover accent="true" id="S3.E1.m1.4.4.4.2.1.1.1.1.1.3" xref="S3.E1.m1.4.4.4.2.1.1.1.1.1.3.cmml"><mi id="S3.E1.m1.4.4.4.2.1.1.1.1.1.3.2" xref="S3.E1.m1.4.4.4.2.1.1.1.1.1.3.2.cmml">𝐱</mi><mo id="S3.E1.m1.4.4.4.2.1.1.1.1.1.3.1" stretchy="false" xref="S3.E1.m1.4.4.4.2.1.1.1.1.1.3.1.cmml">→</mo></mover></mrow><mo id="S3.E1.m1.4.4.4.2.1.1.1.1.3" stretchy="false" xref="S3.E1.m1.4.4.4.2.1.1.2.cmml">)</mo></mrow></mrow><mo id="S3.E1.m1.4.4.4.2.1.3" xref="S3.E1.m1.4.4.4.2.2.1.cmml">‖</mo></mrow><mn id="S3.E1.m1.4.4.4.4" xref="S3.E1.m1.4.4.4.4.cmml">1</mn></msub></mfrac></mstyle><mo id="S3.E1.m1.6.6.1.1.4" xref="S3.E1.m1.6.6.1.1.4.cmml">∈</mo><msup id="S3.E1.m1.6.6.1.1.5" xref="S3.E1.m1.6.6.1.1.5.cmml"><mi id="S3.E1.m1.6.6.1.1.5.2" xref="S3.E1.m1.6.6.1.1.5.2.cmml">ℝ</mi><mi id="S3.E1.m1.6.6.1.1.5.3" xref="S3.E1.m1.6.6.1.1.5.3.cmml">c</mi></msup></mrow><mo id="S3.E1.m1.6.6.1.2" xref="S3.E1.m1.6.6.1.1.cmml">,</mo></mrow><annotation-xml encoding="MathML-Content" id="S3.E1.m1.6b"><apply id="S3.E1.m1.6.6.1.1.cmml" xref="S3.E1.m1.6.6.1"><and id="S3.E1.m1.6.6.1.1a.cmml" xref="S3.E1.m1.6.6.1"></and><apply id="S3.E1.m1.6.6.1.1b.cmml" xref="S3.E1.m1.6.6.1"><csymbol cd="latexml" id="S3.E1.m1.6.6.1.1.3.cmml" xref="S3.E1.m1.6.6.1.1.3">assign</csymbol><apply id="S3.E1.m1.6.6.1.1.2.cmml" xref="S3.E1.m1.6.6.1.1.2"><times id="S3.E1.m1.6.6.1.1.2.1.cmml" xref="S3.E1.m1.6.6.1.1.2.1"></times><ci id="S3.E1.m1.6.6.1.1.2.2a.cmml" xref="S3.E1.m1.6.6.1.1.2.2"><mtext id="S3.E1.m1.6.6.1.1.2.2.cmml" xref="S3.E1.m1.6.6.1.1.2.2">Softmax</mtext></ci><apply id="S3.E1.m1.5.5.cmml" xref="S3.E1.m1.6.6.1.1.2.3.2"><ci id="S3.E1.m1.5.5.1.cmml" xref="S3.E1.m1.5.5.1">→</ci><ci id="S3.E1.m1.5.5.2.cmml" xref="S3.E1.m1.5.5.2">𝐱</ci></apply></apply><apply id="S3.E1.m1.4.4.cmml" xref="S3.E1.m1.4.4"><divide id="S3.E1.m1.4.4.5.cmml" xref="S3.E1.m1.4.4"></divide><apply id="S3.E1.m1.2.2.2.3.cmml" xref="S3.E1.m1.2.2.2.2"><exp id="S3.E1.m1.1.1.1.1.cmml" xref="S3.E1.m1.1.1.1.1"></exp><apply id="S3.E1.m1.2.2.2.2.1.1.cmml" xref="S3.E1.m1.2.2.2.2.1.1"><times id="S3.E1.m1.2.2.2.2.1.1.1.cmml" xref="S3.E1.m1.2.2.2.2.1.1.1"></times><ci id="S3.E1.m1.2.2.2.2.1.1.2.cmml" xref="S3.E1.m1.2.2.2.2.1.1.2">𝐖</ci><apply id="S3.E1.m1.2.2.2.2.1.1.3.cmml" xref="S3.E1.m1.2.2.2.2.1.1.3"><ci id="S3.E1.m1.2.2.2.2.1.1.3.1.cmml" xref="S3.E1.m1.2.2.2.2.1.1.3.1">→</ci><ci id="S3.E1.m1.2.2.2.2.1.1.3.2.cmml" xref="S3.E1.m1.2.2.2.2.1.1.3.2">𝐱</ci></apply></apply></apply><apply id="S3.E1.m1.4.4.4.cmml" xref="S3.E1.m1.4.4.4"><csymbol cd="ambiguous" id="S3.E1.m1.4.4.4.3.cmml" xref="S3.E1.m1.4.4.4">subscript</csymbol><apply id="S3.E1.m1.4.4.4.2.2.cmml" xref="S3.E1.m1.4.4.4.2.1"><csymbol cd="latexml" id="S3.E1.m1.4.4.4.2.2.1.cmml" xref="S3.E1.m1.4.4.4.2.1.2">norm</csymbol><apply id="S3.E1.m1.4.4.4.2.1.1.2.cmml" xref="S3.E1.m1.4.4.4.2.1.1.1"><exp id="S3.E1.m1.3.3.3.1.cmml" xref="S3.E1.m1.3.3.3.1"></exp><apply id="S3.E1.m1.4.4.4.2.1.1.1.1.1.cmml" xref="S3.E1.m1.4.4.4.2.1.1.1.1.1"><times id="S3.E1.m1.4.4.4.2.1.1.1.1.1.1.cmml" xref="S3.E1.m1.4.4.4.2.1.1.1.1.1.1"></times><ci id="S3.E1.m1.4.4.4.2.1.1.1.1.1.2.cmml" xref="S3.E1.m1.4.4.4.2.1.1.1.1.1.2">𝐖</ci><apply id="S3.E1.m1.4.4.4.2.1.1.1.1.1.3.cmml" xref="S3.E1.m1.4.4.4.2.1.1.1.1.1.3"><ci id="S3.E1.m1.4.4.4.2.1.1.1.1.1.3.1.cmml" xref="S3.E1.m1.4.4.4.2.1.1.1.1.1.3.1">→</ci><ci id="S3.E1.m1.4.4.4.2.1.1.1.1.1.3.2.cmml" xref="S3.E1.m1.4.4.4.2.1.1.1.1.1.3.2">𝐱</ci></apply></apply></apply></apply><cn id="S3.E1.m1.4.4.4.4.cmml" type="integer" xref="S3.E1.m1.4.4.4.4">1</cn></apply></apply></apply><apply id="S3.E1.m1.6.6.1.1c.cmml" xref="S3.E1.m1.6.6.1"><in id="S3.E1.m1.6.6.1.1.4.cmml" xref="S3.E1.m1.6.6.1.1.4"></in><share href="#S3.E1.m1.4.4.cmml" id="S3.E1.m1.6.6.1.1d.cmml" xref="S3.E1.m1.6.6.1"></share><apply id="S3.E1.m1.6.6.1.1.5.cmml" xref="S3.E1.m1.6.6.1.1.5"><csymbol cd="ambiguous" id="S3.E1.m1.6.6.1.1.5.1.cmml" xref="S3.E1.m1.6.6.1.1.5">superscript</csymbol><ci id="S3.E1.m1.6.6.1.1.5.2.cmml" xref="S3.E1.m1.6.6.1.1.5.2">ℝ</ci><ci id="S3.E1.m1.6.6.1.1.5.3.cmml" xref="S3.E1.m1.6.6.1.1.5.3">𝑐</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.E1.m1.6c">\displaystyle\textrm{Softmax}\left(\overrightarrow{\mathbf{x}}\right):=\frac{%
\exp({\mathbf{W}}\overrightarrow{\mathbf{x}})}{\left\|\exp({\mathbf{W}}%
\overrightarrow{\mathbf{x}})\right\|_{1}}\in\mathbb{R}^{c},</annotation><annotation encoding="application/x-llamapun" id="S3.E1.m1.6d">Softmax ( over→ start_ARG bold_x end_ARG ) := divide start_ARG roman_exp ( bold_W over→ start_ARG bold_x end_ARG ) end_ARG start_ARG ∥ roman_exp ( bold_W over→ start_ARG bold_x end_ARG ) ∥ start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT end_ARG ∈ blackboard_R start_POSTSUPERSCRIPT italic_c end_POSTSUPERSCRIPT ,</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(1)</span></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S3.SS1.p2.6">where <math alttext="{\mathbf{W}}\in\mathbb{R}^{d\times c}" class="ltx_Math" display="inline" id="S3.SS1.p2.2.m1.1"><semantics id="S3.SS1.p2.2.m1.1a"><mrow id="S3.SS1.p2.2.m1.1.1" xref="S3.SS1.p2.2.m1.1.1.cmml"><mi id="S3.SS1.p2.2.m1.1.1.2" xref="S3.SS1.p2.2.m1.1.1.2.cmml">𝐖</mi><mo id="S3.SS1.p2.2.m1.1.1.1" xref="S3.SS1.p2.2.m1.1.1.1.cmml">∈</mo><msup id="S3.SS1.p2.2.m1.1.1.3" xref="S3.SS1.p2.2.m1.1.1.3.cmml"><mi id="S3.SS1.p2.2.m1.1.1.3.2" xref="S3.SS1.p2.2.m1.1.1.3.2.cmml">ℝ</mi><mrow id="S3.SS1.p2.2.m1.1.1.3.3" xref="S3.SS1.p2.2.m1.1.1.3.3.cmml"><mi id="S3.SS1.p2.2.m1.1.1.3.3.2" xref="S3.SS1.p2.2.m1.1.1.3.3.2.cmml">d</mi><mo id="S3.SS1.p2.2.m1.1.1.3.3.1" lspace="0.222em" rspace="0.222em" xref="S3.SS1.p2.2.m1.1.1.3.3.1.cmml">×</mo><mi id="S3.SS1.p2.2.m1.1.1.3.3.3" xref="S3.SS1.p2.2.m1.1.1.3.3.3.cmml">c</mi></mrow></msup></mrow><annotation-xml encoding="MathML-Content" id="S3.SS1.p2.2.m1.1b"><apply id="S3.SS1.p2.2.m1.1.1.cmml" xref="S3.SS1.p2.2.m1.1.1"><in id="S3.SS1.p2.2.m1.1.1.1.cmml" xref="S3.SS1.p2.2.m1.1.1.1"></in><ci id="S3.SS1.p2.2.m1.1.1.2.cmml" xref="S3.SS1.p2.2.m1.1.1.2">𝐖</ci><apply id="S3.SS1.p2.2.m1.1.1.3.cmml" xref="S3.SS1.p2.2.m1.1.1.3"><csymbol cd="ambiguous" id="S3.SS1.p2.2.m1.1.1.3.1.cmml" xref="S3.SS1.p2.2.m1.1.1.3">superscript</csymbol><ci id="S3.SS1.p2.2.m1.1.1.3.2.cmml" xref="S3.SS1.p2.2.m1.1.1.3.2">ℝ</ci><apply id="S3.SS1.p2.2.m1.1.1.3.3.cmml" xref="S3.SS1.p2.2.m1.1.1.3.3"><times id="S3.SS1.p2.2.m1.1.1.3.3.1.cmml" xref="S3.SS1.p2.2.m1.1.1.3.3.1"></times><ci id="S3.SS1.p2.2.m1.1.1.3.3.2.cmml" xref="S3.SS1.p2.2.m1.1.1.3.3.2">𝑑</ci><ci id="S3.SS1.p2.2.m1.1.1.3.3.3.cmml" xref="S3.SS1.p2.2.m1.1.1.3.3.3">𝑐</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p2.2.m1.1c">{\mathbf{W}}\in\mathbb{R}^{d\times c}</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p2.2.m1.1d">bold_W ∈ blackboard_R start_POSTSUPERSCRIPT italic_d × italic_c end_POSTSUPERSCRIPT</annotation></semantics></math>, <math alttext="d" class="ltx_Math" display="inline" id="S3.SS1.p2.3.m2.1"><semantics id="S3.SS1.p2.3.m2.1a"><mi id="S3.SS1.p2.3.m2.1.1" xref="S3.SS1.p2.3.m2.1.1.cmml">d</mi><annotation-xml encoding="MathML-Content" id="S3.SS1.p2.3.m2.1b"><ci id="S3.SS1.p2.3.m2.1.1.cmml" xref="S3.SS1.p2.3.m2.1.1">𝑑</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p2.3.m2.1c">d</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p2.3.m2.1d">italic_d</annotation></semantics></math> is called the model dimension and <math alttext="c" class="ltx_Math" display="inline" id="S3.SS1.p2.4.m3.1"><semantics id="S3.SS1.p2.4.m3.1a"><mi id="S3.SS1.p2.4.m3.1.1" xref="S3.SS1.p2.4.m3.1.1.cmml">c</mi><annotation-xml encoding="MathML-Content" id="S3.SS1.p2.4.m3.1b"><ci id="S3.SS1.p2.4.m3.1.1.cmml" xref="S3.SS1.p2.4.m3.1.1">𝑐</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p2.4.m3.1c">c</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p2.4.m3.1d">italic_c</annotation></semantics></math> is the number of output classes. In almost all of the applications, we only care about accurately estimating the conditional distribution on the top-<math alttext="k" class="ltx_Math" display="inline" id="S3.SS1.p2.5.m4.1"><semantics id="S3.SS1.p2.5.m4.1a"><mi id="S3.SS1.p2.5.m4.1.1" xref="S3.SS1.p2.5.m4.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="S3.SS1.p2.5.m4.1b"><ci id="S3.SS1.p2.5.m4.1.1.cmml" xref="S3.SS1.p2.5.m4.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p2.5.m4.1c">k</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p2.5.m4.1d">italic_k</annotation></semantics></math> output probabilities for some <math alttext="k" class="ltx_Math" display="inline" id="S3.SS1.p2.6.m5.1"><semantics id="S3.SS1.p2.6.m5.1a"><mi id="S3.SS1.p2.6.m5.1.1" xref="S3.SS1.p2.6.m5.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="S3.SS1.p2.6.m5.1b"><ci id="S3.SS1.p2.6.m5.1.1.cmml" xref="S3.SS1.p2.6.m5.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p2.6.m5.1c">k</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p2.6.m5.1d">italic_k</annotation></semantics></math> i.e.,</p>
<table class="ltx_equationgroup ltx_eqn_align ltx_eqn_table" id="A2.EGx2">
<tbody id="S3.E2"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_align_right ltx_eqn_cell"><math alttext="\displaystyle\textrm{Softmax}_{k}\left(\overrightarrow{\mathbf{x}}\right):=%
\frac{\textrm{Top}_{k}\left(\textrm{Softmax}\left(\overrightarrow{\mathbf{x}}%
\right)\right)}{\left\|\textrm{Top}_{k}\left(\textrm{Softmax}\left(%
\overrightarrow{\mathbf{x}}\right)\right)\right\|_{1}}\in\mathbb{R}^{c}," class="ltx_Math" display="inline" id="S3.E2.m1.6"><semantics id="S3.E2.m1.6a"><mrow id="S3.E2.m1.6.6.1" xref="S3.E2.m1.6.6.1.1.cmml"><mrow id="S3.E2.m1.6.6.1.1" xref="S3.E2.m1.6.6.1.1.cmml"><mrow id="S3.E2.m1.6.6.1.1.2" xref="S3.E2.m1.6.6.1.1.2.cmml"><msub id="S3.E2.m1.6.6.1.1.2.2" xref="S3.E2.m1.6.6.1.1.2.2.cmml"><mtext id="S3.E2.m1.6.6.1.1.2.2.2" xref="S3.E2.m1.6.6.1.1.2.2.2a.cmml">Softmax</mtext><mi id="S3.E2.m1.6.6.1.1.2.2.3" xref="S3.E2.m1.6.6.1.1.2.2.3.cmml">k</mi></msub><mo id="S3.E2.m1.6.6.1.1.2.1" xref="S3.E2.m1.6.6.1.1.2.1.cmml">⁢</mo><mrow id="S3.E2.m1.6.6.1.1.2.3.2" xref="S3.E2.m1.5.5.cmml"><mo id="S3.E2.m1.6.6.1.1.2.3.2.1" xref="S3.E2.m1.5.5.cmml">(</mo><mover accent="true" id="S3.E2.m1.5.5" xref="S3.E2.m1.5.5.cmml"><mi id="S3.E2.m1.5.5.2" xref="S3.E2.m1.5.5.2.cmml">𝐱</mi><mo id="S3.E2.m1.5.5.1" stretchy="false" xref="S3.E2.m1.5.5.1.cmml">→</mo></mover><mo id="S3.E2.m1.6.6.1.1.2.3.2.2" rspace="0.278em" xref="S3.E2.m1.5.5.cmml">)</mo></mrow></mrow><mo id="S3.E2.m1.6.6.1.1.3" rspace="0.278em" xref="S3.E2.m1.6.6.1.1.3.cmml">:=</mo><mstyle displaystyle="true" id="S3.E2.m1.4.4" xref="S3.E2.m1.4.4.cmml"><mfrac id="S3.E2.m1.4.4a" xref="S3.E2.m1.4.4.cmml"><mrow id="S3.E2.m1.2.2.2" xref="S3.E2.m1.2.2.2.cmml"><msub id="S3.E2.m1.2.2.2.4" xref="S3.E2.m1.2.2.2.4.cmml"><mtext id="S3.E2.m1.2.2.2.4.2" xref="S3.E2.m1.2.2.2.4.2a.cmml">Top</mtext><mi id="S3.E2.m1.2.2.2.4.3" xref="S3.E2.m1.2.2.2.4.3.cmml">k</mi></msub><mo id="S3.E2.m1.2.2.2.3" xref="S3.E2.m1.2.2.2.3.cmml">⁢</mo><mrow id="S3.E2.m1.2.2.2.2.1" xref="S3.E2.m1.2.2.2.2.1.1.cmml"><mo id="S3.E2.m1.2.2.2.2.1.2" xref="S3.E2.m1.2.2.2.2.1.1.cmml">(</mo><mrow id="S3.E2.m1.2.2.2.2.1.1" xref="S3.E2.m1.2.2.2.2.1.1.cmml"><mtext id="S3.E2.m1.2.2.2.2.1.1.2" xref="S3.E2.m1.2.2.2.2.1.1.2a.cmml">Softmax</mtext><mo id="S3.E2.m1.2.2.2.2.1.1.1" xref="S3.E2.m1.2.2.2.2.1.1.1.cmml">⁢</mo><mrow id="S3.E2.m1.2.2.2.2.1.1.3.2" xref="S3.E2.m1.1.1.1.1.cmml"><mo id="S3.E2.m1.2.2.2.2.1.1.3.2.1" xref="S3.E2.m1.1.1.1.1.cmml">(</mo><mover accent="true" id="S3.E2.m1.1.1.1.1" xref="S3.E2.m1.1.1.1.1.cmml"><mi id="S3.E2.m1.1.1.1.1.2" xref="S3.E2.m1.1.1.1.1.2.cmml">𝐱</mi><mo id="S3.E2.m1.1.1.1.1.1" stretchy="false" xref="S3.E2.m1.1.1.1.1.1.cmml">→</mo></mover><mo id="S3.E2.m1.2.2.2.2.1.1.3.2.2" xref="S3.E2.m1.1.1.1.1.cmml">)</mo></mrow></mrow><mo id="S3.E2.m1.2.2.2.2.1.3" xref="S3.E2.m1.2.2.2.2.1.1.cmml">)</mo></mrow></mrow><msub id="S3.E2.m1.4.4.4" xref="S3.E2.m1.4.4.4.cmml"><mrow id="S3.E2.m1.4.4.4.2.1" xref="S3.E2.m1.4.4.4.2.2.cmml"><mo id="S3.E2.m1.4.4.4.2.1.2" xref="S3.E2.m1.4.4.4.2.2.1.cmml">‖</mo><mrow id="S3.E2.m1.4.4.4.2.1.1" xref="S3.E2.m1.4.4.4.2.1.1.cmml"><msub id="S3.E2.m1.4.4.4.2.1.1.3" xref="S3.E2.m1.4.4.4.2.1.1.3.cmml"><mtext id="S3.E2.m1.4.4.4.2.1.1.3.2" xref="S3.E2.m1.4.4.4.2.1.1.3.2a.cmml">Top</mtext><mi id="S3.E2.m1.4.4.4.2.1.1.3.3" xref="S3.E2.m1.4.4.4.2.1.1.3.3.cmml">k</mi></msub><mo id="S3.E2.m1.4.4.4.2.1.1.2" xref="S3.E2.m1.4.4.4.2.1.1.2.cmml">⁢</mo><mrow id="S3.E2.m1.4.4.4.2.1.1.1.1" xref="S3.E2.m1.4.4.4.2.1.1.1.1.1.cmml"><mo id="S3.E2.m1.4.4.4.2.1.1.1.1.2" xref="S3.E2.m1.4.4.4.2.1.1.1.1.1.cmml">(</mo><mrow id="S3.E2.m1.4.4.4.2.1.1.1.1.1" xref="S3.E2.m1.4.4.4.2.1.1.1.1.1.cmml"><mtext id="S3.E2.m1.4.4.4.2.1.1.1.1.1.2" xref="S3.E2.m1.4.4.4.2.1.1.1.1.1.2a.cmml">Softmax</mtext><mo id="S3.E2.m1.4.4.4.2.1.1.1.1.1.1" xref="S3.E2.m1.4.4.4.2.1.1.1.1.1.1.cmml">⁢</mo><mrow id="S3.E2.m1.4.4.4.2.1.1.1.1.1.3.2" xref="S3.E2.m1.3.3.3.1.cmml"><mo id="S3.E2.m1.4.4.4.2.1.1.1.1.1.3.2.1" xref="S3.E2.m1.3.3.3.1.cmml">(</mo><mover accent="true" id="S3.E2.m1.3.3.3.1" xref="S3.E2.m1.3.3.3.1.cmml"><mi id="S3.E2.m1.3.3.3.1.2" xref="S3.E2.m1.3.3.3.1.2.cmml">𝐱</mi><mo id="S3.E2.m1.3.3.3.1.1" stretchy="false" xref="S3.E2.m1.3.3.3.1.1.cmml">→</mo></mover><mo id="S3.E2.m1.4.4.4.2.1.1.1.1.1.3.2.2" xref="S3.E2.m1.3.3.3.1.cmml">)</mo></mrow></mrow><mo id="S3.E2.m1.4.4.4.2.1.1.1.1.3" xref="S3.E2.m1.4.4.4.2.1.1.1.1.1.cmml">)</mo></mrow></mrow><mo id="S3.E2.m1.4.4.4.2.1.3" xref="S3.E2.m1.4.4.4.2.2.1.cmml">‖</mo></mrow><mn id="S3.E2.m1.4.4.4.4" xref="S3.E2.m1.4.4.4.4.cmml">1</mn></msub></mfrac></mstyle><mo id="S3.E2.m1.6.6.1.1.4" xref="S3.E2.m1.6.6.1.1.4.cmml">∈</mo><msup id="S3.E2.m1.6.6.1.1.5" xref="S3.E2.m1.6.6.1.1.5.cmml"><mi id="S3.E2.m1.6.6.1.1.5.2" xref="S3.E2.m1.6.6.1.1.5.2.cmml">ℝ</mi><mi id="S3.E2.m1.6.6.1.1.5.3" xref="S3.E2.m1.6.6.1.1.5.3.cmml">c</mi></msup></mrow><mo id="S3.E2.m1.6.6.1.2" xref="S3.E2.m1.6.6.1.1.cmml">,</mo></mrow><annotation-xml encoding="MathML-Content" id="S3.E2.m1.6b"><apply id="S3.E2.m1.6.6.1.1.cmml" xref="S3.E2.m1.6.6.1"><and id="S3.E2.m1.6.6.1.1a.cmml" xref="S3.E2.m1.6.6.1"></and><apply id="S3.E2.m1.6.6.1.1b.cmml" xref="S3.E2.m1.6.6.1"><csymbol cd="latexml" id="S3.E2.m1.6.6.1.1.3.cmml" xref="S3.E2.m1.6.6.1.1.3">assign</csymbol><apply id="S3.E2.m1.6.6.1.1.2.cmml" xref="S3.E2.m1.6.6.1.1.2"><times id="S3.E2.m1.6.6.1.1.2.1.cmml" xref="S3.E2.m1.6.6.1.1.2.1"></times><apply id="S3.E2.m1.6.6.1.1.2.2.cmml" xref="S3.E2.m1.6.6.1.1.2.2"><csymbol cd="ambiguous" id="S3.E2.m1.6.6.1.1.2.2.1.cmml" xref="S3.E2.m1.6.6.1.1.2.2">subscript</csymbol><ci id="S3.E2.m1.6.6.1.1.2.2.2a.cmml" xref="S3.E2.m1.6.6.1.1.2.2.2"><mtext id="S3.E2.m1.6.6.1.1.2.2.2.cmml" xref="S3.E2.m1.6.6.1.1.2.2.2">Softmax</mtext></ci><ci id="S3.E2.m1.6.6.1.1.2.2.3.cmml" xref="S3.E2.m1.6.6.1.1.2.2.3">𝑘</ci></apply><apply id="S3.E2.m1.5.5.cmml" xref="S3.E2.m1.6.6.1.1.2.3.2"><ci id="S3.E2.m1.5.5.1.cmml" xref="S3.E2.m1.5.5.1">→</ci><ci id="S3.E2.m1.5.5.2.cmml" xref="S3.E2.m1.5.5.2">𝐱</ci></apply></apply><apply id="S3.E2.m1.4.4.cmml" xref="S3.E2.m1.4.4"><divide id="S3.E2.m1.4.4.5.cmml" xref="S3.E2.m1.4.4"></divide><apply id="S3.E2.m1.2.2.2.cmml" xref="S3.E2.m1.2.2.2"><times id="S3.E2.m1.2.2.2.3.cmml" xref="S3.E2.m1.2.2.2.3"></times><apply id="S3.E2.m1.2.2.2.4.cmml" xref="S3.E2.m1.2.2.2.4"><csymbol cd="ambiguous" id="S3.E2.m1.2.2.2.4.1.cmml" xref="S3.E2.m1.2.2.2.4">subscript</csymbol><ci id="S3.E2.m1.2.2.2.4.2a.cmml" xref="S3.E2.m1.2.2.2.4.2"><mtext id="S3.E2.m1.2.2.2.4.2.cmml" xref="S3.E2.m1.2.2.2.4.2">Top</mtext></ci><ci id="S3.E2.m1.2.2.2.4.3.cmml" xref="S3.E2.m1.2.2.2.4.3">𝑘</ci></apply><apply id="S3.E2.m1.2.2.2.2.1.1.cmml" xref="S3.E2.m1.2.2.2.2.1"><times id="S3.E2.m1.2.2.2.2.1.1.1.cmml" xref="S3.E2.m1.2.2.2.2.1.1.1"></times><ci id="S3.E2.m1.2.2.2.2.1.1.2a.cmml" xref="S3.E2.m1.2.2.2.2.1.1.2"><mtext id="S3.E2.m1.2.2.2.2.1.1.2.cmml" xref="S3.E2.m1.2.2.2.2.1.1.2">Softmax</mtext></ci><apply id="S3.E2.m1.1.1.1.1.cmml" xref="S3.E2.m1.2.2.2.2.1.1.3.2"><ci id="S3.E2.m1.1.1.1.1.1.cmml" xref="S3.E2.m1.1.1.1.1.1">→</ci><ci id="S3.E2.m1.1.1.1.1.2.cmml" xref="S3.E2.m1.1.1.1.1.2">𝐱</ci></apply></apply></apply><apply id="S3.E2.m1.4.4.4.cmml" xref="S3.E2.m1.4.4.4"><csymbol cd="ambiguous" id="S3.E2.m1.4.4.4.3.cmml" xref="S3.E2.m1.4.4.4">subscript</csymbol><apply id="S3.E2.m1.4.4.4.2.2.cmml" xref="S3.E2.m1.4.4.4.2.1"><csymbol cd="latexml" id="S3.E2.m1.4.4.4.2.2.1.cmml" xref="S3.E2.m1.4.4.4.2.1.2">norm</csymbol><apply id="S3.E2.m1.4.4.4.2.1.1.cmml" xref="S3.E2.m1.4.4.4.2.1.1"><times id="S3.E2.m1.4.4.4.2.1.1.2.cmml" xref="S3.E2.m1.4.4.4.2.1.1.2"></times><apply id="S3.E2.m1.4.4.4.2.1.1.3.cmml" xref="S3.E2.m1.4.4.4.2.1.1.3"><csymbol cd="ambiguous" id="S3.E2.m1.4.4.4.2.1.1.3.1.cmml" xref="S3.E2.m1.4.4.4.2.1.1.3">subscript</csymbol><ci id="S3.E2.m1.4.4.4.2.1.1.3.2a.cmml" xref="S3.E2.m1.4.4.4.2.1.1.3.2"><mtext id="S3.E2.m1.4.4.4.2.1.1.3.2.cmml" xref="S3.E2.m1.4.4.4.2.1.1.3.2">Top</mtext></ci><ci id="S3.E2.m1.4.4.4.2.1.1.3.3.cmml" xref="S3.E2.m1.4.4.4.2.1.1.3.3">𝑘</ci></apply><apply id="S3.E2.m1.4.4.4.2.1.1.1.1.1.cmml" xref="S3.E2.m1.4.4.4.2.1.1.1.1"><times id="S3.E2.m1.4.4.4.2.1.1.1.1.1.1.cmml" xref="S3.E2.m1.4.4.4.2.1.1.1.1.1.1"></times><ci id="S3.E2.m1.4.4.4.2.1.1.1.1.1.2a.cmml" xref="S3.E2.m1.4.4.4.2.1.1.1.1.1.2"><mtext id="S3.E2.m1.4.4.4.2.1.1.1.1.1.2.cmml" xref="S3.E2.m1.4.4.4.2.1.1.1.1.1.2">Softmax</mtext></ci><apply id="S3.E2.m1.3.3.3.1.cmml" xref="S3.E2.m1.4.4.4.2.1.1.1.1.1.3.2"><ci id="S3.E2.m1.3.3.3.1.1.cmml" xref="S3.E2.m1.3.3.3.1.1">→</ci><ci id="S3.E2.m1.3.3.3.1.2.cmml" xref="S3.E2.m1.3.3.3.1.2">𝐱</ci></apply></apply></apply></apply><cn id="S3.E2.m1.4.4.4.4.cmml" type="integer" xref="S3.E2.m1.4.4.4.4">1</cn></apply></apply></apply><apply id="S3.E2.m1.6.6.1.1c.cmml" xref="S3.E2.m1.6.6.1"><in id="S3.E2.m1.6.6.1.1.4.cmml" xref="S3.E2.m1.6.6.1.1.4"></in><share href="#S3.E2.m1.4.4.cmml" id="S3.E2.m1.6.6.1.1d.cmml" xref="S3.E2.m1.6.6.1"></share><apply id="S3.E2.m1.6.6.1.1.5.cmml" xref="S3.E2.m1.6.6.1.1.5"><csymbol cd="ambiguous" id="S3.E2.m1.6.6.1.1.5.1.cmml" xref="S3.E2.m1.6.6.1.1.5">superscript</csymbol><ci id="S3.E2.m1.6.6.1.1.5.2.cmml" xref="S3.E2.m1.6.6.1.1.5.2">ℝ</ci><ci id="S3.E2.m1.6.6.1.1.5.3.cmml" xref="S3.E2.m1.6.6.1.1.5.3">𝑐</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.E2.m1.6c">\displaystyle\textrm{Softmax}_{k}\left(\overrightarrow{\mathbf{x}}\right):=%
\frac{\textrm{Top}_{k}\left(\textrm{Softmax}\left(\overrightarrow{\mathbf{x}}%
\right)\right)}{\left\|\textrm{Top}_{k}\left(\textrm{Softmax}\left(%
\overrightarrow{\mathbf{x}}\right)\right)\right\|_{1}}\in\mathbb{R}^{c},</annotation><annotation encoding="application/x-llamapun" id="S3.E2.m1.6d">Softmax start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT ( over→ start_ARG bold_x end_ARG ) := divide start_ARG Top start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT ( Softmax ( over→ start_ARG bold_x end_ARG ) ) end_ARG start_ARG ∥ Top start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT ( Softmax ( over→ start_ARG bold_x end_ARG ) ) ∥ start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT end_ARG ∈ blackboard_R start_POSTSUPERSCRIPT italic_c end_POSTSUPERSCRIPT ,</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(2)</span></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S3.SS1.p2.10">where <math alttext="\textrm{Top}_{k}\left(\cdot\right)" class="ltx_Math" display="inline" id="S3.SS1.p2.7.m1.1"><semantics id="S3.SS1.p2.7.m1.1a"><mrow id="S3.SS1.p2.7.m1.1.2" xref="S3.SS1.p2.7.m1.1.2.cmml"><msub id="S3.SS1.p2.7.m1.1.2.2" xref="S3.SS1.p2.7.m1.1.2.2.cmml"><mtext id="S3.SS1.p2.7.m1.1.2.2.2" xref="S3.SS1.p2.7.m1.1.2.2.2a.cmml">Top</mtext><mi id="S3.SS1.p2.7.m1.1.2.2.3" xref="S3.SS1.p2.7.m1.1.2.2.3.cmml">k</mi></msub><mo id="S3.SS1.p2.7.m1.1.2.1" xref="S3.SS1.p2.7.m1.1.2.1.cmml">⁢</mo><mrow id="S3.SS1.p2.7.m1.1.2.3.2" xref="S3.SS1.p2.7.m1.1.2.cmml"><mo id="S3.SS1.p2.7.m1.1.2.3.2.1" xref="S3.SS1.p2.7.m1.1.2.cmml">(</mo><mo id="S3.SS1.p2.7.m1.1.1" lspace="0em" rspace="0em" xref="S3.SS1.p2.7.m1.1.1.cmml">⋅</mo><mo id="S3.SS1.p2.7.m1.1.2.3.2.2" xref="S3.SS1.p2.7.m1.1.2.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.SS1.p2.7.m1.1b"><apply id="S3.SS1.p2.7.m1.1.2.cmml" xref="S3.SS1.p2.7.m1.1.2"><times id="S3.SS1.p2.7.m1.1.2.1.cmml" xref="S3.SS1.p2.7.m1.1.2.1"></times><apply id="S3.SS1.p2.7.m1.1.2.2.cmml" xref="S3.SS1.p2.7.m1.1.2.2"><csymbol cd="ambiguous" id="S3.SS1.p2.7.m1.1.2.2.1.cmml" xref="S3.SS1.p2.7.m1.1.2.2">subscript</csymbol><ci id="S3.SS1.p2.7.m1.1.2.2.2a.cmml" xref="S3.SS1.p2.7.m1.1.2.2.2"><mtext id="S3.SS1.p2.7.m1.1.2.2.2.cmml" xref="S3.SS1.p2.7.m1.1.2.2.2">Top</mtext></ci><ci id="S3.SS1.p2.7.m1.1.2.2.3.cmml" xref="S3.SS1.p2.7.m1.1.2.2.3">𝑘</ci></apply><ci id="S3.SS1.p2.7.m1.1.1.cmml" xref="S3.SS1.p2.7.m1.1.1">⋅</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p2.7.m1.1c">\textrm{Top}_{k}\left(\cdot\right)</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p2.7.m1.1d">Top start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT ( ⋅ )</annotation></semantics></math> operation takes a vector as input, retains the values of the top-<math alttext="k" class="ltx_Math" display="inline" id="S3.SS1.p2.8.m2.1"><semantics id="S3.SS1.p2.8.m2.1a"><mi id="S3.SS1.p2.8.m2.1.1" xref="S3.SS1.p2.8.m2.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="S3.SS1.p2.8.m2.1b"><ci id="S3.SS1.p2.8.m2.1.1.cmml" xref="S3.SS1.p2.8.m2.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p2.8.m2.1c">k</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p2.8.m2.1d">italic_k</annotation></semantics></math> entries and sets the remaining to zero. In particular, we only care about estimating the location and values of the top-<math alttext="k" class="ltx_Math" display="inline" id="S3.SS1.p2.9.m3.1"><semantics id="S3.SS1.p2.9.m3.1a"><mi id="S3.SS1.p2.9.m3.1.1" xref="S3.SS1.p2.9.m3.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="S3.SS1.p2.9.m3.1b"><ci id="S3.SS1.p2.9.m3.1.1.cmml" xref="S3.SS1.p2.9.m3.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p2.9.m3.1c">k</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p2.9.m3.1d">italic_k</annotation></semantics></math> entries of <math alttext="\textrm{Softmax}\left(\overrightarrow{\mathbf{x}}\right)" class="ltx_Math" display="inline" id="S3.SS1.p2.10.m4.1"><semantics id="S3.SS1.p2.10.m4.1a"><mrow id="S3.SS1.p2.10.m4.1.2" xref="S3.SS1.p2.10.m4.1.2.cmml"><mtext id="S3.SS1.p2.10.m4.1.2.2" xref="S3.SS1.p2.10.m4.1.2.2a.cmml">Softmax</mtext><mo id="S3.SS1.p2.10.m4.1.2.1" xref="S3.SS1.p2.10.m4.1.2.1.cmml">⁢</mo><mrow id="S3.SS1.p2.10.m4.1.2.3.2" xref="S3.SS1.p2.10.m4.1.1.cmml"><mo id="S3.SS1.p2.10.m4.1.2.3.2.1" xref="S3.SS1.p2.10.m4.1.1.cmml">(</mo><mover accent="true" id="S3.SS1.p2.10.m4.1.1" xref="S3.SS1.p2.10.m4.1.1.cmml"><mi id="S3.SS1.p2.10.m4.1.1.2" xref="S3.SS1.p2.10.m4.1.1.2.cmml">𝐱</mi><mo id="S3.SS1.p2.10.m4.1.1.1" stretchy="false" xref="S3.SS1.p2.10.m4.1.1.1.cmml">→</mo></mover><mo id="S3.SS1.p2.10.m4.1.2.3.2.2" xref="S3.SS1.p2.10.m4.1.1.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.SS1.p2.10.m4.1b"><apply id="S3.SS1.p2.10.m4.1.2.cmml" xref="S3.SS1.p2.10.m4.1.2"><times id="S3.SS1.p2.10.m4.1.2.1.cmml" xref="S3.SS1.p2.10.m4.1.2.1"></times><ci id="S3.SS1.p2.10.m4.1.2.2a.cmml" xref="S3.SS1.p2.10.m4.1.2.2"><mtext id="S3.SS1.p2.10.m4.1.2.2.cmml" xref="S3.SS1.p2.10.m4.1.2.2">Softmax</mtext></ci><apply id="S3.SS1.p2.10.m4.1.1.cmml" xref="S3.SS1.p2.10.m4.1.2.3.2"><ci id="S3.SS1.p2.10.m4.1.1.1.cmml" xref="S3.SS1.p2.10.m4.1.1.1">→</ci><ci id="S3.SS1.p2.10.m4.1.1.2.cmml" xref="S3.SS1.p2.10.m4.1.1.2">𝐱</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p2.10.m4.1c">\textrm{Softmax}\left(\overrightarrow{\mathbf{x}}\right)</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p2.10.m4.1d">Softmax ( over→ start_ARG bold_x end_ARG )</annotation></semantics></math>.</p>
</div>
<div class="ltx_para" id="S3.SS1.p3">
<p class="ltx_p" id="S3.SS1.p3.1">The <span class="ltx_text ltx_font_bold" id="S3.SS1.p3.1.1">FFN</span> layer takes an input <math alttext="\overrightarrow{\mathbf{x}}\in\mathbb{R}^{d}" class="ltx_Math" display="inline" id="S3.SS1.p3.1.m1.1"><semantics id="S3.SS1.p3.1.m1.1a"><mrow id="S3.SS1.p3.1.m1.1.1" xref="S3.SS1.p3.1.m1.1.1.cmml"><mover accent="true" id="S3.SS1.p3.1.m1.1.1.2" xref="S3.SS1.p3.1.m1.1.1.2.cmml"><mi id="S3.SS1.p3.1.m1.1.1.2.2" xref="S3.SS1.p3.1.m1.1.1.2.2.cmml">𝐱</mi><mo id="S3.SS1.p3.1.m1.1.1.2.1" stretchy="false" xref="S3.SS1.p3.1.m1.1.1.2.1.cmml">→</mo></mover><mo id="S3.SS1.p3.1.m1.1.1.1" xref="S3.SS1.p3.1.m1.1.1.1.cmml">∈</mo><msup id="S3.SS1.p3.1.m1.1.1.3" xref="S3.SS1.p3.1.m1.1.1.3.cmml"><mi id="S3.SS1.p3.1.m1.1.1.3.2" xref="S3.SS1.p3.1.m1.1.1.3.2.cmml">ℝ</mi><mi id="S3.SS1.p3.1.m1.1.1.3.3" xref="S3.SS1.p3.1.m1.1.1.3.3.cmml">d</mi></msup></mrow><annotation-xml encoding="MathML-Content" id="S3.SS1.p3.1.m1.1b"><apply id="S3.SS1.p3.1.m1.1.1.cmml" xref="S3.SS1.p3.1.m1.1.1"><in id="S3.SS1.p3.1.m1.1.1.1.cmml" xref="S3.SS1.p3.1.m1.1.1.1"></in><apply id="S3.SS1.p3.1.m1.1.1.2.cmml" xref="S3.SS1.p3.1.m1.1.1.2"><ci id="S3.SS1.p3.1.m1.1.1.2.1.cmml" xref="S3.SS1.p3.1.m1.1.1.2.1">→</ci><ci id="S3.SS1.p3.1.m1.1.1.2.2.cmml" xref="S3.SS1.p3.1.m1.1.1.2.2">𝐱</ci></apply><apply id="S3.SS1.p3.1.m1.1.1.3.cmml" xref="S3.SS1.p3.1.m1.1.1.3"><csymbol cd="ambiguous" id="S3.SS1.p3.1.m1.1.1.3.1.cmml" xref="S3.SS1.p3.1.m1.1.1.3">superscript</csymbol><ci id="S3.SS1.p3.1.m1.1.1.3.2.cmml" xref="S3.SS1.p3.1.m1.1.1.3.2">ℝ</ci><ci id="S3.SS1.p3.1.m1.1.1.3.3.cmml" xref="S3.SS1.p3.1.m1.1.1.3.3">𝑑</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p3.1.m1.1c">\overrightarrow{\mathbf{x}}\in\mathbb{R}^{d}</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p3.1.m1.1d">over→ start_ARG bold_x end_ARG ∈ blackboard_R start_POSTSUPERSCRIPT italic_d end_POSTSUPERSCRIPT</annotation></semantics></math> and outputs:</p>
<table class="ltx_equationgroup ltx_eqn_align ltx_eqn_table" id="A2.EGx3">
<tbody id="S3.E3"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_align_right ltx_eqn_cell"><math alttext="\displaystyle\textrm{FF}\left(\overrightarrow{\mathbf{x}}\right):=\sum_{j=1}^{%
m}\phi(\langle\overrightarrow{\mathbf{u}}_{j},\overrightarrow{\mathbf{x}}%
\rangle)\overrightarrow{\mathbf{v}}_{j}," class="ltx_Math" display="inline" id="S3.E3.m1.3"><semantics id="S3.E3.m1.3a"><mrow id="S3.E3.m1.3.3.1" xref="S3.E3.m1.3.3.1.1.cmml"><mrow id="S3.E3.m1.3.3.1.1" xref="S3.E3.m1.3.3.1.1.cmml"><mrow id="S3.E3.m1.3.3.1.1.3" xref="S3.E3.m1.3.3.1.1.3.cmml"><mtext id="S3.E3.m1.3.3.1.1.3.2" xref="S3.E3.m1.3.3.1.1.3.2a.cmml">FF</mtext><mo id="S3.E3.m1.3.3.1.1.3.1" xref="S3.E3.m1.3.3.1.1.3.1.cmml">⁢</mo><mrow id="S3.E3.m1.3.3.1.1.3.3.2" xref="S3.E3.m1.1.1.cmml"><mo id="S3.E3.m1.3.3.1.1.3.3.2.1" xref="S3.E3.m1.1.1.cmml">(</mo><mover accent="true" id="S3.E3.m1.1.1" xref="S3.E3.m1.1.1.cmml"><mi id="S3.E3.m1.1.1.2" xref="S3.E3.m1.1.1.2.cmml">𝐱</mi><mo id="S3.E3.m1.1.1.1" stretchy="false" xref="S3.E3.m1.1.1.1.cmml">→</mo></mover><mo id="S3.E3.m1.3.3.1.1.3.3.2.2" rspace="0.278em" xref="S3.E3.m1.1.1.cmml">)</mo></mrow></mrow><mo id="S3.E3.m1.3.3.1.1.2" rspace="0.278em" xref="S3.E3.m1.3.3.1.1.2.cmml">:=</mo><mrow id="S3.E3.m1.3.3.1.1.1" xref="S3.E3.m1.3.3.1.1.1.cmml"><mstyle displaystyle="true" id="S3.E3.m1.3.3.1.1.1.2" xref="S3.E3.m1.3.3.1.1.1.2.cmml"><munderover id="S3.E3.m1.3.3.1.1.1.2a" xref="S3.E3.m1.3.3.1.1.1.2.cmml"><mo id="S3.E3.m1.3.3.1.1.1.2.2.2" movablelimits="false" xref="S3.E3.m1.3.3.1.1.1.2.2.2.cmml">∑</mo><mrow id="S3.E3.m1.3.3.1.1.1.2.2.3" xref="S3.E3.m1.3.3.1.1.1.2.2.3.cmml"><mi id="S3.E3.m1.3.3.1.1.1.2.2.3.2" xref="S3.E3.m1.3.3.1.1.1.2.2.3.2.cmml">j</mi><mo id="S3.E3.m1.3.3.1.1.1.2.2.3.1" xref="S3.E3.m1.3.3.1.1.1.2.2.3.1.cmml">=</mo><mn id="S3.E3.m1.3.3.1.1.1.2.2.3.3" xref="S3.E3.m1.3.3.1.1.1.2.2.3.3.cmml">1</mn></mrow><mi id="S3.E3.m1.3.3.1.1.1.2.3" xref="S3.E3.m1.3.3.1.1.1.2.3.cmml">m</mi></munderover></mstyle><mrow id="S3.E3.m1.3.3.1.1.1.1" xref="S3.E3.m1.3.3.1.1.1.1.cmml"><mi id="S3.E3.m1.3.3.1.1.1.1.3" xref="S3.E3.m1.3.3.1.1.1.1.3.cmml">ϕ</mi><mo id="S3.E3.m1.3.3.1.1.1.1.2" xref="S3.E3.m1.3.3.1.1.1.1.2.cmml">⁢</mo><mrow id="S3.E3.m1.3.3.1.1.1.1.1.1" xref="S3.E3.m1.3.3.1.1.1.1.cmml"><mo id="S3.E3.m1.3.3.1.1.1.1.1.1.2" stretchy="false" xref="S3.E3.m1.3.3.1.1.1.1.cmml">(</mo><mrow id="S3.E3.m1.3.3.1.1.1.1.1.1.1.1" xref="S3.E3.m1.3.3.1.1.1.1.1.1.1.2.cmml"><mo id="S3.E3.m1.3.3.1.1.1.1.1.1.1.1.2" stretchy="false" xref="S3.E3.m1.3.3.1.1.1.1.1.1.1.2.cmml">⟨</mo><msub id="S3.E3.m1.3.3.1.1.1.1.1.1.1.1.1" xref="S3.E3.m1.3.3.1.1.1.1.1.1.1.1.1.cmml"><mover accent="true" id="S3.E3.m1.3.3.1.1.1.1.1.1.1.1.1.2" xref="S3.E3.m1.3.3.1.1.1.1.1.1.1.1.1.2.cmml"><mi id="S3.E3.m1.3.3.1.1.1.1.1.1.1.1.1.2.2" xref="S3.E3.m1.3.3.1.1.1.1.1.1.1.1.1.2.2.cmml">𝐮</mi><mo id="S3.E3.m1.3.3.1.1.1.1.1.1.1.1.1.2.1" stretchy="false" xref="S3.E3.m1.3.3.1.1.1.1.1.1.1.1.1.2.1.cmml">→</mo></mover><mi id="S3.E3.m1.3.3.1.1.1.1.1.1.1.1.1.3" xref="S3.E3.m1.3.3.1.1.1.1.1.1.1.1.1.3.cmml">j</mi></msub><mo id="S3.E3.m1.3.3.1.1.1.1.1.1.1.1.3" xref="S3.E3.m1.3.3.1.1.1.1.1.1.1.2.cmml">,</mo><mover accent="true" id="S3.E3.m1.2.2" xref="S3.E3.m1.2.2.cmml"><mi id="S3.E3.m1.2.2.2" xref="S3.E3.m1.2.2.2.cmml">𝐱</mi><mo id="S3.E3.m1.2.2.1" stretchy="false" xref="S3.E3.m1.2.2.1.cmml">→</mo></mover><mo id="S3.E3.m1.3.3.1.1.1.1.1.1.1.1.4" stretchy="false" xref="S3.E3.m1.3.3.1.1.1.1.1.1.1.2.cmml">⟩</mo></mrow><mo id="S3.E3.m1.3.3.1.1.1.1.1.1.3" stretchy="false" xref="S3.E3.m1.3.3.1.1.1.1.cmml">)</mo></mrow><mo id="S3.E3.m1.3.3.1.1.1.1.2a" xref="S3.E3.m1.3.3.1.1.1.1.2.cmml">⁢</mo><msub id="S3.E3.m1.3.3.1.1.1.1.4" xref="S3.E3.m1.3.3.1.1.1.1.4.cmml"><mover accent="true" id="S3.E3.m1.3.3.1.1.1.1.4.2" xref="S3.E3.m1.3.3.1.1.1.1.4.2.cmml"><mi id="S3.E3.m1.3.3.1.1.1.1.4.2.2" xref="S3.E3.m1.3.3.1.1.1.1.4.2.2.cmml">𝐯</mi><mo id="S3.E3.m1.3.3.1.1.1.1.4.2.1" stretchy="false" xref="S3.E3.m1.3.3.1.1.1.1.4.2.1.cmml">→</mo></mover><mi id="S3.E3.m1.3.3.1.1.1.1.4.3" xref="S3.E3.m1.3.3.1.1.1.1.4.3.cmml">j</mi></msub></mrow></mrow></mrow><mo id="S3.E3.m1.3.3.1.2" xref="S3.E3.m1.3.3.1.1.cmml">,</mo></mrow><annotation-xml encoding="MathML-Content" id="S3.E3.m1.3b"><apply id="S3.E3.m1.3.3.1.1.cmml" xref="S3.E3.m1.3.3.1"><csymbol cd="latexml" id="S3.E3.m1.3.3.1.1.2.cmml" xref="S3.E3.m1.3.3.1.1.2">assign</csymbol><apply id="S3.E3.m1.3.3.1.1.3.cmml" xref="S3.E3.m1.3.3.1.1.3"><times id="S3.E3.m1.3.3.1.1.3.1.cmml" xref="S3.E3.m1.3.3.1.1.3.1"></times><ci id="S3.E3.m1.3.3.1.1.3.2a.cmml" xref="S3.E3.m1.3.3.1.1.3.2"><mtext id="S3.E3.m1.3.3.1.1.3.2.cmml" xref="S3.E3.m1.3.3.1.1.3.2">FF</mtext></ci><apply id="S3.E3.m1.1.1.cmml" xref="S3.E3.m1.3.3.1.1.3.3.2"><ci id="S3.E3.m1.1.1.1.cmml" xref="S3.E3.m1.1.1.1">→</ci><ci id="S3.E3.m1.1.1.2.cmml" xref="S3.E3.m1.1.1.2">𝐱</ci></apply></apply><apply id="S3.E3.m1.3.3.1.1.1.cmml" xref="S3.E3.m1.3.3.1.1.1"><apply id="S3.E3.m1.3.3.1.1.1.2.cmml" xref="S3.E3.m1.3.3.1.1.1.2"><csymbol cd="ambiguous" id="S3.E3.m1.3.3.1.1.1.2.1.cmml" xref="S3.E3.m1.3.3.1.1.1.2">superscript</csymbol><apply id="S3.E3.m1.3.3.1.1.1.2.2.cmml" xref="S3.E3.m1.3.3.1.1.1.2"><csymbol cd="ambiguous" id="S3.E3.m1.3.3.1.1.1.2.2.1.cmml" xref="S3.E3.m1.3.3.1.1.1.2">subscript</csymbol><sum id="S3.E3.m1.3.3.1.1.1.2.2.2.cmml" xref="S3.E3.m1.3.3.1.1.1.2.2.2"></sum><apply id="S3.E3.m1.3.3.1.1.1.2.2.3.cmml" xref="S3.E3.m1.3.3.1.1.1.2.2.3"><eq id="S3.E3.m1.3.3.1.1.1.2.2.3.1.cmml" xref="S3.E3.m1.3.3.1.1.1.2.2.3.1"></eq><ci id="S3.E3.m1.3.3.1.1.1.2.2.3.2.cmml" xref="S3.E3.m1.3.3.1.1.1.2.2.3.2">𝑗</ci><cn id="S3.E3.m1.3.3.1.1.1.2.2.3.3.cmml" type="integer" xref="S3.E3.m1.3.3.1.1.1.2.2.3.3">1</cn></apply></apply><ci id="S3.E3.m1.3.3.1.1.1.2.3.cmml" xref="S3.E3.m1.3.3.1.1.1.2.3">𝑚</ci></apply><apply id="S3.E3.m1.3.3.1.1.1.1.cmml" xref="S3.E3.m1.3.3.1.1.1.1"><times id="S3.E3.m1.3.3.1.1.1.1.2.cmml" xref="S3.E3.m1.3.3.1.1.1.1.2"></times><ci id="S3.E3.m1.3.3.1.1.1.1.3.cmml" xref="S3.E3.m1.3.3.1.1.1.1.3">italic-ϕ</ci><list id="S3.E3.m1.3.3.1.1.1.1.1.1.1.2.cmml" xref="S3.E3.m1.3.3.1.1.1.1.1.1.1.1"><apply id="S3.E3.m1.3.3.1.1.1.1.1.1.1.1.1.cmml" xref="S3.E3.m1.3.3.1.1.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S3.E3.m1.3.3.1.1.1.1.1.1.1.1.1.1.cmml" xref="S3.E3.m1.3.3.1.1.1.1.1.1.1.1.1">subscript</csymbol><apply id="S3.E3.m1.3.3.1.1.1.1.1.1.1.1.1.2.cmml" xref="S3.E3.m1.3.3.1.1.1.1.1.1.1.1.1.2"><ci id="S3.E3.m1.3.3.1.1.1.1.1.1.1.1.1.2.1.cmml" xref="S3.E3.m1.3.3.1.1.1.1.1.1.1.1.1.2.1">→</ci><ci id="S3.E3.m1.3.3.1.1.1.1.1.1.1.1.1.2.2.cmml" xref="S3.E3.m1.3.3.1.1.1.1.1.1.1.1.1.2.2">𝐮</ci></apply><ci id="S3.E3.m1.3.3.1.1.1.1.1.1.1.1.1.3.cmml" xref="S3.E3.m1.3.3.1.1.1.1.1.1.1.1.1.3">𝑗</ci></apply><apply id="S3.E3.m1.2.2.cmml" xref="S3.E3.m1.2.2"><ci id="S3.E3.m1.2.2.1.cmml" xref="S3.E3.m1.2.2.1">→</ci><ci id="S3.E3.m1.2.2.2.cmml" xref="S3.E3.m1.2.2.2">𝐱</ci></apply></list><apply id="S3.E3.m1.3.3.1.1.1.1.4.cmml" xref="S3.E3.m1.3.3.1.1.1.1.4"><csymbol cd="ambiguous" id="S3.E3.m1.3.3.1.1.1.1.4.1.cmml" xref="S3.E3.m1.3.3.1.1.1.1.4">subscript</csymbol><apply id="S3.E3.m1.3.3.1.1.1.1.4.2.cmml" xref="S3.E3.m1.3.3.1.1.1.1.4.2"><ci id="S3.E3.m1.3.3.1.1.1.1.4.2.1.cmml" xref="S3.E3.m1.3.3.1.1.1.1.4.2.1">→</ci><ci id="S3.E3.m1.3.3.1.1.1.1.4.2.2.cmml" xref="S3.E3.m1.3.3.1.1.1.1.4.2.2">𝐯</ci></apply><ci id="S3.E3.m1.3.3.1.1.1.1.4.3.cmml" xref="S3.E3.m1.3.3.1.1.1.1.4.3">𝑗</ci></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.E3.m1.3c">\displaystyle\textrm{FF}\left(\overrightarrow{\mathbf{x}}\right):=\sum_{j=1}^{%
m}\phi(\langle\overrightarrow{\mathbf{u}}_{j},\overrightarrow{\mathbf{x}}%
\rangle)\overrightarrow{\mathbf{v}}_{j},</annotation><annotation encoding="application/x-llamapun" id="S3.E3.m1.3d">FF ( over→ start_ARG bold_x end_ARG ) := ∑ start_POSTSUBSCRIPT italic_j = 1 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_m end_POSTSUPERSCRIPT italic_ϕ ( ⟨ over→ start_ARG bold_u end_ARG start_POSTSUBSCRIPT italic_j end_POSTSUBSCRIPT , over→ start_ARG bold_x end_ARG ⟩ ) over→ start_ARG bold_v end_ARG start_POSTSUBSCRIPT italic_j end_POSTSUBSCRIPT ,</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(3)</span></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S3.SS1.p3.10">where <math alttext="\phi(\cdot)" class="ltx_Math" display="inline" id="S3.SS1.p3.2.m1.1"><semantics id="S3.SS1.p3.2.m1.1a"><mrow id="S3.SS1.p3.2.m1.1.2" xref="S3.SS1.p3.2.m1.1.2.cmml"><mi id="S3.SS1.p3.2.m1.1.2.2" xref="S3.SS1.p3.2.m1.1.2.2.cmml">ϕ</mi><mo id="S3.SS1.p3.2.m1.1.2.1" xref="S3.SS1.p3.2.m1.1.2.1.cmml">⁢</mo><mrow id="S3.SS1.p3.2.m1.1.2.3.2" xref="S3.SS1.p3.2.m1.1.2.cmml"><mo id="S3.SS1.p3.2.m1.1.2.3.2.1" stretchy="false" xref="S3.SS1.p3.2.m1.1.2.cmml">(</mo><mo id="S3.SS1.p3.2.m1.1.1" lspace="0em" rspace="0em" xref="S3.SS1.p3.2.m1.1.1.cmml">⋅</mo><mo id="S3.SS1.p3.2.m1.1.2.3.2.2" stretchy="false" xref="S3.SS1.p3.2.m1.1.2.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.SS1.p3.2.m1.1b"><apply id="S3.SS1.p3.2.m1.1.2.cmml" xref="S3.SS1.p3.2.m1.1.2"><times id="S3.SS1.p3.2.m1.1.2.1.cmml" xref="S3.SS1.p3.2.m1.1.2.1"></times><ci id="S3.SS1.p3.2.m1.1.2.2.cmml" xref="S3.SS1.p3.2.m1.1.2.2">italic-ϕ</ci><ci id="S3.SS1.p3.2.m1.1.1.cmml" xref="S3.SS1.p3.2.m1.1.1">⋅</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p3.2.m1.1c">\phi(\cdot)</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p3.2.m1.1d">italic_ϕ ( ⋅ )</annotation></semantics></math> is an activation function, <math alttext="m" class="ltx_Math" display="inline" id="S3.SS1.p3.3.m2.1"><semantics id="S3.SS1.p3.3.m2.1a"><mi id="S3.SS1.p3.3.m2.1.1" xref="S3.SS1.p3.3.m2.1.1.cmml">m</mi><annotation-xml encoding="MathML-Content" id="S3.SS1.p3.3.m2.1b"><ci id="S3.SS1.p3.3.m2.1.1.cmml" xref="S3.SS1.p3.3.m2.1.1">𝑚</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p3.3.m2.1c">m</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p3.3.m2.1d">italic_m</annotation></semantics></math> is the number of hidden units and <math alttext="\overrightarrow{\mathbf{u}}_{j}\in\mathbb{R}^{d}" class="ltx_Math" display="inline" id="S3.SS1.p3.4.m3.1"><semantics id="S3.SS1.p3.4.m3.1a"><mrow id="S3.SS1.p3.4.m3.1.1" xref="S3.SS1.p3.4.m3.1.1.cmml"><msub id="S3.SS1.p3.4.m3.1.1.2" xref="S3.SS1.p3.4.m3.1.1.2.cmml"><mover accent="true" id="S3.SS1.p3.4.m3.1.1.2.2" xref="S3.SS1.p3.4.m3.1.1.2.2.cmml"><mi id="S3.SS1.p3.4.m3.1.1.2.2.2" xref="S3.SS1.p3.4.m3.1.1.2.2.2.cmml">𝐮</mi><mo id="S3.SS1.p3.4.m3.1.1.2.2.1" stretchy="false" xref="S3.SS1.p3.4.m3.1.1.2.2.1.cmml">→</mo></mover><mi id="S3.SS1.p3.4.m3.1.1.2.3" xref="S3.SS1.p3.4.m3.1.1.2.3.cmml">j</mi></msub><mo id="S3.SS1.p3.4.m3.1.1.1" xref="S3.SS1.p3.4.m3.1.1.1.cmml">∈</mo><msup id="S3.SS1.p3.4.m3.1.1.3" xref="S3.SS1.p3.4.m3.1.1.3.cmml"><mi id="S3.SS1.p3.4.m3.1.1.3.2" xref="S3.SS1.p3.4.m3.1.1.3.2.cmml">ℝ</mi><mi id="S3.SS1.p3.4.m3.1.1.3.3" xref="S3.SS1.p3.4.m3.1.1.3.3.cmml">d</mi></msup></mrow><annotation-xml encoding="MathML-Content" id="S3.SS1.p3.4.m3.1b"><apply id="S3.SS1.p3.4.m3.1.1.cmml" xref="S3.SS1.p3.4.m3.1.1"><in id="S3.SS1.p3.4.m3.1.1.1.cmml" xref="S3.SS1.p3.4.m3.1.1.1"></in><apply id="S3.SS1.p3.4.m3.1.1.2.cmml" xref="S3.SS1.p3.4.m3.1.1.2"><csymbol cd="ambiguous" id="S3.SS1.p3.4.m3.1.1.2.1.cmml" xref="S3.SS1.p3.4.m3.1.1.2">subscript</csymbol><apply id="S3.SS1.p3.4.m3.1.1.2.2.cmml" xref="S3.SS1.p3.4.m3.1.1.2.2"><ci id="S3.SS1.p3.4.m3.1.1.2.2.1.cmml" xref="S3.SS1.p3.4.m3.1.1.2.2.1">→</ci><ci id="S3.SS1.p3.4.m3.1.1.2.2.2.cmml" xref="S3.SS1.p3.4.m3.1.1.2.2.2">𝐮</ci></apply><ci id="S3.SS1.p3.4.m3.1.1.2.3.cmml" xref="S3.SS1.p3.4.m3.1.1.2.3">𝑗</ci></apply><apply id="S3.SS1.p3.4.m3.1.1.3.cmml" xref="S3.SS1.p3.4.m3.1.1.3"><csymbol cd="ambiguous" id="S3.SS1.p3.4.m3.1.1.3.1.cmml" xref="S3.SS1.p3.4.m3.1.1.3">superscript</csymbol><ci id="S3.SS1.p3.4.m3.1.1.3.2.cmml" xref="S3.SS1.p3.4.m3.1.1.3.2">ℝ</ci><ci id="S3.SS1.p3.4.m3.1.1.3.3.cmml" xref="S3.SS1.p3.4.m3.1.1.3.3">𝑑</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p3.4.m3.1c">\overrightarrow{\mathbf{u}}_{j}\in\mathbb{R}^{d}</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p3.4.m3.1d">over→ start_ARG bold_u end_ARG start_POSTSUBSCRIPT italic_j end_POSTSUBSCRIPT ∈ blackboard_R start_POSTSUPERSCRIPT italic_d end_POSTSUPERSCRIPT</annotation></semantics></math> and <math alttext="\overrightarrow{\mathbf{v}}_{j}\in\mathbb{R}^{d}" class="ltx_Math" display="inline" id="S3.SS1.p3.5.m4.1"><semantics id="S3.SS1.p3.5.m4.1a"><mrow id="S3.SS1.p3.5.m4.1.1" xref="S3.SS1.p3.5.m4.1.1.cmml"><msub id="S3.SS1.p3.5.m4.1.1.2" xref="S3.SS1.p3.5.m4.1.1.2.cmml"><mover accent="true" id="S3.SS1.p3.5.m4.1.1.2.2" xref="S3.SS1.p3.5.m4.1.1.2.2.cmml"><mi id="S3.SS1.p3.5.m4.1.1.2.2.2" xref="S3.SS1.p3.5.m4.1.1.2.2.2.cmml">𝐯</mi><mo id="S3.SS1.p3.5.m4.1.1.2.2.1" stretchy="false" xref="S3.SS1.p3.5.m4.1.1.2.2.1.cmml">→</mo></mover><mi id="S3.SS1.p3.5.m4.1.1.2.3" xref="S3.SS1.p3.5.m4.1.1.2.3.cmml">j</mi></msub><mo id="S3.SS1.p3.5.m4.1.1.1" xref="S3.SS1.p3.5.m4.1.1.1.cmml">∈</mo><msup id="S3.SS1.p3.5.m4.1.1.3" xref="S3.SS1.p3.5.m4.1.1.3.cmml"><mi id="S3.SS1.p3.5.m4.1.1.3.2" xref="S3.SS1.p3.5.m4.1.1.3.2.cmml">ℝ</mi><mi id="S3.SS1.p3.5.m4.1.1.3.3" xref="S3.SS1.p3.5.m4.1.1.3.3.cmml">d</mi></msup></mrow><annotation-xml encoding="MathML-Content" id="S3.SS1.p3.5.m4.1b"><apply id="S3.SS1.p3.5.m4.1.1.cmml" xref="S3.SS1.p3.5.m4.1.1"><in id="S3.SS1.p3.5.m4.1.1.1.cmml" xref="S3.SS1.p3.5.m4.1.1.1"></in><apply id="S3.SS1.p3.5.m4.1.1.2.cmml" xref="S3.SS1.p3.5.m4.1.1.2"><csymbol cd="ambiguous" id="S3.SS1.p3.5.m4.1.1.2.1.cmml" xref="S3.SS1.p3.5.m4.1.1.2">subscript</csymbol><apply id="S3.SS1.p3.5.m4.1.1.2.2.cmml" xref="S3.SS1.p3.5.m4.1.1.2.2"><ci id="S3.SS1.p3.5.m4.1.1.2.2.1.cmml" xref="S3.SS1.p3.5.m4.1.1.2.2.1">→</ci><ci id="S3.SS1.p3.5.m4.1.1.2.2.2.cmml" xref="S3.SS1.p3.5.m4.1.1.2.2.2">𝐯</ci></apply><ci id="S3.SS1.p3.5.m4.1.1.2.3.cmml" xref="S3.SS1.p3.5.m4.1.1.2.3">𝑗</ci></apply><apply id="S3.SS1.p3.5.m4.1.1.3.cmml" xref="S3.SS1.p3.5.m4.1.1.3"><csymbol cd="ambiguous" id="S3.SS1.p3.5.m4.1.1.3.1.cmml" xref="S3.SS1.p3.5.m4.1.1.3">superscript</csymbol><ci id="S3.SS1.p3.5.m4.1.1.3.2.cmml" xref="S3.SS1.p3.5.m4.1.1.3.2">ℝ</ci><ci id="S3.SS1.p3.5.m4.1.1.3.3.cmml" xref="S3.SS1.p3.5.m4.1.1.3.3">𝑑</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p3.5.m4.1c">\overrightarrow{\mathbf{v}}_{j}\in\mathbb{R}^{d}</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p3.5.m4.1d">over→ start_ARG bold_v end_ARG start_POSTSUBSCRIPT italic_j end_POSTSUBSCRIPT ∈ blackboard_R start_POSTSUPERSCRIPT italic_d end_POSTSUPERSCRIPT</annotation></semantics></math> are the first and second layer weights respectively. We refer to equation <a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#S3.E3" title="3 ‣ 3.1 Problem Setup ‣ 3 Main Ideas ‣ HiRE: High Recall Approximate Top-𝑘 Estimation for Efficient LLM Inference"><span class="ltx_text ltx_ref_tag">3</span></a> as the standard or dense FFN layer.
It turns out that for specific activation functions like (powers of) ReLU, for any given <math alttext="x" class="ltx_Math" display="inline" id="S3.SS1.p3.6.m5.1"><semantics id="S3.SS1.p3.6.m5.1a"><mi id="S3.SS1.p3.6.m5.1.1" xref="S3.SS1.p3.6.m5.1.1.cmml">x</mi><annotation-xml encoding="MathML-Content" id="S3.SS1.p3.6.m5.1b"><ci id="S3.SS1.p3.6.m5.1.1.cmml" xref="S3.SS1.p3.6.m5.1.1">𝑥</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p3.6.m5.1c">x</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p3.6.m5.1d">italic_x</annotation></semantics></math>, the number of <math alttext="j" class="ltx_Math" display="inline" id="S3.SS1.p3.7.m6.1"><semantics id="S3.SS1.p3.7.m6.1a"><mi id="S3.SS1.p3.7.m6.1.1" xref="S3.SS1.p3.7.m6.1.1.cmml">j</mi><annotation-xml encoding="MathML-Content" id="S3.SS1.p3.7.m6.1b"><ci id="S3.SS1.p3.7.m6.1.1.cmml" xref="S3.SS1.p3.7.m6.1.1">𝑗</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p3.7.m6.1c">j</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p3.7.m6.1d">italic_j</annotation></semantics></math> for which the activations i.e., <math alttext="\phi(\langle\overrightarrow{\mathbf{u}}_{j},\overrightarrow{\mathbf{x}}\rangle)" class="ltx_Math" display="inline" id="S3.SS1.p3.8.m7.2"><semantics id="S3.SS1.p3.8.m7.2a"><mrow id="S3.SS1.p3.8.m7.2.2" xref="S3.SS1.p3.8.m7.2.2.cmml"><mi id="S3.SS1.p3.8.m7.2.2.3" xref="S3.SS1.p3.8.m7.2.2.3.cmml">ϕ</mi><mo id="S3.SS1.p3.8.m7.2.2.2" xref="S3.SS1.p3.8.m7.2.2.2.cmml">⁢</mo><mrow id="S3.SS1.p3.8.m7.2.2.1.1" xref="S3.SS1.p3.8.m7.2.2.cmml"><mo id="S3.SS1.p3.8.m7.2.2.1.1.2" stretchy="false" xref="S3.SS1.p3.8.m7.2.2.cmml">(</mo><mrow id="S3.SS1.p3.8.m7.2.2.1.1.1.1" xref="S3.SS1.p3.8.m7.2.2.1.1.1.2.cmml"><mo id="S3.SS1.p3.8.m7.2.2.1.1.1.1.2" stretchy="false" xref="S3.SS1.p3.8.m7.2.2.1.1.1.2.cmml">⟨</mo><msub id="S3.SS1.p3.8.m7.2.2.1.1.1.1.1" xref="S3.SS1.p3.8.m7.2.2.1.1.1.1.1.cmml"><mover accent="true" id="S3.SS1.p3.8.m7.2.2.1.1.1.1.1.2" xref="S3.SS1.p3.8.m7.2.2.1.1.1.1.1.2.cmml"><mi id="S3.SS1.p3.8.m7.2.2.1.1.1.1.1.2.2" xref="S3.SS1.p3.8.m7.2.2.1.1.1.1.1.2.2.cmml">𝐮</mi><mo id="S3.SS1.p3.8.m7.2.2.1.1.1.1.1.2.1" stretchy="false" xref="S3.SS1.p3.8.m7.2.2.1.1.1.1.1.2.1.cmml">→</mo></mover><mi id="S3.SS1.p3.8.m7.2.2.1.1.1.1.1.3" xref="S3.SS1.p3.8.m7.2.2.1.1.1.1.1.3.cmml">j</mi></msub><mo id="S3.SS1.p3.8.m7.2.2.1.1.1.1.3" xref="S3.SS1.p3.8.m7.2.2.1.1.1.2.cmml">,</mo><mover accent="true" id="S3.SS1.p3.8.m7.1.1" xref="S3.SS1.p3.8.m7.1.1.cmml"><mi id="S3.SS1.p3.8.m7.1.1.2" xref="S3.SS1.p3.8.m7.1.1.2.cmml">𝐱</mi><mo id="S3.SS1.p3.8.m7.1.1.1" stretchy="false" xref="S3.SS1.p3.8.m7.1.1.1.cmml">→</mo></mover><mo id="S3.SS1.p3.8.m7.2.2.1.1.1.1.4" stretchy="false" xref="S3.SS1.p3.8.m7.2.2.1.1.1.2.cmml">⟩</mo></mrow><mo id="S3.SS1.p3.8.m7.2.2.1.1.3" stretchy="false" xref="S3.SS1.p3.8.m7.2.2.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.SS1.p3.8.m7.2b"><apply id="S3.SS1.p3.8.m7.2.2.cmml" xref="S3.SS1.p3.8.m7.2.2"><times id="S3.SS1.p3.8.m7.2.2.2.cmml" xref="S3.SS1.p3.8.m7.2.2.2"></times><ci id="S3.SS1.p3.8.m7.2.2.3.cmml" xref="S3.SS1.p3.8.m7.2.2.3">italic-ϕ</ci><list id="S3.SS1.p3.8.m7.2.2.1.1.1.2.cmml" xref="S3.SS1.p3.8.m7.2.2.1.1.1.1"><apply id="S3.SS1.p3.8.m7.2.2.1.1.1.1.1.cmml" xref="S3.SS1.p3.8.m7.2.2.1.1.1.1.1"><csymbol cd="ambiguous" id="S3.SS1.p3.8.m7.2.2.1.1.1.1.1.1.cmml" xref="S3.SS1.p3.8.m7.2.2.1.1.1.1.1">subscript</csymbol><apply id="S3.SS1.p3.8.m7.2.2.1.1.1.1.1.2.cmml" xref="S3.SS1.p3.8.m7.2.2.1.1.1.1.1.2"><ci id="S3.SS1.p3.8.m7.2.2.1.1.1.1.1.2.1.cmml" xref="S3.SS1.p3.8.m7.2.2.1.1.1.1.1.2.1">→</ci><ci id="S3.SS1.p3.8.m7.2.2.1.1.1.1.1.2.2.cmml" xref="S3.SS1.p3.8.m7.2.2.1.1.1.1.1.2.2">𝐮</ci></apply><ci id="S3.SS1.p3.8.m7.2.2.1.1.1.1.1.3.cmml" xref="S3.SS1.p3.8.m7.2.2.1.1.1.1.1.3">𝑗</ci></apply><apply id="S3.SS1.p3.8.m7.1.1.cmml" xref="S3.SS1.p3.8.m7.1.1"><ci id="S3.SS1.p3.8.m7.1.1.1.cmml" xref="S3.SS1.p3.8.m7.1.1.1">→</ci><ci id="S3.SS1.p3.8.m7.1.1.2.cmml" xref="S3.SS1.p3.8.m7.1.1.2">𝐱</ci></apply></list></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p3.8.m7.2c">\phi(\langle\overrightarrow{\mathbf{u}}_{j},\overrightarrow{\mathbf{x}}\rangle)</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p3.8.m7.2d">italic_ϕ ( ⟨ over→ start_ARG bold_u end_ARG start_POSTSUBSCRIPT italic_j end_POSTSUBSCRIPT , over→ start_ARG bold_x end_ARG ⟩ )</annotation></semantics></math> is non-zero in a trained LLM is small (<math alttext="\lessapprox 10\%" class="ltx_Math" display="inline" id="S3.SS1.p3.9.m8.1"><semantics id="S3.SS1.p3.9.m8.1a"><mrow id="S3.SS1.p3.9.m8.1.1" xref="S3.SS1.p3.9.m8.1.1.cmml"><mi id="S3.SS1.p3.9.m8.1.1.2" xref="S3.SS1.p3.9.m8.1.1.2.cmml"></mi><mo id="S3.SS1.p3.9.m8.1.1.1" xref="S3.SS1.p3.9.m8.1.1.cmml">⪅</mo><mrow id="S3.SS1.p3.9.m8.1.1.3" xref="S3.SS1.p3.9.m8.1.1.3.cmml"><mn id="S3.SS1.p3.9.m8.1.1.3.2" xref="S3.SS1.p3.9.m8.1.1.3.2.cmml">10</mn><mo id="S3.SS1.p3.9.m8.1.1.3.1" xref="S3.SS1.p3.9.m8.1.1.3.1.cmml">%</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.SS1.p3.9.m8.1b"><or id="S3.SS1.p3.9.m8.1.1.cmml" xref="S3.SS1.p3.9.m8.1.1"><apply id="S3.SS1.p3.9.m8.1.1a.cmml" xref="S3.SS1.p3.9.m8.1.1"><lt id="S3.SS1.p3.9.m8.1.1b.cmml" xref="S3.SS1.p3.9.m8.1.1"></lt><csymbol cd="latexml" id="S3.SS1.p3.9.m8.1.1.2.cmml" xref="S3.SS1.p3.9.m8.1.1.2">absent</csymbol><apply id="S3.SS1.p3.9.m8.1.1.3.cmml" xref="S3.SS1.p3.9.m8.1.1.3"><csymbol cd="latexml" id="S3.SS1.p3.9.m8.1.1.3.1.cmml" xref="S3.SS1.p3.9.m8.1.1.3.1">percent</csymbol><cn id="S3.SS1.p3.9.m8.1.1.3.2.cmml" type="integer" xref="S3.SS1.p3.9.m8.1.1.3.2">10</cn></apply></apply><apply id="S3.SS1.p3.9.m8.1.1c.cmml" xref="S3.SS1.p3.9.m8.1.1"><approx id="S3.SS1.p3.9.m8.1.1d.cmml" xref="S3.SS1.p3.9.m8.1.1"></approx><share href="#S3.SS1.p3.9.m8.1.1.2.cmml" id="S3.SS1.p3.9.m8.1.1e.cmml" xref="S3.SS1.p3.9.m8.1.1"></share><share href="#S3.SS1.p3.9.m8.1.1.3.cmml" id="S3.SS1.p3.9.m8.1.1f.cmml" xref="S3.SS1.p3.9.m8.1.1"></share></apply></or></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p3.9.m8.1c">\lessapprox 10\%</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p3.9.m8.1d">⪅ 10 %</annotation></semantics></math>) <cite class="ltx_cite ltx_citemacro_citep">(Li et al., <a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#bib.bib32" title="">2022</a>; Mirzadeh et al., <a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#bib.bib38" title="">2023</a>)</cite>. If we explicitly do a top-<math alttext="k" class="ltx_Math" display="inline" id="S3.SS1.p3.10.m9.1"><semantics id="S3.SS1.p3.10.m9.1a"><mi id="S3.SS1.p3.10.m9.1.1" xref="S3.SS1.p3.10.m9.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="S3.SS1.p3.10.m9.1b"><ci id="S3.SS1.p3.10.m9.1.1.cmml" xref="S3.SS1.p3.10.m9.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p3.10.m9.1c">k</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p3.10.m9.1d">italic_k</annotation></semantics></math> step in the feedforward evaluation i.e.,</p>
<table class="ltx_equationgroup ltx_eqn_align ltx_eqn_table" id="A2.EGx4">
<tbody id="S3.E4"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_align_right ltx_eqn_cell"><math alttext="\displaystyle\textrm{FF}_{k}\left(\overrightarrow{\mathbf{x}}\right):=\sum_{j%
\in S(\overrightarrow{\mathbf{x}})}\phi(\langle\overrightarrow{\mathbf{u}}_{j}%
,\overrightarrow{\mathbf{x}}\rangle)\overrightarrow{\mathbf{v}}_{j}," class="ltx_Math" display="inline" id="S3.E4.m1.4"><semantics id="S3.E4.m1.4a"><mrow id="S3.E4.m1.4.4.1" xref="S3.E4.m1.4.4.1.1.cmml"><mrow id="S3.E4.m1.4.4.1.1" xref="S3.E4.m1.4.4.1.1.cmml"><mrow id="S3.E4.m1.4.4.1.1.3" xref="S3.E4.m1.4.4.1.1.3.cmml"><msub id="S3.E4.m1.4.4.1.1.3.2" xref="S3.E4.m1.4.4.1.1.3.2.cmml"><mtext id="S3.E4.m1.4.4.1.1.3.2.2" xref="S3.E4.m1.4.4.1.1.3.2.2a.cmml">FF</mtext><mi id="S3.E4.m1.4.4.1.1.3.2.3" xref="S3.E4.m1.4.4.1.1.3.2.3.cmml">k</mi></msub><mo id="S3.E4.m1.4.4.1.1.3.1" xref="S3.E4.m1.4.4.1.1.3.1.cmml">⁢</mo><mrow id="S3.E4.m1.4.4.1.1.3.3.2" xref="S3.E4.m1.2.2.cmml"><mo id="S3.E4.m1.4.4.1.1.3.3.2.1" xref="S3.E4.m1.2.2.cmml">(</mo><mover accent="true" id="S3.E4.m1.2.2" xref="S3.E4.m1.2.2.cmml"><mi id="S3.E4.m1.2.2.2" xref="S3.E4.m1.2.2.2.cmml">𝐱</mi><mo id="S3.E4.m1.2.2.1" stretchy="false" xref="S3.E4.m1.2.2.1.cmml">→</mo></mover><mo id="S3.E4.m1.4.4.1.1.3.3.2.2" rspace="0.278em" xref="S3.E4.m1.2.2.cmml">)</mo></mrow></mrow><mo id="S3.E4.m1.4.4.1.1.2" rspace="0.278em" xref="S3.E4.m1.4.4.1.1.2.cmml">:=</mo><mrow id="S3.E4.m1.4.4.1.1.1" xref="S3.E4.m1.4.4.1.1.1.cmml"><mstyle displaystyle="true" id="S3.E4.m1.4.4.1.1.1.2" xref="S3.E4.m1.4.4.1.1.1.2.cmml"><munder id="S3.E4.m1.4.4.1.1.1.2a" xref="S3.E4.m1.4.4.1.1.1.2.cmml"><mo id="S3.E4.m1.4.4.1.1.1.2.2" movablelimits="false" xref="S3.E4.m1.4.4.1.1.1.2.2.cmml">∑</mo><mrow id="S3.E4.m1.1.1.1" xref="S3.E4.m1.1.1.1.cmml"><mi id="S3.E4.m1.1.1.1.3" xref="S3.E4.m1.1.1.1.3.cmml">j</mi><mo id="S3.E4.m1.1.1.1.2" xref="S3.E4.m1.1.1.1.2.cmml">∈</mo><mrow id="S3.E4.m1.1.1.1.4" xref="S3.E4.m1.1.1.1.4.cmml"><mi id="S3.E4.m1.1.1.1.4.2" xref="S3.E4.m1.1.1.1.4.2.cmml">S</mi><mo id="S3.E4.m1.1.1.1.4.1" xref="S3.E4.m1.1.1.1.4.1.cmml">⁢</mo><mrow id="S3.E4.m1.1.1.1.4.3.2" xref="S3.E4.m1.1.1.1.1.cmml"><mo id="S3.E4.m1.1.1.1.4.3.2.1" stretchy="false" xref="S3.E4.m1.1.1.1.1.cmml">(</mo><mover accent="true" id="S3.E4.m1.1.1.1.1" xref="S3.E4.m1.1.1.1.1.cmml"><mi id="S3.E4.m1.1.1.1.1.2" xref="S3.E4.m1.1.1.1.1.2.cmml">𝐱</mi><mo id="S3.E4.m1.1.1.1.1.1" stretchy="false" xref="S3.E4.m1.1.1.1.1.1.cmml">→</mo></mover><mo id="S3.E4.m1.1.1.1.4.3.2.2" stretchy="false" xref="S3.E4.m1.1.1.1.1.cmml">)</mo></mrow></mrow></mrow></munder></mstyle><mrow id="S3.E4.m1.4.4.1.1.1.1" xref="S3.E4.m1.4.4.1.1.1.1.cmml"><mi id="S3.E4.m1.4.4.1.1.1.1.3" xref="S3.E4.m1.4.4.1.1.1.1.3.cmml">ϕ</mi><mo id="S3.E4.m1.4.4.1.1.1.1.2" xref="S3.E4.m1.4.4.1.1.1.1.2.cmml">⁢</mo><mrow id="S3.E4.m1.4.4.1.1.1.1.1.1" xref="S3.E4.m1.4.4.1.1.1.1.cmml"><mo id="S3.E4.m1.4.4.1.1.1.1.1.1.2" stretchy="false" xref="S3.E4.m1.4.4.1.1.1.1.cmml">(</mo><mrow id="S3.E4.m1.4.4.1.1.1.1.1.1.1.1" xref="S3.E4.m1.4.4.1.1.1.1.1.1.1.2.cmml"><mo id="S3.E4.m1.4.4.1.1.1.1.1.1.1.1.2" stretchy="false" xref="S3.E4.m1.4.4.1.1.1.1.1.1.1.2.cmml">⟨</mo><msub id="S3.E4.m1.4.4.1.1.1.1.1.1.1.1.1" xref="S3.E4.m1.4.4.1.1.1.1.1.1.1.1.1.cmml"><mover accent="true" id="S3.E4.m1.4.4.1.1.1.1.1.1.1.1.1.2" xref="S3.E4.m1.4.4.1.1.1.1.1.1.1.1.1.2.cmml"><mi id="S3.E4.m1.4.4.1.1.1.1.1.1.1.1.1.2.2" xref="S3.E4.m1.4.4.1.1.1.1.1.1.1.1.1.2.2.cmml">𝐮</mi><mo id="S3.E4.m1.4.4.1.1.1.1.1.1.1.1.1.2.1" stretchy="false" xref="S3.E4.m1.4.4.1.1.1.1.1.1.1.1.1.2.1.cmml">→</mo></mover><mi id="S3.E4.m1.4.4.1.1.1.1.1.1.1.1.1.3" xref="S3.E4.m1.4.4.1.1.1.1.1.1.1.1.1.3.cmml">j</mi></msub><mo id="S3.E4.m1.4.4.1.1.1.1.1.1.1.1.3" xref="S3.E4.m1.4.4.1.1.1.1.1.1.1.2.cmml">,</mo><mover accent="true" id="S3.E4.m1.3.3" xref="S3.E4.m1.3.3.cmml"><mi id="S3.E4.m1.3.3.2" xref="S3.E4.m1.3.3.2.cmml">𝐱</mi><mo id="S3.E4.m1.3.3.1" stretchy="false" xref="S3.E4.m1.3.3.1.cmml">→</mo></mover><mo id="S3.E4.m1.4.4.1.1.1.1.1.1.1.1.4" stretchy="false" xref="S3.E4.m1.4.4.1.1.1.1.1.1.1.2.cmml">⟩</mo></mrow><mo id="S3.E4.m1.4.4.1.1.1.1.1.1.3" stretchy="false" xref="S3.E4.m1.4.4.1.1.1.1.cmml">)</mo></mrow><mo id="S3.E4.m1.4.4.1.1.1.1.2a" xref="S3.E4.m1.4.4.1.1.1.1.2.cmml">⁢</mo><msub id="S3.E4.m1.4.4.1.1.1.1.4" xref="S3.E4.m1.4.4.1.1.1.1.4.cmml"><mover accent="true" id="S3.E4.m1.4.4.1.1.1.1.4.2" xref="S3.E4.m1.4.4.1.1.1.1.4.2.cmml"><mi id="S3.E4.m1.4.4.1.1.1.1.4.2.2" xref="S3.E4.m1.4.4.1.1.1.1.4.2.2.cmml">𝐯</mi><mo id="S3.E4.m1.4.4.1.1.1.1.4.2.1" stretchy="false" xref="S3.E4.m1.4.4.1.1.1.1.4.2.1.cmml">→</mo></mover><mi id="S3.E4.m1.4.4.1.1.1.1.4.3" xref="S3.E4.m1.4.4.1.1.1.1.4.3.cmml">j</mi></msub></mrow></mrow></mrow><mo id="S3.E4.m1.4.4.1.2" xref="S3.E4.m1.4.4.1.1.cmml">,</mo></mrow><annotation-xml encoding="MathML-Content" id="S3.E4.m1.4b"><apply id="S3.E4.m1.4.4.1.1.cmml" xref="S3.E4.m1.4.4.1"><csymbol cd="latexml" id="S3.E4.m1.4.4.1.1.2.cmml" xref="S3.E4.m1.4.4.1.1.2">assign</csymbol><apply id="S3.E4.m1.4.4.1.1.3.cmml" xref="S3.E4.m1.4.4.1.1.3"><times id="S3.E4.m1.4.4.1.1.3.1.cmml" xref="S3.E4.m1.4.4.1.1.3.1"></times><apply id="S3.E4.m1.4.4.1.1.3.2.cmml" xref="S3.E4.m1.4.4.1.1.3.2"><csymbol cd="ambiguous" id="S3.E4.m1.4.4.1.1.3.2.1.cmml" xref="S3.E4.m1.4.4.1.1.3.2">subscript</csymbol><ci id="S3.E4.m1.4.4.1.1.3.2.2a.cmml" xref="S3.E4.m1.4.4.1.1.3.2.2"><mtext id="S3.E4.m1.4.4.1.1.3.2.2.cmml" xref="S3.E4.m1.4.4.1.1.3.2.2">FF</mtext></ci><ci id="S3.E4.m1.4.4.1.1.3.2.3.cmml" xref="S3.E4.m1.4.4.1.1.3.2.3">𝑘</ci></apply><apply id="S3.E4.m1.2.2.cmml" xref="S3.E4.m1.4.4.1.1.3.3.2"><ci id="S3.E4.m1.2.2.1.cmml" xref="S3.E4.m1.2.2.1">→</ci><ci id="S3.E4.m1.2.2.2.cmml" xref="S3.E4.m1.2.2.2">𝐱</ci></apply></apply><apply id="S3.E4.m1.4.4.1.1.1.cmml" xref="S3.E4.m1.4.4.1.1.1"><apply id="S3.E4.m1.4.4.1.1.1.2.cmml" xref="S3.E4.m1.4.4.1.1.1.2"><csymbol cd="ambiguous" id="S3.E4.m1.4.4.1.1.1.2.1.cmml" xref="S3.E4.m1.4.4.1.1.1.2">subscript</csymbol><sum id="S3.E4.m1.4.4.1.1.1.2.2.cmml" xref="S3.E4.m1.4.4.1.1.1.2.2"></sum><apply id="S3.E4.m1.1.1.1.cmml" xref="S3.E4.m1.1.1.1"><in id="S3.E4.m1.1.1.1.2.cmml" xref="S3.E4.m1.1.1.1.2"></in><ci id="S3.E4.m1.1.1.1.3.cmml" xref="S3.E4.m1.1.1.1.3">𝑗</ci><apply id="S3.E4.m1.1.1.1.4.cmml" xref="S3.E4.m1.1.1.1.4"><times id="S3.E4.m1.1.1.1.4.1.cmml" xref="S3.E4.m1.1.1.1.4.1"></times><ci id="S3.E4.m1.1.1.1.4.2.cmml" xref="S3.E4.m1.1.1.1.4.2">𝑆</ci><apply id="S3.E4.m1.1.1.1.1.cmml" xref="S3.E4.m1.1.1.1.4.3.2"><ci id="S3.E4.m1.1.1.1.1.1.cmml" xref="S3.E4.m1.1.1.1.1.1">→</ci><ci id="S3.E4.m1.1.1.1.1.2.cmml" xref="S3.E4.m1.1.1.1.1.2">𝐱</ci></apply></apply></apply></apply><apply id="S3.E4.m1.4.4.1.1.1.1.cmml" xref="S3.E4.m1.4.4.1.1.1.1"><times id="S3.E4.m1.4.4.1.1.1.1.2.cmml" xref="S3.E4.m1.4.4.1.1.1.1.2"></times><ci id="S3.E4.m1.4.4.1.1.1.1.3.cmml" xref="S3.E4.m1.4.4.1.1.1.1.3">italic-ϕ</ci><list id="S3.E4.m1.4.4.1.1.1.1.1.1.1.2.cmml" xref="S3.E4.m1.4.4.1.1.1.1.1.1.1.1"><apply id="S3.E4.m1.4.4.1.1.1.1.1.1.1.1.1.cmml" xref="S3.E4.m1.4.4.1.1.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S3.E4.m1.4.4.1.1.1.1.1.1.1.1.1.1.cmml" xref="S3.E4.m1.4.4.1.1.1.1.1.1.1.1.1">subscript</csymbol><apply id="S3.E4.m1.4.4.1.1.1.1.1.1.1.1.1.2.cmml" xref="S3.E4.m1.4.4.1.1.1.1.1.1.1.1.1.2"><ci id="S3.E4.m1.4.4.1.1.1.1.1.1.1.1.1.2.1.cmml" xref="S3.E4.m1.4.4.1.1.1.1.1.1.1.1.1.2.1">→</ci><ci id="S3.E4.m1.4.4.1.1.1.1.1.1.1.1.1.2.2.cmml" xref="S3.E4.m1.4.4.1.1.1.1.1.1.1.1.1.2.2">𝐮</ci></apply><ci id="S3.E4.m1.4.4.1.1.1.1.1.1.1.1.1.3.cmml" xref="S3.E4.m1.4.4.1.1.1.1.1.1.1.1.1.3">𝑗</ci></apply><apply id="S3.E4.m1.3.3.cmml" xref="S3.E4.m1.3.3"><ci id="S3.E4.m1.3.3.1.cmml" xref="S3.E4.m1.3.3.1">→</ci><ci id="S3.E4.m1.3.3.2.cmml" xref="S3.E4.m1.3.3.2">𝐱</ci></apply></list><apply id="S3.E4.m1.4.4.1.1.1.1.4.cmml" xref="S3.E4.m1.4.4.1.1.1.1.4"><csymbol cd="ambiguous" id="S3.E4.m1.4.4.1.1.1.1.4.1.cmml" xref="S3.E4.m1.4.4.1.1.1.1.4">subscript</csymbol><apply id="S3.E4.m1.4.4.1.1.1.1.4.2.cmml" xref="S3.E4.m1.4.4.1.1.1.1.4.2"><ci id="S3.E4.m1.4.4.1.1.1.1.4.2.1.cmml" xref="S3.E4.m1.4.4.1.1.1.1.4.2.1">→</ci><ci id="S3.E4.m1.4.4.1.1.1.1.4.2.2.cmml" xref="S3.E4.m1.4.4.1.1.1.1.4.2.2">𝐯</ci></apply><ci id="S3.E4.m1.4.4.1.1.1.1.4.3.cmml" xref="S3.E4.m1.4.4.1.1.1.1.4.3">𝑗</ci></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.E4.m1.4c">\displaystyle\textrm{FF}_{k}\left(\overrightarrow{\mathbf{x}}\right):=\sum_{j%
\in S(\overrightarrow{\mathbf{x}})}\phi(\langle\overrightarrow{\mathbf{u}}_{j}%
,\overrightarrow{\mathbf{x}}\rangle)\overrightarrow{\mathbf{v}}_{j},</annotation><annotation encoding="application/x-llamapun" id="S3.E4.m1.4d">FF start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT ( over→ start_ARG bold_x end_ARG ) := ∑ start_POSTSUBSCRIPT italic_j ∈ italic_S ( over→ start_ARG bold_x end_ARG ) end_POSTSUBSCRIPT italic_ϕ ( ⟨ over→ start_ARG bold_u end_ARG start_POSTSUBSCRIPT italic_j end_POSTSUBSCRIPT , over→ start_ARG bold_x end_ARG ⟩ ) over→ start_ARG bold_v end_ARG start_POSTSUBSCRIPT italic_j end_POSTSUBSCRIPT ,</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(4)</span></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S3.SS1.p3.19">where <math alttext="S(\overrightarrow{\mathbf{x}}):=\textrm{TopInd}_{k}\left(\phi(\mathbf{U}^{\top%
}{\overrightarrow{\mathbf{x}}})\right)" class="ltx_Math" display="inline" id="S3.SS1.p3.11.m1.2"><semantics id="S3.SS1.p3.11.m1.2a"><mrow id="S3.SS1.p3.11.m1.2.2" xref="S3.SS1.p3.11.m1.2.2.cmml"><mrow id="S3.SS1.p3.11.m1.2.2.3" xref="S3.SS1.p3.11.m1.2.2.3.cmml"><mi id="S3.SS1.p3.11.m1.2.2.3.2" xref="S3.SS1.p3.11.m1.2.2.3.2.cmml">S</mi><mo id="S3.SS1.p3.11.m1.2.2.3.1" xref="S3.SS1.p3.11.m1.2.2.3.1.cmml">⁢</mo><mrow id="S3.SS1.p3.11.m1.2.2.3.3.2" xref="S3.SS1.p3.11.m1.1.1.cmml"><mo id="S3.SS1.p3.11.m1.2.2.3.3.2.1" stretchy="false" xref="S3.SS1.p3.11.m1.1.1.cmml">(</mo><mover accent="true" id="S3.SS1.p3.11.m1.1.1" xref="S3.SS1.p3.11.m1.1.1.cmml"><mi id="S3.SS1.p3.11.m1.1.1.2" xref="S3.SS1.p3.11.m1.1.1.2.cmml">𝐱</mi><mo id="S3.SS1.p3.11.m1.1.1.1" stretchy="false" xref="S3.SS1.p3.11.m1.1.1.1.cmml">→</mo></mover><mo id="S3.SS1.p3.11.m1.2.2.3.3.2.2" rspace="0.278em" stretchy="false" xref="S3.SS1.p3.11.m1.1.1.cmml">)</mo></mrow></mrow><mo id="S3.SS1.p3.11.m1.2.2.2" rspace="0.278em" xref="S3.SS1.p3.11.m1.2.2.2.cmml">:=</mo><mrow id="S3.SS1.p3.11.m1.2.2.1" xref="S3.SS1.p3.11.m1.2.2.1.cmml"><msub id="S3.SS1.p3.11.m1.2.2.1.3" xref="S3.SS1.p3.11.m1.2.2.1.3.cmml"><mtext id="S3.SS1.p3.11.m1.2.2.1.3.2" xref="S3.SS1.p3.11.m1.2.2.1.3.2a.cmml">TopInd</mtext><mi id="S3.SS1.p3.11.m1.2.2.1.3.3" xref="S3.SS1.p3.11.m1.2.2.1.3.3.cmml">k</mi></msub><mo id="S3.SS1.p3.11.m1.2.2.1.2" xref="S3.SS1.p3.11.m1.2.2.1.2.cmml">⁢</mo><mrow id="S3.SS1.p3.11.m1.2.2.1.1.1" xref="S3.SS1.p3.11.m1.2.2.1.1.1.1.cmml"><mo id="S3.SS1.p3.11.m1.2.2.1.1.1.2" xref="S3.SS1.p3.11.m1.2.2.1.1.1.1.cmml">(</mo><mrow id="S3.SS1.p3.11.m1.2.2.1.1.1.1" xref="S3.SS1.p3.11.m1.2.2.1.1.1.1.cmml"><mi id="S3.SS1.p3.11.m1.2.2.1.1.1.1.3" xref="S3.SS1.p3.11.m1.2.2.1.1.1.1.3.cmml">ϕ</mi><mo id="S3.SS1.p3.11.m1.2.2.1.1.1.1.2" xref="S3.SS1.p3.11.m1.2.2.1.1.1.1.2.cmml">⁢</mo><mrow id="S3.SS1.p3.11.m1.2.2.1.1.1.1.1.1" xref="S3.SS1.p3.11.m1.2.2.1.1.1.1.1.1.1.cmml"><mo id="S3.SS1.p3.11.m1.2.2.1.1.1.1.1.1.2" stretchy="false" xref="S3.SS1.p3.11.m1.2.2.1.1.1.1.1.1.1.cmml">(</mo><mrow id="S3.SS1.p3.11.m1.2.2.1.1.1.1.1.1.1" xref="S3.SS1.p3.11.m1.2.2.1.1.1.1.1.1.1.cmml"><msup id="S3.SS1.p3.11.m1.2.2.1.1.1.1.1.1.1.2" xref="S3.SS1.p3.11.m1.2.2.1.1.1.1.1.1.1.2.cmml"><mi id="S3.SS1.p3.11.m1.2.2.1.1.1.1.1.1.1.2.2" xref="S3.SS1.p3.11.m1.2.2.1.1.1.1.1.1.1.2.2.cmml">𝐔</mi><mo id="S3.SS1.p3.11.m1.2.2.1.1.1.1.1.1.1.2.3" xref="S3.SS1.p3.11.m1.2.2.1.1.1.1.1.1.1.2.3.cmml">⊤</mo></msup><mo id="S3.SS1.p3.11.m1.2.2.1.1.1.1.1.1.1.1" xref="S3.SS1.p3.11.m1.2.2.1.1.1.1.1.1.1.1.cmml">⁢</mo><mover accent="true" id="S3.SS1.p3.11.m1.2.2.1.1.1.1.1.1.1.3" xref="S3.SS1.p3.11.m1.2.2.1.1.1.1.1.1.1.3.cmml"><mi id="S3.SS1.p3.11.m1.2.2.1.1.1.1.1.1.1.3.2" xref="S3.SS1.p3.11.m1.2.2.1.1.1.1.1.1.1.3.2.cmml">𝐱</mi><mo id="S3.SS1.p3.11.m1.2.2.1.1.1.1.1.1.1.3.1" stretchy="false" xref="S3.SS1.p3.11.m1.2.2.1.1.1.1.1.1.1.3.1.cmml">→</mo></mover></mrow><mo id="S3.SS1.p3.11.m1.2.2.1.1.1.1.1.1.3" stretchy="false" xref="S3.SS1.p3.11.m1.2.2.1.1.1.1.1.1.1.cmml">)</mo></mrow></mrow><mo id="S3.SS1.p3.11.m1.2.2.1.1.1.3" xref="S3.SS1.p3.11.m1.2.2.1.1.1.1.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.SS1.p3.11.m1.2b"><apply id="S3.SS1.p3.11.m1.2.2.cmml" xref="S3.SS1.p3.11.m1.2.2"><csymbol cd="latexml" id="S3.SS1.p3.11.m1.2.2.2.cmml" xref="S3.SS1.p3.11.m1.2.2.2">assign</csymbol><apply id="S3.SS1.p3.11.m1.2.2.3.cmml" xref="S3.SS1.p3.11.m1.2.2.3"><times id="S3.SS1.p3.11.m1.2.2.3.1.cmml" xref="S3.SS1.p3.11.m1.2.2.3.1"></times><ci id="S3.SS1.p3.11.m1.2.2.3.2.cmml" xref="S3.SS1.p3.11.m1.2.2.3.2">𝑆</ci><apply id="S3.SS1.p3.11.m1.1.1.cmml" xref="S3.SS1.p3.11.m1.2.2.3.3.2"><ci id="S3.SS1.p3.11.m1.1.1.1.cmml" xref="S3.SS1.p3.11.m1.1.1.1">→</ci><ci id="S3.SS1.p3.11.m1.1.1.2.cmml" xref="S3.SS1.p3.11.m1.1.1.2">𝐱</ci></apply></apply><apply id="S3.SS1.p3.11.m1.2.2.1.cmml" xref="S3.SS1.p3.11.m1.2.2.1"><times id="S3.SS1.p3.11.m1.2.2.1.2.cmml" xref="S3.SS1.p3.11.m1.2.2.1.2"></times><apply id="S3.SS1.p3.11.m1.2.2.1.3.cmml" xref="S3.SS1.p3.11.m1.2.2.1.3"><csymbol cd="ambiguous" id="S3.SS1.p3.11.m1.2.2.1.3.1.cmml" xref="S3.SS1.p3.11.m1.2.2.1.3">subscript</csymbol><ci id="S3.SS1.p3.11.m1.2.2.1.3.2a.cmml" xref="S3.SS1.p3.11.m1.2.2.1.3.2"><mtext id="S3.SS1.p3.11.m1.2.2.1.3.2.cmml" xref="S3.SS1.p3.11.m1.2.2.1.3.2">TopInd</mtext></ci><ci id="S3.SS1.p3.11.m1.2.2.1.3.3.cmml" xref="S3.SS1.p3.11.m1.2.2.1.3.3">𝑘</ci></apply><apply id="S3.SS1.p3.11.m1.2.2.1.1.1.1.cmml" xref="S3.SS1.p3.11.m1.2.2.1.1.1"><times id="S3.SS1.p3.11.m1.2.2.1.1.1.1.2.cmml" xref="S3.SS1.p3.11.m1.2.2.1.1.1.1.2"></times><ci id="S3.SS1.p3.11.m1.2.2.1.1.1.1.3.cmml" xref="S3.SS1.p3.11.m1.2.2.1.1.1.1.3">italic-ϕ</ci><apply id="S3.SS1.p3.11.m1.2.2.1.1.1.1.1.1.1.cmml" xref="S3.SS1.p3.11.m1.2.2.1.1.1.1.1.1"><times id="S3.SS1.p3.11.m1.2.2.1.1.1.1.1.1.1.1.cmml" xref="S3.SS1.p3.11.m1.2.2.1.1.1.1.1.1.1.1"></times><apply id="S3.SS1.p3.11.m1.2.2.1.1.1.1.1.1.1.2.cmml" xref="S3.SS1.p3.11.m1.2.2.1.1.1.1.1.1.1.2"><csymbol cd="ambiguous" id="S3.SS1.p3.11.m1.2.2.1.1.1.1.1.1.1.2.1.cmml" xref="S3.SS1.p3.11.m1.2.2.1.1.1.1.1.1.1.2">superscript</csymbol><ci id="S3.SS1.p3.11.m1.2.2.1.1.1.1.1.1.1.2.2.cmml" xref="S3.SS1.p3.11.m1.2.2.1.1.1.1.1.1.1.2.2">𝐔</ci><csymbol cd="latexml" id="S3.SS1.p3.11.m1.2.2.1.1.1.1.1.1.1.2.3.cmml" xref="S3.SS1.p3.11.m1.2.2.1.1.1.1.1.1.1.2.3">top</csymbol></apply><apply id="S3.SS1.p3.11.m1.2.2.1.1.1.1.1.1.1.3.cmml" xref="S3.SS1.p3.11.m1.2.2.1.1.1.1.1.1.1.3"><ci id="S3.SS1.p3.11.m1.2.2.1.1.1.1.1.1.1.3.1.cmml" xref="S3.SS1.p3.11.m1.2.2.1.1.1.1.1.1.1.3.1">→</ci><ci id="S3.SS1.p3.11.m1.2.2.1.1.1.1.1.1.1.3.2.cmml" xref="S3.SS1.p3.11.m1.2.2.1.1.1.1.1.1.1.3.2">𝐱</ci></apply></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p3.11.m1.2c">S(\overrightarrow{\mathbf{x}}):=\textrm{TopInd}_{k}\left(\phi(\mathbf{U}^{\top%
}{\overrightarrow{\mathbf{x}}})\right)</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p3.11.m1.2d">italic_S ( over→ start_ARG bold_x end_ARG ) := TopInd start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT ( italic_ϕ ( bold_U start_POSTSUPERSCRIPT ⊤ end_POSTSUPERSCRIPT over→ start_ARG bold_x end_ARG ) )</annotation></semantics></math>, where <math alttext="\mathbf{U}" class="ltx_Math" display="inline" id="S3.SS1.p3.12.m2.1"><semantics id="S3.SS1.p3.12.m2.1a"><mi id="S3.SS1.p3.12.m2.1.1" xref="S3.SS1.p3.12.m2.1.1.cmml">𝐔</mi><annotation-xml encoding="MathML-Content" id="S3.SS1.p3.12.m2.1b"><ci id="S3.SS1.p3.12.m2.1.1.cmml" xref="S3.SS1.p3.12.m2.1.1">𝐔</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p3.12.m2.1c">\mathbf{U}</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p3.12.m2.1d">bold_U</annotation></semantics></math> is the matrix whose <math alttext="j^{\textrm{th}}" class="ltx_Math" display="inline" id="S3.SS1.p3.13.m3.1"><semantics id="S3.SS1.p3.13.m3.1a"><msup id="S3.SS1.p3.13.m3.1.1" xref="S3.SS1.p3.13.m3.1.1.cmml"><mi id="S3.SS1.p3.13.m3.1.1.2" xref="S3.SS1.p3.13.m3.1.1.2.cmml">j</mi><mtext id="S3.SS1.p3.13.m3.1.1.3" xref="S3.SS1.p3.13.m3.1.1.3a.cmml">th</mtext></msup><annotation-xml encoding="MathML-Content" id="S3.SS1.p3.13.m3.1b"><apply id="S3.SS1.p3.13.m3.1.1.cmml" xref="S3.SS1.p3.13.m3.1.1"><csymbol cd="ambiguous" id="S3.SS1.p3.13.m3.1.1.1.cmml" xref="S3.SS1.p3.13.m3.1.1">superscript</csymbol><ci id="S3.SS1.p3.13.m3.1.1.2.cmml" xref="S3.SS1.p3.13.m3.1.1.2">𝑗</ci><ci id="S3.SS1.p3.13.m3.1.1.3a.cmml" xref="S3.SS1.p3.13.m3.1.1.3"><mtext id="S3.SS1.p3.13.m3.1.1.3.cmml" mathsize="70%" xref="S3.SS1.p3.13.m3.1.1.3">th</mtext></ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p3.13.m3.1c">j^{\textrm{th}}</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p3.13.m3.1d">italic_j start_POSTSUPERSCRIPT th end_POSTSUPERSCRIPT</annotation></semantics></math> column is <math alttext="\overrightarrow{\mathbf{u}}_{j}" class="ltx_Math" display="inline" id="S3.SS1.p3.14.m4.1"><semantics id="S3.SS1.p3.14.m4.1a"><msub id="S3.SS1.p3.14.m4.1.1" xref="S3.SS1.p3.14.m4.1.1.cmml"><mover accent="true" id="S3.SS1.p3.14.m4.1.1.2" xref="S3.SS1.p3.14.m4.1.1.2.cmml"><mi id="S3.SS1.p3.14.m4.1.1.2.2" xref="S3.SS1.p3.14.m4.1.1.2.2.cmml">𝐮</mi><mo id="S3.SS1.p3.14.m4.1.1.2.1" stretchy="false" xref="S3.SS1.p3.14.m4.1.1.2.1.cmml">→</mo></mover><mi id="S3.SS1.p3.14.m4.1.1.3" xref="S3.SS1.p3.14.m4.1.1.3.cmml">j</mi></msub><annotation-xml encoding="MathML-Content" id="S3.SS1.p3.14.m4.1b"><apply id="S3.SS1.p3.14.m4.1.1.cmml" xref="S3.SS1.p3.14.m4.1.1"><csymbol cd="ambiguous" id="S3.SS1.p3.14.m4.1.1.1.cmml" xref="S3.SS1.p3.14.m4.1.1">subscript</csymbol><apply id="S3.SS1.p3.14.m4.1.1.2.cmml" xref="S3.SS1.p3.14.m4.1.1.2"><ci id="S3.SS1.p3.14.m4.1.1.2.1.cmml" xref="S3.SS1.p3.14.m4.1.1.2.1">→</ci><ci id="S3.SS1.p3.14.m4.1.1.2.2.cmml" xref="S3.SS1.p3.14.m4.1.1.2.2">𝐮</ci></apply><ci id="S3.SS1.p3.14.m4.1.1.3.cmml" xref="S3.SS1.p3.14.m4.1.1.3">𝑗</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p3.14.m4.1c">\overrightarrow{\mathbf{u}}_{j}</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p3.14.m4.1d">over→ start_ARG bold_u end_ARG start_POSTSUBSCRIPT italic_j end_POSTSUBSCRIPT</annotation></semantics></math> and <math alttext="\textrm{TopInd}_{k}\left(\overrightarrow{\mathbf{z}}\right)" class="ltx_Math" display="inline" id="S3.SS1.p3.15.m5.1"><semantics id="S3.SS1.p3.15.m5.1a"><mrow id="S3.SS1.p3.15.m5.1.2" xref="S3.SS1.p3.15.m5.1.2.cmml"><msub id="S3.SS1.p3.15.m5.1.2.2" xref="S3.SS1.p3.15.m5.1.2.2.cmml"><mtext id="S3.SS1.p3.15.m5.1.2.2.2" xref="S3.SS1.p3.15.m5.1.2.2.2a.cmml">TopInd</mtext><mi id="S3.SS1.p3.15.m5.1.2.2.3" xref="S3.SS1.p3.15.m5.1.2.2.3.cmml">k</mi></msub><mo id="S3.SS1.p3.15.m5.1.2.1" xref="S3.SS1.p3.15.m5.1.2.1.cmml">⁢</mo><mrow id="S3.SS1.p3.15.m5.1.2.3.2" xref="S3.SS1.p3.15.m5.1.1.cmml"><mo id="S3.SS1.p3.15.m5.1.2.3.2.1" xref="S3.SS1.p3.15.m5.1.1.cmml">(</mo><mover accent="true" id="S3.SS1.p3.15.m5.1.1" xref="S3.SS1.p3.15.m5.1.1.cmml"><mi id="S3.SS1.p3.15.m5.1.1.2" xref="S3.SS1.p3.15.m5.1.1.2.cmml">𝐳</mi><mo id="S3.SS1.p3.15.m5.1.1.1" stretchy="false" xref="S3.SS1.p3.15.m5.1.1.1.cmml">→</mo></mover><mo id="S3.SS1.p3.15.m5.1.2.3.2.2" xref="S3.SS1.p3.15.m5.1.1.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.SS1.p3.15.m5.1b"><apply id="S3.SS1.p3.15.m5.1.2.cmml" xref="S3.SS1.p3.15.m5.1.2"><times id="S3.SS1.p3.15.m5.1.2.1.cmml" xref="S3.SS1.p3.15.m5.1.2.1"></times><apply id="S3.SS1.p3.15.m5.1.2.2.cmml" xref="S3.SS1.p3.15.m5.1.2.2"><csymbol cd="ambiguous" id="S3.SS1.p3.15.m5.1.2.2.1.cmml" xref="S3.SS1.p3.15.m5.1.2.2">subscript</csymbol><ci id="S3.SS1.p3.15.m5.1.2.2.2a.cmml" xref="S3.SS1.p3.15.m5.1.2.2.2"><mtext id="S3.SS1.p3.15.m5.1.2.2.2.cmml" xref="S3.SS1.p3.15.m5.1.2.2.2">TopInd</mtext></ci><ci id="S3.SS1.p3.15.m5.1.2.2.3.cmml" xref="S3.SS1.p3.15.m5.1.2.2.3">𝑘</ci></apply><apply id="S3.SS1.p3.15.m5.1.1.cmml" xref="S3.SS1.p3.15.m5.1.2.3.2"><ci id="S3.SS1.p3.15.m5.1.1.1.cmml" xref="S3.SS1.p3.15.m5.1.1.1">→</ci><ci id="S3.SS1.p3.15.m5.1.1.2.cmml" xref="S3.SS1.p3.15.m5.1.1.2">𝐳</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p3.15.m5.1c">\textrm{TopInd}_{k}\left(\overrightarrow{\mathbf{z}}\right)</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p3.15.m5.1d">TopInd start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT ( over→ start_ARG bold_z end_ARG )</annotation></semantics></math> denotes the set of indices where the top-<math alttext="k" class="ltx_Math" display="inline" id="S3.SS1.p3.16.m6.1"><semantics id="S3.SS1.p3.16.m6.1a"><mi id="S3.SS1.p3.16.m6.1.1" xref="S3.SS1.p3.16.m6.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="S3.SS1.p3.16.m6.1b"><ci id="S3.SS1.p3.16.m6.1.1.cmml" xref="S3.SS1.p3.16.m6.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p3.16.m6.1c">k</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p3.16.m6.1d">italic_k</annotation></semantics></math> entries occur in <math alttext="\overrightarrow{\mathbf{z}}" class="ltx_Math" display="inline" id="S3.SS1.p3.17.m7.1"><semantics id="S3.SS1.p3.17.m7.1a"><mover accent="true" id="S3.SS1.p3.17.m7.1.1" xref="S3.SS1.p3.17.m7.1.1.cmml"><mi id="S3.SS1.p3.17.m7.1.1.2" xref="S3.SS1.p3.17.m7.1.1.2.cmml">𝐳</mi><mo id="S3.SS1.p3.17.m7.1.1.1" stretchy="false" xref="S3.SS1.p3.17.m7.1.1.1.cmml">→</mo></mover><annotation-xml encoding="MathML-Content" id="S3.SS1.p3.17.m7.1b"><apply id="S3.SS1.p3.17.m7.1.1.cmml" xref="S3.SS1.p3.17.m7.1.1"><ci id="S3.SS1.p3.17.m7.1.1.1.cmml" xref="S3.SS1.p3.17.m7.1.1.1">→</ci><ci id="S3.SS1.p3.17.m7.1.1.2.cmml" xref="S3.SS1.p3.17.m7.1.1.2">𝐳</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p3.17.m7.1c">\overrightarrow{\mathbf{z}}</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p3.17.m7.1d">over→ start_ARG bold_z end_ARG</annotation></semantics></math>, then the number of non-zeros reduces even further without drop in quality for <math alttext="k\approx 5\%" class="ltx_Math" display="inline" id="S3.SS1.p3.18.m8.1"><semantics id="S3.SS1.p3.18.m8.1a"><mrow id="S3.SS1.p3.18.m8.1.1" xref="S3.SS1.p3.18.m8.1.1.cmml"><mi id="S3.SS1.p3.18.m8.1.1.2" xref="S3.SS1.p3.18.m8.1.1.2.cmml">k</mi><mo id="S3.SS1.p3.18.m8.1.1.1" xref="S3.SS1.p3.18.m8.1.1.1.cmml">≈</mo><mrow id="S3.SS1.p3.18.m8.1.1.3" xref="S3.SS1.p3.18.m8.1.1.3.cmml"><mn id="S3.SS1.p3.18.m8.1.1.3.2" xref="S3.SS1.p3.18.m8.1.1.3.2.cmml">5</mn><mo id="S3.SS1.p3.18.m8.1.1.3.1" xref="S3.SS1.p3.18.m8.1.1.3.1.cmml">%</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.SS1.p3.18.m8.1b"><apply id="S3.SS1.p3.18.m8.1.1.cmml" xref="S3.SS1.p3.18.m8.1.1"><approx id="S3.SS1.p3.18.m8.1.1.1.cmml" xref="S3.SS1.p3.18.m8.1.1.1"></approx><ci id="S3.SS1.p3.18.m8.1.1.2.cmml" xref="S3.SS1.p3.18.m8.1.1.2">𝑘</ci><apply id="S3.SS1.p3.18.m8.1.1.3.cmml" xref="S3.SS1.p3.18.m8.1.1.3"><csymbol cd="latexml" id="S3.SS1.p3.18.m8.1.1.3.1.cmml" xref="S3.SS1.p3.18.m8.1.1.3.1">percent</csymbol><cn id="S3.SS1.p3.18.m8.1.1.3.2.cmml" type="integer" xref="S3.SS1.p3.18.m8.1.1.3.2">5</cn></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p3.18.m8.1c">k\approx 5\%</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p3.18.m8.1d">italic_k ≈ 5 %</annotation></semantics></math> <cite class="ltx_cite ltx_citemacro_citep">(Li et al., <a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#bib.bib32" title="">2022</a>)</cite>. We refer to equation <a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#S3.E4" title="4 ‣ 3.1 Problem Setup ‣ 3 Main Ideas ‣ HiRE: High Recall Approximate Top-𝑘 Estimation for Efficient LLM Inference"><span class="ltx_text ltx_ref_tag">4</span></a> as the sparse or top-<math alttext="k" class="ltx_Math" display="inline" id="S3.SS1.p3.19.m9.1"><semantics id="S3.SS1.p3.19.m9.1a"><mi id="S3.SS1.p3.19.m9.1.1" xref="S3.SS1.p3.19.m9.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="S3.SS1.p3.19.m9.1b"><ci id="S3.SS1.p3.19.m9.1.1.cmml" xref="S3.SS1.p3.19.m9.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p3.19.m9.1c">k</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p3.19.m9.1d">italic_k</annotation></semantics></math> FFN layer.</p>
</div>
<div class="ltx_para" id="S3.SS1.p4">
<p class="ltx_p" id="S3.SS1.p4.4">We now abstract out the key component that can speed up both top-<math alttext="k" class="ltx_Math" display="inline" id="S3.SS1.p4.1.m1.1"><semantics id="S3.SS1.p4.1.m1.1a"><mi id="S3.SS1.p4.1.m1.1.1" xref="S3.SS1.p4.1.m1.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="S3.SS1.p4.1.m1.1b"><ci id="S3.SS1.p4.1.m1.1.1.cmml" xref="S3.SS1.p4.1.m1.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p4.1.m1.1c">k</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p4.1.m1.1d">italic_k</annotation></semantics></math> based softmax equation <a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#S3.E2" title="2 ‣ 3.1 Problem Setup ‣ 3 Main Ideas ‣ HiRE: High Recall Approximate Top-𝑘 Estimation for Efficient LLM Inference"><span class="ltx_text ltx_ref_tag">2</span></a> as well as top-<math alttext="k" class="ltx_Math" display="inline" id="S3.SS1.p4.2.m2.1"><semantics id="S3.SS1.p4.2.m2.1a"><mi id="S3.SS1.p4.2.m2.1.1" xref="S3.SS1.p4.2.m2.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="S3.SS1.p4.2.m2.1b"><ci id="S3.SS1.p4.2.m2.1.1.cmml" xref="S3.SS1.p4.2.m2.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p4.2.m2.1c">k</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p4.2.m2.1d">italic_k</annotation></semantics></math> based FFN equation <a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#S3.E4" title="4 ‣ 3.1 Problem Setup ‣ 3 Main Ideas ‣ HiRE: High Recall Approximate Top-𝑘 Estimation for Efficient LLM Inference"><span class="ltx_text ltx_ref_tag">4</span></a> as follows. Given a matrix <math alttext="{\mathbf{Z}}\in\mathbb{R}^{d\times\ell}" class="ltx_Math" display="inline" id="S3.SS1.p4.3.m3.1"><semantics id="S3.SS1.p4.3.m3.1a"><mrow id="S3.SS1.p4.3.m3.1.1" xref="S3.SS1.p4.3.m3.1.1.cmml"><mi id="S3.SS1.p4.3.m3.1.1.2" xref="S3.SS1.p4.3.m3.1.1.2.cmml">𝐙</mi><mo id="S3.SS1.p4.3.m3.1.1.1" xref="S3.SS1.p4.3.m3.1.1.1.cmml">∈</mo><msup id="S3.SS1.p4.3.m3.1.1.3" xref="S3.SS1.p4.3.m3.1.1.3.cmml"><mi id="S3.SS1.p4.3.m3.1.1.3.2" xref="S3.SS1.p4.3.m3.1.1.3.2.cmml">ℝ</mi><mrow id="S3.SS1.p4.3.m3.1.1.3.3" xref="S3.SS1.p4.3.m3.1.1.3.3.cmml"><mi id="S3.SS1.p4.3.m3.1.1.3.3.2" xref="S3.SS1.p4.3.m3.1.1.3.3.2.cmml">d</mi><mo id="S3.SS1.p4.3.m3.1.1.3.3.1" lspace="0.222em" rspace="0.222em" xref="S3.SS1.p4.3.m3.1.1.3.3.1.cmml">×</mo><mi id="S3.SS1.p4.3.m3.1.1.3.3.3" mathvariant="normal" xref="S3.SS1.p4.3.m3.1.1.3.3.3.cmml">ℓ</mi></mrow></msup></mrow><annotation-xml encoding="MathML-Content" id="S3.SS1.p4.3.m3.1b"><apply id="S3.SS1.p4.3.m3.1.1.cmml" xref="S3.SS1.p4.3.m3.1.1"><in id="S3.SS1.p4.3.m3.1.1.1.cmml" xref="S3.SS1.p4.3.m3.1.1.1"></in><ci id="S3.SS1.p4.3.m3.1.1.2.cmml" xref="S3.SS1.p4.3.m3.1.1.2">𝐙</ci><apply id="S3.SS1.p4.3.m3.1.1.3.cmml" xref="S3.SS1.p4.3.m3.1.1.3"><csymbol cd="ambiguous" id="S3.SS1.p4.3.m3.1.1.3.1.cmml" xref="S3.SS1.p4.3.m3.1.1.3">superscript</csymbol><ci id="S3.SS1.p4.3.m3.1.1.3.2.cmml" xref="S3.SS1.p4.3.m3.1.1.3.2">ℝ</ci><apply id="S3.SS1.p4.3.m3.1.1.3.3.cmml" xref="S3.SS1.p4.3.m3.1.1.3.3"><times id="S3.SS1.p4.3.m3.1.1.3.3.1.cmml" xref="S3.SS1.p4.3.m3.1.1.3.3.1"></times><ci id="S3.SS1.p4.3.m3.1.1.3.3.2.cmml" xref="S3.SS1.p4.3.m3.1.1.3.3.2">𝑑</ci><ci id="S3.SS1.p4.3.m3.1.1.3.3.3.cmml" xref="S3.SS1.p4.3.m3.1.1.3.3.3">ℓ</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p4.3.m3.1c">{\mathbf{Z}}\in\mathbb{R}^{d\times\ell}</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p4.3.m3.1d">bold_Z ∈ blackboard_R start_POSTSUPERSCRIPT italic_d × roman_ℓ end_POSTSUPERSCRIPT</annotation></semantics></math> and a vector <math alttext="\overrightarrow{\mathbf{x}}\in\mathbb{R}^{d}" class="ltx_Math" display="inline" id="S3.SS1.p4.4.m4.1"><semantics id="S3.SS1.p4.4.m4.1a"><mrow id="S3.SS1.p4.4.m4.1.1" xref="S3.SS1.p4.4.m4.1.1.cmml"><mover accent="true" id="S3.SS1.p4.4.m4.1.1.2" xref="S3.SS1.p4.4.m4.1.1.2.cmml"><mi id="S3.SS1.p4.4.m4.1.1.2.2" xref="S3.SS1.p4.4.m4.1.1.2.2.cmml">𝐱</mi><mo id="S3.SS1.p4.4.m4.1.1.2.1" stretchy="false" xref="S3.SS1.p4.4.m4.1.1.2.1.cmml">→</mo></mover><mo id="S3.SS1.p4.4.m4.1.1.1" xref="S3.SS1.p4.4.m4.1.1.1.cmml">∈</mo><msup id="S3.SS1.p4.4.m4.1.1.3" xref="S3.SS1.p4.4.m4.1.1.3.cmml"><mi id="S3.SS1.p4.4.m4.1.1.3.2" xref="S3.SS1.p4.4.m4.1.1.3.2.cmml">ℝ</mi><mi id="S3.SS1.p4.4.m4.1.1.3.3" xref="S3.SS1.p4.4.m4.1.1.3.3.cmml">d</mi></msup></mrow><annotation-xml encoding="MathML-Content" id="S3.SS1.p4.4.m4.1b"><apply id="S3.SS1.p4.4.m4.1.1.cmml" xref="S3.SS1.p4.4.m4.1.1"><in id="S3.SS1.p4.4.m4.1.1.1.cmml" xref="S3.SS1.p4.4.m4.1.1.1"></in><apply id="S3.SS1.p4.4.m4.1.1.2.cmml" xref="S3.SS1.p4.4.m4.1.1.2"><ci id="S3.SS1.p4.4.m4.1.1.2.1.cmml" xref="S3.SS1.p4.4.m4.1.1.2.1">→</ci><ci id="S3.SS1.p4.4.m4.1.1.2.2.cmml" xref="S3.SS1.p4.4.m4.1.1.2.2">𝐱</ci></apply><apply id="S3.SS1.p4.4.m4.1.1.3.cmml" xref="S3.SS1.p4.4.m4.1.1.3"><csymbol cd="ambiguous" id="S3.SS1.p4.4.m4.1.1.3.1.cmml" xref="S3.SS1.p4.4.m4.1.1.3">superscript</csymbol><ci id="S3.SS1.p4.4.m4.1.1.3.2.cmml" xref="S3.SS1.p4.4.m4.1.1.3.2">ℝ</ci><ci id="S3.SS1.p4.4.m4.1.1.3.3.cmml" xref="S3.SS1.p4.4.m4.1.1.3.3">𝑑</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p4.4.m4.1c">\overrightarrow{\mathbf{x}}\in\mathbb{R}^{d}</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p4.4.m4.1d">over→ start_ARG bold_x end_ARG ∈ blackboard_R start_POSTSUPERSCRIPT italic_d end_POSTSUPERSCRIPT</annotation></semantics></math>, we wish to compute:</p>
<table class="ltx_equationgroup ltx_eqn_align ltx_eqn_table" id="A2.EGx5">
<tbody id="S3.E5"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_align_right ltx_eqn_cell"><math alttext="\displaystyle S=\{(i,\phi(\langle\overrightarrow{\mathbf{z}}_{i},%
\overrightarrow{\mathbf{x}}\rangle)):i\in\textrm{TopInd}_{k}\left(\phi({%
\mathbf{Z}}^{\top}{\overrightarrow{\mathbf{x}}})\right)\}," class="ltx_Math" display="inline" id="S3.E5.m1.3"><semantics id="S3.E5.m1.3a"><mrow id="S3.E5.m1.3.3.1" xref="S3.E5.m1.3.3.1.1.cmml"><mrow id="S3.E5.m1.3.3.1.1" xref="S3.E5.m1.3.3.1.1.cmml"><mi id="S3.E5.m1.3.3.1.1.4" xref="S3.E5.m1.3.3.1.1.4.cmml">S</mi><mo id="S3.E5.m1.3.3.1.1.3" xref="S3.E5.m1.3.3.1.1.3.cmml">=</mo><mrow id="S3.E5.m1.3.3.1.1.2.2" xref="S3.E5.m1.3.3.1.1.2.3.cmml"><mo id="S3.E5.m1.3.3.1.1.2.2.3" stretchy="false" xref="S3.E5.m1.3.3.1.1.2.3.1.cmml">{</mo><mrow id="S3.E5.m1.3.3.1.1.1.1.1.1" xref="S3.E5.m1.3.3.1.1.1.1.1.2.cmml"><mo id="S3.E5.m1.3.3.1.1.1.1.1.1.2" stretchy="false" xref="S3.E5.m1.3.3.1.1.1.1.1.2.cmml">(</mo><mi id="S3.E5.m1.2.2" xref="S3.E5.m1.2.2.cmml">i</mi><mo id="S3.E5.m1.3.3.1.1.1.1.1.1.3" xref="S3.E5.m1.3.3.1.1.1.1.1.2.cmml">,</mo><mrow id="S3.E5.m1.3.3.1.1.1.1.1.1.1" xref="S3.E5.m1.3.3.1.1.1.1.1.1.1.cmml"><mi id="S3.E5.m1.3.3.1.1.1.1.1.1.1.3" xref="S3.E5.m1.3.3.1.1.1.1.1.1.1.3.cmml">ϕ</mi><mo id="S3.E5.m1.3.3.1.1.1.1.1.1.1.2" xref="S3.E5.m1.3.3.1.1.1.1.1.1.1.2.cmml">⁢</mo><mrow id="S3.E5.m1.3.3.1.1.1.1.1.1.1.1.1" xref="S3.E5.m1.3.3.1.1.1.1.1.1.1.cmml"><mo id="S3.E5.m1.3.3.1.1.1.1.1.1.1.1.1.2" stretchy="false" xref="S3.E5.m1.3.3.1.1.1.1.1.1.1.cmml">(</mo><mrow id="S3.E5.m1.3.3.1.1.1.1.1.1.1.1.1.1.1" xref="S3.E5.m1.3.3.1.1.1.1.1.1.1.1.1.1.2.cmml"><mo id="S3.E5.m1.3.3.1.1.1.1.1.1.1.1.1.1.1.2" stretchy="false" xref="S3.E5.m1.3.3.1.1.1.1.1.1.1.1.1.1.2.cmml">⟨</mo><msub id="S3.E5.m1.3.3.1.1.1.1.1.1.1.1.1.1.1.1" xref="S3.E5.m1.3.3.1.1.1.1.1.1.1.1.1.1.1.1.cmml"><mover accent="true" id="S3.E5.m1.3.3.1.1.1.1.1.1.1.1.1.1.1.1.2" xref="S3.E5.m1.3.3.1.1.1.1.1.1.1.1.1.1.1.1.2.cmml"><mi id="S3.E5.m1.3.3.1.1.1.1.1.1.1.1.1.1.1.1.2.2" xref="S3.E5.m1.3.3.1.1.1.1.1.1.1.1.1.1.1.1.2.2.cmml">𝐳</mi><mo id="S3.E5.m1.3.3.1.1.1.1.1.1.1.1.1.1.1.1.2.1" stretchy="false" xref="S3.E5.m1.3.3.1.1.1.1.1.1.1.1.1.1.1.1.2.1.cmml">→</mo></mover><mi id="S3.E5.m1.3.3.1.1.1.1.1.1.1.1.1.1.1.1.3" xref="S3.E5.m1.3.3.1.1.1.1.1.1.1.1.1.1.1.1.3.cmml">i</mi></msub><mo id="S3.E5.m1.3.3.1.1.1.1.1.1.1.1.1.1.1.3" xref="S3.E5.m1.3.3.1.1.1.1.1.1.1.1.1.1.2.cmml">,</mo><mover accent="true" id="S3.E5.m1.1.1" xref="S3.E5.m1.1.1.cmml"><mi id="S3.E5.m1.1.1.2" xref="S3.E5.m1.1.1.2.cmml">𝐱</mi><mo id="S3.E5.m1.1.1.1" stretchy="false" xref="S3.E5.m1.1.1.1.cmml">→</mo></mover><mo id="S3.E5.m1.3.3.1.1.1.1.1.1.1.1.1.1.1.4" stretchy="false" xref="S3.E5.m1.3.3.1.1.1.1.1.1.1.1.1.1.2.cmml">⟩</mo></mrow><mo id="S3.E5.m1.3.3.1.1.1.1.1.1.1.1.1.3" stretchy="false" xref="S3.E5.m1.3.3.1.1.1.1.1.1.1.cmml">)</mo></mrow></mrow><mo id="S3.E5.m1.3.3.1.1.1.1.1.1.4" rspace="0.278em" stretchy="false" xref="S3.E5.m1.3.3.1.1.1.1.1.2.cmml">)</mo></mrow><mo id="S3.E5.m1.3.3.1.1.2.2.4" rspace="0.278em" xref="S3.E5.m1.3.3.1.1.2.3.1.cmml">:</mo><mrow id="S3.E5.m1.3.3.1.1.2.2.2" xref="S3.E5.m1.3.3.1.1.2.2.2.cmml"><mi id="S3.E5.m1.3.3.1.1.2.2.2.3" xref="S3.E5.m1.3.3.1.1.2.2.2.3.cmml">i</mi><mo id="S3.E5.m1.3.3.1.1.2.2.2.2" xref="S3.E5.m1.3.3.1.1.2.2.2.2.cmml">∈</mo><mrow id="S3.E5.m1.3.3.1.1.2.2.2.1" xref="S3.E5.m1.3.3.1.1.2.2.2.1.cmml"><msub id="S3.E5.m1.3.3.1.1.2.2.2.1.3" xref="S3.E5.m1.3.3.1.1.2.2.2.1.3.cmml"><mtext id="S3.E5.m1.3.3.1.1.2.2.2.1.3.2" xref="S3.E5.m1.3.3.1.1.2.2.2.1.3.2a.cmml">TopInd</mtext><mi id="S3.E5.m1.3.3.1.1.2.2.2.1.3.3" xref="S3.E5.m1.3.3.1.1.2.2.2.1.3.3.cmml">k</mi></msub><mo id="S3.E5.m1.3.3.1.1.2.2.2.1.2" xref="S3.E5.m1.3.3.1.1.2.2.2.1.2.cmml">⁢</mo><mrow id="S3.E5.m1.3.3.1.1.2.2.2.1.1.1" xref="S3.E5.m1.3.3.1.1.2.2.2.1.1.1.1.cmml"><mo id="S3.E5.m1.3.3.1.1.2.2.2.1.1.1.2" xref="S3.E5.m1.3.3.1.1.2.2.2.1.1.1.1.cmml">(</mo><mrow id="S3.E5.m1.3.3.1.1.2.2.2.1.1.1.1" xref="S3.E5.m1.3.3.1.1.2.2.2.1.1.1.1.cmml"><mi id="S3.E5.m1.3.3.1.1.2.2.2.1.1.1.1.3" xref="S3.E5.m1.3.3.1.1.2.2.2.1.1.1.1.3.cmml">ϕ</mi><mo id="S3.E5.m1.3.3.1.1.2.2.2.1.1.1.1.2" xref="S3.E5.m1.3.3.1.1.2.2.2.1.1.1.1.2.cmml">⁢</mo><mrow id="S3.E5.m1.3.3.1.1.2.2.2.1.1.1.1.1.1" xref="S3.E5.m1.3.3.1.1.2.2.2.1.1.1.1.1.1.1.cmml"><mo id="S3.E5.m1.3.3.1.1.2.2.2.1.1.1.1.1.1.2" stretchy="false" xref="S3.E5.m1.3.3.1.1.2.2.2.1.1.1.1.1.1.1.cmml">(</mo><mrow id="S3.E5.m1.3.3.1.1.2.2.2.1.1.1.1.1.1.1" xref="S3.E5.m1.3.3.1.1.2.2.2.1.1.1.1.1.1.1.cmml"><msup id="S3.E5.m1.3.3.1.1.2.2.2.1.1.1.1.1.1.1.2" xref="S3.E5.m1.3.3.1.1.2.2.2.1.1.1.1.1.1.1.2.cmml"><mi id="S3.E5.m1.3.3.1.1.2.2.2.1.1.1.1.1.1.1.2.2" xref="S3.E5.m1.3.3.1.1.2.2.2.1.1.1.1.1.1.1.2.2.cmml">𝐙</mi><mo id="S3.E5.m1.3.3.1.1.2.2.2.1.1.1.1.1.1.1.2.3" xref="S3.E5.m1.3.3.1.1.2.2.2.1.1.1.1.1.1.1.2.3.cmml">⊤</mo></msup><mo id="S3.E5.m1.3.3.1.1.2.2.2.1.1.1.1.1.1.1.1" xref="S3.E5.m1.3.3.1.1.2.2.2.1.1.1.1.1.1.1.1.cmml">⁢</mo><mover accent="true" id="S3.E5.m1.3.3.1.1.2.2.2.1.1.1.1.1.1.1.3" xref="S3.E5.m1.3.3.1.1.2.2.2.1.1.1.1.1.1.1.3.cmml"><mi id="S3.E5.m1.3.3.1.1.2.2.2.1.1.1.1.1.1.1.3.2" xref="S3.E5.m1.3.3.1.1.2.2.2.1.1.1.1.1.1.1.3.2.cmml">𝐱</mi><mo id="S3.E5.m1.3.3.1.1.2.2.2.1.1.1.1.1.1.1.3.1" stretchy="false" xref="S3.E5.m1.3.3.1.1.2.2.2.1.1.1.1.1.1.1.3.1.cmml">→</mo></mover></mrow><mo id="S3.E5.m1.3.3.1.1.2.2.2.1.1.1.1.1.1.3" stretchy="false" xref="S3.E5.m1.3.3.1.1.2.2.2.1.1.1.1.1.1.1.cmml">)</mo></mrow></mrow><mo id="S3.E5.m1.3.3.1.1.2.2.2.1.1.1.3" xref="S3.E5.m1.3.3.1.1.2.2.2.1.1.1.1.cmml">)</mo></mrow></mrow></mrow><mo id="S3.E5.m1.3.3.1.1.2.2.5" stretchy="false" xref="S3.E5.m1.3.3.1.1.2.3.1.cmml">}</mo></mrow></mrow><mo id="S3.E5.m1.3.3.1.2" xref="S3.E5.m1.3.3.1.1.cmml">,</mo></mrow><annotation-xml encoding="MathML-Content" id="S3.E5.m1.3b"><apply id="S3.E5.m1.3.3.1.1.cmml" xref="S3.E5.m1.3.3.1"><eq id="S3.E5.m1.3.3.1.1.3.cmml" xref="S3.E5.m1.3.3.1.1.3"></eq><ci id="S3.E5.m1.3.3.1.1.4.cmml" xref="S3.E5.m1.3.3.1.1.4">𝑆</ci><apply id="S3.E5.m1.3.3.1.1.2.3.cmml" xref="S3.E5.m1.3.3.1.1.2.2"><csymbol cd="latexml" id="S3.E5.m1.3.3.1.1.2.3.1.cmml" xref="S3.E5.m1.3.3.1.1.2.2.3">conditional-set</csymbol><interval closure="open" id="S3.E5.m1.3.3.1.1.1.1.1.2.cmml" xref="S3.E5.m1.3.3.1.1.1.1.1.1"><ci id="S3.E5.m1.2.2.cmml" xref="S3.E5.m1.2.2">𝑖</ci><apply id="S3.E5.m1.3.3.1.1.1.1.1.1.1.cmml" xref="S3.E5.m1.3.3.1.1.1.1.1.1.1"><times id="S3.E5.m1.3.3.1.1.1.1.1.1.1.2.cmml" xref="S3.E5.m1.3.3.1.1.1.1.1.1.1.2"></times><ci id="S3.E5.m1.3.3.1.1.1.1.1.1.1.3.cmml" xref="S3.E5.m1.3.3.1.1.1.1.1.1.1.3">italic-ϕ</ci><list id="S3.E5.m1.3.3.1.1.1.1.1.1.1.1.1.1.2.cmml" xref="S3.E5.m1.3.3.1.1.1.1.1.1.1.1.1.1.1"><apply id="S3.E5.m1.3.3.1.1.1.1.1.1.1.1.1.1.1.1.cmml" xref="S3.E5.m1.3.3.1.1.1.1.1.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S3.E5.m1.3.3.1.1.1.1.1.1.1.1.1.1.1.1.1.cmml" xref="S3.E5.m1.3.3.1.1.1.1.1.1.1.1.1.1.1.1">subscript</csymbol><apply id="S3.E5.m1.3.3.1.1.1.1.1.1.1.1.1.1.1.1.2.cmml" xref="S3.E5.m1.3.3.1.1.1.1.1.1.1.1.1.1.1.1.2"><ci id="S3.E5.m1.3.3.1.1.1.1.1.1.1.1.1.1.1.1.2.1.cmml" xref="S3.E5.m1.3.3.1.1.1.1.1.1.1.1.1.1.1.1.2.1">→</ci><ci id="S3.E5.m1.3.3.1.1.1.1.1.1.1.1.1.1.1.1.2.2.cmml" xref="S3.E5.m1.3.3.1.1.1.1.1.1.1.1.1.1.1.1.2.2">𝐳</ci></apply><ci id="S3.E5.m1.3.3.1.1.1.1.1.1.1.1.1.1.1.1.3.cmml" xref="S3.E5.m1.3.3.1.1.1.1.1.1.1.1.1.1.1.1.3">𝑖</ci></apply><apply id="S3.E5.m1.1.1.cmml" xref="S3.E5.m1.1.1"><ci id="S3.E5.m1.1.1.1.cmml" xref="S3.E5.m1.1.1.1">→</ci><ci id="S3.E5.m1.1.1.2.cmml" xref="S3.E5.m1.1.1.2">𝐱</ci></apply></list></apply></interval><apply id="S3.E5.m1.3.3.1.1.2.2.2.cmml" xref="S3.E5.m1.3.3.1.1.2.2.2"><in id="S3.E5.m1.3.3.1.1.2.2.2.2.cmml" xref="S3.E5.m1.3.3.1.1.2.2.2.2"></in><ci id="S3.E5.m1.3.3.1.1.2.2.2.3.cmml" xref="S3.E5.m1.3.3.1.1.2.2.2.3">𝑖</ci><apply id="S3.E5.m1.3.3.1.1.2.2.2.1.cmml" xref="S3.E5.m1.3.3.1.1.2.2.2.1"><times id="S3.E5.m1.3.3.1.1.2.2.2.1.2.cmml" xref="S3.E5.m1.3.3.1.1.2.2.2.1.2"></times><apply id="S3.E5.m1.3.3.1.1.2.2.2.1.3.cmml" xref="S3.E5.m1.3.3.1.1.2.2.2.1.3"><csymbol cd="ambiguous" id="S3.E5.m1.3.3.1.1.2.2.2.1.3.1.cmml" xref="S3.E5.m1.3.3.1.1.2.2.2.1.3">subscript</csymbol><ci id="S3.E5.m1.3.3.1.1.2.2.2.1.3.2a.cmml" xref="S3.E5.m1.3.3.1.1.2.2.2.1.3.2"><mtext id="S3.E5.m1.3.3.1.1.2.2.2.1.3.2.cmml" xref="S3.E5.m1.3.3.1.1.2.2.2.1.3.2">TopInd</mtext></ci><ci id="S3.E5.m1.3.3.1.1.2.2.2.1.3.3.cmml" xref="S3.E5.m1.3.3.1.1.2.2.2.1.3.3">𝑘</ci></apply><apply id="S3.E5.m1.3.3.1.1.2.2.2.1.1.1.1.cmml" xref="S3.E5.m1.3.3.1.1.2.2.2.1.1.1"><times id="S3.E5.m1.3.3.1.1.2.2.2.1.1.1.1.2.cmml" xref="S3.E5.m1.3.3.1.1.2.2.2.1.1.1.1.2"></times><ci id="S3.E5.m1.3.3.1.1.2.2.2.1.1.1.1.3.cmml" xref="S3.E5.m1.3.3.1.1.2.2.2.1.1.1.1.3">italic-ϕ</ci><apply id="S3.E5.m1.3.3.1.1.2.2.2.1.1.1.1.1.1.1.cmml" xref="S3.E5.m1.3.3.1.1.2.2.2.1.1.1.1.1.1"><times id="S3.E5.m1.3.3.1.1.2.2.2.1.1.1.1.1.1.1.1.cmml" xref="S3.E5.m1.3.3.1.1.2.2.2.1.1.1.1.1.1.1.1"></times><apply id="S3.E5.m1.3.3.1.1.2.2.2.1.1.1.1.1.1.1.2.cmml" xref="S3.E5.m1.3.3.1.1.2.2.2.1.1.1.1.1.1.1.2"><csymbol cd="ambiguous" id="S3.E5.m1.3.3.1.1.2.2.2.1.1.1.1.1.1.1.2.1.cmml" xref="S3.E5.m1.3.3.1.1.2.2.2.1.1.1.1.1.1.1.2">superscript</csymbol><ci id="S3.E5.m1.3.3.1.1.2.2.2.1.1.1.1.1.1.1.2.2.cmml" xref="S3.E5.m1.3.3.1.1.2.2.2.1.1.1.1.1.1.1.2.2">𝐙</ci><csymbol cd="latexml" id="S3.E5.m1.3.3.1.1.2.2.2.1.1.1.1.1.1.1.2.3.cmml" xref="S3.E5.m1.3.3.1.1.2.2.2.1.1.1.1.1.1.1.2.3">top</csymbol></apply><apply id="S3.E5.m1.3.3.1.1.2.2.2.1.1.1.1.1.1.1.3.cmml" xref="S3.E5.m1.3.3.1.1.2.2.2.1.1.1.1.1.1.1.3"><ci id="S3.E5.m1.3.3.1.1.2.2.2.1.1.1.1.1.1.1.3.1.cmml" xref="S3.E5.m1.3.3.1.1.2.2.2.1.1.1.1.1.1.1.3.1">→</ci><ci id="S3.E5.m1.3.3.1.1.2.2.2.1.1.1.1.1.1.1.3.2.cmml" xref="S3.E5.m1.3.3.1.1.2.2.2.1.1.1.1.1.1.1.3.2">𝐱</ci></apply></apply></apply></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.E5.m1.3c">\displaystyle S=\{(i,\phi(\langle\overrightarrow{\mathbf{z}}_{i},%
\overrightarrow{\mathbf{x}}\rangle)):i\in\textrm{TopInd}_{k}\left(\phi({%
\mathbf{Z}}^{\top}{\overrightarrow{\mathbf{x}}})\right)\},</annotation><annotation encoding="application/x-llamapun" id="S3.E5.m1.3d">italic_S = { ( italic_i , italic_ϕ ( ⟨ over→ start_ARG bold_z end_ARG start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT , over→ start_ARG bold_x end_ARG ⟩ ) ) : italic_i ∈ TopInd start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT ( italic_ϕ ( bold_Z start_POSTSUPERSCRIPT ⊤ end_POSTSUPERSCRIPT over→ start_ARG bold_x end_ARG ) ) } ,</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(5)</span></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S3.SS1.p4.12">where <math alttext="\overrightarrow{\mathbf{z}}_{i}" class="ltx_Math" display="inline" id="S3.SS1.p4.5.m1.1"><semantics id="S3.SS1.p4.5.m1.1a"><msub id="S3.SS1.p4.5.m1.1.1" xref="S3.SS1.p4.5.m1.1.1.cmml"><mover accent="true" id="S3.SS1.p4.5.m1.1.1.2" xref="S3.SS1.p4.5.m1.1.1.2.cmml"><mi id="S3.SS1.p4.5.m1.1.1.2.2" xref="S3.SS1.p4.5.m1.1.1.2.2.cmml">𝐳</mi><mo id="S3.SS1.p4.5.m1.1.1.2.1" stretchy="false" xref="S3.SS1.p4.5.m1.1.1.2.1.cmml">→</mo></mover><mi id="S3.SS1.p4.5.m1.1.1.3" xref="S3.SS1.p4.5.m1.1.1.3.cmml">i</mi></msub><annotation-xml encoding="MathML-Content" id="S3.SS1.p4.5.m1.1b"><apply id="S3.SS1.p4.5.m1.1.1.cmml" xref="S3.SS1.p4.5.m1.1.1"><csymbol cd="ambiguous" id="S3.SS1.p4.5.m1.1.1.1.cmml" xref="S3.SS1.p4.5.m1.1.1">subscript</csymbol><apply id="S3.SS1.p4.5.m1.1.1.2.cmml" xref="S3.SS1.p4.5.m1.1.1.2"><ci id="S3.SS1.p4.5.m1.1.1.2.1.cmml" xref="S3.SS1.p4.5.m1.1.1.2.1">→</ci><ci id="S3.SS1.p4.5.m1.1.1.2.2.cmml" xref="S3.SS1.p4.5.m1.1.1.2.2">𝐳</ci></apply><ci id="S3.SS1.p4.5.m1.1.1.3.cmml" xref="S3.SS1.p4.5.m1.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p4.5.m1.1c">\overrightarrow{\mathbf{z}}_{i}</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p4.5.m1.1d">over→ start_ARG bold_z end_ARG start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT</annotation></semantics></math> is the <math alttext="i^{\textrm{th}}" class="ltx_Math" display="inline" id="S3.SS1.p4.6.m2.1"><semantics id="S3.SS1.p4.6.m2.1a"><msup id="S3.SS1.p4.6.m2.1.1" xref="S3.SS1.p4.6.m2.1.1.cmml"><mi id="S3.SS1.p4.6.m2.1.1.2" xref="S3.SS1.p4.6.m2.1.1.2.cmml">i</mi><mtext id="S3.SS1.p4.6.m2.1.1.3" xref="S3.SS1.p4.6.m2.1.1.3a.cmml">th</mtext></msup><annotation-xml encoding="MathML-Content" id="S3.SS1.p4.6.m2.1b"><apply id="S3.SS1.p4.6.m2.1.1.cmml" xref="S3.SS1.p4.6.m2.1.1"><csymbol cd="ambiguous" id="S3.SS1.p4.6.m2.1.1.1.cmml" xref="S3.SS1.p4.6.m2.1.1">superscript</csymbol><ci id="S3.SS1.p4.6.m2.1.1.2.cmml" xref="S3.SS1.p4.6.m2.1.1.2">𝑖</ci><ci id="S3.SS1.p4.6.m2.1.1.3a.cmml" xref="S3.SS1.p4.6.m2.1.1.3"><mtext id="S3.SS1.p4.6.m2.1.1.3.cmml" mathsize="70%" xref="S3.SS1.p4.6.m2.1.1.3">th</mtext></ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p4.6.m2.1c">i^{\textrm{th}}</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p4.6.m2.1d">italic_i start_POSTSUPERSCRIPT th end_POSTSUPERSCRIPT</annotation></semantics></math> column of <math alttext="{\mathbf{Z}}" class="ltx_Math" display="inline" id="S3.SS1.p4.7.m3.1"><semantics id="S3.SS1.p4.7.m3.1a"><mi id="S3.SS1.p4.7.m3.1.1" xref="S3.SS1.p4.7.m3.1.1.cmml">𝐙</mi><annotation-xml encoding="MathML-Content" id="S3.SS1.p4.7.m3.1b"><ci id="S3.SS1.p4.7.m3.1.1.cmml" xref="S3.SS1.p4.7.m3.1.1">𝐙</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p4.7.m3.1c">{\mathbf{Z}}</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p4.7.m3.1d">bold_Z</annotation></semantics></math> and <math alttext="\phi(\cdot)" class="ltx_Math" display="inline" id="S3.SS1.p4.8.m4.1"><semantics id="S3.SS1.p4.8.m4.1a"><mrow id="S3.SS1.p4.8.m4.1.2" xref="S3.SS1.p4.8.m4.1.2.cmml"><mi id="S3.SS1.p4.8.m4.1.2.2" xref="S3.SS1.p4.8.m4.1.2.2.cmml">ϕ</mi><mo id="S3.SS1.p4.8.m4.1.2.1" xref="S3.SS1.p4.8.m4.1.2.1.cmml">⁢</mo><mrow id="S3.SS1.p4.8.m4.1.2.3.2" xref="S3.SS1.p4.8.m4.1.2.cmml"><mo id="S3.SS1.p4.8.m4.1.2.3.2.1" stretchy="false" xref="S3.SS1.p4.8.m4.1.2.cmml">(</mo><mo id="S3.SS1.p4.8.m4.1.1" lspace="0em" rspace="0em" xref="S3.SS1.p4.8.m4.1.1.cmml">⋅</mo><mo id="S3.SS1.p4.8.m4.1.2.3.2.2" stretchy="false" xref="S3.SS1.p4.8.m4.1.2.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.SS1.p4.8.m4.1b"><apply id="S3.SS1.p4.8.m4.1.2.cmml" xref="S3.SS1.p4.8.m4.1.2"><times id="S3.SS1.p4.8.m4.1.2.1.cmml" xref="S3.SS1.p4.8.m4.1.2.1"></times><ci id="S3.SS1.p4.8.m4.1.2.2.cmml" xref="S3.SS1.p4.8.m4.1.2.2">italic-ϕ</ci><ci id="S3.SS1.p4.8.m4.1.1.cmml" xref="S3.SS1.p4.8.m4.1.1">⋅</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p4.8.m4.1c">\phi(\cdot)</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p4.8.m4.1d">italic_ϕ ( ⋅ )</annotation></semantics></math> is any given activation function (could be identity for softmax equation <a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#S3.E2" title="2 ‣ 3.1 Problem Setup ‣ 3 Main Ideas ‣ HiRE: High Recall Approximate Top-𝑘 Estimation for Efficient LLM Inference"><span class="ltx_text ltx_ref_tag">2</span></a>), and <math alttext="d\ll\ell" class="ltx_Math" display="inline" id="S3.SS1.p4.9.m5.1"><semantics id="S3.SS1.p4.9.m5.1a"><mrow id="S3.SS1.p4.9.m5.1.1" xref="S3.SS1.p4.9.m5.1.1.cmml"><mi id="S3.SS1.p4.9.m5.1.1.2" xref="S3.SS1.p4.9.m5.1.1.2.cmml">d</mi><mo id="S3.SS1.p4.9.m5.1.1.1" xref="S3.SS1.p4.9.m5.1.1.1.cmml">≪</mo><mi id="S3.SS1.p4.9.m5.1.1.3" mathvariant="normal" xref="S3.SS1.p4.9.m5.1.1.3.cmml">ℓ</mi></mrow><annotation-xml encoding="MathML-Content" id="S3.SS1.p4.9.m5.1b"><apply id="S3.SS1.p4.9.m5.1.1.cmml" xref="S3.SS1.p4.9.m5.1.1"><csymbol cd="latexml" id="S3.SS1.p4.9.m5.1.1.1.cmml" xref="S3.SS1.p4.9.m5.1.1.1">much-less-than</csymbol><ci id="S3.SS1.p4.9.m5.1.1.2.cmml" xref="S3.SS1.p4.9.m5.1.1.2">𝑑</ci><ci id="S3.SS1.p4.9.m5.1.1.3.cmml" xref="S3.SS1.p4.9.m5.1.1.3">ℓ</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p4.9.m5.1c">d\ll\ell</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p4.9.m5.1d">italic_d ≪ roman_ℓ</annotation></semantics></math>. Our goal is to design an efficient mechanism to compute <math alttext="S" class="ltx_Math" display="inline" id="S3.SS1.p4.10.m6.1"><semantics id="S3.SS1.p4.10.m6.1a"><mi id="S3.SS1.p4.10.m6.1.1" xref="S3.SS1.p4.10.m6.1.1.cmml">S</mi><annotation-xml encoding="MathML-Content" id="S3.SS1.p4.10.m6.1b"><ci id="S3.SS1.p4.10.m6.1.1.cmml" xref="S3.SS1.p4.10.m6.1.1">𝑆</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p4.10.m6.1c">S</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p4.10.m6.1d">italic_S</annotation></semantics></math> in equation <a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#S3.E5" title="5 ‣ 3.1 Problem Setup ‣ 3 Main Ideas ‣ HiRE: High Recall Approximate Top-𝑘 Estimation for Efficient LLM Inference"><span class="ltx_text ltx_ref_tag">5</span></a> compared to the baseline approach of computing <math alttext="\phi({\mathbf{Z}}^{\top}{\overrightarrow{\mathbf{x}}})" class="ltx_Math" display="inline" id="S3.SS1.p4.11.m7.1"><semantics id="S3.SS1.p4.11.m7.1a"><mrow id="S3.SS1.p4.11.m7.1.1" xref="S3.SS1.p4.11.m7.1.1.cmml"><mi id="S3.SS1.p4.11.m7.1.1.3" xref="S3.SS1.p4.11.m7.1.1.3.cmml">ϕ</mi><mo id="S3.SS1.p4.11.m7.1.1.2" xref="S3.SS1.p4.11.m7.1.1.2.cmml">⁢</mo><mrow id="S3.SS1.p4.11.m7.1.1.1.1" xref="S3.SS1.p4.11.m7.1.1.1.1.1.cmml"><mo id="S3.SS1.p4.11.m7.1.1.1.1.2" stretchy="false" xref="S3.SS1.p4.11.m7.1.1.1.1.1.cmml">(</mo><mrow id="S3.SS1.p4.11.m7.1.1.1.1.1" xref="S3.SS1.p4.11.m7.1.1.1.1.1.cmml"><msup id="S3.SS1.p4.11.m7.1.1.1.1.1.2" xref="S3.SS1.p4.11.m7.1.1.1.1.1.2.cmml"><mi id="S3.SS1.p4.11.m7.1.1.1.1.1.2.2" xref="S3.SS1.p4.11.m7.1.1.1.1.1.2.2.cmml">𝐙</mi><mo id="S3.SS1.p4.11.m7.1.1.1.1.1.2.3" xref="S3.SS1.p4.11.m7.1.1.1.1.1.2.3.cmml">⊤</mo></msup><mo id="S3.SS1.p4.11.m7.1.1.1.1.1.1" xref="S3.SS1.p4.11.m7.1.1.1.1.1.1.cmml">⁢</mo><mover accent="true" id="S3.SS1.p4.11.m7.1.1.1.1.1.3" xref="S3.SS1.p4.11.m7.1.1.1.1.1.3.cmml"><mi id="S3.SS1.p4.11.m7.1.1.1.1.1.3.2" xref="S3.SS1.p4.11.m7.1.1.1.1.1.3.2.cmml">𝐱</mi><mo id="S3.SS1.p4.11.m7.1.1.1.1.1.3.1" stretchy="false" xref="S3.SS1.p4.11.m7.1.1.1.1.1.3.1.cmml">→</mo></mover></mrow><mo id="S3.SS1.p4.11.m7.1.1.1.1.3" stretchy="false" xref="S3.SS1.p4.11.m7.1.1.1.1.1.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.SS1.p4.11.m7.1b"><apply id="S3.SS1.p4.11.m7.1.1.cmml" xref="S3.SS1.p4.11.m7.1.1"><times id="S3.SS1.p4.11.m7.1.1.2.cmml" xref="S3.SS1.p4.11.m7.1.1.2"></times><ci id="S3.SS1.p4.11.m7.1.1.3.cmml" xref="S3.SS1.p4.11.m7.1.1.3">italic-ϕ</ci><apply id="S3.SS1.p4.11.m7.1.1.1.1.1.cmml" xref="S3.SS1.p4.11.m7.1.1.1.1"><times id="S3.SS1.p4.11.m7.1.1.1.1.1.1.cmml" xref="S3.SS1.p4.11.m7.1.1.1.1.1.1"></times><apply id="S3.SS1.p4.11.m7.1.1.1.1.1.2.cmml" xref="S3.SS1.p4.11.m7.1.1.1.1.1.2"><csymbol cd="ambiguous" id="S3.SS1.p4.11.m7.1.1.1.1.1.2.1.cmml" xref="S3.SS1.p4.11.m7.1.1.1.1.1.2">superscript</csymbol><ci id="S3.SS1.p4.11.m7.1.1.1.1.1.2.2.cmml" xref="S3.SS1.p4.11.m7.1.1.1.1.1.2.2">𝐙</ci><csymbol cd="latexml" id="S3.SS1.p4.11.m7.1.1.1.1.1.2.3.cmml" xref="S3.SS1.p4.11.m7.1.1.1.1.1.2.3">top</csymbol></apply><apply id="S3.SS1.p4.11.m7.1.1.1.1.1.3.cmml" xref="S3.SS1.p4.11.m7.1.1.1.1.1.3"><ci id="S3.SS1.p4.11.m7.1.1.1.1.1.3.1.cmml" xref="S3.SS1.p4.11.m7.1.1.1.1.1.3.1">→</ci><ci id="S3.SS1.p4.11.m7.1.1.1.1.1.3.2.cmml" xref="S3.SS1.p4.11.m7.1.1.1.1.1.3.2">𝐱</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p4.11.m7.1c">\phi({\mathbf{Z}}^{\top}{\overrightarrow{\mathbf{x}}})</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p4.11.m7.1d">italic_ϕ ( bold_Z start_POSTSUPERSCRIPT ⊤ end_POSTSUPERSCRIPT over→ start_ARG bold_x end_ARG )</annotation></semantics></math> followed by a top-<math alttext="k" class="ltx_Math" display="inline" id="S3.SS1.p4.12.m8.1"><semantics id="S3.SS1.p4.12.m8.1a"><mi id="S3.SS1.p4.12.m8.1.1" xref="S3.SS1.p4.12.m8.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="S3.SS1.p4.12.m8.1b"><ci id="S3.SS1.p4.12.m8.1.1.cmml" xref="S3.SS1.p4.12.m8.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p4.12.m8.1c">k</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p4.12.m8.1d">italic_k</annotation></semantics></math> operation.</p>
</div>
<section class="ltx_paragraph" id="S3.SS1.SSS0.Px1">
<h5 class="ltx_title ltx_title_paragraph">Theoretical proxy for quantifying efficiency</h5>
<div class="ltx_para" id="S3.SS1.SSS0.Px1.p1">
<p class="ltx_p" id="S3.SS1.SSS0.Px1.p1.10">: Autoregressive decoding for small batch sizes is memory bound i.e., the time taken for transferring model parameters across different hierarchies of memory (e.g., HBM/RAM to cache) of the accelerator device (GPU/TPU) is the largest component of the total inference latency <cite class="ltx_cite ltx_citemacro_citep">(Leviathan et al., <a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#bib.bib30" title="">2023</a>)</cite>.
To quantify this intuition, and get a sense of how much we are improving inference latency, <em class="ltx_emph ltx_font_italic" id="S3.SS1.SSS0.Px1.p1.10.1">only in the current section</em>, we use the number of effective parameters (measured in terms of bytes taken to store them) used by a given algorithm <math alttext="\mathcal{A}" class="ltx_Math" display="inline" id="S3.SS1.SSS0.Px1.p1.1.m1.1"><semantics id="S3.SS1.SSS0.Px1.p1.1.m1.1a"><mi class="ltx_font_mathcaligraphic" id="S3.SS1.SSS0.Px1.p1.1.m1.1.1" xref="S3.SS1.SSS0.Px1.p1.1.m1.1.1.cmml">𝒜</mi><annotation-xml encoding="MathML-Content" id="S3.SS1.SSS0.Px1.p1.1.m1.1b"><ci id="S3.SS1.SSS0.Px1.p1.1.m1.1.1.cmml" xref="S3.SS1.SSS0.Px1.p1.1.m1.1.1">𝒜</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.SSS0.Px1.p1.1.m1.1c">\mathcal{A}</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.SSS0.Px1.p1.1.m1.1d">caligraphic_A</annotation></semantics></math> for the computation in equation <a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#S3.E5" title="5 ‣ 3.1 Problem Setup ‣ 3 Main Ideas ‣ HiRE: High Recall Approximate Top-𝑘 Estimation for Efficient LLM Inference"><span class="ltx_text ltx_ref_tag">5</span></a> as a proxy for its latency, and refer to it as <math alttext="\textrm{PS}\left(\mathcal{A}\right)" class="ltx_Math" display="inline" id="S3.SS1.SSS0.Px1.p1.2.m2.1"><semantics id="S3.SS1.SSS0.Px1.p1.2.m2.1a"><mrow id="S3.SS1.SSS0.Px1.p1.2.m2.1.2" xref="S3.SS1.SSS0.Px1.p1.2.m2.1.2.cmml"><mtext id="S3.SS1.SSS0.Px1.p1.2.m2.1.2.2" xref="S3.SS1.SSS0.Px1.p1.2.m2.1.2.2a.cmml">PS</mtext><mo id="S3.SS1.SSS0.Px1.p1.2.m2.1.2.1" xref="S3.SS1.SSS0.Px1.p1.2.m2.1.2.1.cmml">⁢</mo><mrow id="S3.SS1.SSS0.Px1.p1.2.m2.1.2.3.2" xref="S3.SS1.SSS0.Px1.p1.2.m2.1.2.cmml"><mo id="S3.SS1.SSS0.Px1.p1.2.m2.1.2.3.2.1" xref="S3.SS1.SSS0.Px1.p1.2.m2.1.2.cmml">(</mo><mi class="ltx_font_mathcaligraphic" id="S3.SS1.SSS0.Px1.p1.2.m2.1.1" xref="S3.SS1.SSS0.Px1.p1.2.m2.1.1.cmml">𝒜</mi><mo id="S3.SS1.SSS0.Px1.p1.2.m2.1.2.3.2.2" xref="S3.SS1.SSS0.Px1.p1.2.m2.1.2.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.SS1.SSS0.Px1.p1.2.m2.1b"><apply id="S3.SS1.SSS0.Px1.p1.2.m2.1.2.cmml" xref="S3.SS1.SSS0.Px1.p1.2.m2.1.2"><times id="S3.SS1.SSS0.Px1.p1.2.m2.1.2.1.cmml" xref="S3.SS1.SSS0.Px1.p1.2.m2.1.2.1"></times><ci id="S3.SS1.SSS0.Px1.p1.2.m2.1.2.2a.cmml" xref="S3.SS1.SSS0.Px1.p1.2.m2.1.2.2"><mtext id="S3.SS1.SSS0.Px1.p1.2.m2.1.2.2.cmml" xref="S3.SS1.SSS0.Px1.p1.2.m2.1.2.2">PS</mtext></ci><ci id="S3.SS1.SSS0.Px1.p1.2.m2.1.1.cmml" xref="S3.SS1.SSS0.Px1.p1.2.m2.1.1">𝒜</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.SSS0.Px1.p1.2.m2.1c">\textrm{PS}\left(\mathcal{A}\right)</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.SSS0.Px1.p1.2.m2.1d">PS ( caligraphic_A )</annotation></semantics></math>. For example, the <span class="ltx_text ltx_markedasmath" id="S3.SS1.SSS0.Px1.p1.10.2">Baseline</span> which first computes <math alttext="\phi({\mathbf{Z}}^{\top}{\overrightarrow{\mathbf{x}}})" class="ltx_Math" display="inline" id="S3.SS1.SSS0.Px1.p1.4.m4.1"><semantics id="S3.SS1.SSS0.Px1.p1.4.m4.1a"><mrow id="S3.SS1.SSS0.Px1.p1.4.m4.1.1" xref="S3.SS1.SSS0.Px1.p1.4.m4.1.1.cmml"><mi id="S3.SS1.SSS0.Px1.p1.4.m4.1.1.3" xref="S3.SS1.SSS0.Px1.p1.4.m4.1.1.3.cmml">ϕ</mi><mo id="S3.SS1.SSS0.Px1.p1.4.m4.1.1.2" xref="S3.SS1.SSS0.Px1.p1.4.m4.1.1.2.cmml">⁢</mo><mrow id="S3.SS1.SSS0.Px1.p1.4.m4.1.1.1.1" xref="S3.SS1.SSS0.Px1.p1.4.m4.1.1.1.1.1.cmml"><mo id="S3.SS1.SSS0.Px1.p1.4.m4.1.1.1.1.2" stretchy="false" xref="S3.SS1.SSS0.Px1.p1.4.m4.1.1.1.1.1.cmml">(</mo><mrow id="S3.SS1.SSS0.Px1.p1.4.m4.1.1.1.1.1" xref="S3.SS1.SSS0.Px1.p1.4.m4.1.1.1.1.1.cmml"><msup id="S3.SS1.SSS0.Px1.p1.4.m4.1.1.1.1.1.2" xref="S3.SS1.SSS0.Px1.p1.4.m4.1.1.1.1.1.2.cmml"><mi id="S3.SS1.SSS0.Px1.p1.4.m4.1.1.1.1.1.2.2" xref="S3.SS1.SSS0.Px1.p1.4.m4.1.1.1.1.1.2.2.cmml">𝐙</mi><mo id="S3.SS1.SSS0.Px1.p1.4.m4.1.1.1.1.1.2.3" xref="S3.SS1.SSS0.Px1.p1.4.m4.1.1.1.1.1.2.3.cmml">⊤</mo></msup><mo id="S3.SS1.SSS0.Px1.p1.4.m4.1.1.1.1.1.1" xref="S3.SS1.SSS0.Px1.p1.4.m4.1.1.1.1.1.1.cmml">⁢</mo><mover accent="true" id="S3.SS1.SSS0.Px1.p1.4.m4.1.1.1.1.1.3" xref="S3.SS1.SSS0.Px1.p1.4.m4.1.1.1.1.1.3.cmml"><mi id="S3.SS1.SSS0.Px1.p1.4.m4.1.1.1.1.1.3.2" xref="S3.SS1.SSS0.Px1.p1.4.m4.1.1.1.1.1.3.2.cmml">𝐱</mi><mo id="S3.SS1.SSS0.Px1.p1.4.m4.1.1.1.1.1.3.1" stretchy="false" xref="S3.SS1.SSS0.Px1.p1.4.m4.1.1.1.1.1.3.1.cmml">→</mo></mover></mrow><mo id="S3.SS1.SSS0.Px1.p1.4.m4.1.1.1.1.3" stretchy="false" xref="S3.SS1.SSS0.Px1.p1.4.m4.1.1.1.1.1.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.SS1.SSS0.Px1.p1.4.m4.1b"><apply id="S3.SS1.SSS0.Px1.p1.4.m4.1.1.cmml" xref="S3.SS1.SSS0.Px1.p1.4.m4.1.1"><times id="S3.SS1.SSS0.Px1.p1.4.m4.1.1.2.cmml" xref="S3.SS1.SSS0.Px1.p1.4.m4.1.1.2"></times><ci id="S3.SS1.SSS0.Px1.p1.4.m4.1.1.3.cmml" xref="S3.SS1.SSS0.Px1.p1.4.m4.1.1.3">italic-ϕ</ci><apply id="S3.SS1.SSS0.Px1.p1.4.m4.1.1.1.1.1.cmml" xref="S3.SS1.SSS0.Px1.p1.4.m4.1.1.1.1"><times id="S3.SS1.SSS0.Px1.p1.4.m4.1.1.1.1.1.1.cmml" xref="S3.SS1.SSS0.Px1.p1.4.m4.1.1.1.1.1.1"></times><apply id="S3.SS1.SSS0.Px1.p1.4.m4.1.1.1.1.1.2.cmml" xref="S3.SS1.SSS0.Px1.p1.4.m4.1.1.1.1.1.2"><csymbol cd="ambiguous" id="S3.SS1.SSS0.Px1.p1.4.m4.1.1.1.1.1.2.1.cmml" xref="S3.SS1.SSS0.Px1.p1.4.m4.1.1.1.1.1.2">superscript</csymbol><ci id="S3.SS1.SSS0.Px1.p1.4.m4.1.1.1.1.1.2.2.cmml" xref="S3.SS1.SSS0.Px1.p1.4.m4.1.1.1.1.1.2.2">𝐙</ci><csymbol cd="latexml" id="S3.SS1.SSS0.Px1.p1.4.m4.1.1.1.1.1.2.3.cmml" xref="S3.SS1.SSS0.Px1.p1.4.m4.1.1.1.1.1.2.3">top</csymbol></apply><apply id="S3.SS1.SSS0.Px1.p1.4.m4.1.1.1.1.1.3.cmml" xref="S3.SS1.SSS0.Px1.p1.4.m4.1.1.1.1.1.3"><ci id="S3.SS1.SSS0.Px1.p1.4.m4.1.1.1.1.1.3.1.cmml" xref="S3.SS1.SSS0.Px1.p1.4.m4.1.1.1.1.1.3.1">→</ci><ci id="S3.SS1.SSS0.Px1.p1.4.m4.1.1.1.1.1.3.2.cmml" xref="S3.SS1.SSS0.Px1.p1.4.m4.1.1.1.1.1.3.2">𝐱</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.SSS0.Px1.p1.4.m4.1c">\phi({\mathbf{Z}}^{\top}{\overrightarrow{\mathbf{x}}})</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.SSS0.Px1.p1.4.m4.1d">italic_ϕ ( bold_Z start_POSTSUPERSCRIPT ⊤ end_POSTSUPERSCRIPT over→ start_ARG bold_x end_ARG )</annotation></semantics></math>, followed by a top-<math alttext="k" class="ltx_Math" display="inline" id="S3.SS1.SSS0.Px1.p1.5.m5.1"><semantics id="S3.SS1.SSS0.Px1.p1.5.m5.1a"><mi id="S3.SS1.SSS0.Px1.p1.5.m5.1.1" xref="S3.SS1.SSS0.Px1.p1.5.m5.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="S3.SS1.SSS0.Px1.p1.5.m5.1b"><ci id="S3.SS1.SSS0.Px1.p1.5.m5.1.1.cmml" xref="S3.SS1.SSS0.Px1.p1.5.m5.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.SSS0.Px1.p1.5.m5.1c">k</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.SSS0.Px1.p1.5.m5.1d">italic_k</annotation></semantics></math> operation has <math alttext="\textrm{PS}\left(\textrm{Baseline}\right)=2d\ell" class="ltx_Math" display="inline" id="S3.SS1.SSS0.Px1.p1.6.m6.1"><semantics id="S3.SS1.SSS0.Px1.p1.6.m6.1a"><mrow id="S3.SS1.SSS0.Px1.p1.6.m6.1.2" xref="S3.SS1.SSS0.Px1.p1.6.m6.1.2.cmml"><mrow id="S3.SS1.SSS0.Px1.p1.6.m6.1.2.2" xref="S3.SS1.SSS0.Px1.p1.6.m6.1.2.2.cmml"><mtext id="S3.SS1.SSS0.Px1.p1.6.m6.1.2.2.2" xref="S3.SS1.SSS0.Px1.p1.6.m6.1.2.2.2a.cmml">PS</mtext><mo id="S3.SS1.SSS0.Px1.p1.6.m6.1.2.2.1" xref="S3.SS1.SSS0.Px1.p1.6.m6.1.2.2.1.cmml">⁢</mo><mrow id="S3.SS1.SSS0.Px1.p1.6.m6.1.2.2.3.2" xref="S3.SS1.SSS0.Px1.p1.6.m6.1.1a.cmml"><mo id="S3.SS1.SSS0.Px1.p1.6.m6.1.2.2.3.2.1" xref="S3.SS1.SSS0.Px1.p1.6.m6.1.1a.cmml">(</mo><mtext id="S3.SS1.SSS0.Px1.p1.6.m6.1.1" xref="S3.SS1.SSS0.Px1.p1.6.m6.1.1.cmml">Baseline</mtext><mo id="S3.SS1.SSS0.Px1.p1.6.m6.1.2.2.3.2.2" xref="S3.SS1.SSS0.Px1.p1.6.m6.1.1a.cmml">)</mo></mrow></mrow><mo id="S3.SS1.SSS0.Px1.p1.6.m6.1.2.1" xref="S3.SS1.SSS0.Px1.p1.6.m6.1.2.1.cmml">=</mo><mrow id="S3.SS1.SSS0.Px1.p1.6.m6.1.2.3" xref="S3.SS1.SSS0.Px1.p1.6.m6.1.2.3.cmml"><mn id="S3.SS1.SSS0.Px1.p1.6.m6.1.2.3.2" xref="S3.SS1.SSS0.Px1.p1.6.m6.1.2.3.2.cmml">2</mn><mo id="S3.SS1.SSS0.Px1.p1.6.m6.1.2.3.1" xref="S3.SS1.SSS0.Px1.p1.6.m6.1.2.3.1.cmml">⁢</mo><mi id="S3.SS1.SSS0.Px1.p1.6.m6.1.2.3.3" xref="S3.SS1.SSS0.Px1.p1.6.m6.1.2.3.3.cmml">d</mi><mo id="S3.SS1.SSS0.Px1.p1.6.m6.1.2.3.1a" xref="S3.SS1.SSS0.Px1.p1.6.m6.1.2.3.1.cmml">⁢</mo><mi id="S3.SS1.SSS0.Px1.p1.6.m6.1.2.3.4" mathvariant="normal" xref="S3.SS1.SSS0.Px1.p1.6.m6.1.2.3.4.cmml">ℓ</mi></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.SS1.SSS0.Px1.p1.6.m6.1b"><apply id="S3.SS1.SSS0.Px1.p1.6.m6.1.2.cmml" xref="S3.SS1.SSS0.Px1.p1.6.m6.1.2"><eq id="S3.SS1.SSS0.Px1.p1.6.m6.1.2.1.cmml" xref="S3.SS1.SSS0.Px1.p1.6.m6.1.2.1"></eq><apply id="S3.SS1.SSS0.Px1.p1.6.m6.1.2.2.cmml" xref="S3.SS1.SSS0.Px1.p1.6.m6.1.2.2"><times id="S3.SS1.SSS0.Px1.p1.6.m6.1.2.2.1.cmml" xref="S3.SS1.SSS0.Px1.p1.6.m6.1.2.2.1"></times><ci id="S3.SS1.SSS0.Px1.p1.6.m6.1.2.2.2a.cmml" xref="S3.SS1.SSS0.Px1.p1.6.m6.1.2.2.2"><mtext id="S3.SS1.SSS0.Px1.p1.6.m6.1.2.2.2.cmml" xref="S3.SS1.SSS0.Px1.p1.6.m6.1.2.2.2">PS</mtext></ci><ci id="S3.SS1.SSS0.Px1.p1.6.m6.1.1a.cmml" xref="S3.SS1.SSS0.Px1.p1.6.m6.1.2.2.3.2"><mtext id="S3.SS1.SSS0.Px1.p1.6.m6.1.1.cmml" xref="S3.SS1.SSS0.Px1.p1.6.m6.1.1">Baseline</mtext></ci></apply><apply id="S3.SS1.SSS0.Px1.p1.6.m6.1.2.3.cmml" xref="S3.SS1.SSS0.Px1.p1.6.m6.1.2.3"><times id="S3.SS1.SSS0.Px1.p1.6.m6.1.2.3.1.cmml" xref="S3.SS1.SSS0.Px1.p1.6.m6.1.2.3.1"></times><cn id="S3.SS1.SSS0.Px1.p1.6.m6.1.2.3.2.cmml" type="integer" xref="S3.SS1.SSS0.Px1.p1.6.m6.1.2.3.2">2</cn><ci id="S3.SS1.SSS0.Px1.p1.6.m6.1.2.3.3.cmml" xref="S3.SS1.SSS0.Px1.p1.6.m6.1.2.3.3">𝑑</ci><ci id="S3.SS1.SSS0.Px1.p1.6.m6.1.2.3.4.cmml" xref="S3.SS1.SSS0.Px1.p1.6.m6.1.2.3.4">ℓ</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.SSS0.Px1.p1.6.m6.1c">\textrm{PS}\left(\textrm{Baseline}\right)=2d\ell</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.SSS0.Px1.p1.6.m6.1d">PS ( Baseline ) = 2 italic_d roman_ℓ</annotation></semantics></math> since <math alttext="{\mathbf{Z}}" class="ltx_Math" display="inline" id="S3.SS1.SSS0.Px1.p1.7.m7.1"><semantics id="S3.SS1.SSS0.Px1.p1.7.m7.1a"><mi id="S3.SS1.SSS0.Px1.p1.7.m7.1.1" xref="S3.SS1.SSS0.Px1.p1.7.m7.1.1.cmml">𝐙</mi><annotation-xml encoding="MathML-Content" id="S3.SS1.SSS0.Px1.p1.7.m7.1b"><ci id="S3.SS1.SSS0.Px1.p1.7.m7.1.1.cmml" xref="S3.SS1.SSS0.Px1.p1.7.m7.1.1">𝐙</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.SSS0.Px1.p1.7.m7.1c">{\mathbf{Z}}</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.SSS0.Px1.p1.7.m7.1d">bold_Z</annotation></semantics></math> is a <math alttext="d\times\ell" class="ltx_Math" display="inline" id="S3.SS1.SSS0.Px1.p1.8.m8.1"><semantics id="S3.SS1.SSS0.Px1.p1.8.m8.1a"><mrow id="S3.SS1.SSS0.Px1.p1.8.m8.1.1" xref="S3.SS1.SSS0.Px1.p1.8.m8.1.1.cmml"><mi id="S3.SS1.SSS0.Px1.p1.8.m8.1.1.2" xref="S3.SS1.SSS0.Px1.p1.8.m8.1.1.2.cmml">d</mi><mo id="S3.SS1.SSS0.Px1.p1.8.m8.1.1.1" lspace="0.222em" rspace="0.222em" xref="S3.SS1.SSS0.Px1.p1.8.m8.1.1.1.cmml">×</mo><mi id="S3.SS1.SSS0.Px1.p1.8.m8.1.1.3" mathvariant="normal" xref="S3.SS1.SSS0.Px1.p1.8.m8.1.1.3.cmml">ℓ</mi></mrow><annotation-xml encoding="MathML-Content" id="S3.SS1.SSS0.Px1.p1.8.m8.1b"><apply id="S3.SS1.SSS0.Px1.p1.8.m8.1.1.cmml" xref="S3.SS1.SSS0.Px1.p1.8.m8.1.1"><times id="S3.SS1.SSS0.Px1.p1.8.m8.1.1.1.cmml" xref="S3.SS1.SSS0.Px1.p1.8.m8.1.1.1"></times><ci id="S3.SS1.SSS0.Px1.p1.8.m8.1.1.2.cmml" xref="S3.SS1.SSS0.Px1.p1.8.m8.1.1.2">𝑑</ci><ci id="S3.SS1.SSS0.Px1.p1.8.m8.1.1.3.cmml" xref="S3.SS1.SSS0.Px1.p1.8.m8.1.1.3">ℓ</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.SSS0.Px1.p1.8.m8.1c">d\times\ell</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.SSS0.Px1.p1.8.m8.1d">italic_d × roman_ℓ</annotation></semantics></math> matrix, which is stored in <math alttext="16" class="ltx_Math" display="inline" id="S3.SS1.SSS0.Px1.p1.9.m9.1"><semantics id="S3.SS1.SSS0.Px1.p1.9.m9.1a"><mn id="S3.SS1.SSS0.Px1.p1.9.m9.1.1" xref="S3.SS1.SSS0.Px1.p1.9.m9.1.1.cmml">16</mn><annotation-xml encoding="MathML-Content" id="S3.SS1.SSS0.Px1.p1.9.m9.1b"><cn id="S3.SS1.SSS0.Px1.p1.9.m9.1.1.cmml" type="integer" xref="S3.SS1.SSS0.Px1.p1.9.m9.1.1">16</cn></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.SSS0.Px1.p1.9.m9.1c">16</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.SSS0.Px1.p1.9.m9.1d">16</annotation></semantics></math>-bit floating point (<span class="ltx_text ltx_markedasmath" id="S3.SS1.SSS0.Px1.p1.10.3">bf16</span>) format.
</p>
</div>
</section>
</section>
<section class="ltx_subsection" id="S3.SS2">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">3.2 </span>HiRE: Overall Approach</h3>
<div class="ltx_para" id="S3.SS2.p1">
<p class="ltx_p" id="S3.SS2.p1.1">In this section, we present the key ideas behind HiRE, along with its application to the softmax and FFN layers.</p>
</div>
<section class="ltx_subsubsection" id="S3.SS2.SSS1">
<h4 class="ltx_title ltx_title_subsubsection">
<span class="ltx_tag ltx_tag_subsubsection">3.2.1 </span>Solving equation <a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#S3.E5" title="5 ‣ 3.1 Problem Setup ‣ 3 Main Ideas ‣ HiRE: High Recall Approximate Top-𝑘 Estimation for Efficient LLM Inference"><span class="ltx_text ltx_ref_tag">5</span></a> accurately and efficiently</h4>
<figure class="ltx_float ltx_float_algorithm ltx_framed_top" id="alg1">
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_float"><span class="ltx_text ltx_font_bold" id="alg1.2.1.1">Algorithm 1</span> </span> Pseudocode for HiRE </figcaption>
<div class="ltx_listing ltx_listing" id="alg1.3">
<div class="ltx_listingline" id="alg1.l0">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg1.l0.1.1.1" style="font-size:80%;">0:</span></span>  <math alttext="\overrightarrow{\mathbf{x}},{\mathbf{Z}},{\mathbf{Z}_{\textrm{approx}}},k,k^{\prime}" class="ltx_Math" display="inline" id="alg1.l0.m1.5"><semantics id="alg1.l0.m1.5a"><mrow id="alg1.l0.m1.5.5.2" xref="alg1.l0.m1.5.5.3.cmml"><mover accent="true" id="alg1.l0.m1.1.1" xref="alg1.l0.m1.1.1.cmml"><mi id="alg1.l0.m1.1.1.2" xref="alg1.l0.m1.1.1.2.cmml">𝐱</mi><mo id="alg1.l0.m1.1.1.1" stretchy="false" xref="alg1.l0.m1.1.1.1.cmml">→</mo></mover><mo id="alg1.l0.m1.5.5.2.3" xref="alg1.l0.m1.5.5.3.cmml">,</mo><mi id="alg1.l0.m1.2.2" xref="alg1.l0.m1.2.2.cmml">𝐙</mi><mo id="alg1.l0.m1.5.5.2.4" xref="alg1.l0.m1.5.5.3.cmml">,</mo><msub id="alg1.l0.m1.4.4.1.1" xref="alg1.l0.m1.4.4.1.1.cmml"><mi id="alg1.l0.m1.4.4.1.1.2" xref="alg1.l0.m1.4.4.1.1.2.cmml">𝐙</mi><mtext id="alg1.l0.m1.4.4.1.1.3" xref="alg1.l0.m1.4.4.1.1.3a.cmml">approx</mtext></msub><mo id="alg1.l0.m1.5.5.2.5" xref="alg1.l0.m1.5.5.3.cmml">,</mo><mi id="alg1.l0.m1.3.3" xref="alg1.l0.m1.3.3.cmml">k</mi><mo id="alg1.l0.m1.5.5.2.6" xref="alg1.l0.m1.5.5.3.cmml">,</mo><msup id="alg1.l0.m1.5.5.2.2" xref="alg1.l0.m1.5.5.2.2.cmml"><mi id="alg1.l0.m1.5.5.2.2.2" xref="alg1.l0.m1.5.5.2.2.2.cmml">k</mi><mo id="alg1.l0.m1.5.5.2.2.3" xref="alg1.l0.m1.5.5.2.2.3.cmml">′</mo></msup></mrow><annotation-xml encoding="MathML-Content" id="alg1.l0.m1.5b"><list id="alg1.l0.m1.5.5.3.cmml" xref="alg1.l0.m1.5.5.2"><apply id="alg1.l0.m1.1.1.cmml" xref="alg1.l0.m1.1.1"><ci id="alg1.l0.m1.1.1.1.cmml" xref="alg1.l0.m1.1.1.1">→</ci><ci id="alg1.l0.m1.1.1.2.cmml" xref="alg1.l0.m1.1.1.2">𝐱</ci></apply><ci id="alg1.l0.m1.2.2.cmml" xref="alg1.l0.m1.2.2">𝐙</ci><apply id="alg1.l0.m1.4.4.1.1.cmml" xref="alg1.l0.m1.4.4.1.1"><csymbol cd="ambiguous" id="alg1.l0.m1.4.4.1.1.1.cmml" xref="alg1.l0.m1.4.4.1.1">subscript</csymbol><ci id="alg1.l0.m1.4.4.1.1.2.cmml" xref="alg1.l0.m1.4.4.1.1.2">𝐙</ci><ci id="alg1.l0.m1.4.4.1.1.3a.cmml" xref="alg1.l0.m1.4.4.1.1.3"><mtext id="alg1.l0.m1.4.4.1.1.3.cmml" mathsize="70%" xref="alg1.l0.m1.4.4.1.1.3">approx</mtext></ci></apply><ci id="alg1.l0.m1.3.3.cmml" xref="alg1.l0.m1.3.3">𝑘</ci><apply id="alg1.l0.m1.5.5.2.2.cmml" xref="alg1.l0.m1.5.5.2.2"><csymbol cd="ambiguous" id="alg1.l0.m1.5.5.2.2.1.cmml" xref="alg1.l0.m1.5.5.2.2">superscript</csymbol><ci id="alg1.l0.m1.5.5.2.2.2.cmml" xref="alg1.l0.m1.5.5.2.2.2">𝑘</ci><ci id="alg1.l0.m1.5.5.2.2.3.cmml" xref="alg1.l0.m1.5.5.2.2.3">′</ci></apply></list></annotation-xml><annotation encoding="application/x-tex" id="alg1.l0.m1.5c">\overrightarrow{\mathbf{x}},{\mathbf{Z}},{\mathbf{Z}_{\textrm{approx}}},k,k^{\prime}</annotation><annotation encoding="application/x-llamapun" id="alg1.l0.m1.5d">over→ start_ARG bold_x end_ARG , bold_Z , bold_Z start_POSTSUBSCRIPT approx end_POSTSUBSCRIPT , italic_k , italic_k start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT</annotation></semantics></math>
</div>
<div class="ltx_listingline" id="alg1.l1">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg1.l1.1.1.1" style="font-size:80%;">1:</span></span>  <math alttext="S^{\prime}\leftarrow\textrm{TopInd}_{k^{\prime}}\left(\phi\left({\mathbf{Z}_{%
\textrm{approx}}}^{\top}{\overrightarrow{\mathbf{x}}}\right)\right)" class="ltx_Math" display="inline" id="alg1.l1.m1.1"><semantics id="alg1.l1.m1.1a"><mrow id="alg1.l1.m1.1.1" xref="alg1.l1.m1.1.1.cmml"><msup id="alg1.l1.m1.1.1.3" xref="alg1.l1.m1.1.1.3.cmml"><mi id="alg1.l1.m1.1.1.3.2" xref="alg1.l1.m1.1.1.3.2.cmml">S</mi><mo id="alg1.l1.m1.1.1.3.3" xref="alg1.l1.m1.1.1.3.3.cmml">′</mo></msup><mo id="alg1.l1.m1.1.1.2" stretchy="false" xref="alg1.l1.m1.1.1.2.cmml">←</mo><mrow id="alg1.l1.m1.1.1.1" xref="alg1.l1.m1.1.1.1.cmml"><msub id="alg1.l1.m1.1.1.1.3" xref="alg1.l1.m1.1.1.1.3.cmml"><mtext id="alg1.l1.m1.1.1.1.3.2" xref="alg1.l1.m1.1.1.1.3.2a.cmml">TopInd</mtext><msup id="alg1.l1.m1.1.1.1.3.3" xref="alg1.l1.m1.1.1.1.3.3.cmml"><mi id="alg1.l1.m1.1.1.1.3.3.2" xref="alg1.l1.m1.1.1.1.3.3.2.cmml">k</mi><mo id="alg1.l1.m1.1.1.1.3.3.3" xref="alg1.l1.m1.1.1.1.3.3.3.cmml">′</mo></msup></msub><mo id="alg1.l1.m1.1.1.1.2" xref="alg1.l1.m1.1.1.1.2.cmml">⁢</mo><mrow id="alg1.l1.m1.1.1.1.1.1" xref="alg1.l1.m1.1.1.1.1.1.1.cmml"><mo id="alg1.l1.m1.1.1.1.1.1.2" xref="alg1.l1.m1.1.1.1.1.1.1.cmml">(</mo><mrow id="alg1.l1.m1.1.1.1.1.1.1" xref="alg1.l1.m1.1.1.1.1.1.1.cmml"><mi id="alg1.l1.m1.1.1.1.1.1.1.3" xref="alg1.l1.m1.1.1.1.1.1.1.3.cmml">ϕ</mi><mo id="alg1.l1.m1.1.1.1.1.1.1.2" xref="alg1.l1.m1.1.1.1.1.1.1.2.cmml">⁢</mo><mrow id="alg1.l1.m1.1.1.1.1.1.1.1.1" xref="alg1.l1.m1.1.1.1.1.1.1.1.1.1.cmml"><mo id="alg1.l1.m1.1.1.1.1.1.1.1.1.2" xref="alg1.l1.m1.1.1.1.1.1.1.1.1.1.cmml">(</mo><mrow id="alg1.l1.m1.1.1.1.1.1.1.1.1.1" xref="alg1.l1.m1.1.1.1.1.1.1.1.1.1.cmml"><mmultiscripts id="alg1.l1.m1.1.1.1.1.1.1.1.1.1.2" xref="alg1.l1.m1.1.1.1.1.1.1.1.1.1.2.cmml"><mi id="alg1.l1.m1.1.1.1.1.1.1.1.1.1.2.2.2" xref="alg1.l1.m1.1.1.1.1.1.1.1.1.1.2.2.2.cmml">𝐙</mi><mtext id="alg1.l1.m1.1.1.1.1.1.1.1.1.1.2.2.3" xref="alg1.l1.m1.1.1.1.1.1.1.1.1.1.2.2.3a.cmml">approx</mtext><mrow id="alg1.l1.m1.1.1.1.1.1.1.1.1.1.2a" xref="alg1.l1.m1.1.1.1.1.1.1.1.1.1.2.cmml"></mrow><mrow id="alg1.l1.m1.1.1.1.1.1.1.1.1.1.2b" xref="alg1.l1.m1.1.1.1.1.1.1.1.1.1.2.cmml"></mrow><mo id="alg1.l1.m1.1.1.1.1.1.1.1.1.1.2.3" xref="alg1.l1.m1.1.1.1.1.1.1.1.1.1.2.3.cmml">⊤</mo></mmultiscripts><mo id="alg1.l1.m1.1.1.1.1.1.1.1.1.1.1" xref="alg1.l1.m1.1.1.1.1.1.1.1.1.1.1.cmml">⁢</mo><mover accent="true" id="alg1.l1.m1.1.1.1.1.1.1.1.1.1.3" xref="alg1.l1.m1.1.1.1.1.1.1.1.1.1.3.cmml"><mi id="alg1.l1.m1.1.1.1.1.1.1.1.1.1.3.2" xref="alg1.l1.m1.1.1.1.1.1.1.1.1.1.3.2.cmml">𝐱</mi><mo id="alg1.l1.m1.1.1.1.1.1.1.1.1.1.3.1" stretchy="false" xref="alg1.l1.m1.1.1.1.1.1.1.1.1.1.3.1.cmml">→</mo></mover></mrow><mo id="alg1.l1.m1.1.1.1.1.1.1.1.1.3" xref="alg1.l1.m1.1.1.1.1.1.1.1.1.1.cmml">)</mo></mrow></mrow><mo id="alg1.l1.m1.1.1.1.1.1.3" xref="alg1.l1.m1.1.1.1.1.1.1.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="alg1.l1.m1.1b"><apply id="alg1.l1.m1.1.1.cmml" xref="alg1.l1.m1.1.1"><ci id="alg1.l1.m1.1.1.2.cmml" xref="alg1.l1.m1.1.1.2">←</ci><apply id="alg1.l1.m1.1.1.3.cmml" xref="alg1.l1.m1.1.1.3"><csymbol cd="ambiguous" id="alg1.l1.m1.1.1.3.1.cmml" xref="alg1.l1.m1.1.1.3">superscript</csymbol><ci id="alg1.l1.m1.1.1.3.2.cmml" xref="alg1.l1.m1.1.1.3.2">𝑆</ci><ci id="alg1.l1.m1.1.1.3.3.cmml" xref="alg1.l1.m1.1.1.3.3">′</ci></apply><apply id="alg1.l1.m1.1.1.1.cmml" xref="alg1.l1.m1.1.1.1"><times id="alg1.l1.m1.1.1.1.2.cmml" xref="alg1.l1.m1.1.1.1.2"></times><apply id="alg1.l1.m1.1.1.1.3.cmml" xref="alg1.l1.m1.1.1.1.3"><csymbol cd="ambiguous" id="alg1.l1.m1.1.1.1.3.1.cmml" xref="alg1.l1.m1.1.1.1.3">subscript</csymbol><ci id="alg1.l1.m1.1.1.1.3.2a.cmml" xref="alg1.l1.m1.1.1.1.3.2"><mtext id="alg1.l1.m1.1.1.1.3.2.cmml" xref="alg1.l1.m1.1.1.1.3.2">TopInd</mtext></ci><apply id="alg1.l1.m1.1.1.1.3.3.cmml" xref="alg1.l1.m1.1.1.1.3.3"><csymbol cd="ambiguous" id="alg1.l1.m1.1.1.1.3.3.1.cmml" xref="alg1.l1.m1.1.1.1.3.3">superscript</csymbol><ci id="alg1.l1.m1.1.1.1.3.3.2.cmml" xref="alg1.l1.m1.1.1.1.3.3.2">𝑘</ci><ci id="alg1.l1.m1.1.1.1.3.3.3.cmml" xref="alg1.l1.m1.1.1.1.3.3.3">′</ci></apply></apply><apply id="alg1.l1.m1.1.1.1.1.1.1.cmml" xref="alg1.l1.m1.1.1.1.1.1"><times id="alg1.l1.m1.1.1.1.1.1.1.2.cmml" xref="alg1.l1.m1.1.1.1.1.1.1.2"></times><ci id="alg1.l1.m1.1.1.1.1.1.1.3.cmml" xref="alg1.l1.m1.1.1.1.1.1.1.3">italic-ϕ</ci><apply id="alg1.l1.m1.1.1.1.1.1.1.1.1.1.cmml" xref="alg1.l1.m1.1.1.1.1.1.1.1.1"><times id="alg1.l1.m1.1.1.1.1.1.1.1.1.1.1.cmml" xref="alg1.l1.m1.1.1.1.1.1.1.1.1.1.1"></times><apply id="alg1.l1.m1.1.1.1.1.1.1.1.1.1.2.cmml" xref="alg1.l1.m1.1.1.1.1.1.1.1.1.1.2"><csymbol cd="ambiguous" id="alg1.l1.m1.1.1.1.1.1.1.1.1.1.2.1.cmml" xref="alg1.l1.m1.1.1.1.1.1.1.1.1.1.2">superscript</csymbol><apply id="alg1.l1.m1.1.1.1.1.1.1.1.1.1.2.2.cmml" xref="alg1.l1.m1.1.1.1.1.1.1.1.1.1.2"><csymbol cd="ambiguous" id="alg1.l1.m1.1.1.1.1.1.1.1.1.1.2.2.1.cmml" xref="alg1.l1.m1.1.1.1.1.1.1.1.1.1.2">subscript</csymbol><ci id="alg1.l1.m1.1.1.1.1.1.1.1.1.1.2.2.2.cmml" xref="alg1.l1.m1.1.1.1.1.1.1.1.1.1.2.2.2">𝐙</ci><ci id="alg1.l1.m1.1.1.1.1.1.1.1.1.1.2.2.3a.cmml" xref="alg1.l1.m1.1.1.1.1.1.1.1.1.1.2.2.3"><mtext id="alg1.l1.m1.1.1.1.1.1.1.1.1.1.2.2.3.cmml" mathsize="70%" xref="alg1.l1.m1.1.1.1.1.1.1.1.1.1.2.2.3">approx</mtext></ci></apply><csymbol cd="latexml" id="alg1.l1.m1.1.1.1.1.1.1.1.1.1.2.3.cmml" xref="alg1.l1.m1.1.1.1.1.1.1.1.1.1.2.3">top</csymbol></apply><apply id="alg1.l1.m1.1.1.1.1.1.1.1.1.1.3.cmml" xref="alg1.l1.m1.1.1.1.1.1.1.1.1.1.3"><ci id="alg1.l1.m1.1.1.1.1.1.1.1.1.1.3.1.cmml" xref="alg1.l1.m1.1.1.1.1.1.1.1.1.1.3.1">→</ci><ci id="alg1.l1.m1.1.1.1.1.1.1.1.1.1.3.2.cmml" xref="alg1.l1.m1.1.1.1.1.1.1.1.1.1.3.2">𝐱</ci></apply></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.l1.m1.1c">S^{\prime}\leftarrow\textrm{TopInd}_{k^{\prime}}\left(\phi\left({\mathbf{Z}_{%
\textrm{approx}}}^{\top}{\overrightarrow{\mathbf{x}}}\right)\right)</annotation><annotation encoding="application/x-llamapun" id="alg1.l1.m1.1d">italic_S start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT ← TopInd start_POSTSUBSCRIPT italic_k start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT end_POSTSUBSCRIPT ( italic_ϕ ( bold_Z start_POSTSUBSCRIPT approx end_POSTSUBSCRIPT start_POSTSUPERSCRIPT ⊤ end_POSTSUPERSCRIPT over→ start_ARG bold_x end_ARG ) )</annotation></semantics></math> {Top-<math alttext="k^{\prime}" class="ltx_Math" display="inline" id="alg1.l1.m2.1"><semantics id="alg1.l1.m2.1a"><msup id="alg1.l1.m2.1.1" xref="alg1.l1.m2.1.1.cmml"><mi id="alg1.l1.m2.1.1.2" xref="alg1.l1.m2.1.1.2.cmml">k</mi><mo id="alg1.l1.m2.1.1.3" xref="alg1.l1.m2.1.1.3.cmml">′</mo></msup><annotation-xml encoding="MathML-Content" id="alg1.l1.m2.1b"><apply id="alg1.l1.m2.1.1.cmml" xref="alg1.l1.m2.1.1"><csymbol cd="ambiguous" id="alg1.l1.m2.1.1.1.cmml" xref="alg1.l1.m2.1.1">superscript</csymbol><ci id="alg1.l1.m2.1.1.2.cmml" xref="alg1.l1.m2.1.1.2">𝑘</ci><ci id="alg1.l1.m2.1.1.3.cmml" xref="alg1.l1.m2.1.1.3">′</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.l1.m2.1c">k^{\prime}</annotation><annotation encoding="application/x-llamapun" id="alg1.l1.m2.1d">italic_k start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT</annotation></semantics></math> indices of <math alttext="\phi\left({\mathbf{Z}_{\textrm{approx}}}^{\top}{\overrightarrow{\mathbf{x}}}\right)" class="ltx_Math" display="inline" id="alg1.l1.m3.1"><semantics id="alg1.l1.m3.1a"><mrow id="alg1.l1.m3.1.1" xref="alg1.l1.m3.1.1.cmml"><mi id="alg1.l1.m3.1.1.3" xref="alg1.l1.m3.1.1.3.cmml">ϕ</mi><mo id="alg1.l1.m3.1.1.2" xref="alg1.l1.m3.1.1.2.cmml">⁢</mo><mrow id="alg1.l1.m3.1.1.1.1" xref="alg1.l1.m3.1.1.1.1.1.cmml"><mo id="alg1.l1.m3.1.1.1.1.2" xref="alg1.l1.m3.1.1.1.1.1.cmml">(</mo><mrow id="alg1.l1.m3.1.1.1.1.1" xref="alg1.l1.m3.1.1.1.1.1.cmml"><mmultiscripts id="alg1.l1.m3.1.1.1.1.1.2" xref="alg1.l1.m3.1.1.1.1.1.2.cmml"><mi id="alg1.l1.m3.1.1.1.1.1.2.2.2" xref="alg1.l1.m3.1.1.1.1.1.2.2.2.cmml">𝐙</mi><mtext id="alg1.l1.m3.1.1.1.1.1.2.2.3" xref="alg1.l1.m3.1.1.1.1.1.2.2.3a.cmml">approx</mtext><mrow id="alg1.l1.m3.1.1.1.1.1.2a" xref="alg1.l1.m3.1.1.1.1.1.2.cmml"></mrow><mrow id="alg1.l1.m3.1.1.1.1.1.2b" xref="alg1.l1.m3.1.1.1.1.1.2.cmml"></mrow><mo id="alg1.l1.m3.1.1.1.1.1.2.3" xref="alg1.l1.m3.1.1.1.1.1.2.3.cmml">⊤</mo></mmultiscripts><mo id="alg1.l1.m3.1.1.1.1.1.1" xref="alg1.l1.m3.1.1.1.1.1.1.cmml">⁢</mo><mover accent="true" id="alg1.l1.m3.1.1.1.1.1.3" xref="alg1.l1.m3.1.1.1.1.1.3.cmml"><mi id="alg1.l1.m3.1.1.1.1.1.3.2" xref="alg1.l1.m3.1.1.1.1.1.3.2.cmml">𝐱</mi><mo id="alg1.l1.m3.1.1.1.1.1.3.1" stretchy="false" xref="alg1.l1.m3.1.1.1.1.1.3.1.cmml">→</mo></mover></mrow><mo id="alg1.l1.m3.1.1.1.1.3" xref="alg1.l1.m3.1.1.1.1.1.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="alg1.l1.m3.1b"><apply id="alg1.l1.m3.1.1.cmml" xref="alg1.l1.m3.1.1"><times id="alg1.l1.m3.1.1.2.cmml" xref="alg1.l1.m3.1.1.2"></times><ci id="alg1.l1.m3.1.1.3.cmml" xref="alg1.l1.m3.1.1.3">italic-ϕ</ci><apply id="alg1.l1.m3.1.1.1.1.1.cmml" xref="alg1.l1.m3.1.1.1.1"><times id="alg1.l1.m3.1.1.1.1.1.1.cmml" xref="alg1.l1.m3.1.1.1.1.1.1"></times><apply id="alg1.l1.m3.1.1.1.1.1.2.cmml" xref="alg1.l1.m3.1.1.1.1.1.2"><csymbol cd="ambiguous" id="alg1.l1.m3.1.1.1.1.1.2.1.cmml" xref="alg1.l1.m3.1.1.1.1.1.2">superscript</csymbol><apply id="alg1.l1.m3.1.1.1.1.1.2.2.cmml" xref="alg1.l1.m3.1.1.1.1.1.2"><csymbol cd="ambiguous" id="alg1.l1.m3.1.1.1.1.1.2.2.1.cmml" xref="alg1.l1.m3.1.1.1.1.1.2">subscript</csymbol><ci id="alg1.l1.m3.1.1.1.1.1.2.2.2.cmml" xref="alg1.l1.m3.1.1.1.1.1.2.2.2">𝐙</ci><ci id="alg1.l1.m3.1.1.1.1.1.2.2.3a.cmml" xref="alg1.l1.m3.1.1.1.1.1.2.2.3"><mtext id="alg1.l1.m3.1.1.1.1.1.2.2.3.cmml" mathsize="70%" xref="alg1.l1.m3.1.1.1.1.1.2.2.3">approx</mtext></ci></apply><csymbol cd="latexml" id="alg1.l1.m3.1.1.1.1.1.2.3.cmml" xref="alg1.l1.m3.1.1.1.1.1.2.3">top</csymbol></apply><apply id="alg1.l1.m3.1.1.1.1.1.3.cmml" xref="alg1.l1.m3.1.1.1.1.1.3"><ci id="alg1.l1.m3.1.1.1.1.1.3.1.cmml" xref="alg1.l1.m3.1.1.1.1.1.3.1">→</ci><ci id="alg1.l1.m3.1.1.1.1.1.3.2.cmml" xref="alg1.l1.m3.1.1.1.1.1.3.2">𝐱</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.l1.m3.1c">\phi\left({\mathbf{Z}_{\textrm{approx}}}^{\top}{\overrightarrow{\mathbf{x}}}\right)</annotation><annotation encoding="application/x-llamapun" id="alg1.l1.m3.1d">italic_ϕ ( bold_Z start_POSTSUBSCRIPT approx end_POSTSUBSCRIPT start_POSTSUPERSCRIPT ⊤ end_POSTSUPERSCRIPT over→ start_ARG bold_x end_ARG )</annotation></semantics></math>}

</div>
<div class="ltx_listingline" id="alg1.l2">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg1.l2.1.1.1" style="font-size:80%;">2:</span></span>  <math alttext="\overrightarrow{\mathbf{y}}\leftarrow{\textrm{Top}_{k}\left({\mathbf{Z}}|_{S^{%
\prime}}^{\top}\overrightarrow{\mathbf{x}}\right)}" class="ltx_Math" display="inline" id="alg1.l2.m1.4"><semantics id="alg1.l2.m1.4a"><mrow id="alg1.l2.m1.4.4" xref="alg1.l2.m1.4.4.cmml"><mover accent="true" id="alg1.l2.m1.4.4.3" xref="alg1.l2.m1.4.4.3.cmml"><mi id="alg1.l2.m1.4.4.3.2" xref="alg1.l2.m1.4.4.3.2.cmml">𝐲</mi><mo id="alg1.l2.m1.4.4.3.1" stretchy="false" xref="alg1.l2.m1.4.4.3.1.cmml">→</mo></mover><mo id="alg1.l2.m1.4.4.2" stretchy="false" xref="alg1.l2.m1.4.4.2.cmml">←</mo><mrow id="alg1.l2.m1.4.4.1" xref="alg1.l2.m1.4.4.1.cmml"><msub id="alg1.l2.m1.4.4.1.3" xref="alg1.l2.m1.4.4.1.3.cmml"><mtext id="alg1.l2.m1.4.4.1.3.2" xref="alg1.l2.m1.4.4.1.3.2a.cmml">Top</mtext><mi id="alg1.l2.m1.4.4.1.3.3" xref="alg1.l2.m1.4.4.1.3.3.cmml">k</mi></msub><mo id="alg1.l2.m1.4.4.1.2" xref="alg1.l2.m1.4.4.1.2.cmml">⁢</mo><mrow id="alg1.l2.m1.4.4.1.1.1" xref="alg1.l2.m1.4.4.1.1.1.1.cmml"><mo id="alg1.l2.m1.4.4.1.1.1.2" xref="alg1.l2.m1.4.4.1.1.1.1.cmml">(</mo><mrow id="alg1.l2.m1.4.4.1.1.1.1" xref="alg1.l2.m1.4.4.1.1.1.1.cmml"><msubsup id="alg1.l2.m1.4.4.1.1.1.1.2.2" xref="alg1.l2.m1.4.4.1.1.1.1.2.1.cmml"><mrow id="alg1.l2.m1.4.4.1.1.1.1.2.2.2.2" xref="alg1.l2.m1.4.4.1.1.1.1.2.1.cmml"><mi id="alg1.l2.m1.1.1" xref="alg1.l2.m1.1.1.cmml">𝐙</mi><mo id="alg1.l2.m1.4.4.1.1.1.1.2.2.2.2.1" stretchy="false" xref="alg1.l2.m1.4.4.1.1.1.1.2.1.1.cmml">|</mo></mrow><msup id="alg1.l2.m1.2.2.1" xref="alg1.l2.m1.2.2.1.cmml"><mi id="alg1.l2.m1.2.2.1.2" xref="alg1.l2.m1.2.2.1.2.cmml">S</mi><mo id="alg1.l2.m1.2.2.1.3" xref="alg1.l2.m1.2.2.1.3.cmml">′</mo></msup><mo id="alg1.l2.m1.3.3.1" xref="alg1.l2.m1.3.3.1.cmml">⊤</mo></msubsup><mo id="alg1.l2.m1.4.4.1.1.1.1.1" xref="alg1.l2.m1.4.4.1.1.1.1.1.cmml">⁢</mo><mover accent="true" id="alg1.l2.m1.4.4.1.1.1.1.3" xref="alg1.l2.m1.4.4.1.1.1.1.3.cmml"><mi id="alg1.l2.m1.4.4.1.1.1.1.3.2" xref="alg1.l2.m1.4.4.1.1.1.1.3.2.cmml">𝐱</mi><mo id="alg1.l2.m1.4.4.1.1.1.1.3.1" stretchy="false" xref="alg1.l2.m1.4.4.1.1.1.1.3.1.cmml">→</mo></mover></mrow><mo id="alg1.l2.m1.4.4.1.1.1.3" xref="alg1.l2.m1.4.4.1.1.1.1.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="alg1.l2.m1.4b"><apply id="alg1.l2.m1.4.4.cmml" xref="alg1.l2.m1.4.4"><ci id="alg1.l2.m1.4.4.2.cmml" xref="alg1.l2.m1.4.4.2">←</ci><apply id="alg1.l2.m1.4.4.3.cmml" xref="alg1.l2.m1.4.4.3"><ci id="alg1.l2.m1.4.4.3.1.cmml" xref="alg1.l2.m1.4.4.3.1">→</ci><ci id="alg1.l2.m1.4.4.3.2.cmml" xref="alg1.l2.m1.4.4.3.2">𝐲</ci></apply><apply id="alg1.l2.m1.4.4.1.cmml" xref="alg1.l2.m1.4.4.1"><times id="alg1.l2.m1.4.4.1.2.cmml" xref="alg1.l2.m1.4.4.1.2"></times><apply id="alg1.l2.m1.4.4.1.3.cmml" xref="alg1.l2.m1.4.4.1.3"><csymbol cd="ambiguous" id="alg1.l2.m1.4.4.1.3.1.cmml" xref="alg1.l2.m1.4.4.1.3">subscript</csymbol><ci id="alg1.l2.m1.4.4.1.3.2a.cmml" xref="alg1.l2.m1.4.4.1.3.2"><mtext id="alg1.l2.m1.4.4.1.3.2.cmml" xref="alg1.l2.m1.4.4.1.3.2">Top</mtext></ci><ci id="alg1.l2.m1.4.4.1.3.3.cmml" xref="alg1.l2.m1.4.4.1.3.3">𝑘</ci></apply><apply id="alg1.l2.m1.4.4.1.1.1.1.cmml" xref="alg1.l2.m1.4.4.1.1.1"><times id="alg1.l2.m1.4.4.1.1.1.1.1.cmml" xref="alg1.l2.m1.4.4.1.1.1.1.1"></times><apply id="alg1.l2.m1.4.4.1.1.1.1.2.1.cmml" xref="alg1.l2.m1.4.4.1.1.1.1.2.2"><csymbol cd="latexml" id="alg1.l2.m1.4.4.1.1.1.1.2.1.1.cmml" xref="alg1.l2.m1.4.4.1.1.1.1.2.2.2.2.1">evaluated-at</csymbol><ci id="alg1.l2.m1.1.1.cmml" xref="alg1.l2.m1.1.1">𝐙</ci><apply id="alg1.l2.m1.2.2.1.cmml" xref="alg1.l2.m1.2.2.1"><csymbol cd="ambiguous" id="alg1.l2.m1.2.2.1.1.cmml" xref="alg1.l2.m1.2.2.1">superscript</csymbol><ci id="alg1.l2.m1.2.2.1.2.cmml" xref="alg1.l2.m1.2.2.1.2">𝑆</ci><ci id="alg1.l2.m1.2.2.1.3.cmml" xref="alg1.l2.m1.2.2.1.3">′</ci></apply><csymbol cd="latexml" id="alg1.l2.m1.3.3.1.cmml" xref="alg1.l2.m1.3.3.1">top</csymbol></apply><apply id="alg1.l2.m1.4.4.1.1.1.1.3.cmml" xref="alg1.l2.m1.4.4.1.1.1.1.3"><ci id="alg1.l2.m1.4.4.1.1.1.1.3.1.cmml" xref="alg1.l2.m1.4.4.1.1.1.1.3.1">→</ci><ci id="alg1.l2.m1.4.4.1.1.1.1.3.2.cmml" xref="alg1.l2.m1.4.4.1.1.1.1.3.2">𝐱</ci></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.l2.m1.4c">\overrightarrow{\mathbf{y}}\leftarrow{\textrm{Top}_{k}\left({\mathbf{Z}}|_{S^{%
\prime}}^{\top}\overrightarrow{\mathbf{x}}\right)}</annotation><annotation encoding="application/x-llamapun" id="alg1.l2.m1.4d">over→ start_ARG bold_y end_ARG ← Top start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT ( bold_Z | start_POSTSUBSCRIPT italic_S start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT end_POSTSUBSCRIPT start_POSTSUPERSCRIPT ⊤ end_POSTSUPERSCRIPT over→ start_ARG bold_x end_ARG )</annotation></semantics></math>
</div>
<div class="ltx_listingline" id="alg1.l2a">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg1.l2a.1.1.1" style="font-size:80%;">2:</span></span>  <math alttext="\overrightarrow{\mathbf{y}}" class="ltx_Math" display="inline" id="alg1.l2a.m1.1"><semantics id="alg1.l2a.m1.1a"><mover accent="true" id="alg1.l2a.m1.1.1" xref="alg1.l2a.m1.1.1.cmml"><mi id="alg1.l2a.m1.1.1.2" xref="alg1.l2a.m1.1.1.2.cmml">𝐲</mi><mo id="alg1.l2a.m1.1.1.1" stretchy="false" xref="alg1.l2a.m1.1.1.1.cmml">→</mo></mover><annotation-xml encoding="MathML-Content" id="alg1.l2a.m1.1b"><apply id="alg1.l2a.m1.1.1.cmml" xref="alg1.l2a.m1.1.1"><ci id="alg1.l2a.m1.1.1.1.cmml" xref="alg1.l2a.m1.1.1.1">→</ci><ci id="alg1.l2a.m1.1.1.2.cmml" xref="alg1.l2a.m1.1.1.2">𝐲</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.l2a.m1.1c">\overrightarrow{\mathbf{y}}</annotation><annotation encoding="application/x-llamapun" id="alg1.l2a.m1.1d">over→ start_ARG bold_y end_ARG</annotation></semantics></math>
</div>
</div>
</figure>
<figure class="ltx_figure" id="S3.F1"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_square" height="386" id="S3.F1.g1" src="extracted/5409158/figures/herd.png" width="407"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure">Figure 1: </span>HiRE schematic: To compute the top-<math alttext="k" class="ltx_Math" display="inline" id="S3.F1.10.m1.1"><semantics id="S3.F1.10.m1.1b"><mi id="S3.F1.10.m1.1.1" xref="S3.F1.10.m1.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="S3.F1.10.m1.1c"><ci id="S3.F1.10.m1.1.1.cmml" xref="S3.F1.10.m1.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.F1.10.m1.1d">k</annotation><annotation encoding="application/x-llamapun" id="S3.F1.10.m1.1e">italic_k</annotation></semantics></math> elements of <math alttext="\phi({\mathbf{Z}}^{\top}\overrightarrow{\mathbf{x}})" class="ltx_Math" display="inline" id="S3.F1.11.m2.1"><semantics id="S3.F1.11.m2.1b"><mrow id="S3.F1.11.m2.1.1" xref="S3.F1.11.m2.1.1.cmml"><mi id="S3.F1.11.m2.1.1.3" xref="S3.F1.11.m2.1.1.3.cmml">ϕ</mi><mo id="S3.F1.11.m2.1.1.2" xref="S3.F1.11.m2.1.1.2.cmml">⁢</mo><mrow id="S3.F1.11.m2.1.1.1.1" xref="S3.F1.11.m2.1.1.1.1.1.cmml"><mo id="S3.F1.11.m2.1.1.1.1.2" stretchy="false" xref="S3.F1.11.m2.1.1.1.1.1.cmml">(</mo><mrow id="S3.F1.11.m2.1.1.1.1.1" xref="S3.F1.11.m2.1.1.1.1.1.cmml"><msup id="S3.F1.11.m2.1.1.1.1.1.2" xref="S3.F1.11.m2.1.1.1.1.1.2.cmml"><mi id="S3.F1.11.m2.1.1.1.1.1.2.2" xref="S3.F1.11.m2.1.1.1.1.1.2.2.cmml">𝐙</mi><mo id="S3.F1.11.m2.1.1.1.1.1.2.3" xref="S3.F1.11.m2.1.1.1.1.1.2.3.cmml">⊤</mo></msup><mo id="S3.F1.11.m2.1.1.1.1.1.1" xref="S3.F1.11.m2.1.1.1.1.1.1.cmml">⁢</mo><mover accent="true" id="S3.F1.11.m2.1.1.1.1.1.3" xref="S3.F1.11.m2.1.1.1.1.1.3.cmml"><mi id="S3.F1.11.m2.1.1.1.1.1.3.2" xref="S3.F1.11.m2.1.1.1.1.1.3.2.cmml">𝐱</mi><mo id="S3.F1.11.m2.1.1.1.1.1.3.1" stretchy="false" xref="S3.F1.11.m2.1.1.1.1.1.3.1.cmml">→</mo></mover></mrow><mo id="S3.F1.11.m2.1.1.1.1.3" stretchy="false" xref="S3.F1.11.m2.1.1.1.1.1.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.F1.11.m2.1c"><apply id="S3.F1.11.m2.1.1.cmml" xref="S3.F1.11.m2.1.1"><times id="S3.F1.11.m2.1.1.2.cmml" xref="S3.F1.11.m2.1.1.2"></times><ci id="S3.F1.11.m2.1.1.3.cmml" xref="S3.F1.11.m2.1.1.3">italic-ϕ</ci><apply id="S3.F1.11.m2.1.1.1.1.1.cmml" xref="S3.F1.11.m2.1.1.1.1"><times id="S3.F1.11.m2.1.1.1.1.1.1.cmml" xref="S3.F1.11.m2.1.1.1.1.1.1"></times><apply id="S3.F1.11.m2.1.1.1.1.1.2.cmml" xref="S3.F1.11.m2.1.1.1.1.1.2"><csymbol cd="ambiguous" id="S3.F1.11.m2.1.1.1.1.1.2.1.cmml" xref="S3.F1.11.m2.1.1.1.1.1.2">superscript</csymbol><ci id="S3.F1.11.m2.1.1.1.1.1.2.2.cmml" xref="S3.F1.11.m2.1.1.1.1.1.2.2">𝐙</ci><csymbol cd="latexml" id="S3.F1.11.m2.1.1.1.1.1.2.3.cmml" xref="S3.F1.11.m2.1.1.1.1.1.2.3">top</csymbol></apply><apply id="S3.F1.11.m2.1.1.1.1.1.3.cmml" xref="S3.F1.11.m2.1.1.1.1.1.3"><ci id="S3.F1.11.m2.1.1.1.1.1.3.1.cmml" xref="S3.F1.11.m2.1.1.1.1.1.3.1">→</ci><ci id="S3.F1.11.m2.1.1.1.1.1.3.2.cmml" xref="S3.F1.11.m2.1.1.1.1.1.3.2">𝐱</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.F1.11.m2.1d">\phi({\mathbf{Z}}^{\top}\overrightarrow{\mathbf{x}})</annotation><annotation encoding="application/x-llamapun" id="S3.F1.11.m2.1e">italic_ϕ ( bold_Z start_POSTSUPERSCRIPT ⊤ end_POSTSUPERSCRIPT over→ start_ARG bold_x end_ARG )</annotation></semantics></math>, we first compute an approximate top-<math alttext="k^{\prime}" class="ltx_Math" display="inline" id="S3.F1.12.m3.1"><semantics id="S3.F1.12.m3.1b"><msup id="S3.F1.12.m3.1.1" xref="S3.F1.12.m3.1.1.cmml"><mi id="S3.F1.12.m3.1.1.2" xref="S3.F1.12.m3.1.1.2.cmml">k</mi><mo id="S3.F1.12.m3.1.1.3" xref="S3.F1.12.m3.1.1.3.cmml">′</mo></msup><annotation-xml encoding="MathML-Content" id="S3.F1.12.m3.1c"><apply id="S3.F1.12.m3.1.1.cmml" xref="S3.F1.12.m3.1.1"><csymbol cd="ambiguous" id="S3.F1.12.m3.1.1.1.cmml" xref="S3.F1.12.m3.1.1">superscript</csymbol><ci id="S3.F1.12.m3.1.1.2.cmml" xref="S3.F1.12.m3.1.1.2">𝑘</ci><ci id="S3.F1.12.m3.1.1.3.cmml" xref="S3.F1.12.m3.1.1.3">′</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.F1.12.m3.1d">k^{\prime}</annotation><annotation encoding="application/x-llamapun" id="S3.F1.12.m3.1e">italic_k start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT</annotation></semantics></math> index set <math alttext="S^{\prime}" class="ltx_Math" display="inline" id="S3.F1.13.m4.1"><semantics id="S3.F1.13.m4.1b"><msup id="S3.F1.13.m4.1.1" xref="S3.F1.13.m4.1.1.cmml"><mi id="S3.F1.13.m4.1.1.2" xref="S3.F1.13.m4.1.1.2.cmml">S</mi><mo id="S3.F1.13.m4.1.1.3" xref="S3.F1.13.m4.1.1.3.cmml">′</mo></msup><annotation-xml encoding="MathML-Content" id="S3.F1.13.m4.1c"><apply id="S3.F1.13.m4.1.1.cmml" xref="S3.F1.13.m4.1.1"><csymbol cd="ambiguous" id="S3.F1.13.m4.1.1.1.cmml" xref="S3.F1.13.m4.1.1">superscript</csymbol><ci id="S3.F1.13.m4.1.1.2.cmml" xref="S3.F1.13.m4.1.1.2">𝑆</ci><ci id="S3.F1.13.m4.1.1.3.cmml" xref="S3.F1.13.m4.1.1.3">′</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.F1.13.m4.1d">S^{\prime}</annotation><annotation encoding="application/x-llamapun" id="S3.F1.13.m4.1e">italic_S start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT</annotation></semantics></math> by using a low rank approximation <math alttext="{\mathbf{Z}_{\textrm{approx}}}={\mathbf{Z}}_{1}{\mathbf{Z}}_{2}^{\top}" class="ltx_Math" display="inline" id="S3.F1.14.m5.1"><semantics id="S3.F1.14.m5.1b"><mrow id="S3.F1.14.m5.1.1" xref="S3.F1.14.m5.1.1.cmml"><msub id="S3.F1.14.m5.1.1.2" xref="S3.F1.14.m5.1.1.2.cmml"><mi id="S3.F1.14.m5.1.1.2.2" xref="S3.F1.14.m5.1.1.2.2.cmml">𝐙</mi><mtext id="S3.F1.14.m5.1.1.2.3" xref="S3.F1.14.m5.1.1.2.3a.cmml">approx</mtext></msub><mo id="S3.F1.14.m5.1.1.1" xref="S3.F1.14.m5.1.1.1.cmml">=</mo><mrow id="S3.F1.14.m5.1.1.3" xref="S3.F1.14.m5.1.1.3.cmml"><msub id="S3.F1.14.m5.1.1.3.2" xref="S3.F1.14.m5.1.1.3.2.cmml"><mi id="S3.F1.14.m5.1.1.3.2.2" xref="S3.F1.14.m5.1.1.3.2.2.cmml">𝐙</mi><mn id="S3.F1.14.m5.1.1.3.2.3" xref="S3.F1.14.m5.1.1.3.2.3.cmml">1</mn></msub><mo id="S3.F1.14.m5.1.1.3.1" xref="S3.F1.14.m5.1.1.3.1.cmml">⁢</mo><msubsup id="S3.F1.14.m5.1.1.3.3" xref="S3.F1.14.m5.1.1.3.3.cmml"><mi id="S3.F1.14.m5.1.1.3.3.2.2" xref="S3.F1.14.m5.1.1.3.3.2.2.cmml">𝐙</mi><mn id="S3.F1.14.m5.1.1.3.3.2.3" xref="S3.F1.14.m5.1.1.3.3.2.3.cmml">2</mn><mo id="S3.F1.14.m5.1.1.3.3.3" xref="S3.F1.14.m5.1.1.3.3.3.cmml">⊤</mo></msubsup></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.F1.14.m5.1c"><apply id="S3.F1.14.m5.1.1.cmml" xref="S3.F1.14.m5.1.1"><eq id="S3.F1.14.m5.1.1.1.cmml" xref="S3.F1.14.m5.1.1.1"></eq><apply id="S3.F1.14.m5.1.1.2.cmml" xref="S3.F1.14.m5.1.1.2"><csymbol cd="ambiguous" id="S3.F1.14.m5.1.1.2.1.cmml" xref="S3.F1.14.m5.1.1.2">subscript</csymbol><ci id="S3.F1.14.m5.1.1.2.2.cmml" xref="S3.F1.14.m5.1.1.2.2">𝐙</ci><ci id="S3.F1.14.m5.1.1.2.3a.cmml" xref="S3.F1.14.m5.1.1.2.3"><mtext id="S3.F1.14.m5.1.1.2.3.cmml" mathsize="70%" xref="S3.F1.14.m5.1.1.2.3">approx</mtext></ci></apply><apply id="S3.F1.14.m5.1.1.3.cmml" xref="S3.F1.14.m5.1.1.3"><times id="S3.F1.14.m5.1.1.3.1.cmml" xref="S3.F1.14.m5.1.1.3.1"></times><apply id="S3.F1.14.m5.1.1.3.2.cmml" xref="S3.F1.14.m5.1.1.3.2"><csymbol cd="ambiguous" id="S3.F1.14.m5.1.1.3.2.1.cmml" xref="S3.F1.14.m5.1.1.3.2">subscript</csymbol><ci id="S3.F1.14.m5.1.1.3.2.2.cmml" xref="S3.F1.14.m5.1.1.3.2.2">𝐙</ci><cn id="S3.F1.14.m5.1.1.3.2.3.cmml" type="integer" xref="S3.F1.14.m5.1.1.3.2.3">1</cn></apply><apply id="S3.F1.14.m5.1.1.3.3.cmml" xref="S3.F1.14.m5.1.1.3.3"><csymbol cd="ambiguous" id="S3.F1.14.m5.1.1.3.3.1.cmml" xref="S3.F1.14.m5.1.1.3.3">superscript</csymbol><apply id="S3.F1.14.m5.1.1.3.3.2.cmml" xref="S3.F1.14.m5.1.1.3.3"><csymbol cd="ambiguous" id="S3.F1.14.m5.1.1.3.3.2.1.cmml" xref="S3.F1.14.m5.1.1.3.3">subscript</csymbol><ci id="S3.F1.14.m5.1.1.3.3.2.2.cmml" xref="S3.F1.14.m5.1.1.3.3.2.2">𝐙</ci><cn id="S3.F1.14.m5.1.1.3.3.2.3.cmml" type="integer" xref="S3.F1.14.m5.1.1.3.3.2.3">2</cn></apply><csymbol cd="latexml" id="S3.F1.14.m5.1.1.3.3.3.cmml" xref="S3.F1.14.m5.1.1.3.3.3">top</csymbol></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.F1.14.m5.1d">{\mathbf{Z}_{\textrm{approx}}}={\mathbf{Z}}_{1}{\mathbf{Z}}_{2}^{\top}</annotation><annotation encoding="application/x-llamapun" id="S3.F1.14.m5.1e">bold_Z start_POSTSUBSCRIPT approx end_POSTSUBSCRIPT = bold_Z start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT bold_Z start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT ⊤ end_POSTSUPERSCRIPT</annotation></semantics></math>. We then compute <math alttext="\phi({\mathbf{Z}}|_{S^{\prime}}^{\top}\overrightarrow{\mathbf{x}})" class="ltx_Math" display="inline" id="S3.F1.15.m6.4"><semantics id="S3.F1.15.m6.4b"><mrow id="S3.F1.15.m6.4.4" xref="S3.F1.15.m6.4.4.cmml"><mi id="S3.F1.15.m6.4.4.3" xref="S3.F1.15.m6.4.4.3.cmml">ϕ</mi><mo id="S3.F1.15.m6.4.4.2" xref="S3.F1.15.m6.4.4.2.cmml">⁢</mo><mrow id="S3.F1.15.m6.4.4.1.1" xref="S3.F1.15.m6.4.4.1.1.1.cmml"><mo id="S3.F1.15.m6.4.4.1.1.2" stretchy="false" xref="S3.F1.15.m6.4.4.1.1.1.cmml">(</mo><mrow id="S3.F1.15.m6.4.4.1.1.1" xref="S3.F1.15.m6.4.4.1.1.1.cmml"><msubsup id="S3.F1.15.m6.4.4.1.1.1.2.2" xref="S3.F1.15.m6.4.4.1.1.1.2.1.cmml"><mrow id="S3.F1.15.m6.4.4.1.1.1.2.2.2.2" xref="S3.F1.15.m6.4.4.1.1.1.2.1.cmml"><mi id="S3.F1.15.m6.1.1" xref="S3.F1.15.m6.1.1.cmml">𝐙</mi><mo id="S3.F1.15.m6.4.4.1.1.1.2.2.2.2.1" stretchy="false" xref="S3.F1.15.m6.4.4.1.1.1.2.1.1.cmml">|</mo></mrow><msup id="S3.F1.15.m6.2.2.1" xref="S3.F1.15.m6.2.2.1.cmml"><mi id="S3.F1.15.m6.2.2.1.2" xref="S3.F1.15.m6.2.2.1.2.cmml">S</mi><mo id="S3.F1.15.m6.2.2.1.3" xref="S3.F1.15.m6.2.2.1.3.cmml">′</mo></msup><mo id="S3.F1.15.m6.3.3.1" xref="S3.F1.15.m6.3.3.1.cmml">⊤</mo></msubsup><mo id="S3.F1.15.m6.4.4.1.1.1.1" xref="S3.F1.15.m6.4.4.1.1.1.1.cmml">⁢</mo><mover accent="true" id="S3.F1.15.m6.4.4.1.1.1.3" xref="S3.F1.15.m6.4.4.1.1.1.3.cmml"><mi id="S3.F1.15.m6.4.4.1.1.1.3.2" xref="S3.F1.15.m6.4.4.1.1.1.3.2.cmml">𝐱</mi><mo id="S3.F1.15.m6.4.4.1.1.1.3.1" stretchy="false" xref="S3.F1.15.m6.4.4.1.1.1.3.1.cmml">→</mo></mover></mrow><mo id="S3.F1.15.m6.4.4.1.1.3" stretchy="false" xref="S3.F1.15.m6.4.4.1.1.1.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.F1.15.m6.4c"><apply id="S3.F1.15.m6.4.4.cmml" xref="S3.F1.15.m6.4.4"><times id="S3.F1.15.m6.4.4.2.cmml" xref="S3.F1.15.m6.4.4.2"></times><ci id="S3.F1.15.m6.4.4.3.cmml" xref="S3.F1.15.m6.4.4.3">italic-ϕ</ci><apply id="S3.F1.15.m6.4.4.1.1.1.cmml" xref="S3.F1.15.m6.4.4.1.1"><times id="S3.F1.15.m6.4.4.1.1.1.1.cmml" xref="S3.F1.15.m6.4.4.1.1.1.1"></times><apply id="S3.F1.15.m6.4.4.1.1.1.2.1.cmml" xref="S3.F1.15.m6.4.4.1.1.1.2.2"><csymbol cd="latexml" id="S3.F1.15.m6.4.4.1.1.1.2.1.1.cmml" xref="S3.F1.15.m6.4.4.1.1.1.2.2.2.2.1">evaluated-at</csymbol><ci id="S3.F1.15.m6.1.1.cmml" xref="S3.F1.15.m6.1.1">𝐙</ci><apply id="S3.F1.15.m6.2.2.1.cmml" xref="S3.F1.15.m6.2.2.1"><csymbol cd="ambiguous" id="S3.F1.15.m6.2.2.1.1.cmml" xref="S3.F1.15.m6.2.2.1">superscript</csymbol><ci id="S3.F1.15.m6.2.2.1.2.cmml" xref="S3.F1.15.m6.2.2.1.2">𝑆</ci><ci id="S3.F1.15.m6.2.2.1.3.cmml" xref="S3.F1.15.m6.2.2.1.3">′</ci></apply><csymbol cd="latexml" id="S3.F1.15.m6.3.3.1.cmml" xref="S3.F1.15.m6.3.3.1">top</csymbol></apply><apply id="S3.F1.15.m6.4.4.1.1.1.3.cmml" xref="S3.F1.15.m6.4.4.1.1.1.3"><ci id="S3.F1.15.m6.4.4.1.1.1.3.1.cmml" xref="S3.F1.15.m6.4.4.1.1.1.3.1">→</ci><ci id="S3.F1.15.m6.4.4.1.1.1.3.2.cmml" xref="S3.F1.15.m6.4.4.1.1.1.3.2">𝐱</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.F1.15.m6.4d">\phi({\mathbf{Z}}|_{S^{\prime}}^{\top}\overrightarrow{\mathbf{x}})</annotation><annotation encoding="application/x-llamapun" id="S3.F1.15.m6.4e">italic_ϕ ( bold_Z | start_POSTSUBSCRIPT italic_S start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT end_POSTSUBSCRIPT start_POSTSUPERSCRIPT ⊤ end_POSTSUPERSCRIPT over→ start_ARG bold_x end_ARG )</annotation></semantics></math> for <math alttext="{\mathbf{Z}}" class="ltx_Math" display="inline" id="S3.F1.16.m7.1"><semantics id="S3.F1.16.m7.1b"><mi id="S3.F1.16.m7.1.1" xref="S3.F1.16.m7.1.1.cmml">𝐙</mi><annotation-xml encoding="MathML-Content" id="S3.F1.16.m7.1c"><ci id="S3.F1.16.m7.1.1.cmml" xref="S3.F1.16.m7.1.1">𝐙</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.F1.16.m7.1d">{\mathbf{Z}}</annotation><annotation encoding="application/x-llamapun" id="S3.F1.16.m7.1e">bold_Z</annotation></semantics></math> restricted to <math alttext="S^{\prime}" class="ltx_Math" display="inline" id="S3.F1.17.m8.1"><semantics id="S3.F1.17.m8.1b"><msup id="S3.F1.17.m8.1.1" xref="S3.F1.17.m8.1.1.cmml"><mi id="S3.F1.17.m8.1.1.2" xref="S3.F1.17.m8.1.1.2.cmml">S</mi><mo id="S3.F1.17.m8.1.1.3" xref="S3.F1.17.m8.1.1.3.cmml">′</mo></msup><annotation-xml encoding="MathML-Content" id="S3.F1.17.m8.1c"><apply id="S3.F1.17.m8.1.1.cmml" xref="S3.F1.17.m8.1.1"><csymbol cd="ambiguous" id="S3.F1.17.m8.1.1.1.cmml" xref="S3.F1.17.m8.1.1">superscript</csymbol><ci id="S3.F1.17.m8.1.1.2.cmml" xref="S3.F1.17.m8.1.1.2">𝑆</ci><ci id="S3.F1.17.m8.1.1.3.cmml" xref="S3.F1.17.m8.1.1.3">′</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.F1.17.m8.1d">S^{\prime}</annotation><annotation encoding="application/x-llamapun" id="S3.F1.17.m8.1e">italic_S start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT</annotation></semantics></math> and then perform top-<math alttext="k" class="ltx_Math" display="inline" id="S3.F1.18.m9.1"><semantics id="S3.F1.18.m9.1b"><mi id="S3.F1.18.m9.1.1" xref="S3.F1.18.m9.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="S3.F1.18.m9.1c"><ci id="S3.F1.18.m9.1.1.cmml" xref="S3.F1.18.m9.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.F1.18.m9.1d">k</annotation><annotation encoding="application/x-llamapun" id="S3.F1.18.m9.1e">italic_k</annotation></semantics></math> operation on that vector.</figcaption>
</figure>
<div class="ltx_para" id="S3.SS2.SSS1.p1">
<p class="ltx_p" id="S3.SS2.SSS1.p1.16">The key idea behind HiRE is that given an approximate, and smaller version of the matrix <math alttext="Z" class="ltx_Math" display="inline" id="S3.SS2.SSS1.p1.1.m1.1"><semantics id="S3.SS2.SSS1.p1.1.m1.1a"><mi id="S3.SS2.SSS1.p1.1.m1.1.1" xref="S3.SS2.SSS1.p1.1.m1.1.1.cmml">Z</mi><annotation-xml encoding="MathML-Content" id="S3.SS2.SSS1.p1.1.m1.1b"><ci id="S3.SS2.SSS1.p1.1.m1.1.1.cmml" xref="S3.SS2.SSS1.p1.1.m1.1.1">𝑍</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.SSS1.p1.1.m1.1c">Z</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.SSS1.p1.1.m1.1d">italic_Z</annotation></semantics></math>, denoted by <math alttext="{\mathbf{Z}_{\textrm{approx}}}" class="ltx_Math" display="inline" id="S3.SS2.SSS1.p1.2.m2.1"><semantics id="S3.SS2.SSS1.p1.2.m2.1a"><msub id="S3.SS2.SSS1.p1.2.m2.1.1" xref="S3.SS2.SSS1.p1.2.m2.1.1.cmml"><mi id="S3.SS2.SSS1.p1.2.m2.1.1.2" xref="S3.SS2.SSS1.p1.2.m2.1.1.2.cmml">𝐙</mi><mtext id="S3.SS2.SSS1.p1.2.m2.1.1.3" xref="S3.SS2.SSS1.p1.2.m2.1.1.3a.cmml">approx</mtext></msub><annotation-xml encoding="MathML-Content" id="S3.SS2.SSS1.p1.2.m2.1b"><apply id="S3.SS2.SSS1.p1.2.m2.1.1.cmml" xref="S3.SS2.SSS1.p1.2.m2.1.1"><csymbol cd="ambiguous" id="S3.SS2.SSS1.p1.2.m2.1.1.1.cmml" xref="S3.SS2.SSS1.p1.2.m2.1.1">subscript</csymbol><ci id="S3.SS2.SSS1.p1.2.m2.1.1.2.cmml" xref="S3.SS2.SSS1.p1.2.m2.1.1.2">𝐙</ci><ci id="S3.SS2.SSS1.p1.2.m2.1.1.3a.cmml" xref="S3.SS2.SSS1.p1.2.m2.1.1.3"><mtext id="S3.SS2.SSS1.p1.2.m2.1.1.3.cmml" mathsize="70%" xref="S3.SS2.SSS1.p1.2.m2.1.1.3">approx</mtext></ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.SSS1.p1.2.m2.1c">{\mathbf{Z}_{\textrm{approx}}}</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.SSS1.p1.2.m2.1d">bold_Z start_POSTSUBSCRIPT approx end_POSTSUBSCRIPT</annotation></semantics></math>, we first approximate <math alttext="\phi({\mathbf{Z}}^{\top}\overrightarrow{\mathbf{x}})" class="ltx_Math" display="inline" id="S3.SS2.SSS1.p1.3.m3.1"><semantics id="S3.SS2.SSS1.p1.3.m3.1a"><mrow id="S3.SS2.SSS1.p1.3.m3.1.1" xref="S3.SS2.SSS1.p1.3.m3.1.1.cmml"><mi id="S3.SS2.SSS1.p1.3.m3.1.1.3" xref="S3.SS2.SSS1.p1.3.m3.1.1.3.cmml">ϕ</mi><mo id="S3.SS2.SSS1.p1.3.m3.1.1.2" xref="S3.SS2.SSS1.p1.3.m3.1.1.2.cmml">⁢</mo><mrow id="S3.SS2.SSS1.p1.3.m3.1.1.1.1" xref="S3.SS2.SSS1.p1.3.m3.1.1.1.1.1.cmml"><mo id="S3.SS2.SSS1.p1.3.m3.1.1.1.1.2" stretchy="false" xref="S3.SS2.SSS1.p1.3.m3.1.1.1.1.1.cmml">(</mo><mrow id="S3.SS2.SSS1.p1.3.m3.1.1.1.1.1" xref="S3.SS2.SSS1.p1.3.m3.1.1.1.1.1.cmml"><msup id="S3.SS2.SSS1.p1.3.m3.1.1.1.1.1.2" xref="S3.SS2.SSS1.p1.3.m3.1.1.1.1.1.2.cmml"><mi id="S3.SS2.SSS1.p1.3.m3.1.1.1.1.1.2.2" xref="S3.SS2.SSS1.p1.3.m3.1.1.1.1.1.2.2.cmml">𝐙</mi><mo id="S3.SS2.SSS1.p1.3.m3.1.1.1.1.1.2.3" xref="S3.SS2.SSS1.p1.3.m3.1.1.1.1.1.2.3.cmml">⊤</mo></msup><mo id="S3.SS2.SSS1.p1.3.m3.1.1.1.1.1.1" xref="S3.SS2.SSS1.p1.3.m3.1.1.1.1.1.1.cmml">⁢</mo><mover accent="true" id="S3.SS2.SSS1.p1.3.m3.1.1.1.1.1.3" xref="S3.SS2.SSS1.p1.3.m3.1.1.1.1.1.3.cmml"><mi id="S3.SS2.SSS1.p1.3.m3.1.1.1.1.1.3.2" xref="S3.SS2.SSS1.p1.3.m3.1.1.1.1.1.3.2.cmml">𝐱</mi><mo id="S3.SS2.SSS1.p1.3.m3.1.1.1.1.1.3.1" stretchy="false" xref="S3.SS2.SSS1.p1.3.m3.1.1.1.1.1.3.1.cmml">→</mo></mover></mrow><mo id="S3.SS2.SSS1.p1.3.m3.1.1.1.1.3" stretchy="false" xref="S3.SS2.SSS1.p1.3.m3.1.1.1.1.1.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.SS2.SSS1.p1.3.m3.1b"><apply id="S3.SS2.SSS1.p1.3.m3.1.1.cmml" xref="S3.SS2.SSS1.p1.3.m3.1.1"><times id="S3.SS2.SSS1.p1.3.m3.1.1.2.cmml" xref="S3.SS2.SSS1.p1.3.m3.1.1.2"></times><ci id="S3.SS2.SSS1.p1.3.m3.1.1.3.cmml" xref="S3.SS2.SSS1.p1.3.m3.1.1.3">italic-ϕ</ci><apply id="S3.SS2.SSS1.p1.3.m3.1.1.1.1.1.cmml" xref="S3.SS2.SSS1.p1.3.m3.1.1.1.1"><times id="S3.SS2.SSS1.p1.3.m3.1.1.1.1.1.1.cmml" xref="S3.SS2.SSS1.p1.3.m3.1.1.1.1.1.1"></times><apply id="S3.SS2.SSS1.p1.3.m3.1.1.1.1.1.2.cmml" xref="S3.SS2.SSS1.p1.3.m3.1.1.1.1.1.2"><csymbol cd="ambiguous" id="S3.SS2.SSS1.p1.3.m3.1.1.1.1.1.2.1.cmml" xref="S3.SS2.SSS1.p1.3.m3.1.1.1.1.1.2">superscript</csymbol><ci id="S3.SS2.SSS1.p1.3.m3.1.1.1.1.1.2.2.cmml" xref="S3.SS2.SSS1.p1.3.m3.1.1.1.1.1.2.2">𝐙</ci><csymbol cd="latexml" id="S3.SS2.SSS1.p1.3.m3.1.1.1.1.1.2.3.cmml" xref="S3.SS2.SSS1.p1.3.m3.1.1.1.1.1.2.3">top</csymbol></apply><apply id="S3.SS2.SSS1.p1.3.m3.1.1.1.1.1.3.cmml" xref="S3.SS2.SSS1.p1.3.m3.1.1.1.1.1.3"><ci id="S3.SS2.SSS1.p1.3.m3.1.1.1.1.1.3.1.cmml" xref="S3.SS2.SSS1.p1.3.m3.1.1.1.1.1.3.1">→</ci><ci id="S3.SS2.SSS1.p1.3.m3.1.1.1.1.1.3.2.cmml" xref="S3.SS2.SSS1.p1.3.m3.1.1.1.1.1.3.2">𝐱</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.SSS1.p1.3.m3.1c">\phi({\mathbf{Z}}^{\top}\overrightarrow{\mathbf{x}})</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.SSS1.p1.3.m3.1d">italic_ϕ ( bold_Z start_POSTSUPERSCRIPT ⊤ end_POSTSUPERSCRIPT over→ start_ARG bold_x end_ARG )</annotation></semantics></math> with <math alttext="\phi({\mathbf{Z}_{\textrm{approx}}}^{\top}\overrightarrow{\mathbf{x}})" class="ltx_Math" display="inline" id="S3.SS2.SSS1.p1.4.m4.1"><semantics id="S3.SS2.SSS1.p1.4.m4.1a"><mrow id="S3.SS2.SSS1.p1.4.m4.1.1" xref="S3.SS2.SSS1.p1.4.m4.1.1.cmml"><mi id="S3.SS2.SSS1.p1.4.m4.1.1.3" xref="S3.SS2.SSS1.p1.4.m4.1.1.3.cmml">ϕ</mi><mo id="S3.SS2.SSS1.p1.4.m4.1.1.2" xref="S3.SS2.SSS1.p1.4.m4.1.1.2.cmml">⁢</mo><mrow id="S3.SS2.SSS1.p1.4.m4.1.1.1.1" xref="S3.SS2.SSS1.p1.4.m4.1.1.1.1.1.cmml"><mo id="S3.SS2.SSS1.p1.4.m4.1.1.1.1.2" stretchy="false" xref="S3.SS2.SSS1.p1.4.m4.1.1.1.1.1.cmml">(</mo><mrow id="S3.SS2.SSS1.p1.4.m4.1.1.1.1.1" xref="S3.SS2.SSS1.p1.4.m4.1.1.1.1.1.cmml"><mmultiscripts id="S3.SS2.SSS1.p1.4.m4.1.1.1.1.1.2" xref="S3.SS2.SSS1.p1.4.m4.1.1.1.1.1.2.cmml"><mi id="S3.SS2.SSS1.p1.4.m4.1.1.1.1.1.2.2.2" xref="S3.SS2.SSS1.p1.4.m4.1.1.1.1.1.2.2.2.cmml">𝐙</mi><mtext id="S3.SS2.SSS1.p1.4.m4.1.1.1.1.1.2.2.3" xref="S3.SS2.SSS1.p1.4.m4.1.1.1.1.1.2.2.3a.cmml">approx</mtext><mrow id="S3.SS2.SSS1.p1.4.m4.1.1.1.1.1.2a" xref="S3.SS2.SSS1.p1.4.m4.1.1.1.1.1.2.cmml"></mrow><mrow id="S3.SS2.SSS1.p1.4.m4.1.1.1.1.1.2b" xref="S3.SS2.SSS1.p1.4.m4.1.1.1.1.1.2.cmml"></mrow><mo id="S3.SS2.SSS1.p1.4.m4.1.1.1.1.1.2.3" xref="S3.SS2.SSS1.p1.4.m4.1.1.1.1.1.2.3.cmml">⊤</mo></mmultiscripts><mo id="S3.SS2.SSS1.p1.4.m4.1.1.1.1.1.1" xref="S3.SS2.SSS1.p1.4.m4.1.1.1.1.1.1.cmml">⁢</mo><mover accent="true" id="S3.SS2.SSS1.p1.4.m4.1.1.1.1.1.3" xref="S3.SS2.SSS1.p1.4.m4.1.1.1.1.1.3.cmml"><mi id="S3.SS2.SSS1.p1.4.m4.1.1.1.1.1.3.2" xref="S3.SS2.SSS1.p1.4.m4.1.1.1.1.1.3.2.cmml">𝐱</mi><mo id="S3.SS2.SSS1.p1.4.m4.1.1.1.1.1.3.1" stretchy="false" xref="S3.SS2.SSS1.p1.4.m4.1.1.1.1.1.3.1.cmml">→</mo></mover></mrow><mo id="S3.SS2.SSS1.p1.4.m4.1.1.1.1.3" stretchy="false" xref="S3.SS2.SSS1.p1.4.m4.1.1.1.1.1.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.SS2.SSS1.p1.4.m4.1b"><apply id="S3.SS2.SSS1.p1.4.m4.1.1.cmml" xref="S3.SS2.SSS1.p1.4.m4.1.1"><times id="S3.SS2.SSS1.p1.4.m4.1.1.2.cmml" xref="S3.SS2.SSS1.p1.4.m4.1.1.2"></times><ci id="S3.SS2.SSS1.p1.4.m4.1.1.3.cmml" xref="S3.SS2.SSS1.p1.4.m4.1.1.3">italic-ϕ</ci><apply id="S3.SS2.SSS1.p1.4.m4.1.1.1.1.1.cmml" xref="S3.SS2.SSS1.p1.4.m4.1.1.1.1"><times id="S3.SS2.SSS1.p1.4.m4.1.1.1.1.1.1.cmml" xref="S3.SS2.SSS1.p1.4.m4.1.1.1.1.1.1"></times><apply id="S3.SS2.SSS1.p1.4.m4.1.1.1.1.1.2.cmml" xref="S3.SS2.SSS1.p1.4.m4.1.1.1.1.1.2"><csymbol cd="ambiguous" id="S3.SS2.SSS1.p1.4.m4.1.1.1.1.1.2.1.cmml" xref="S3.SS2.SSS1.p1.4.m4.1.1.1.1.1.2">superscript</csymbol><apply id="S3.SS2.SSS1.p1.4.m4.1.1.1.1.1.2.2.cmml" xref="S3.SS2.SSS1.p1.4.m4.1.1.1.1.1.2"><csymbol cd="ambiguous" id="S3.SS2.SSS1.p1.4.m4.1.1.1.1.1.2.2.1.cmml" xref="S3.SS2.SSS1.p1.4.m4.1.1.1.1.1.2">subscript</csymbol><ci id="S3.SS2.SSS1.p1.4.m4.1.1.1.1.1.2.2.2.cmml" xref="S3.SS2.SSS1.p1.4.m4.1.1.1.1.1.2.2.2">𝐙</ci><ci id="S3.SS2.SSS1.p1.4.m4.1.1.1.1.1.2.2.3a.cmml" xref="S3.SS2.SSS1.p1.4.m4.1.1.1.1.1.2.2.3"><mtext id="S3.SS2.SSS1.p1.4.m4.1.1.1.1.1.2.2.3.cmml" mathsize="70%" xref="S3.SS2.SSS1.p1.4.m4.1.1.1.1.1.2.2.3">approx</mtext></ci></apply><csymbol cd="latexml" id="S3.SS2.SSS1.p1.4.m4.1.1.1.1.1.2.3.cmml" xref="S3.SS2.SSS1.p1.4.m4.1.1.1.1.1.2.3">top</csymbol></apply><apply id="S3.SS2.SSS1.p1.4.m4.1.1.1.1.1.3.cmml" xref="S3.SS2.SSS1.p1.4.m4.1.1.1.1.1.3"><ci id="S3.SS2.SSS1.p1.4.m4.1.1.1.1.1.3.1.cmml" xref="S3.SS2.SSS1.p1.4.m4.1.1.1.1.1.3.1">→</ci><ci id="S3.SS2.SSS1.p1.4.m4.1.1.1.1.1.3.2.cmml" xref="S3.SS2.SSS1.p1.4.m4.1.1.1.1.1.3.2">𝐱</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.SSS1.p1.4.m4.1c">\phi({\mathbf{Z}_{\textrm{approx}}}^{\top}\overrightarrow{\mathbf{x}})</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.SSS1.p1.4.m4.1d">italic_ϕ ( bold_Z start_POSTSUBSCRIPT approx end_POSTSUBSCRIPT start_POSTSUPERSCRIPT ⊤ end_POSTSUPERSCRIPT over→ start_ARG bold_x end_ARG )</annotation></semantics></math>, use it to compute the set of top-<math alttext="k^{\prime}" class="ltx_Math" display="inline" id="S3.SS2.SSS1.p1.5.m5.1"><semantics id="S3.SS2.SSS1.p1.5.m5.1a"><msup id="S3.SS2.SSS1.p1.5.m5.1.1" xref="S3.SS2.SSS1.p1.5.m5.1.1.cmml"><mi id="S3.SS2.SSS1.p1.5.m5.1.1.2" xref="S3.SS2.SSS1.p1.5.m5.1.1.2.cmml">k</mi><mo id="S3.SS2.SSS1.p1.5.m5.1.1.3" xref="S3.SS2.SSS1.p1.5.m5.1.1.3.cmml">′</mo></msup><annotation-xml encoding="MathML-Content" id="S3.SS2.SSS1.p1.5.m5.1b"><apply id="S3.SS2.SSS1.p1.5.m5.1.1.cmml" xref="S3.SS2.SSS1.p1.5.m5.1.1"><csymbol cd="ambiguous" id="S3.SS2.SSS1.p1.5.m5.1.1.1.cmml" xref="S3.SS2.SSS1.p1.5.m5.1.1">superscript</csymbol><ci id="S3.SS2.SSS1.p1.5.m5.1.1.2.cmml" xref="S3.SS2.SSS1.p1.5.m5.1.1.2">𝑘</ci><ci id="S3.SS2.SSS1.p1.5.m5.1.1.3.cmml" xref="S3.SS2.SSS1.p1.5.m5.1.1.3">′</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.SSS1.p1.5.m5.1c">k^{\prime}</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.SSS1.p1.5.m5.1d">italic_k start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT</annotation></semantics></math> elements <math alttext="S^{\prime}" class="ltx_Math" display="inline" id="S3.SS2.SSS1.p1.6.m6.1"><semantics id="S3.SS2.SSS1.p1.6.m6.1a"><msup id="S3.SS2.SSS1.p1.6.m6.1.1" xref="S3.SS2.SSS1.p1.6.m6.1.1.cmml"><mi id="S3.SS2.SSS1.p1.6.m6.1.1.2" xref="S3.SS2.SSS1.p1.6.m6.1.1.2.cmml">S</mi><mo id="S3.SS2.SSS1.p1.6.m6.1.1.3" xref="S3.SS2.SSS1.p1.6.m6.1.1.3.cmml">′</mo></msup><annotation-xml encoding="MathML-Content" id="S3.SS2.SSS1.p1.6.m6.1b"><apply id="S3.SS2.SSS1.p1.6.m6.1.1.cmml" xref="S3.SS2.SSS1.p1.6.m6.1.1"><csymbol cd="ambiguous" id="S3.SS2.SSS1.p1.6.m6.1.1.1.cmml" xref="S3.SS2.SSS1.p1.6.m6.1.1">superscript</csymbol><ci id="S3.SS2.SSS1.p1.6.m6.1.1.2.cmml" xref="S3.SS2.SSS1.p1.6.m6.1.1.2">𝑆</ci><ci id="S3.SS2.SSS1.p1.6.m6.1.1.3.cmml" xref="S3.SS2.SSS1.p1.6.m6.1.1.3">′</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.SSS1.p1.6.m6.1c">S^{\prime}</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.SSS1.p1.6.m6.1d">italic_S start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT</annotation></semantics></math> for some <math alttext="k^{\prime}&gt;k" class="ltx_Math" display="inline" id="S3.SS2.SSS1.p1.7.m7.1"><semantics id="S3.SS2.SSS1.p1.7.m7.1a"><mrow id="S3.SS2.SSS1.p1.7.m7.1.1" xref="S3.SS2.SSS1.p1.7.m7.1.1.cmml"><msup id="S3.SS2.SSS1.p1.7.m7.1.1.2" xref="S3.SS2.SSS1.p1.7.m7.1.1.2.cmml"><mi id="S3.SS2.SSS1.p1.7.m7.1.1.2.2" xref="S3.SS2.SSS1.p1.7.m7.1.1.2.2.cmml">k</mi><mo id="S3.SS2.SSS1.p1.7.m7.1.1.2.3" xref="S3.SS2.SSS1.p1.7.m7.1.1.2.3.cmml">′</mo></msup><mo id="S3.SS2.SSS1.p1.7.m7.1.1.1" xref="S3.SS2.SSS1.p1.7.m7.1.1.1.cmml">&gt;</mo><mi id="S3.SS2.SSS1.p1.7.m7.1.1.3" xref="S3.SS2.SSS1.p1.7.m7.1.1.3.cmml">k</mi></mrow><annotation-xml encoding="MathML-Content" id="S3.SS2.SSS1.p1.7.m7.1b"><apply id="S3.SS2.SSS1.p1.7.m7.1.1.cmml" xref="S3.SS2.SSS1.p1.7.m7.1.1"><gt id="S3.SS2.SSS1.p1.7.m7.1.1.1.cmml" xref="S3.SS2.SSS1.p1.7.m7.1.1.1"></gt><apply id="S3.SS2.SSS1.p1.7.m7.1.1.2.cmml" xref="S3.SS2.SSS1.p1.7.m7.1.1.2"><csymbol cd="ambiguous" id="S3.SS2.SSS1.p1.7.m7.1.1.2.1.cmml" xref="S3.SS2.SSS1.p1.7.m7.1.1.2">superscript</csymbol><ci id="S3.SS2.SSS1.p1.7.m7.1.1.2.2.cmml" xref="S3.SS2.SSS1.p1.7.m7.1.1.2.2">𝑘</ci><ci id="S3.SS2.SSS1.p1.7.m7.1.1.2.3.cmml" xref="S3.SS2.SSS1.p1.7.m7.1.1.2.3">′</ci></apply><ci id="S3.SS2.SSS1.p1.7.m7.1.1.3.cmml" xref="S3.SS2.SSS1.p1.7.m7.1.1.3">𝑘</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.SSS1.p1.7.m7.1c">k^{\prime}&gt;k</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.SSS1.p1.7.m7.1d">italic_k start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT &gt; italic_k</annotation></semantics></math>, compute <math alttext="\phi({\mathbf{Z}}|_{S^{\prime}}^{\top}\overrightarrow{\mathbf{x}})" class="ltx_Math" display="inline" id="S3.SS2.SSS1.p1.8.m8.4"><semantics id="S3.SS2.SSS1.p1.8.m8.4a"><mrow id="S3.SS2.SSS1.p1.8.m8.4.4" xref="S3.SS2.SSS1.p1.8.m8.4.4.cmml"><mi id="S3.SS2.SSS1.p1.8.m8.4.4.3" xref="S3.SS2.SSS1.p1.8.m8.4.4.3.cmml">ϕ</mi><mo id="S3.SS2.SSS1.p1.8.m8.4.4.2" xref="S3.SS2.SSS1.p1.8.m8.4.4.2.cmml">⁢</mo><mrow id="S3.SS2.SSS1.p1.8.m8.4.4.1.1" xref="S3.SS2.SSS1.p1.8.m8.4.4.1.1.1.cmml"><mo id="S3.SS2.SSS1.p1.8.m8.4.4.1.1.2" stretchy="false" xref="S3.SS2.SSS1.p1.8.m8.4.4.1.1.1.cmml">(</mo><mrow id="S3.SS2.SSS1.p1.8.m8.4.4.1.1.1" xref="S3.SS2.SSS1.p1.8.m8.4.4.1.1.1.cmml"><msubsup id="S3.SS2.SSS1.p1.8.m8.4.4.1.1.1.2.2" xref="S3.SS2.SSS1.p1.8.m8.4.4.1.1.1.2.1.cmml"><mrow id="S3.SS2.SSS1.p1.8.m8.4.4.1.1.1.2.2.2.2" xref="S3.SS2.SSS1.p1.8.m8.4.4.1.1.1.2.1.cmml"><mi id="S3.SS2.SSS1.p1.8.m8.1.1" xref="S3.SS2.SSS1.p1.8.m8.1.1.cmml">𝐙</mi><mo id="S3.SS2.SSS1.p1.8.m8.4.4.1.1.1.2.2.2.2.1" stretchy="false" xref="S3.SS2.SSS1.p1.8.m8.4.4.1.1.1.2.1.1.cmml">|</mo></mrow><msup id="S3.SS2.SSS1.p1.8.m8.2.2.1" xref="S3.SS2.SSS1.p1.8.m8.2.2.1.cmml"><mi id="S3.SS2.SSS1.p1.8.m8.2.2.1.2" xref="S3.SS2.SSS1.p1.8.m8.2.2.1.2.cmml">S</mi><mo id="S3.SS2.SSS1.p1.8.m8.2.2.1.3" xref="S3.SS2.SSS1.p1.8.m8.2.2.1.3.cmml">′</mo></msup><mo id="S3.SS2.SSS1.p1.8.m8.3.3.1" xref="S3.SS2.SSS1.p1.8.m8.3.3.1.cmml">⊤</mo></msubsup><mo id="S3.SS2.SSS1.p1.8.m8.4.4.1.1.1.1" xref="S3.SS2.SSS1.p1.8.m8.4.4.1.1.1.1.cmml">⁢</mo><mover accent="true" id="S3.SS2.SSS1.p1.8.m8.4.4.1.1.1.3" xref="S3.SS2.SSS1.p1.8.m8.4.4.1.1.1.3.cmml"><mi id="S3.SS2.SSS1.p1.8.m8.4.4.1.1.1.3.2" xref="S3.SS2.SSS1.p1.8.m8.4.4.1.1.1.3.2.cmml">𝐱</mi><mo id="S3.SS2.SSS1.p1.8.m8.4.4.1.1.1.3.1" stretchy="false" xref="S3.SS2.SSS1.p1.8.m8.4.4.1.1.1.3.1.cmml">→</mo></mover></mrow><mo id="S3.SS2.SSS1.p1.8.m8.4.4.1.1.3" stretchy="false" xref="S3.SS2.SSS1.p1.8.m8.4.4.1.1.1.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.SS2.SSS1.p1.8.m8.4b"><apply id="S3.SS2.SSS1.p1.8.m8.4.4.cmml" xref="S3.SS2.SSS1.p1.8.m8.4.4"><times id="S3.SS2.SSS1.p1.8.m8.4.4.2.cmml" xref="S3.SS2.SSS1.p1.8.m8.4.4.2"></times><ci id="S3.SS2.SSS1.p1.8.m8.4.4.3.cmml" xref="S3.SS2.SSS1.p1.8.m8.4.4.3">italic-ϕ</ci><apply id="S3.SS2.SSS1.p1.8.m8.4.4.1.1.1.cmml" xref="S3.SS2.SSS1.p1.8.m8.4.4.1.1"><times id="S3.SS2.SSS1.p1.8.m8.4.4.1.1.1.1.cmml" xref="S3.SS2.SSS1.p1.8.m8.4.4.1.1.1.1"></times><apply id="S3.SS2.SSS1.p1.8.m8.4.4.1.1.1.2.1.cmml" xref="S3.SS2.SSS1.p1.8.m8.4.4.1.1.1.2.2"><csymbol cd="latexml" id="S3.SS2.SSS1.p1.8.m8.4.4.1.1.1.2.1.1.cmml" xref="S3.SS2.SSS1.p1.8.m8.4.4.1.1.1.2.2.2.2.1">evaluated-at</csymbol><ci id="S3.SS2.SSS1.p1.8.m8.1.1.cmml" xref="S3.SS2.SSS1.p1.8.m8.1.1">𝐙</ci><apply id="S3.SS2.SSS1.p1.8.m8.2.2.1.cmml" xref="S3.SS2.SSS1.p1.8.m8.2.2.1"><csymbol cd="ambiguous" id="S3.SS2.SSS1.p1.8.m8.2.2.1.1.cmml" xref="S3.SS2.SSS1.p1.8.m8.2.2.1">superscript</csymbol><ci id="S3.SS2.SSS1.p1.8.m8.2.2.1.2.cmml" xref="S3.SS2.SSS1.p1.8.m8.2.2.1.2">𝑆</ci><ci id="S3.SS2.SSS1.p1.8.m8.2.2.1.3.cmml" xref="S3.SS2.SSS1.p1.8.m8.2.2.1.3">′</ci></apply><csymbol cd="latexml" id="S3.SS2.SSS1.p1.8.m8.3.3.1.cmml" xref="S3.SS2.SSS1.p1.8.m8.3.3.1">top</csymbol></apply><apply id="S3.SS2.SSS1.p1.8.m8.4.4.1.1.1.3.cmml" xref="S3.SS2.SSS1.p1.8.m8.4.4.1.1.1.3"><ci id="S3.SS2.SSS1.p1.8.m8.4.4.1.1.1.3.1.cmml" xref="S3.SS2.SSS1.p1.8.m8.4.4.1.1.1.3.1">→</ci><ci id="S3.SS2.SSS1.p1.8.m8.4.4.1.1.1.3.2.cmml" xref="S3.SS2.SSS1.p1.8.m8.4.4.1.1.1.3.2">𝐱</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.SSS1.p1.8.m8.4c">\phi({\mathbf{Z}}|_{S^{\prime}}^{\top}\overrightarrow{\mathbf{x}})</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.SSS1.p1.8.m8.4d">italic_ϕ ( bold_Z | start_POSTSUBSCRIPT italic_S start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT end_POSTSUBSCRIPT start_POSTSUPERSCRIPT ⊤ end_POSTSUPERSCRIPT over→ start_ARG bold_x end_ARG )</annotation></semantics></math> for only indices restricted to <math alttext="S^{\prime}" class="ltx_Math" display="inline" id="S3.SS2.SSS1.p1.9.m9.1"><semantics id="S3.SS2.SSS1.p1.9.m9.1a"><msup id="S3.SS2.SSS1.p1.9.m9.1.1" xref="S3.SS2.SSS1.p1.9.m9.1.1.cmml"><mi id="S3.SS2.SSS1.p1.9.m9.1.1.2" xref="S3.SS2.SSS1.p1.9.m9.1.1.2.cmml">S</mi><mo id="S3.SS2.SSS1.p1.9.m9.1.1.3" xref="S3.SS2.SSS1.p1.9.m9.1.1.3.cmml">′</mo></msup><annotation-xml encoding="MathML-Content" id="S3.SS2.SSS1.p1.9.m9.1b"><apply id="S3.SS2.SSS1.p1.9.m9.1.1.cmml" xref="S3.SS2.SSS1.p1.9.m9.1.1"><csymbol cd="ambiguous" id="S3.SS2.SSS1.p1.9.m9.1.1.1.cmml" xref="S3.SS2.SSS1.p1.9.m9.1.1">superscript</csymbol><ci id="S3.SS2.SSS1.p1.9.m9.1.1.2.cmml" xref="S3.SS2.SSS1.p1.9.m9.1.1.2">𝑆</ci><ci id="S3.SS2.SSS1.p1.9.m9.1.1.3.cmml" xref="S3.SS2.SSS1.p1.9.m9.1.1.3">′</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.SSS1.p1.9.m9.1c">S^{\prime}</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.SSS1.p1.9.m9.1d">italic_S start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT</annotation></semantics></math>, and then perform the top-<math alttext="k" class="ltx_Math" display="inline" id="S3.SS2.SSS1.p1.10.m10.1"><semantics id="S3.SS2.SSS1.p1.10.m10.1a"><mi id="S3.SS2.SSS1.p1.10.m10.1.1" xref="S3.SS2.SSS1.p1.10.m10.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="S3.SS2.SSS1.p1.10.m10.1b"><ci id="S3.SS2.SSS1.p1.10.m10.1.1.cmml" xref="S3.SS2.SSS1.p1.10.m10.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.SSS1.p1.10.m10.1c">k</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.SSS1.p1.10.m10.1d">italic_k</annotation></semantics></math> operation on the resulting vector. A pseudocode of HiRE is presented in Algorithm <a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#alg1" title="Algorithm 1 ‣ 3.2.1 Solving equation 5 accurately and efficiently ‣ 3.2 HiRE: Overall Approach ‣ 3 Main Ideas ‣ HiRE: High Recall Approximate Top-𝑘 Estimation for Efficient LLM Inference"><span class="ltx_text ltx_ref_tag">1</span></a> and a schematic diagram is presented in Figure <a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#S3.F1" title="Figure 1 ‣ 3.2.1 Solving equation 5 accurately and efficiently ‣ 3.2 HiRE: Overall Approach ‣ 3 Main Ideas ‣ HiRE: High Recall Approximate Top-𝑘 Estimation for Efficient LLM Inference"><span class="ltx_text ltx_ref_tag">1</span></a>. It is easy to see that as long as <math alttext="\textrm{TopInd}_{k}\left(\phi({\mathbf{Z}}^{\top}\overrightarrow{\mathbf{x}})%
\right)\subseteq S^{\prime}" class="ltx_Math" display="inline" id="S3.SS2.SSS1.p1.11.m11.1"><semantics id="S3.SS2.SSS1.p1.11.m11.1a"><mrow id="S3.SS2.SSS1.p1.11.m11.1.1" xref="S3.SS2.SSS1.p1.11.m11.1.1.cmml"><mrow id="S3.SS2.SSS1.p1.11.m11.1.1.1" xref="S3.SS2.SSS1.p1.11.m11.1.1.1.cmml"><msub id="S3.SS2.SSS1.p1.11.m11.1.1.1.3" xref="S3.SS2.SSS1.p1.11.m11.1.1.1.3.cmml"><mtext id="S3.SS2.SSS1.p1.11.m11.1.1.1.3.2" xref="S3.SS2.SSS1.p1.11.m11.1.1.1.3.2a.cmml">TopInd</mtext><mi id="S3.SS2.SSS1.p1.11.m11.1.1.1.3.3" xref="S3.SS2.SSS1.p1.11.m11.1.1.1.3.3.cmml">k</mi></msub><mo id="S3.SS2.SSS1.p1.11.m11.1.1.1.2" xref="S3.SS2.SSS1.p1.11.m11.1.1.1.2.cmml">⁢</mo><mrow id="S3.SS2.SSS1.p1.11.m11.1.1.1.1.1" xref="S3.SS2.SSS1.p1.11.m11.1.1.1.1.1.1.cmml"><mo id="S3.SS2.SSS1.p1.11.m11.1.1.1.1.1.2" xref="S3.SS2.SSS1.p1.11.m11.1.1.1.1.1.1.cmml">(</mo><mrow id="S3.SS2.SSS1.p1.11.m11.1.1.1.1.1.1" xref="S3.SS2.SSS1.p1.11.m11.1.1.1.1.1.1.cmml"><mi id="S3.SS2.SSS1.p1.11.m11.1.1.1.1.1.1.3" xref="S3.SS2.SSS1.p1.11.m11.1.1.1.1.1.1.3.cmml">ϕ</mi><mo id="S3.SS2.SSS1.p1.11.m11.1.1.1.1.1.1.2" xref="S3.SS2.SSS1.p1.11.m11.1.1.1.1.1.1.2.cmml">⁢</mo><mrow id="S3.SS2.SSS1.p1.11.m11.1.1.1.1.1.1.1.1" xref="S3.SS2.SSS1.p1.11.m11.1.1.1.1.1.1.1.1.1.cmml"><mo id="S3.SS2.SSS1.p1.11.m11.1.1.1.1.1.1.1.1.2" stretchy="false" xref="S3.SS2.SSS1.p1.11.m11.1.1.1.1.1.1.1.1.1.cmml">(</mo><mrow id="S3.SS2.SSS1.p1.11.m11.1.1.1.1.1.1.1.1.1" xref="S3.SS2.SSS1.p1.11.m11.1.1.1.1.1.1.1.1.1.cmml"><msup id="S3.SS2.SSS1.p1.11.m11.1.1.1.1.1.1.1.1.1.2" xref="S3.SS2.SSS1.p1.11.m11.1.1.1.1.1.1.1.1.1.2.cmml"><mi id="S3.SS2.SSS1.p1.11.m11.1.1.1.1.1.1.1.1.1.2.2" xref="S3.SS2.SSS1.p1.11.m11.1.1.1.1.1.1.1.1.1.2.2.cmml">𝐙</mi><mo id="S3.SS2.SSS1.p1.11.m11.1.1.1.1.1.1.1.1.1.2.3" xref="S3.SS2.SSS1.p1.11.m11.1.1.1.1.1.1.1.1.1.2.3.cmml">⊤</mo></msup><mo id="S3.SS2.SSS1.p1.11.m11.1.1.1.1.1.1.1.1.1.1" xref="S3.SS2.SSS1.p1.11.m11.1.1.1.1.1.1.1.1.1.1.cmml">⁢</mo><mover accent="true" id="S3.SS2.SSS1.p1.11.m11.1.1.1.1.1.1.1.1.1.3" xref="S3.SS2.SSS1.p1.11.m11.1.1.1.1.1.1.1.1.1.3.cmml"><mi id="S3.SS2.SSS1.p1.11.m11.1.1.1.1.1.1.1.1.1.3.2" xref="S3.SS2.SSS1.p1.11.m11.1.1.1.1.1.1.1.1.1.3.2.cmml">𝐱</mi><mo id="S3.SS2.SSS1.p1.11.m11.1.1.1.1.1.1.1.1.1.3.1" stretchy="false" xref="S3.SS2.SSS1.p1.11.m11.1.1.1.1.1.1.1.1.1.3.1.cmml">→</mo></mover></mrow><mo id="S3.SS2.SSS1.p1.11.m11.1.1.1.1.1.1.1.1.3" stretchy="false" xref="S3.SS2.SSS1.p1.11.m11.1.1.1.1.1.1.1.1.1.cmml">)</mo></mrow></mrow><mo id="S3.SS2.SSS1.p1.11.m11.1.1.1.1.1.3" xref="S3.SS2.SSS1.p1.11.m11.1.1.1.1.1.1.cmml">)</mo></mrow></mrow><mo id="S3.SS2.SSS1.p1.11.m11.1.1.2" xref="S3.SS2.SSS1.p1.11.m11.1.1.2.cmml">⊆</mo><msup id="S3.SS2.SSS1.p1.11.m11.1.1.3" xref="S3.SS2.SSS1.p1.11.m11.1.1.3.cmml"><mi id="S3.SS2.SSS1.p1.11.m11.1.1.3.2" xref="S3.SS2.SSS1.p1.11.m11.1.1.3.2.cmml">S</mi><mo id="S3.SS2.SSS1.p1.11.m11.1.1.3.3" xref="S3.SS2.SSS1.p1.11.m11.1.1.3.3.cmml">′</mo></msup></mrow><annotation-xml encoding="MathML-Content" id="S3.SS2.SSS1.p1.11.m11.1b"><apply id="S3.SS2.SSS1.p1.11.m11.1.1.cmml" xref="S3.SS2.SSS1.p1.11.m11.1.1"><subset id="S3.SS2.SSS1.p1.11.m11.1.1.2.cmml" xref="S3.SS2.SSS1.p1.11.m11.1.1.2"></subset><apply id="S3.SS2.SSS1.p1.11.m11.1.1.1.cmml" xref="S3.SS2.SSS1.p1.11.m11.1.1.1"><times id="S3.SS2.SSS1.p1.11.m11.1.1.1.2.cmml" xref="S3.SS2.SSS1.p1.11.m11.1.1.1.2"></times><apply id="S3.SS2.SSS1.p1.11.m11.1.1.1.3.cmml" xref="S3.SS2.SSS1.p1.11.m11.1.1.1.3"><csymbol cd="ambiguous" id="S3.SS2.SSS1.p1.11.m11.1.1.1.3.1.cmml" xref="S3.SS2.SSS1.p1.11.m11.1.1.1.3">subscript</csymbol><ci id="S3.SS2.SSS1.p1.11.m11.1.1.1.3.2a.cmml" xref="S3.SS2.SSS1.p1.11.m11.1.1.1.3.2"><mtext id="S3.SS2.SSS1.p1.11.m11.1.1.1.3.2.cmml" xref="S3.SS2.SSS1.p1.11.m11.1.1.1.3.2">TopInd</mtext></ci><ci id="S3.SS2.SSS1.p1.11.m11.1.1.1.3.3.cmml" xref="S3.SS2.SSS1.p1.11.m11.1.1.1.3.3">𝑘</ci></apply><apply id="S3.SS2.SSS1.p1.11.m11.1.1.1.1.1.1.cmml" xref="S3.SS2.SSS1.p1.11.m11.1.1.1.1.1"><times id="S3.SS2.SSS1.p1.11.m11.1.1.1.1.1.1.2.cmml" xref="S3.SS2.SSS1.p1.11.m11.1.1.1.1.1.1.2"></times><ci id="S3.SS2.SSS1.p1.11.m11.1.1.1.1.1.1.3.cmml" xref="S3.SS2.SSS1.p1.11.m11.1.1.1.1.1.1.3">italic-ϕ</ci><apply id="S3.SS2.SSS1.p1.11.m11.1.1.1.1.1.1.1.1.1.cmml" xref="S3.SS2.SSS1.p1.11.m11.1.1.1.1.1.1.1.1"><times id="S3.SS2.SSS1.p1.11.m11.1.1.1.1.1.1.1.1.1.1.cmml" xref="S3.SS2.SSS1.p1.11.m11.1.1.1.1.1.1.1.1.1.1"></times><apply id="S3.SS2.SSS1.p1.11.m11.1.1.1.1.1.1.1.1.1.2.cmml" xref="S3.SS2.SSS1.p1.11.m11.1.1.1.1.1.1.1.1.1.2"><csymbol cd="ambiguous" id="S3.SS2.SSS1.p1.11.m11.1.1.1.1.1.1.1.1.1.2.1.cmml" xref="S3.SS2.SSS1.p1.11.m11.1.1.1.1.1.1.1.1.1.2">superscript</csymbol><ci id="S3.SS2.SSS1.p1.11.m11.1.1.1.1.1.1.1.1.1.2.2.cmml" xref="S3.SS2.SSS1.p1.11.m11.1.1.1.1.1.1.1.1.1.2.2">𝐙</ci><csymbol cd="latexml" id="S3.SS2.SSS1.p1.11.m11.1.1.1.1.1.1.1.1.1.2.3.cmml" xref="S3.SS2.SSS1.p1.11.m11.1.1.1.1.1.1.1.1.1.2.3">top</csymbol></apply><apply id="S3.SS2.SSS1.p1.11.m11.1.1.1.1.1.1.1.1.1.3.cmml" xref="S3.SS2.SSS1.p1.11.m11.1.1.1.1.1.1.1.1.1.3"><ci id="S3.SS2.SSS1.p1.11.m11.1.1.1.1.1.1.1.1.1.3.1.cmml" xref="S3.SS2.SSS1.p1.11.m11.1.1.1.1.1.1.1.1.1.3.1">→</ci><ci id="S3.SS2.SSS1.p1.11.m11.1.1.1.1.1.1.1.1.1.3.2.cmml" xref="S3.SS2.SSS1.p1.11.m11.1.1.1.1.1.1.1.1.1.3.2">𝐱</ci></apply></apply></apply></apply><apply id="S3.SS2.SSS1.p1.11.m11.1.1.3.cmml" xref="S3.SS2.SSS1.p1.11.m11.1.1.3"><csymbol cd="ambiguous" id="S3.SS2.SSS1.p1.11.m11.1.1.3.1.cmml" xref="S3.SS2.SSS1.p1.11.m11.1.1.3">superscript</csymbol><ci id="S3.SS2.SSS1.p1.11.m11.1.1.3.2.cmml" xref="S3.SS2.SSS1.p1.11.m11.1.1.3.2">𝑆</ci><ci id="S3.SS2.SSS1.p1.11.m11.1.1.3.3.cmml" xref="S3.SS2.SSS1.p1.11.m11.1.1.3.3">′</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.SSS1.p1.11.m11.1c">\textrm{TopInd}_{k}\left(\phi({\mathbf{Z}}^{\top}\overrightarrow{\mathbf{x}})%
\right)\subseteq S^{\prime}</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.SSS1.p1.11.m11.1d">TopInd start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT ( italic_ϕ ( bold_Z start_POSTSUPERSCRIPT ⊤ end_POSTSUPERSCRIPT over→ start_ARG bold_x end_ARG ) ) ⊆ italic_S start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT</annotation></semantics></math>, we have that <math alttext="\textrm{Top}_{k}\left(\phi({\mathbf{Z}}^{\top}\overrightarrow{\mathbf{x}})%
\right)=\textrm{Top}_{k}\left(\phi({\mathbf{Z}}|_{S^{\prime}}^{\top}%
\overrightarrow{\mathbf{x}})\right)" class="ltx_Math" display="inline" id="S3.SS2.SSS1.p1.12.m12.5"><semantics id="S3.SS2.SSS1.p1.12.m12.5a"><mrow id="S3.SS2.SSS1.p1.12.m12.5.5" xref="S3.SS2.SSS1.p1.12.m12.5.5.cmml"><mrow id="S3.SS2.SSS1.p1.12.m12.4.4.1" xref="S3.SS2.SSS1.p1.12.m12.4.4.1.cmml"><msub id="S3.SS2.SSS1.p1.12.m12.4.4.1.3" xref="S3.SS2.SSS1.p1.12.m12.4.4.1.3.cmml"><mtext id="S3.SS2.SSS1.p1.12.m12.4.4.1.3.2" xref="S3.SS2.SSS1.p1.12.m12.4.4.1.3.2a.cmml">Top</mtext><mi id="S3.SS2.SSS1.p1.12.m12.4.4.1.3.3" xref="S3.SS2.SSS1.p1.12.m12.4.4.1.3.3.cmml">k</mi></msub><mo id="S3.SS2.SSS1.p1.12.m12.4.4.1.2" xref="S3.SS2.SSS1.p1.12.m12.4.4.1.2.cmml">⁢</mo><mrow id="S3.SS2.SSS1.p1.12.m12.4.4.1.1.1" xref="S3.SS2.SSS1.p1.12.m12.4.4.1.1.1.1.cmml"><mo id="S3.SS2.SSS1.p1.12.m12.4.4.1.1.1.2" xref="S3.SS2.SSS1.p1.12.m12.4.4.1.1.1.1.cmml">(</mo><mrow id="S3.SS2.SSS1.p1.12.m12.4.4.1.1.1.1" xref="S3.SS2.SSS1.p1.12.m12.4.4.1.1.1.1.cmml"><mi id="S3.SS2.SSS1.p1.12.m12.4.4.1.1.1.1.3" xref="S3.SS2.SSS1.p1.12.m12.4.4.1.1.1.1.3.cmml">ϕ</mi><mo id="S3.SS2.SSS1.p1.12.m12.4.4.1.1.1.1.2" xref="S3.SS2.SSS1.p1.12.m12.4.4.1.1.1.1.2.cmml">⁢</mo><mrow id="S3.SS2.SSS1.p1.12.m12.4.4.1.1.1.1.1.1" xref="S3.SS2.SSS1.p1.12.m12.4.4.1.1.1.1.1.1.1.cmml"><mo id="S3.SS2.SSS1.p1.12.m12.4.4.1.1.1.1.1.1.2" stretchy="false" xref="S3.SS2.SSS1.p1.12.m12.4.4.1.1.1.1.1.1.1.cmml">(</mo><mrow id="S3.SS2.SSS1.p1.12.m12.4.4.1.1.1.1.1.1.1" xref="S3.SS2.SSS1.p1.12.m12.4.4.1.1.1.1.1.1.1.cmml"><msup id="S3.SS2.SSS1.p1.12.m12.4.4.1.1.1.1.1.1.1.2" xref="S3.SS2.SSS1.p1.12.m12.4.4.1.1.1.1.1.1.1.2.cmml"><mi id="S3.SS2.SSS1.p1.12.m12.4.4.1.1.1.1.1.1.1.2.2" xref="S3.SS2.SSS1.p1.12.m12.4.4.1.1.1.1.1.1.1.2.2.cmml">𝐙</mi><mo id="S3.SS2.SSS1.p1.12.m12.4.4.1.1.1.1.1.1.1.2.3" xref="S3.SS2.SSS1.p1.12.m12.4.4.1.1.1.1.1.1.1.2.3.cmml">⊤</mo></msup><mo id="S3.SS2.SSS1.p1.12.m12.4.4.1.1.1.1.1.1.1.1" xref="S3.SS2.SSS1.p1.12.m12.4.4.1.1.1.1.1.1.1.1.cmml">⁢</mo><mover accent="true" id="S3.SS2.SSS1.p1.12.m12.4.4.1.1.1.1.1.1.1.3" xref="S3.SS2.SSS1.p1.12.m12.4.4.1.1.1.1.1.1.1.3.cmml"><mi id="S3.SS2.SSS1.p1.12.m12.4.4.1.1.1.1.1.1.1.3.2" xref="S3.SS2.SSS1.p1.12.m12.4.4.1.1.1.1.1.1.1.3.2.cmml">𝐱</mi><mo id="S3.SS2.SSS1.p1.12.m12.4.4.1.1.1.1.1.1.1.3.1" stretchy="false" xref="S3.SS2.SSS1.p1.12.m12.4.4.1.1.1.1.1.1.1.3.1.cmml">→</mo></mover></mrow><mo id="S3.SS2.SSS1.p1.12.m12.4.4.1.1.1.1.1.1.3" stretchy="false" xref="S3.SS2.SSS1.p1.12.m12.4.4.1.1.1.1.1.1.1.cmml">)</mo></mrow></mrow><mo id="S3.SS2.SSS1.p1.12.m12.4.4.1.1.1.3" xref="S3.SS2.SSS1.p1.12.m12.4.4.1.1.1.1.cmml">)</mo></mrow></mrow><mo id="S3.SS2.SSS1.p1.12.m12.5.5.3" xref="S3.SS2.SSS1.p1.12.m12.5.5.3.cmml">=</mo><mrow id="S3.SS2.SSS1.p1.12.m12.5.5.2" xref="S3.SS2.SSS1.p1.12.m12.5.5.2.cmml"><msub id="S3.SS2.SSS1.p1.12.m12.5.5.2.3" xref="S3.SS2.SSS1.p1.12.m12.5.5.2.3.cmml"><mtext id="S3.SS2.SSS1.p1.12.m12.5.5.2.3.2" xref="S3.SS2.SSS1.p1.12.m12.5.5.2.3.2a.cmml">Top</mtext><mi id="S3.SS2.SSS1.p1.12.m12.5.5.2.3.3" xref="S3.SS2.SSS1.p1.12.m12.5.5.2.3.3.cmml">k</mi></msub><mo id="S3.SS2.SSS1.p1.12.m12.5.5.2.2" xref="S3.SS2.SSS1.p1.12.m12.5.5.2.2.cmml">⁢</mo><mrow id="S3.SS2.SSS1.p1.12.m12.5.5.2.1.1" xref="S3.SS2.SSS1.p1.12.m12.5.5.2.1.1.1.cmml"><mo id="S3.SS2.SSS1.p1.12.m12.5.5.2.1.1.2" xref="S3.SS2.SSS1.p1.12.m12.5.5.2.1.1.1.cmml">(</mo><mrow id="S3.SS2.SSS1.p1.12.m12.5.5.2.1.1.1" xref="S3.SS2.SSS1.p1.12.m12.5.5.2.1.1.1.cmml"><mi id="S3.SS2.SSS1.p1.12.m12.5.5.2.1.1.1.3" xref="S3.SS2.SSS1.p1.12.m12.5.5.2.1.1.1.3.cmml">ϕ</mi><mo id="S3.SS2.SSS1.p1.12.m12.5.5.2.1.1.1.2" xref="S3.SS2.SSS1.p1.12.m12.5.5.2.1.1.1.2.cmml">⁢</mo><mrow id="S3.SS2.SSS1.p1.12.m12.5.5.2.1.1.1.1.1" xref="S3.SS2.SSS1.p1.12.m12.5.5.2.1.1.1.1.1.1.cmml"><mo id="S3.SS2.SSS1.p1.12.m12.5.5.2.1.1.1.1.1.2" stretchy="false" xref="S3.SS2.SSS1.p1.12.m12.5.5.2.1.1.1.1.1.1.cmml">(</mo><mrow id="S3.SS2.SSS1.p1.12.m12.5.5.2.1.1.1.1.1.1" xref="S3.SS2.SSS1.p1.12.m12.5.5.2.1.1.1.1.1.1.cmml"><msubsup id="S3.SS2.SSS1.p1.12.m12.5.5.2.1.1.1.1.1.1.2.2" xref="S3.SS2.SSS1.p1.12.m12.5.5.2.1.1.1.1.1.1.2.1.cmml"><mrow id="S3.SS2.SSS1.p1.12.m12.5.5.2.1.1.1.1.1.1.2.2.2.2" xref="S3.SS2.SSS1.p1.12.m12.5.5.2.1.1.1.1.1.1.2.1.cmml"><mi id="S3.SS2.SSS1.p1.12.m12.1.1" xref="S3.SS2.SSS1.p1.12.m12.1.1.cmml">𝐙</mi><mo id="S3.SS2.SSS1.p1.12.m12.5.5.2.1.1.1.1.1.1.2.2.2.2.1" stretchy="false" xref="S3.SS2.SSS1.p1.12.m12.5.5.2.1.1.1.1.1.1.2.1.1.cmml">|</mo></mrow><msup id="S3.SS2.SSS1.p1.12.m12.2.2.1" xref="S3.SS2.SSS1.p1.12.m12.2.2.1.cmml"><mi id="S3.SS2.SSS1.p1.12.m12.2.2.1.2" xref="S3.SS2.SSS1.p1.12.m12.2.2.1.2.cmml">S</mi><mo id="S3.SS2.SSS1.p1.12.m12.2.2.1.3" xref="S3.SS2.SSS1.p1.12.m12.2.2.1.3.cmml">′</mo></msup><mo id="S3.SS2.SSS1.p1.12.m12.3.3.1" xref="S3.SS2.SSS1.p1.12.m12.3.3.1.cmml">⊤</mo></msubsup><mo id="S3.SS2.SSS1.p1.12.m12.5.5.2.1.1.1.1.1.1.1" xref="S3.SS2.SSS1.p1.12.m12.5.5.2.1.1.1.1.1.1.1.cmml">⁢</mo><mover accent="true" id="S3.SS2.SSS1.p1.12.m12.5.5.2.1.1.1.1.1.1.3" xref="S3.SS2.SSS1.p1.12.m12.5.5.2.1.1.1.1.1.1.3.cmml"><mi id="S3.SS2.SSS1.p1.12.m12.5.5.2.1.1.1.1.1.1.3.2" xref="S3.SS2.SSS1.p1.12.m12.5.5.2.1.1.1.1.1.1.3.2.cmml">𝐱</mi><mo id="S3.SS2.SSS1.p1.12.m12.5.5.2.1.1.1.1.1.1.3.1" stretchy="false" xref="S3.SS2.SSS1.p1.12.m12.5.5.2.1.1.1.1.1.1.3.1.cmml">→</mo></mover></mrow><mo id="S3.SS2.SSS1.p1.12.m12.5.5.2.1.1.1.1.1.3" stretchy="false" xref="S3.SS2.SSS1.p1.12.m12.5.5.2.1.1.1.1.1.1.cmml">)</mo></mrow></mrow><mo id="S3.SS2.SSS1.p1.12.m12.5.5.2.1.1.3" xref="S3.SS2.SSS1.p1.12.m12.5.5.2.1.1.1.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.SS2.SSS1.p1.12.m12.5b"><apply id="S3.SS2.SSS1.p1.12.m12.5.5.cmml" xref="S3.SS2.SSS1.p1.12.m12.5.5"><eq id="S3.SS2.SSS1.p1.12.m12.5.5.3.cmml" xref="S3.SS2.SSS1.p1.12.m12.5.5.3"></eq><apply id="S3.SS2.SSS1.p1.12.m12.4.4.1.cmml" xref="S3.SS2.SSS1.p1.12.m12.4.4.1"><times id="S3.SS2.SSS1.p1.12.m12.4.4.1.2.cmml" xref="S3.SS2.SSS1.p1.12.m12.4.4.1.2"></times><apply id="S3.SS2.SSS1.p1.12.m12.4.4.1.3.cmml" xref="S3.SS2.SSS1.p1.12.m12.4.4.1.3"><csymbol cd="ambiguous" id="S3.SS2.SSS1.p1.12.m12.4.4.1.3.1.cmml" xref="S3.SS2.SSS1.p1.12.m12.4.4.1.3">subscript</csymbol><ci id="S3.SS2.SSS1.p1.12.m12.4.4.1.3.2a.cmml" xref="S3.SS2.SSS1.p1.12.m12.4.4.1.3.2"><mtext id="S3.SS2.SSS1.p1.12.m12.4.4.1.3.2.cmml" xref="S3.SS2.SSS1.p1.12.m12.4.4.1.3.2">Top</mtext></ci><ci id="S3.SS2.SSS1.p1.12.m12.4.4.1.3.3.cmml" xref="S3.SS2.SSS1.p1.12.m12.4.4.1.3.3">𝑘</ci></apply><apply id="S3.SS2.SSS1.p1.12.m12.4.4.1.1.1.1.cmml" xref="S3.SS2.SSS1.p1.12.m12.4.4.1.1.1"><times id="S3.SS2.SSS1.p1.12.m12.4.4.1.1.1.1.2.cmml" xref="S3.SS2.SSS1.p1.12.m12.4.4.1.1.1.1.2"></times><ci id="S3.SS2.SSS1.p1.12.m12.4.4.1.1.1.1.3.cmml" xref="S3.SS2.SSS1.p1.12.m12.4.4.1.1.1.1.3">italic-ϕ</ci><apply id="S3.SS2.SSS1.p1.12.m12.4.4.1.1.1.1.1.1.1.cmml" xref="S3.SS2.SSS1.p1.12.m12.4.4.1.1.1.1.1.1"><times id="S3.SS2.SSS1.p1.12.m12.4.4.1.1.1.1.1.1.1.1.cmml" xref="S3.SS2.SSS1.p1.12.m12.4.4.1.1.1.1.1.1.1.1"></times><apply id="S3.SS2.SSS1.p1.12.m12.4.4.1.1.1.1.1.1.1.2.cmml" xref="S3.SS2.SSS1.p1.12.m12.4.4.1.1.1.1.1.1.1.2"><csymbol cd="ambiguous" id="S3.SS2.SSS1.p1.12.m12.4.4.1.1.1.1.1.1.1.2.1.cmml" xref="S3.SS2.SSS1.p1.12.m12.4.4.1.1.1.1.1.1.1.2">superscript</csymbol><ci id="S3.SS2.SSS1.p1.12.m12.4.4.1.1.1.1.1.1.1.2.2.cmml" xref="S3.SS2.SSS1.p1.12.m12.4.4.1.1.1.1.1.1.1.2.2">𝐙</ci><csymbol cd="latexml" id="S3.SS2.SSS1.p1.12.m12.4.4.1.1.1.1.1.1.1.2.3.cmml" xref="S3.SS2.SSS1.p1.12.m12.4.4.1.1.1.1.1.1.1.2.3">top</csymbol></apply><apply id="S3.SS2.SSS1.p1.12.m12.4.4.1.1.1.1.1.1.1.3.cmml" xref="S3.SS2.SSS1.p1.12.m12.4.4.1.1.1.1.1.1.1.3"><ci id="S3.SS2.SSS1.p1.12.m12.4.4.1.1.1.1.1.1.1.3.1.cmml" xref="S3.SS2.SSS1.p1.12.m12.4.4.1.1.1.1.1.1.1.3.1">→</ci><ci id="S3.SS2.SSS1.p1.12.m12.4.4.1.1.1.1.1.1.1.3.2.cmml" xref="S3.SS2.SSS1.p1.12.m12.4.4.1.1.1.1.1.1.1.3.2">𝐱</ci></apply></apply></apply></apply><apply id="S3.SS2.SSS1.p1.12.m12.5.5.2.cmml" xref="S3.SS2.SSS1.p1.12.m12.5.5.2"><times id="S3.SS2.SSS1.p1.12.m12.5.5.2.2.cmml" xref="S3.SS2.SSS1.p1.12.m12.5.5.2.2"></times><apply id="S3.SS2.SSS1.p1.12.m12.5.5.2.3.cmml" xref="S3.SS2.SSS1.p1.12.m12.5.5.2.3"><csymbol cd="ambiguous" id="S3.SS2.SSS1.p1.12.m12.5.5.2.3.1.cmml" xref="S3.SS2.SSS1.p1.12.m12.5.5.2.3">subscript</csymbol><ci id="S3.SS2.SSS1.p1.12.m12.5.5.2.3.2a.cmml" xref="S3.SS2.SSS1.p1.12.m12.5.5.2.3.2"><mtext id="S3.SS2.SSS1.p1.12.m12.5.5.2.3.2.cmml" xref="S3.SS2.SSS1.p1.12.m12.5.5.2.3.2">Top</mtext></ci><ci id="S3.SS2.SSS1.p1.12.m12.5.5.2.3.3.cmml" xref="S3.SS2.SSS1.p1.12.m12.5.5.2.3.3">𝑘</ci></apply><apply id="S3.SS2.SSS1.p1.12.m12.5.5.2.1.1.1.cmml" xref="S3.SS2.SSS1.p1.12.m12.5.5.2.1.1"><times id="S3.SS2.SSS1.p1.12.m12.5.5.2.1.1.1.2.cmml" xref="S3.SS2.SSS1.p1.12.m12.5.5.2.1.1.1.2"></times><ci id="S3.SS2.SSS1.p1.12.m12.5.5.2.1.1.1.3.cmml" xref="S3.SS2.SSS1.p1.12.m12.5.5.2.1.1.1.3">italic-ϕ</ci><apply id="S3.SS2.SSS1.p1.12.m12.5.5.2.1.1.1.1.1.1.cmml" xref="S3.SS2.SSS1.p1.12.m12.5.5.2.1.1.1.1.1"><times id="S3.SS2.SSS1.p1.12.m12.5.5.2.1.1.1.1.1.1.1.cmml" xref="S3.SS2.SSS1.p1.12.m12.5.5.2.1.1.1.1.1.1.1"></times><apply id="S3.SS2.SSS1.p1.12.m12.5.5.2.1.1.1.1.1.1.2.1.cmml" xref="S3.SS2.SSS1.p1.12.m12.5.5.2.1.1.1.1.1.1.2.2"><csymbol cd="latexml" id="S3.SS2.SSS1.p1.12.m12.5.5.2.1.1.1.1.1.1.2.1.1.cmml" xref="S3.SS2.SSS1.p1.12.m12.5.5.2.1.1.1.1.1.1.2.2.2.2.1">evaluated-at</csymbol><ci id="S3.SS2.SSS1.p1.12.m12.1.1.cmml" xref="S3.SS2.SSS1.p1.12.m12.1.1">𝐙</ci><apply id="S3.SS2.SSS1.p1.12.m12.2.2.1.cmml" xref="S3.SS2.SSS1.p1.12.m12.2.2.1"><csymbol cd="ambiguous" id="S3.SS2.SSS1.p1.12.m12.2.2.1.1.cmml" xref="S3.SS2.SSS1.p1.12.m12.2.2.1">superscript</csymbol><ci id="S3.SS2.SSS1.p1.12.m12.2.2.1.2.cmml" xref="S3.SS2.SSS1.p1.12.m12.2.2.1.2">𝑆</ci><ci id="S3.SS2.SSS1.p1.12.m12.2.2.1.3.cmml" xref="S3.SS2.SSS1.p1.12.m12.2.2.1.3">′</ci></apply><csymbol cd="latexml" id="S3.SS2.SSS1.p1.12.m12.3.3.1.cmml" xref="S3.SS2.SSS1.p1.12.m12.3.3.1">top</csymbol></apply><apply id="S3.SS2.SSS1.p1.12.m12.5.5.2.1.1.1.1.1.1.3.cmml" xref="S3.SS2.SSS1.p1.12.m12.5.5.2.1.1.1.1.1.1.3"><ci id="S3.SS2.SSS1.p1.12.m12.5.5.2.1.1.1.1.1.1.3.1.cmml" xref="S3.SS2.SSS1.p1.12.m12.5.5.2.1.1.1.1.1.1.3.1">→</ci><ci id="S3.SS2.SSS1.p1.12.m12.5.5.2.1.1.1.1.1.1.3.2.cmml" xref="S3.SS2.SSS1.p1.12.m12.5.5.2.1.1.1.1.1.1.3.2">𝐱</ci></apply></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.SSS1.p1.12.m12.5c">\textrm{Top}_{k}\left(\phi({\mathbf{Z}}^{\top}\overrightarrow{\mathbf{x}})%
\right)=\textrm{Top}_{k}\left(\phi({\mathbf{Z}}|_{S^{\prime}}^{\top}%
\overrightarrow{\mathbf{x}})\right)</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.SSS1.p1.12.m12.5d">Top start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT ( italic_ϕ ( bold_Z start_POSTSUPERSCRIPT ⊤ end_POSTSUPERSCRIPT over→ start_ARG bold_x end_ARG ) ) = Top start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT ( italic_ϕ ( bold_Z | start_POSTSUBSCRIPT italic_S start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT end_POSTSUBSCRIPT start_POSTSUPERSCRIPT ⊤ end_POSTSUPERSCRIPT over→ start_ARG bold_x end_ARG ) )</annotation></semantics></math>. If the size of <math alttext="{\mathbf{Z}_{\textrm{approx}}}" class="ltx_Math" display="inline" id="S3.SS2.SSS1.p1.13.m13.1"><semantics id="S3.SS2.SSS1.p1.13.m13.1a"><msub id="S3.SS2.SSS1.p1.13.m13.1.1" xref="S3.SS2.SSS1.p1.13.m13.1.1.cmml"><mi id="S3.SS2.SSS1.p1.13.m13.1.1.2" xref="S3.SS2.SSS1.p1.13.m13.1.1.2.cmml">𝐙</mi><mtext id="S3.SS2.SSS1.p1.13.m13.1.1.3" xref="S3.SS2.SSS1.p1.13.m13.1.1.3a.cmml">approx</mtext></msub><annotation-xml encoding="MathML-Content" id="S3.SS2.SSS1.p1.13.m13.1b"><apply id="S3.SS2.SSS1.p1.13.m13.1.1.cmml" xref="S3.SS2.SSS1.p1.13.m13.1.1"><csymbol cd="ambiguous" id="S3.SS2.SSS1.p1.13.m13.1.1.1.cmml" xref="S3.SS2.SSS1.p1.13.m13.1.1">subscript</csymbol><ci id="S3.SS2.SSS1.p1.13.m13.1.1.2.cmml" xref="S3.SS2.SSS1.p1.13.m13.1.1.2">𝐙</ci><ci id="S3.SS2.SSS1.p1.13.m13.1.1.3a.cmml" xref="S3.SS2.SSS1.p1.13.m13.1.1.3"><mtext id="S3.SS2.SSS1.p1.13.m13.1.1.3.cmml" mathsize="70%" xref="S3.SS2.SSS1.p1.13.m13.1.1.3">approx</mtext></ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.SSS1.p1.13.m13.1c">{\mathbf{Z}_{\textrm{approx}}}</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.SSS1.p1.13.m13.1d">bold_Z start_POSTSUBSCRIPT approx end_POSTSUBSCRIPT</annotation></semantics></math> is chosen to be substantially smaller than that of <math alttext="{\mathbf{Z}}" class="ltx_Math" display="inline" id="S3.SS2.SSS1.p1.14.m14.1"><semantics id="S3.SS2.SSS1.p1.14.m14.1a"><mi id="S3.SS2.SSS1.p1.14.m14.1.1" xref="S3.SS2.SSS1.p1.14.m14.1.1.cmml">𝐙</mi><annotation-xml encoding="MathML-Content" id="S3.SS2.SSS1.p1.14.m14.1b"><ci id="S3.SS2.SSS1.p1.14.m14.1.1.cmml" xref="S3.SS2.SSS1.p1.14.m14.1.1">𝐙</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.SSS1.p1.14.m14.1c">{\mathbf{Z}}</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.SSS1.p1.14.m14.1d">bold_Z</annotation></semantics></math>, and if <math alttext="k^{\prime}\ll\ell" class="ltx_Math" display="inline" id="S3.SS2.SSS1.p1.15.m15.1"><semantics id="S3.SS2.SSS1.p1.15.m15.1a"><mrow id="S3.SS2.SSS1.p1.15.m15.1.1" xref="S3.SS2.SSS1.p1.15.m15.1.1.cmml"><msup id="S3.SS2.SSS1.p1.15.m15.1.1.2" xref="S3.SS2.SSS1.p1.15.m15.1.1.2.cmml"><mi id="S3.SS2.SSS1.p1.15.m15.1.1.2.2" xref="S3.SS2.SSS1.p1.15.m15.1.1.2.2.cmml">k</mi><mo id="S3.SS2.SSS1.p1.15.m15.1.1.2.3" xref="S3.SS2.SSS1.p1.15.m15.1.1.2.3.cmml">′</mo></msup><mo id="S3.SS2.SSS1.p1.15.m15.1.1.1" xref="S3.SS2.SSS1.p1.15.m15.1.1.1.cmml">≪</mo><mi id="S3.SS2.SSS1.p1.15.m15.1.1.3" mathvariant="normal" xref="S3.SS2.SSS1.p1.15.m15.1.1.3.cmml">ℓ</mi></mrow><annotation-xml encoding="MathML-Content" id="S3.SS2.SSS1.p1.15.m15.1b"><apply id="S3.SS2.SSS1.p1.15.m15.1.1.cmml" xref="S3.SS2.SSS1.p1.15.m15.1.1"><csymbol cd="latexml" id="S3.SS2.SSS1.p1.15.m15.1.1.1.cmml" xref="S3.SS2.SSS1.p1.15.m15.1.1.1">much-less-than</csymbol><apply id="S3.SS2.SSS1.p1.15.m15.1.1.2.cmml" xref="S3.SS2.SSS1.p1.15.m15.1.1.2"><csymbol cd="ambiguous" id="S3.SS2.SSS1.p1.15.m15.1.1.2.1.cmml" xref="S3.SS2.SSS1.p1.15.m15.1.1.2">superscript</csymbol><ci id="S3.SS2.SSS1.p1.15.m15.1.1.2.2.cmml" xref="S3.SS2.SSS1.p1.15.m15.1.1.2.2">𝑘</ci><ci id="S3.SS2.SSS1.p1.15.m15.1.1.2.3.cmml" xref="S3.SS2.SSS1.p1.15.m15.1.1.2.3">′</ci></apply><ci id="S3.SS2.SSS1.p1.15.m15.1.1.3.cmml" xref="S3.SS2.SSS1.p1.15.m15.1.1.3">ℓ</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.SSS1.p1.15.m15.1c">k^{\prime}\ll\ell</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.SSS1.p1.15.m15.1d">italic_k start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT ≪ roman_ℓ</annotation></semantics></math>, then HiRE executes much faster than the naive version of implementing equation <a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#S3.E5" title="5 ‣ 3.1 Problem Setup ‣ 3 Main Ideas ‣ HiRE: High Recall Approximate Top-𝑘 Estimation for Efficient LLM Inference"><span class="ltx_text ltx_ref_tag">5</span></a>. In this paper, we consider two ways of choosing <math alttext="{\mathbf{Z}_{\textrm{approx}}}" class="ltx_Math" display="inline" id="S3.SS2.SSS1.p1.16.m16.1"><semantics id="S3.SS2.SSS1.p1.16.m16.1a"><msub id="S3.SS2.SSS1.p1.16.m16.1.1" xref="S3.SS2.SSS1.p1.16.m16.1.1.cmml"><mi id="S3.SS2.SSS1.p1.16.m16.1.1.2" xref="S3.SS2.SSS1.p1.16.m16.1.1.2.cmml">𝐙</mi><mtext id="S3.SS2.SSS1.p1.16.m16.1.1.3" xref="S3.SS2.SSS1.p1.16.m16.1.1.3a.cmml">approx</mtext></msub><annotation-xml encoding="MathML-Content" id="S3.SS2.SSS1.p1.16.m16.1b"><apply id="S3.SS2.SSS1.p1.16.m16.1.1.cmml" xref="S3.SS2.SSS1.p1.16.m16.1.1"><csymbol cd="ambiguous" id="S3.SS2.SSS1.p1.16.m16.1.1.1.cmml" xref="S3.SS2.SSS1.p1.16.m16.1.1">subscript</csymbol><ci id="S3.SS2.SSS1.p1.16.m16.1.1.2.cmml" xref="S3.SS2.SSS1.p1.16.m16.1.1.2">𝐙</ci><ci id="S3.SS2.SSS1.p1.16.m16.1.1.3a.cmml" xref="S3.SS2.SSS1.p1.16.m16.1.1.3"><mtext id="S3.SS2.SSS1.p1.16.m16.1.1.3.cmml" mathsize="70%" xref="S3.SS2.SSS1.p1.16.m16.1.1.3">approx</mtext></ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.SSS1.p1.16.m16.1c">{\mathbf{Z}_{\textrm{approx}}}</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.SSS1.p1.16.m16.1d">bold_Z start_POSTSUBSCRIPT approx end_POSTSUBSCRIPT</annotation></semantics></math>.</p>
</div>
<section class="ltx_paragraph" id="S3.SS2.SSS1.Px1">
<h5 class="ltx_title ltx_title_paragraph">HiRE-LR </h5>
<div class="ltx_para" id="S3.SS2.SSS1.Px1.p1">
<p class="ltx_p" id="S3.SS2.SSS1.Px1.p1.12">: In this case, we choose <math alttext="{\mathbf{Z}_{\textrm{approx}}}" class="ltx_Math" display="inline" id="S3.SS2.SSS1.Px1.p1.1.m1.1"><semantics id="S3.SS2.SSS1.Px1.p1.1.m1.1a"><msub id="S3.SS2.SSS1.Px1.p1.1.m1.1.1" xref="S3.SS2.SSS1.Px1.p1.1.m1.1.1.cmml"><mi id="S3.SS2.SSS1.Px1.p1.1.m1.1.1.2" xref="S3.SS2.SSS1.Px1.p1.1.m1.1.1.2.cmml">𝐙</mi><mtext id="S3.SS2.SSS1.Px1.p1.1.m1.1.1.3" xref="S3.SS2.SSS1.Px1.p1.1.m1.1.1.3a.cmml">approx</mtext></msub><annotation-xml encoding="MathML-Content" id="S3.SS2.SSS1.Px1.p1.1.m1.1b"><apply id="S3.SS2.SSS1.Px1.p1.1.m1.1.1.cmml" xref="S3.SS2.SSS1.Px1.p1.1.m1.1.1"><csymbol cd="ambiguous" id="S3.SS2.SSS1.Px1.p1.1.m1.1.1.1.cmml" xref="S3.SS2.SSS1.Px1.p1.1.m1.1.1">subscript</csymbol><ci id="S3.SS2.SSS1.Px1.p1.1.m1.1.1.2.cmml" xref="S3.SS2.SSS1.Px1.p1.1.m1.1.1.2">𝐙</ci><ci id="S3.SS2.SSS1.Px1.p1.1.m1.1.1.3a.cmml" xref="S3.SS2.SSS1.Px1.p1.1.m1.1.1.3"><mtext id="S3.SS2.SSS1.Px1.p1.1.m1.1.1.3.cmml" mathsize="70%" xref="S3.SS2.SSS1.Px1.p1.1.m1.1.1.3">approx</mtext></ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.SSS1.Px1.p1.1.m1.1c">{\mathbf{Z}_{\textrm{approx}}}</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.SSS1.Px1.p1.1.m1.1d">bold_Z start_POSTSUBSCRIPT approx end_POSTSUBSCRIPT</annotation></semantics></math> to be a low rank matrix factorized as <math alttext="{\mathbf{Z}}_{1}*{\mathbf{Z}}_{2}^{\top}" class="ltx_Math" display="inline" id="S3.SS2.SSS1.Px1.p1.2.m2.1"><semantics id="S3.SS2.SSS1.Px1.p1.2.m2.1a"><mrow id="S3.SS2.SSS1.Px1.p1.2.m2.1.1" xref="S3.SS2.SSS1.Px1.p1.2.m2.1.1.cmml"><msub id="S3.SS2.SSS1.Px1.p1.2.m2.1.1.2" xref="S3.SS2.SSS1.Px1.p1.2.m2.1.1.2.cmml"><mi id="S3.SS2.SSS1.Px1.p1.2.m2.1.1.2.2" xref="S3.SS2.SSS1.Px1.p1.2.m2.1.1.2.2.cmml">𝐙</mi><mn id="S3.SS2.SSS1.Px1.p1.2.m2.1.1.2.3" xref="S3.SS2.SSS1.Px1.p1.2.m2.1.1.2.3.cmml">1</mn></msub><mo id="S3.SS2.SSS1.Px1.p1.2.m2.1.1.1" lspace="0.222em" rspace="0.222em" xref="S3.SS2.SSS1.Px1.p1.2.m2.1.1.1.cmml">*</mo><msubsup id="S3.SS2.SSS1.Px1.p1.2.m2.1.1.3" xref="S3.SS2.SSS1.Px1.p1.2.m2.1.1.3.cmml"><mi id="S3.SS2.SSS1.Px1.p1.2.m2.1.1.3.2.2" xref="S3.SS2.SSS1.Px1.p1.2.m2.1.1.3.2.2.cmml">𝐙</mi><mn id="S3.SS2.SSS1.Px1.p1.2.m2.1.1.3.2.3" xref="S3.SS2.SSS1.Px1.p1.2.m2.1.1.3.2.3.cmml">2</mn><mo id="S3.SS2.SSS1.Px1.p1.2.m2.1.1.3.3" xref="S3.SS2.SSS1.Px1.p1.2.m2.1.1.3.3.cmml">⊤</mo></msubsup></mrow><annotation-xml encoding="MathML-Content" id="S3.SS2.SSS1.Px1.p1.2.m2.1b"><apply id="S3.SS2.SSS1.Px1.p1.2.m2.1.1.cmml" xref="S3.SS2.SSS1.Px1.p1.2.m2.1.1"><times id="S3.SS2.SSS1.Px1.p1.2.m2.1.1.1.cmml" xref="S3.SS2.SSS1.Px1.p1.2.m2.1.1.1"></times><apply id="S3.SS2.SSS1.Px1.p1.2.m2.1.1.2.cmml" xref="S3.SS2.SSS1.Px1.p1.2.m2.1.1.2"><csymbol cd="ambiguous" id="S3.SS2.SSS1.Px1.p1.2.m2.1.1.2.1.cmml" xref="S3.SS2.SSS1.Px1.p1.2.m2.1.1.2">subscript</csymbol><ci id="S3.SS2.SSS1.Px1.p1.2.m2.1.1.2.2.cmml" xref="S3.SS2.SSS1.Px1.p1.2.m2.1.1.2.2">𝐙</ci><cn id="S3.SS2.SSS1.Px1.p1.2.m2.1.1.2.3.cmml" type="integer" xref="S3.SS2.SSS1.Px1.p1.2.m2.1.1.2.3">1</cn></apply><apply id="S3.SS2.SSS1.Px1.p1.2.m2.1.1.3.cmml" xref="S3.SS2.SSS1.Px1.p1.2.m2.1.1.3"><csymbol cd="ambiguous" id="S3.SS2.SSS1.Px1.p1.2.m2.1.1.3.1.cmml" xref="S3.SS2.SSS1.Px1.p1.2.m2.1.1.3">superscript</csymbol><apply id="S3.SS2.SSS1.Px1.p1.2.m2.1.1.3.2.cmml" xref="S3.SS2.SSS1.Px1.p1.2.m2.1.1.3"><csymbol cd="ambiguous" id="S3.SS2.SSS1.Px1.p1.2.m2.1.1.3.2.1.cmml" xref="S3.SS2.SSS1.Px1.p1.2.m2.1.1.3">subscript</csymbol><ci id="S3.SS2.SSS1.Px1.p1.2.m2.1.1.3.2.2.cmml" xref="S3.SS2.SSS1.Px1.p1.2.m2.1.1.3.2.2">𝐙</ci><cn id="S3.SS2.SSS1.Px1.p1.2.m2.1.1.3.2.3.cmml" type="integer" xref="S3.SS2.SSS1.Px1.p1.2.m2.1.1.3.2.3">2</cn></apply><csymbol cd="latexml" id="S3.SS2.SSS1.Px1.p1.2.m2.1.1.3.3.cmml" xref="S3.SS2.SSS1.Px1.p1.2.m2.1.1.3.3">top</csymbol></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.SSS1.Px1.p1.2.m2.1c">{\mathbf{Z}}_{1}*{\mathbf{Z}}_{2}^{\top}</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.SSS1.Px1.p1.2.m2.1d">bold_Z start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT * bold_Z start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT ⊤ end_POSTSUPERSCRIPT</annotation></semantics></math>, where <math alttext="{\mathbf{Z}}_{1}\in\mathbb{R}^{d\times r}" class="ltx_Math" display="inline" id="S3.SS2.SSS1.Px1.p1.3.m3.1"><semantics id="S3.SS2.SSS1.Px1.p1.3.m3.1a"><mrow id="S3.SS2.SSS1.Px1.p1.3.m3.1.1" xref="S3.SS2.SSS1.Px1.p1.3.m3.1.1.cmml"><msub id="S3.SS2.SSS1.Px1.p1.3.m3.1.1.2" xref="S3.SS2.SSS1.Px1.p1.3.m3.1.1.2.cmml"><mi id="S3.SS2.SSS1.Px1.p1.3.m3.1.1.2.2" xref="S3.SS2.SSS1.Px1.p1.3.m3.1.1.2.2.cmml">𝐙</mi><mn id="S3.SS2.SSS1.Px1.p1.3.m3.1.1.2.3" xref="S3.SS2.SSS1.Px1.p1.3.m3.1.1.2.3.cmml">1</mn></msub><mo id="S3.SS2.SSS1.Px1.p1.3.m3.1.1.1" xref="S3.SS2.SSS1.Px1.p1.3.m3.1.1.1.cmml">∈</mo><msup id="S3.SS2.SSS1.Px1.p1.3.m3.1.1.3" xref="S3.SS2.SSS1.Px1.p1.3.m3.1.1.3.cmml"><mi id="S3.SS2.SSS1.Px1.p1.3.m3.1.1.3.2" xref="S3.SS2.SSS1.Px1.p1.3.m3.1.1.3.2.cmml">ℝ</mi><mrow id="S3.SS2.SSS1.Px1.p1.3.m3.1.1.3.3" xref="S3.SS2.SSS1.Px1.p1.3.m3.1.1.3.3.cmml"><mi id="S3.SS2.SSS1.Px1.p1.3.m3.1.1.3.3.2" xref="S3.SS2.SSS1.Px1.p1.3.m3.1.1.3.3.2.cmml">d</mi><mo id="S3.SS2.SSS1.Px1.p1.3.m3.1.1.3.3.1" lspace="0.222em" rspace="0.222em" xref="S3.SS2.SSS1.Px1.p1.3.m3.1.1.3.3.1.cmml">×</mo><mi id="S3.SS2.SSS1.Px1.p1.3.m3.1.1.3.3.3" xref="S3.SS2.SSS1.Px1.p1.3.m3.1.1.3.3.3.cmml">r</mi></mrow></msup></mrow><annotation-xml encoding="MathML-Content" id="S3.SS2.SSS1.Px1.p1.3.m3.1b"><apply id="S3.SS2.SSS1.Px1.p1.3.m3.1.1.cmml" xref="S3.SS2.SSS1.Px1.p1.3.m3.1.1"><in id="S3.SS2.SSS1.Px1.p1.3.m3.1.1.1.cmml" xref="S3.SS2.SSS1.Px1.p1.3.m3.1.1.1"></in><apply id="S3.SS2.SSS1.Px1.p1.3.m3.1.1.2.cmml" xref="S3.SS2.SSS1.Px1.p1.3.m3.1.1.2"><csymbol cd="ambiguous" id="S3.SS2.SSS1.Px1.p1.3.m3.1.1.2.1.cmml" xref="S3.SS2.SSS1.Px1.p1.3.m3.1.1.2">subscript</csymbol><ci id="S3.SS2.SSS1.Px1.p1.3.m3.1.1.2.2.cmml" xref="S3.SS2.SSS1.Px1.p1.3.m3.1.1.2.2">𝐙</ci><cn id="S3.SS2.SSS1.Px1.p1.3.m3.1.1.2.3.cmml" type="integer" xref="S3.SS2.SSS1.Px1.p1.3.m3.1.1.2.3">1</cn></apply><apply id="S3.SS2.SSS1.Px1.p1.3.m3.1.1.3.cmml" xref="S3.SS2.SSS1.Px1.p1.3.m3.1.1.3"><csymbol cd="ambiguous" id="S3.SS2.SSS1.Px1.p1.3.m3.1.1.3.1.cmml" xref="S3.SS2.SSS1.Px1.p1.3.m3.1.1.3">superscript</csymbol><ci id="S3.SS2.SSS1.Px1.p1.3.m3.1.1.3.2.cmml" xref="S3.SS2.SSS1.Px1.p1.3.m3.1.1.3.2">ℝ</ci><apply id="S3.SS2.SSS1.Px1.p1.3.m3.1.1.3.3.cmml" xref="S3.SS2.SSS1.Px1.p1.3.m3.1.1.3.3"><times id="S3.SS2.SSS1.Px1.p1.3.m3.1.1.3.3.1.cmml" xref="S3.SS2.SSS1.Px1.p1.3.m3.1.1.3.3.1"></times><ci id="S3.SS2.SSS1.Px1.p1.3.m3.1.1.3.3.2.cmml" xref="S3.SS2.SSS1.Px1.p1.3.m3.1.1.3.3.2">𝑑</ci><ci id="S3.SS2.SSS1.Px1.p1.3.m3.1.1.3.3.3.cmml" xref="S3.SS2.SSS1.Px1.p1.3.m3.1.1.3.3.3">𝑟</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.SSS1.Px1.p1.3.m3.1c">{\mathbf{Z}}_{1}\in\mathbb{R}^{d\times r}</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.SSS1.Px1.p1.3.m3.1d">bold_Z start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT ∈ blackboard_R start_POSTSUPERSCRIPT italic_d × italic_r end_POSTSUPERSCRIPT</annotation></semantics></math> and <math alttext="{\mathbf{Z}}_{2}\in\mathbb{R}^{\ell\times r}" class="ltx_Math" display="inline" id="S3.SS2.SSS1.Px1.p1.4.m4.1"><semantics id="S3.SS2.SSS1.Px1.p1.4.m4.1a"><mrow id="S3.SS2.SSS1.Px1.p1.4.m4.1.1" xref="S3.SS2.SSS1.Px1.p1.4.m4.1.1.cmml"><msub id="S3.SS2.SSS1.Px1.p1.4.m4.1.1.2" xref="S3.SS2.SSS1.Px1.p1.4.m4.1.1.2.cmml"><mi id="S3.SS2.SSS1.Px1.p1.4.m4.1.1.2.2" xref="S3.SS2.SSS1.Px1.p1.4.m4.1.1.2.2.cmml">𝐙</mi><mn id="S3.SS2.SSS1.Px1.p1.4.m4.1.1.2.3" xref="S3.SS2.SSS1.Px1.p1.4.m4.1.1.2.3.cmml">2</mn></msub><mo id="S3.SS2.SSS1.Px1.p1.4.m4.1.1.1" xref="S3.SS2.SSS1.Px1.p1.4.m4.1.1.1.cmml">∈</mo><msup id="S3.SS2.SSS1.Px1.p1.4.m4.1.1.3" xref="S3.SS2.SSS1.Px1.p1.4.m4.1.1.3.cmml"><mi id="S3.SS2.SSS1.Px1.p1.4.m4.1.1.3.2" xref="S3.SS2.SSS1.Px1.p1.4.m4.1.1.3.2.cmml">ℝ</mi><mrow id="S3.SS2.SSS1.Px1.p1.4.m4.1.1.3.3" xref="S3.SS2.SSS1.Px1.p1.4.m4.1.1.3.3.cmml"><mi id="S3.SS2.SSS1.Px1.p1.4.m4.1.1.3.3.2" mathvariant="normal" xref="S3.SS2.SSS1.Px1.p1.4.m4.1.1.3.3.2.cmml">ℓ</mi><mo id="S3.SS2.SSS1.Px1.p1.4.m4.1.1.3.3.1" lspace="0.222em" rspace="0.222em" xref="S3.SS2.SSS1.Px1.p1.4.m4.1.1.3.3.1.cmml">×</mo><mi id="S3.SS2.SSS1.Px1.p1.4.m4.1.1.3.3.3" xref="S3.SS2.SSS1.Px1.p1.4.m4.1.1.3.3.3.cmml">r</mi></mrow></msup></mrow><annotation-xml encoding="MathML-Content" id="S3.SS2.SSS1.Px1.p1.4.m4.1b"><apply id="S3.SS2.SSS1.Px1.p1.4.m4.1.1.cmml" xref="S3.SS2.SSS1.Px1.p1.4.m4.1.1"><in id="S3.SS2.SSS1.Px1.p1.4.m4.1.1.1.cmml" xref="S3.SS2.SSS1.Px1.p1.4.m4.1.1.1"></in><apply id="S3.SS2.SSS1.Px1.p1.4.m4.1.1.2.cmml" xref="S3.SS2.SSS1.Px1.p1.4.m4.1.1.2"><csymbol cd="ambiguous" id="S3.SS2.SSS1.Px1.p1.4.m4.1.1.2.1.cmml" xref="S3.SS2.SSS1.Px1.p1.4.m4.1.1.2">subscript</csymbol><ci id="S3.SS2.SSS1.Px1.p1.4.m4.1.1.2.2.cmml" xref="S3.SS2.SSS1.Px1.p1.4.m4.1.1.2.2">𝐙</ci><cn id="S3.SS2.SSS1.Px1.p1.4.m4.1.1.2.3.cmml" type="integer" xref="S3.SS2.SSS1.Px1.p1.4.m4.1.1.2.3">2</cn></apply><apply id="S3.SS2.SSS1.Px1.p1.4.m4.1.1.3.cmml" xref="S3.SS2.SSS1.Px1.p1.4.m4.1.1.3"><csymbol cd="ambiguous" id="S3.SS2.SSS1.Px1.p1.4.m4.1.1.3.1.cmml" xref="S3.SS2.SSS1.Px1.p1.4.m4.1.1.3">superscript</csymbol><ci id="S3.SS2.SSS1.Px1.p1.4.m4.1.1.3.2.cmml" xref="S3.SS2.SSS1.Px1.p1.4.m4.1.1.3.2">ℝ</ci><apply id="S3.SS2.SSS1.Px1.p1.4.m4.1.1.3.3.cmml" xref="S3.SS2.SSS1.Px1.p1.4.m4.1.1.3.3"><times id="S3.SS2.SSS1.Px1.p1.4.m4.1.1.3.3.1.cmml" xref="S3.SS2.SSS1.Px1.p1.4.m4.1.1.3.3.1"></times><ci id="S3.SS2.SSS1.Px1.p1.4.m4.1.1.3.3.2.cmml" xref="S3.SS2.SSS1.Px1.p1.4.m4.1.1.3.3.2">ℓ</ci><ci id="S3.SS2.SSS1.Px1.p1.4.m4.1.1.3.3.3.cmml" xref="S3.SS2.SSS1.Px1.p1.4.m4.1.1.3.3.3">𝑟</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.SSS1.Px1.p1.4.m4.1c">{\mathbf{Z}}_{2}\in\mathbb{R}^{\ell\times r}</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.SSS1.Px1.p1.4.m4.1d">bold_Z start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT ∈ blackboard_R start_POSTSUPERSCRIPT roman_ℓ × italic_r end_POSTSUPERSCRIPT</annotation></semantics></math> for some <math alttext="r\ll d" class="ltx_Math" display="inline" id="S3.SS2.SSS1.Px1.p1.5.m5.1"><semantics id="S3.SS2.SSS1.Px1.p1.5.m5.1a"><mrow id="S3.SS2.SSS1.Px1.p1.5.m5.1.1" xref="S3.SS2.SSS1.Px1.p1.5.m5.1.1.cmml"><mi id="S3.SS2.SSS1.Px1.p1.5.m5.1.1.2" xref="S3.SS2.SSS1.Px1.p1.5.m5.1.1.2.cmml">r</mi><mo id="S3.SS2.SSS1.Px1.p1.5.m5.1.1.1" xref="S3.SS2.SSS1.Px1.p1.5.m5.1.1.1.cmml">≪</mo><mi id="S3.SS2.SSS1.Px1.p1.5.m5.1.1.3" xref="S3.SS2.SSS1.Px1.p1.5.m5.1.1.3.cmml">d</mi></mrow><annotation-xml encoding="MathML-Content" id="S3.SS2.SSS1.Px1.p1.5.m5.1b"><apply id="S3.SS2.SSS1.Px1.p1.5.m5.1.1.cmml" xref="S3.SS2.SSS1.Px1.p1.5.m5.1.1"><csymbol cd="latexml" id="S3.SS2.SSS1.Px1.p1.5.m5.1.1.1.cmml" xref="S3.SS2.SSS1.Px1.p1.5.m5.1.1.1">much-less-than</csymbol><ci id="S3.SS2.SSS1.Px1.p1.5.m5.1.1.2.cmml" xref="S3.SS2.SSS1.Px1.p1.5.m5.1.1.2">𝑟</ci><ci id="S3.SS2.SSS1.Px1.p1.5.m5.1.1.3.cmml" xref="S3.SS2.SSS1.Px1.p1.5.m5.1.1.3">𝑑</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.SSS1.Px1.p1.5.m5.1c">r\ll d</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.SSS1.Px1.p1.5.m5.1d">italic_r ≪ italic_d</annotation></semantics></math>. In this case, <math alttext="\textrm{PS}\left(\textrm{HiRE}-\textrm{LR}\right)=2(dr+r\ell+dk^{\prime})" class="ltx_Math" display="inline" id="S3.SS2.SSS1.Px1.p1.6.m6.2"><semantics id="S3.SS2.SSS1.Px1.p1.6.m6.2a"><mrow id="S3.SS2.SSS1.Px1.p1.6.m6.2.2" xref="S3.SS2.SSS1.Px1.p1.6.m6.2.2.cmml"><mrow id="S3.SS2.SSS1.Px1.p1.6.m6.1.1.1" xref="S3.SS2.SSS1.Px1.p1.6.m6.1.1.1.cmml"><mtext id="S3.SS2.SSS1.Px1.p1.6.m6.1.1.1.3" xref="S3.SS2.SSS1.Px1.p1.6.m6.1.1.1.3a.cmml">PS</mtext><mo id="S3.SS2.SSS1.Px1.p1.6.m6.1.1.1.2" xref="S3.SS2.SSS1.Px1.p1.6.m6.1.1.1.2.cmml">⁢</mo><mrow id="S3.SS2.SSS1.Px1.p1.6.m6.1.1.1.1.1" xref="S3.SS2.SSS1.Px1.p1.6.m6.1.1.1.1.1.1.cmml"><mo id="S3.SS2.SSS1.Px1.p1.6.m6.1.1.1.1.1.2" xref="S3.SS2.SSS1.Px1.p1.6.m6.1.1.1.1.1.1.cmml">(</mo><mrow id="S3.SS2.SSS1.Px1.p1.6.m6.1.1.1.1.1.1" xref="S3.SS2.SSS1.Px1.p1.6.m6.1.1.1.1.1.1.cmml"><mtext id="S3.SS2.SSS1.Px1.p1.6.m6.1.1.1.1.1.1.2" xref="S3.SS2.SSS1.Px1.p1.6.m6.1.1.1.1.1.1.2a.cmml">HiRE</mtext><mo id="S3.SS2.SSS1.Px1.p1.6.m6.1.1.1.1.1.1.1" xref="S3.SS2.SSS1.Px1.p1.6.m6.1.1.1.1.1.1.1.cmml">−</mo><mtext id="S3.SS2.SSS1.Px1.p1.6.m6.1.1.1.1.1.1.3" xref="S3.SS2.SSS1.Px1.p1.6.m6.1.1.1.1.1.1.3a.cmml">LR</mtext></mrow><mo id="S3.SS2.SSS1.Px1.p1.6.m6.1.1.1.1.1.3" xref="S3.SS2.SSS1.Px1.p1.6.m6.1.1.1.1.1.1.cmml">)</mo></mrow></mrow><mo id="S3.SS2.SSS1.Px1.p1.6.m6.2.2.3" xref="S3.SS2.SSS1.Px1.p1.6.m6.2.2.3.cmml">=</mo><mrow id="S3.SS2.SSS1.Px1.p1.6.m6.2.2.2" xref="S3.SS2.SSS1.Px1.p1.6.m6.2.2.2.cmml"><mn id="S3.SS2.SSS1.Px1.p1.6.m6.2.2.2.3" xref="S3.SS2.SSS1.Px1.p1.6.m6.2.2.2.3.cmml">2</mn><mo id="S3.SS2.SSS1.Px1.p1.6.m6.2.2.2.2" xref="S3.SS2.SSS1.Px1.p1.6.m6.2.2.2.2.cmml">⁢</mo><mrow id="S3.SS2.SSS1.Px1.p1.6.m6.2.2.2.1.1" xref="S3.SS2.SSS1.Px1.p1.6.m6.2.2.2.1.1.1.cmml"><mo id="S3.SS2.SSS1.Px1.p1.6.m6.2.2.2.1.1.2" stretchy="false" xref="S3.SS2.SSS1.Px1.p1.6.m6.2.2.2.1.1.1.cmml">(</mo><mrow id="S3.SS2.SSS1.Px1.p1.6.m6.2.2.2.1.1.1" xref="S3.SS2.SSS1.Px1.p1.6.m6.2.2.2.1.1.1.cmml"><mrow id="S3.SS2.SSS1.Px1.p1.6.m6.2.2.2.1.1.1.2" xref="S3.SS2.SSS1.Px1.p1.6.m6.2.2.2.1.1.1.2.cmml"><mi id="S3.SS2.SSS1.Px1.p1.6.m6.2.2.2.1.1.1.2.2" xref="S3.SS2.SSS1.Px1.p1.6.m6.2.2.2.1.1.1.2.2.cmml">d</mi><mo id="S3.SS2.SSS1.Px1.p1.6.m6.2.2.2.1.1.1.2.1" xref="S3.SS2.SSS1.Px1.p1.6.m6.2.2.2.1.1.1.2.1.cmml">⁢</mo><mi id="S3.SS2.SSS1.Px1.p1.6.m6.2.2.2.1.1.1.2.3" xref="S3.SS2.SSS1.Px1.p1.6.m6.2.2.2.1.1.1.2.3.cmml">r</mi></mrow><mo id="S3.SS2.SSS1.Px1.p1.6.m6.2.2.2.1.1.1.1" xref="S3.SS2.SSS1.Px1.p1.6.m6.2.2.2.1.1.1.1.cmml">+</mo><mrow id="S3.SS2.SSS1.Px1.p1.6.m6.2.2.2.1.1.1.3" xref="S3.SS2.SSS1.Px1.p1.6.m6.2.2.2.1.1.1.3.cmml"><mi id="S3.SS2.SSS1.Px1.p1.6.m6.2.2.2.1.1.1.3.2" xref="S3.SS2.SSS1.Px1.p1.6.m6.2.2.2.1.1.1.3.2.cmml">r</mi><mo id="S3.SS2.SSS1.Px1.p1.6.m6.2.2.2.1.1.1.3.1" xref="S3.SS2.SSS1.Px1.p1.6.m6.2.2.2.1.1.1.3.1.cmml">⁢</mo><mi id="S3.SS2.SSS1.Px1.p1.6.m6.2.2.2.1.1.1.3.3" mathvariant="normal" xref="S3.SS2.SSS1.Px1.p1.6.m6.2.2.2.1.1.1.3.3.cmml">ℓ</mi></mrow><mo id="S3.SS2.SSS1.Px1.p1.6.m6.2.2.2.1.1.1.1a" xref="S3.SS2.SSS1.Px1.p1.6.m6.2.2.2.1.1.1.1.cmml">+</mo><mrow id="S3.SS2.SSS1.Px1.p1.6.m6.2.2.2.1.1.1.4" xref="S3.SS2.SSS1.Px1.p1.6.m6.2.2.2.1.1.1.4.cmml"><mi id="S3.SS2.SSS1.Px1.p1.6.m6.2.2.2.1.1.1.4.2" xref="S3.SS2.SSS1.Px1.p1.6.m6.2.2.2.1.1.1.4.2.cmml">d</mi><mo id="S3.SS2.SSS1.Px1.p1.6.m6.2.2.2.1.1.1.4.1" xref="S3.SS2.SSS1.Px1.p1.6.m6.2.2.2.1.1.1.4.1.cmml">⁢</mo><msup id="S3.SS2.SSS1.Px1.p1.6.m6.2.2.2.1.1.1.4.3" xref="S3.SS2.SSS1.Px1.p1.6.m6.2.2.2.1.1.1.4.3.cmml"><mi id="S3.SS2.SSS1.Px1.p1.6.m6.2.2.2.1.1.1.4.3.2" xref="S3.SS2.SSS1.Px1.p1.6.m6.2.2.2.1.1.1.4.3.2.cmml">k</mi><mo id="S3.SS2.SSS1.Px1.p1.6.m6.2.2.2.1.1.1.4.3.3" xref="S3.SS2.SSS1.Px1.p1.6.m6.2.2.2.1.1.1.4.3.3.cmml">′</mo></msup></mrow></mrow><mo id="S3.SS2.SSS1.Px1.p1.6.m6.2.2.2.1.1.3" stretchy="false" xref="S3.SS2.SSS1.Px1.p1.6.m6.2.2.2.1.1.1.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.SS2.SSS1.Px1.p1.6.m6.2b"><apply id="S3.SS2.SSS1.Px1.p1.6.m6.2.2.cmml" xref="S3.SS2.SSS1.Px1.p1.6.m6.2.2"><eq id="S3.SS2.SSS1.Px1.p1.6.m6.2.2.3.cmml" xref="S3.SS2.SSS1.Px1.p1.6.m6.2.2.3"></eq><apply id="S3.SS2.SSS1.Px1.p1.6.m6.1.1.1.cmml" xref="S3.SS2.SSS1.Px1.p1.6.m6.1.1.1"><times id="S3.SS2.SSS1.Px1.p1.6.m6.1.1.1.2.cmml" xref="S3.SS2.SSS1.Px1.p1.6.m6.1.1.1.2"></times><ci id="S3.SS2.SSS1.Px1.p1.6.m6.1.1.1.3a.cmml" xref="S3.SS2.SSS1.Px1.p1.6.m6.1.1.1.3"><mtext id="S3.SS2.SSS1.Px1.p1.6.m6.1.1.1.3.cmml" xref="S3.SS2.SSS1.Px1.p1.6.m6.1.1.1.3">PS</mtext></ci><apply id="S3.SS2.SSS1.Px1.p1.6.m6.1.1.1.1.1.1.cmml" xref="S3.SS2.SSS1.Px1.p1.6.m6.1.1.1.1.1"><minus id="S3.SS2.SSS1.Px1.p1.6.m6.1.1.1.1.1.1.1.cmml" xref="S3.SS2.SSS1.Px1.p1.6.m6.1.1.1.1.1.1.1"></minus><ci id="S3.SS2.SSS1.Px1.p1.6.m6.1.1.1.1.1.1.2a.cmml" xref="S3.SS2.SSS1.Px1.p1.6.m6.1.1.1.1.1.1.2"><mtext id="S3.SS2.SSS1.Px1.p1.6.m6.1.1.1.1.1.1.2.cmml" xref="S3.SS2.SSS1.Px1.p1.6.m6.1.1.1.1.1.1.2">HiRE</mtext></ci><ci id="S3.SS2.SSS1.Px1.p1.6.m6.1.1.1.1.1.1.3a.cmml" xref="S3.SS2.SSS1.Px1.p1.6.m6.1.1.1.1.1.1.3"><mtext id="S3.SS2.SSS1.Px1.p1.6.m6.1.1.1.1.1.1.3.cmml" xref="S3.SS2.SSS1.Px1.p1.6.m6.1.1.1.1.1.1.3">LR</mtext></ci></apply></apply><apply id="S3.SS2.SSS1.Px1.p1.6.m6.2.2.2.cmml" xref="S3.SS2.SSS1.Px1.p1.6.m6.2.2.2"><times id="S3.SS2.SSS1.Px1.p1.6.m6.2.2.2.2.cmml" xref="S3.SS2.SSS1.Px1.p1.6.m6.2.2.2.2"></times><cn id="S3.SS2.SSS1.Px1.p1.6.m6.2.2.2.3.cmml" type="integer" xref="S3.SS2.SSS1.Px1.p1.6.m6.2.2.2.3">2</cn><apply id="S3.SS2.SSS1.Px1.p1.6.m6.2.2.2.1.1.1.cmml" xref="S3.SS2.SSS1.Px1.p1.6.m6.2.2.2.1.1"><plus id="S3.SS2.SSS1.Px1.p1.6.m6.2.2.2.1.1.1.1.cmml" xref="S3.SS2.SSS1.Px1.p1.6.m6.2.2.2.1.1.1.1"></plus><apply id="S3.SS2.SSS1.Px1.p1.6.m6.2.2.2.1.1.1.2.cmml" xref="S3.SS2.SSS1.Px1.p1.6.m6.2.2.2.1.1.1.2"><times id="S3.SS2.SSS1.Px1.p1.6.m6.2.2.2.1.1.1.2.1.cmml" xref="S3.SS2.SSS1.Px1.p1.6.m6.2.2.2.1.1.1.2.1"></times><ci id="S3.SS2.SSS1.Px1.p1.6.m6.2.2.2.1.1.1.2.2.cmml" xref="S3.SS2.SSS1.Px1.p1.6.m6.2.2.2.1.1.1.2.2">𝑑</ci><ci id="S3.SS2.SSS1.Px1.p1.6.m6.2.2.2.1.1.1.2.3.cmml" xref="S3.SS2.SSS1.Px1.p1.6.m6.2.2.2.1.1.1.2.3">𝑟</ci></apply><apply id="S3.SS2.SSS1.Px1.p1.6.m6.2.2.2.1.1.1.3.cmml" xref="S3.SS2.SSS1.Px1.p1.6.m6.2.2.2.1.1.1.3"><times id="S3.SS2.SSS1.Px1.p1.6.m6.2.2.2.1.1.1.3.1.cmml" xref="S3.SS2.SSS1.Px1.p1.6.m6.2.2.2.1.1.1.3.1"></times><ci id="S3.SS2.SSS1.Px1.p1.6.m6.2.2.2.1.1.1.3.2.cmml" xref="S3.SS2.SSS1.Px1.p1.6.m6.2.2.2.1.1.1.3.2">𝑟</ci><ci id="S3.SS2.SSS1.Px1.p1.6.m6.2.2.2.1.1.1.3.3.cmml" xref="S3.SS2.SSS1.Px1.p1.6.m6.2.2.2.1.1.1.3.3">ℓ</ci></apply><apply id="S3.SS2.SSS1.Px1.p1.6.m6.2.2.2.1.1.1.4.cmml" xref="S3.SS2.SSS1.Px1.p1.6.m6.2.2.2.1.1.1.4"><times id="S3.SS2.SSS1.Px1.p1.6.m6.2.2.2.1.1.1.4.1.cmml" xref="S3.SS2.SSS1.Px1.p1.6.m6.2.2.2.1.1.1.4.1"></times><ci id="S3.SS2.SSS1.Px1.p1.6.m6.2.2.2.1.1.1.4.2.cmml" xref="S3.SS2.SSS1.Px1.p1.6.m6.2.2.2.1.1.1.4.2">𝑑</ci><apply id="S3.SS2.SSS1.Px1.p1.6.m6.2.2.2.1.1.1.4.3.cmml" xref="S3.SS2.SSS1.Px1.p1.6.m6.2.2.2.1.1.1.4.3"><csymbol cd="ambiguous" id="S3.SS2.SSS1.Px1.p1.6.m6.2.2.2.1.1.1.4.3.1.cmml" xref="S3.SS2.SSS1.Px1.p1.6.m6.2.2.2.1.1.1.4.3">superscript</csymbol><ci id="S3.SS2.SSS1.Px1.p1.6.m6.2.2.2.1.1.1.4.3.2.cmml" xref="S3.SS2.SSS1.Px1.p1.6.m6.2.2.2.1.1.1.4.3.2">𝑘</ci><ci id="S3.SS2.SSS1.Px1.p1.6.m6.2.2.2.1.1.1.4.3.3.cmml" xref="S3.SS2.SSS1.Px1.p1.6.m6.2.2.2.1.1.1.4.3.3">′</ci></apply></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.SSS1.Px1.p1.6.m6.2c">\textrm{PS}\left(\textrm{HiRE}-\textrm{LR}\right)=2(dr+r\ell+dk^{\prime})</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.SSS1.Px1.p1.6.m6.2d">PS ( HiRE - LR ) = 2 ( italic_d italic_r + italic_r roman_ℓ + italic_d italic_k start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT )</annotation></semantics></math>, which will be much smaller than <math alttext="2d\ell" class="ltx_Math" display="inline" id="S3.SS2.SSS1.Px1.p1.7.m7.1"><semantics id="S3.SS2.SSS1.Px1.p1.7.m7.1a"><mrow id="S3.SS2.SSS1.Px1.p1.7.m7.1.1" xref="S3.SS2.SSS1.Px1.p1.7.m7.1.1.cmml"><mn id="S3.SS2.SSS1.Px1.p1.7.m7.1.1.2" xref="S3.SS2.SSS1.Px1.p1.7.m7.1.1.2.cmml">2</mn><mo id="S3.SS2.SSS1.Px1.p1.7.m7.1.1.1" xref="S3.SS2.SSS1.Px1.p1.7.m7.1.1.1.cmml">⁢</mo><mi id="S3.SS2.SSS1.Px1.p1.7.m7.1.1.3" xref="S3.SS2.SSS1.Px1.p1.7.m7.1.1.3.cmml">d</mi><mo id="S3.SS2.SSS1.Px1.p1.7.m7.1.1.1a" xref="S3.SS2.SSS1.Px1.p1.7.m7.1.1.1.cmml">⁢</mo><mi id="S3.SS2.SSS1.Px1.p1.7.m7.1.1.4" mathvariant="normal" xref="S3.SS2.SSS1.Px1.p1.7.m7.1.1.4.cmml">ℓ</mi></mrow><annotation-xml encoding="MathML-Content" id="S3.SS2.SSS1.Px1.p1.7.m7.1b"><apply id="S3.SS2.SSS1.Px1.p1.7.m7.1.1.cmml" xref="S3.SS2.SSS1.Px1.p1.7.m7.1.1"><times id="S3.SS2.SSS1.Px1.p1.7.m7.1.1.1.cmml" xref="S3.SS2.SSS1.Px1.p1.7.m7.1.1.1"></times><cn id="S3.SS2.SSS1.Px1.p1.7.m7.1.1.2.cmml" type="integer" xref="S3.SS2.SSS1.Px1.p1.7.m7.1.1.2">2</cn><ci id="S3.SS2.SSS1.Px1.p1.7.m7.1.1.3.cmml" xref="S3.SS2.SSS1.Px1.p1.7.m7.1.1.3">𝑑</ci><ci id="S3.SS2.SSS1.Px1.p1.7.m7.1.1.4.cmml" xref="S3.SS2.SSS1.Px1.p1.7.m7.1.1.4">ℓ</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.SSS1.Px1.p1.7.m7.1c">2d\ell</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.SSS1.Px1.p1.7.m7.1d">2 italic_d roman_ℓ</annotation></semantics></math> since <math alttext="r\ll d\ll\ell" class="ltx_Math" display="inline" id="S3.SS2.SSS1.Px1.p1.8.m8.1"><semantics id="S3.SS2.SSS1.Px1.p1.8.m8.1a"><mrow id="S3.SS2.SSS1.Px1.p1.8.m8.1.1" xref="S3.SS2.SSS1.Px1.p1.8.m8.1.1.cmml"><mi id="S3.SS2.SSS1.Px1.p1.8.m8.1.1.2" xref="S3.SS2.SSS1.Px1.p1.8.m8.1.1.2.cmml">r</mi><mo id="S3.SS2.SSS1.Px1.p1.8.m8.1.1.3" xref="S3.SS2.SSS1.Px1.p1.8.m8.1.1.3.cmml">≪</mo><mi id="S3.SS2.SSS1.Px1.p1.8.m8.1.1.4" xref="S3.SS2.SSS1.Px1.p1.8.m8.1.1.4.cmml">d</mi><mo id="S3.SS2.SSS1.Px1.p1.8.m8.1.1.5" xref="S3.SS2.SSS1.Px1.p1.8.m8.1.1.5.cmml">≪</mo><mi id="S3.SS2.SSS1.Px1.p1.8.m8.1.1.6" mathvariant="normal" xref="S3.SS2.SSS1.Px1.p1.8.m8.1.1.6.cmml">ℓ</mi></mrow><annotation-xml encoding="MathML-Content" id="S3.SS2.SSS1.Px1.p1.8.m8.1b"><apply id="S3.SS2.SSS1.Px1.p1.8.m8.1.1.cmml" xref="S3.SS2.SSS1.Px1.p1.8.m8.1.1"><and id="S3.SS2.SSS1.Px1.p1.8.m8.1.1a.cmml" xref="S3.SS2.SSS1.Px1.p1.8.m8.1.1"></and><apply id="S3.SS2.SSS1.Px1.p1.8.m8.1.1b.cmml" xref="S3.SS2.SSS1.Px1.p1.8.m8.1.1"><csymbol cd="latexml" id="S3.SS2.SSS1.Px1.p1.8.m8.1.1.3.cmml" xref="S3.SS2.SSS1.Px1.p1.8.m8.1.1.3">much-less-than</csymbol><ci id="S3.SS2.SSS1.Px1.p1.8.m8.1.1.2.cmml" xref="S3.SS2.SSS1.Px1.p1.8.m8.1.1.2">𝑟</ci><ci id="S3.SS2.SSS1.Px1.p1.8.m8.1.1.4.cmml" xref="S3.SS2.SSS1.Px1.p1.8.m8.1.1.4">𝑑</ci></apply><apply id="S3.SS2.SSS1.Px1.p1.8.m8.1.1c.cmml" xref="S3.SS2.SSS1.Px1.p1.8.m8.1.1"><csymbol cd="latexml" id="S3.SS2.SSS1.Px1.p1.8.m8.1.1.5.cmml" xref="S3.SS2.SSS1.Px1.p1.8.m8.1.1.5">much-less-than</csymbol><share href="#S3.SS2.SSS1.Px1.p1.8.m8.1.1.4.cmml" id="S3.SS2.SSS1.Px1.p1.8.m8.1.1d.cmml" xref="S3.SS2.SSS1.Px1.p1.8.m8.1.1"></share><ci id="S3.SS2.SSS1.Px1.p1.8.m8.1.1.6.cmml" xref="S3.SS2.SSS1.Px1.p1.8.m8.1.1.6">ℓ</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.SSS1.Px1.p1.8.m8.1c">r\ll d\ll\ell</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.SSS1.Px1.p1.8.m8.1d">italic_r ≪ italic_d ≪ roman_ℓ</annotation></semantics></math> and <math alttext="k^{\prime}\ll\ell" class="ltx_Math" display="inline" id="S3.SS2.SSS1.Px1.p1.9.m9.1"><semantics id="S3.SS2.SSS1.Px1.p1.9.m9.1a"><mrow id="S3.SS2.SSS1.Px1.p1.9.m9.1.1" xref="S3.SS2.SSS1.Px1.p1.9.m9.1.1.cmml"><msup id="S3.SS2.SSS1.Px1.p1.9.m9.1.1.2" xref="S3.SS2.SSS1.Px1.p1.9.m9.1.1.2.cmml"><mi id="S3.SS2.SSS1.Px1.p1.9.m9.1.1.2.2" xref="S3.SS2.SSS1.Px1.p1.9.m9.1.1.2.2.cmml">k</mi><mo id="S3.SS2.SSS1.Px1.p1.9.m9.1.1.2.3" xref="S3.SS2.SSS1.Px1.p1.9.m9.1.1.2.3.cmml">′</mo></msup><mo id="S3.SS2.SSS1.Px1.p1.9.m9.1.1.1" xref="S3.SS2.SSS1.Px1.p1.9.m9.1.1.1.cmml">≪</mo><mi id="S3.SS2.SSS1.Px1.p1.9.m9.1.1.3" mathvariant="normal" xref="S3.SS2.SSS1.Px1.p1.9.m9.1.1.3.cmml">ℓ</mi></mrow><annotation-xml encoding="MathML-Content" id="S3.SS2.SSS1.Px1.p1.9.m9.1b"><apply id="S3.SS2.SSS1.Px1.p1.9.m9.1.1.cmml" xref="S3.SS2.SSS1.Px1.p1.9.m9.1.1"><csymbol cd="latexml" id="S3.SS2.SSS1.Px1.p1.9.m9.1.1.1.cmml" xref="S3.SS2.SSS1.Px1.p1.9.m9.1.1.1">much-less-than</csymbol><apply id="S3.SS2.SSS1.Px1.p1.9.m9.1.1.2.cmml" xref="S3.SS2.SSS1.Px1.p1.9.m9.1.1.2"><csymbol cd="ambiguous" id="S3.SS2.SSS1.Px1.p1.9.m9.1.1.2.1.cmml" xref="S3.SS2.SSS1.Px1.p1.9.m9.1.1.2">superscript</csymbol><ci id="S3.SS2.SSS1.Px1.p1.9.m9.1.1.2.2.cmml" xref="S3.SS2.SSS1.Px1.p1.9.m9.1.1.2.2">𝑘</ci><ci id="S3.SS2.SSS1.Px1.p1.9.m9.1.1.2.3.cmml" xref="S3.SS2.SSS1.Px1.p1.9.m9.1.1.2.3">′</ci></apply><ci id="S3.SS2.SSS1.Px1.p1.9.m9.1.1.3.cmml" xref="S3.SS2.SSS1.Px1.p1.9.m9.1.1.3">ℓ</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.SSS1.Px1.p1.9.m9.1c">k^{\prime}\ll\ell</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.SSS1.Px1.p1.9.m9.1d">italic_k start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT ≪ roman_ℓ</annotation></semantics></math>. Note that this requires us to train <math alttext="{\mathbf{Z}_{\textrm{approx}}}" class="ltx_Math" display="inline" id="S3.SS2.SSS1.Px1.p1.10.m10.1"><semantics id="S3.SS2.SSS1.Px1.p1.10.m10.1a"><msub id="S3.SS2.SSS1.Px1.p1.10.m10.1.1" xref="S3.SS2.SSS1.Px1.p1.10.m10.1.1.cmml"><mi id="S3.SS2.SSS1.Px1.p1.10.m10.1.1.2" xref="S3.SS2.SSS1.Px1.p1.10.m10.1.1.2.cmml">𝐙</mi><mtext id="S3.SS2.SSS1.Px1.p1.10.m10.1.1.3" xref="S3.SS2.SSS1.Px1.p1.10.m10.1.1.3a.cmml">approx</mtext></msub><annotation-xml encoding="MathML-Content" id="S3.SS2.SSS1.Px1.p1.10.m10.1b"><apply id="S3.SS2.SSS1.Px1.p1.10.m10.1.1.cmml" xref="S3.SS2.SSS1.Px1.p1.10.m10.1.1"><csymbol cd="ambiguous" id="S3.SS2.SSS1.Px1.p1.10.m10.1.1.1.cmml" xref="S3.SS2.SSS1.Px1.p1.10.m10.1.1">subscript</csymbol><ci id="S3.SS2.SSS1.Px1.p1.10.m10.1.1.2.cmml" xref="S3.SS2.SSS1.Px1.p1.10.m10.1.1.2">𝐙</ci><ci id="S3.SS2.SSS1.Px1.p1.10.m10.1.1.3a.cmml" xref="S3.SS2.SSS1.Px1.p1.10.m10.1.1.3"><mtext id="S3.SS2.SSS1.Px1.p1.10.m10.1.1.3.cmml" mathsize="70%" xref="S3.SS2.SSS1.Px1.p1.10.m10.1.1.3">approx</mtext></ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.SSS1.Px1.p1.10.m10.1c">{\mathbf{Z}_{\textrm{approx}}}</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.SSS1.Px1.p1.10.m10.1d">bold_Z start_POSTSUBSCRIPT approx end_POSTSUBSCRIPT</annotation></semantics></math> either in an end to end manner, or by performing low rank decomposition on <math alttext="{\mathbf{Z}}" class="ltx_Math" display="inline" id="S3.SS2.SSS1.Px1.p1.11.m11.1"><semantics id="S3.SS2.SSS1.Px1.p1.11.m11.1a"><mi id="S3.SS2.SSS1.Px1.p1.11.m11.1.1" xref="S3.SS2.SSS1.Px1.p1.11.m11.1.1.cmml">𝐙</mi><annotation-xml encoding="MathML-Content" id="S3.SS2.SSS1.Px1.p1.11.m11.1b"><ci id="S3.SS2.SSS1.Px1.p1.11.m11.1.1.cmml" xref="S3.SS2.SSS1.Px1.p1.11.m11.1.1">𝐙</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.SSS1.Px1.p1.11.m11.1c">{\mathbf{Z}}</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.SSS1.Px1.p1.11.m11.1d">bold_Z</annotation></semantics></math>. However, there is a high potential for latency gains here since <math alttext="r" class="ltx_Math" display="inline" id="S3.SS2.SSS1.Px1.p1.12.m12.1"><semantics id="S3.SS2.SSS1.Px1.p1.12.m12.1a"><mi id="S3.SS2.SSS1.Px1.p1.12.m12.1.1" xref="S3.SS2.SSS1.Px1.p1.12.m12.1.1.cmml">r</mi><annotation-xml encoding="MathML-Content" id="S3.SS2.SSS1.Px1.p1.12.m12.1b"><ci id="S3.SS2.SSS1.Px1.p1.12.m12.1.1.cmml" xref="S3.SS2.SSS1.Px1.p1.12.m12.1.1">𝑟</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.SSS1.Px1.p1.12.m12.1c">r</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.SSS1.Px1.p1.12.m12.1d">italic_r</annotation></semantics></math> could potentially be chosen to be very small.</p>
</div>
</section>
<section class="ltx_paragraph" id="S3.SS2.SSS1.Px2">
<h5 class="ltx_title ltx_title_paragraph">HiRE-Q </h5>
<div class="ltx_para" id="S3.SS2.SSS1.Px2.p1">
<p class="ltx_p" id="S3.SS2.SSS1.Px2.p1.8">: In this case, we choose <math alttext="{\mathbf{Z}_{\textrm{approx}}}" class="ltx_Math" display="inline" id="S3.SS2.SSS1.Px2.p1.1.m1.1"><semantics id="S3.SS2.SSS1.Px2.p1.1.m1.1a"><msub id="S3.SS2.SSS1.Px2.p1.1.m1.1.1" xref="S3.SS2.SSS1.Px2.p1.1.m1.1.1.cmml"><mi id="S3.SS2.SSS1.Px2.p1.1.m1.1.1.2" xref="S3.SS2.SSS1.Px2.p1.1.m1.1.1.2.cmml">𝐙</mi><mtext id="S3.SS2.SSS1.Px2.p1.1.m1.1.1.3" xref="S3.SS2.SSS1.Px2.p1.1.m1.1.1.3a.cmml">approx</mtext></msub><annotation-xml encoding="MathML-Content" id="S3.SS2.SSS1.Px2.p1.1.m1.1b"><apply id="S3.SS2.SSS1.Px2.p1.1.m1.1.1.cmml" xref="S3.SS2.SSS1.Px2.p1.1.m1.1.1"><csymbol cd="ambiguous" id="S3.SS2.SSS1.Px2.p1.1.m1.1.1.1.cmml" xref="S3.SS2.SSS1.Px2.p1.1.m1.1.1">subscript</csymbol><ci id="S3.SS2.SSS1.Px2.p1.1.m1.1.1.2.cmml" xref="S3.SS2.SSS1.Px2.p1.1.m1.1.1.2">𝐙</ci><ci id="S3.SS2.SSS1.Px2.p1.1.m1.1.1.3a.cmml" xref="S3.SS2.SSS1.Px2.p1.1.m1.1.1.3"><mtext id="S3.SS2.SSS1.Px2.p1.1.m1.1.1.3.cmml" mathsize="70%" xref="S3.SS2.SSS1.Px2.p1.1.m1.1.1.3">approx</mtext></ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.SSS1.Px2.p1.1.m1.1c">{\mathbf{Z}_{\textrm{approx}}}</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.SSS1.Px2.p1.1.m1.1d">bold_Z start_POSTSUBSCRIPT approx end_POSTSUBSCRIPT</annotation></semantics></math> to be a aggressively quantized version of <math alttext="{\mathbf{Z}}" class="ltx_Math" display="inline" id="S3.SS2.SSS1.Px2.p1.2.m2.1"><semantics id="S3.SS2.SSS1.Px2.p1.2.m2.1a"><mi id="S3.SS2.SSS1.Px2.p1.2.m2.1.1" xref="S3.SS2.SSS1.Px2.p1.2.m2.1.1.cmml">𝐙</mi><annotation-xml encoding="MathML-Content" id="S3.SS2.SSS1.Px2.p1.2.m2.1b"><ci id="S3.SS2.SSS1.Px2.p1.2.m2.1.1.cmml" xref="S3.SS2.SSS1.Px2.p1.2.m2.1.1">𝐙</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.SSS1.Px2.p1.2.m2.1c">{\mathbf{Z}}</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.SSS1.Px2.p1.2.m2.1d">bold_Z</annotation></semantics></math> for example in <math alttext="4" class="ltx_Math" display="inline" id="S3.SS2.SSS1.Px2.p1.3.m3.1"><semantics id="S3.SS2.SSS1.Px2.p1.3.m3.1a"><mn id="S3.SS2.SSS1.Px2.p1.3.m3.1.1" xref="S3.SS2.SSS1.Px2.p1.3.m3.1.1.cmml">4</mn><annotation-xml encoding="MathML-Content" id="S3.SS2.SSS1.Px2.p1.3.m3.1b"><cn id="S3.SS2.SSS1.Px2.p1.3.m3.1.1.cmml" type="integer" xref="S3.SS2.SSS1.Px2.p1.3.m3.1.1">4</cn></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.SSS1.Px2.p1.3.m3.1c">4</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.SSS1.Px2.p1.3.m3.1d">4</annotation></semantics></math>-bit integer format (int4). In this case, <math alttext="\textrm{PS}\left(\textrm{HiRE}-\textrm{Q}\right)=\frac{d\ell}{2}+2dk^{\prime}" class="ltx_Math" display="inline" id="S3.SS2.SSS1.Px2.p1.4.m4.1"><semantics id="S3.SS2.SSS1.Px2.p1.4.m4.1a"><mrow id="S3.SS2.SSS1.Px2.p1.4.m4.1.1" xref="S3.SS2.SSS1.Px2.p1.4.m4.1.1.cmml"><mrow id="S3.SS2.SSS1.Px2.p1.4.m4.1.1.1" xref="S3.SS2.SSS1.Px2.p1.4.m4.1.1.1.cmml"><mtext id="S3.SS2.SSS1.Px2.p1.4.m4.1.1.1.3" xref="S3.SS2.SSS1.Px2.p1.4.m4.1.1.1.3a.cmml">PS</mtext><mo id="S3.SS2.SSS1.Px2.p1.4.m4.1.1.1.2" xref="S3.SS2.SSS1.Px2.p1.4.m4.1.1.1.2.cmml">⁢</mo><mrow id="S3.SS2.SSS1.Px2.p1.4.m4.1.1.1.1.1" xref="S3.SS2.SSS1.Px2.p1.4.m4.1.1.1.1.1.1.cmml"><mo id="S3.SS2.SSS1.Px2.p1.4.m4.1.1.1.1.1.2" xref="S3.SS2.SSS1.Px2.p1.4.m4.1.1.1.1.1.1.cmml">(</mo><mrow id="S3.SS2.SSS1.Px2.p1.4.m4.1.1.1.1.1.1" xref="S3.SS2.SSS1.Px2.p1.4.m4.1.1.1.1.1.1.cmml"><mtext id="S3.SS2.SSS1.Px2.p1.4.m4.1.1.1.1.1.1.2" xref="S3.SS2.SSS1.Px2.p1.4.m4.1.1.1.1.1.1.2a.cmml">HiRE</mtext><mo id="S3.SS2.SSS1.Px2.p1.4.m4.1.1.1.1.1.1.1" xref="S3.SS2.SSS1.Px2.p1.4.m4.1.1.1.1.1.1.1.cmml">−</mo><mtext id="S3.SS2.SSS1.Px2.p1.4.m4.1.1.1.1.1.1.3" xref="S3.SS2.SSS1.Px2.p1.4.m4.1.1.1.1.1.1.3a.cmml">Q</mtext></mrow><mo id="S3.SS2.SSS1.Px2.p1.4.m4.1.1.1.1.1.3" xref="S3.SS2.SSS1.Px2.p1.4.m4.1.1.1.1.1.1.cmml">)</mo></mrow></mrow><mo id="S3.SS2.SSS1.Px2.p1.4.m4.1.1.2" xref="S3.SS2.SSS1.Px2.p1.4.m4.1.1.2.cmml">=</mo><mrow id="S3.SS2.SSS1.Px2.p1.4.m4.1.1.3" xref="S3.SS2.SSS1.Px2.p1.4.m4.1.1.3.cmml"><mfrac id="S3.SS2.SSS1.Px2.p1.4.m4.1.1.3.2" xref="S3.SS2.SSS1.Px2.p1.4.m4.1.1.3.2.cmml"><mrow id="S3.SS2.SSS1.Px2.p1.4.m4.1.1.3.2.2" xref="S3.SS2.SSS1.Px2.p1.4.m4.1.1.3.2.2.cmml"><mi id="S3.SS2.SSS1.Px2.p1.4.m4.1.1.3.2.2.2" xref="S3.SS2.SSS1.Px2.p1.4.m4.1.1.3.2.2.2.cmml">d</mi><mo id="S3.SS2.SSS1.Px2.p1.4.m4.1.1.3.2.2.1" xref="S3.SS2.SSS1.Px2.p1.4.m4.1.1.3.2.2.1.cmml">⁢</mo><mi id="S3.SS2.SSS1.Px2.p1.4.m4.1.1.3.2.2.3" mathvariant="normal" xref="S3.SS2.SSS1.Px2.p1.4.m4.1.1.3.2.2.3.cmml">ℓ</mi></mrow><mn id="S3.SS2.SSS1.Px2.p1.4.m4.1.1.3.2.3" xref="S3.SS2.SSS1.Px2.p1.4.m4.1.1.3.2.3.cmml">2</mn></mfrac><mo id="S3.SS2.SSS1.Px2.p1.4.m4.1.1.3.1" xref="S3.SS2.SSS1.Px2.p1.4.m4.1.1.3.1.cmml">+</mo><mrow id="S3.SS2.SSS1.Px2.p1.4.m4.1.1.3.3" xref="S3.SS2.SSS1.Px2.p1.4.m4.1.1.3.3.cmml"><mn id="S3.SS2.SSS1.Px2.p1.4.m4.1.1.3.3.2" xref="S3.SS2.SSS1.Px2.p1.4.m4.1.1.3.3.2.cmml">2</mn><mo id="S3.SS2.SSS1.Px2.p1.4.m4.1.1.3.3.1" xref="S3.SS2.SSS1.Px2.p1.4.m4.1.1.3.3.1.cmml">⁢</mo><mi id="S3.SS2.SSS1.Px2.p1.4.m4.1.1.3.3.3" xref="S3.SS2.SSS1.Px2.p1.4.m4.1.1.3.3.3.cmml">d</mi><mo id="S3.SS2.SSS1.Px2.p1.4.m4.1.1.3.3.1a" xref="S3.SS2.SSS1.Px2.p1.4.m4.1.1.3.3.1.cmml">⁢</mo><msup id="S3.SS2.SSS1.Px2.p1.4.m4.1.1.3.3.4" xref="S3.SS2.SSS1.Px2.p1.4.m4.1.1.3.3.4.cmml"><mi id="S3.SS2.SSS1.Px2.p1.4.m4.1.1.3.3.4.2" xref="S3.SS2.SSS1.Px2.p1.4.m4.1.1.3.3.4.2.cmml">k</mi><mo id="S3.SS2.SSS1.Px2.p1.4.m4.1.1.3.3.4.3" xref="S3.SS2.SSS1.Px2.p1.4.m4.1.1.3.3.4.3.cmml">′</mo></msup></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.SS2.SSS1.Px2.p1.4.m4.1b"><apply id="S3.SS2.SSS1.Px2.p1.4.m4.1.1.cmml" xref="S3.SS2.SSS1.Px2.p1.4.m4.1.1"><eq id="S3.SS2.SSS1.Px2.p1.4.m4.1.1.2.cmml" xref="S3.SS2.SSS1.Px2.p1.4.m4.1.1.2"></eq><apply id="S3.SS2.SSS1.Px2.p1.4.m4.1.1.1.cmml" xref="S3.SS2.SSS1.Px2.p1.4.m4.1.1.1"><times id="S3.SS2.SSS1.Px2.p1.4.m4.1.1.1.2.cmml" xref="S3.SS2.SSS1.Px2.p1.4.m4.1.1.1.2"></times><ci id="S3.SS2.SSS1.Px2.p1.4.m4.1.1.1.3a.cmml" xref="S3.SS2.SSS1.Px2.p1.4.m4.1.1.1.3"><mtext id="S3.SS2.SSS1.Px2.p1.4.m4.1.1.1.3.cmml" xref="S3.SS2.SSS1.Px2.p1.4.m4.1.1.1.3">PS</mtext></ci><apply id="S3.SS2.SSS1.Px2.p1.4.m4.1.1.1.1.1.1.cmml" xref="S3.SS2.SSS1.Px2.p1.4.m4.1.1.1.1.1"><minus id="S3.SS2.SSS1.Px2.p1.4.m4.1.1.1.1.1.1.1.cmml" xref="S3.SS2.SSS1.Px2.p1.4.m4.1.1.1.1.1.1.1"></minus><ci id="S3.SS2.SSS1.Px2.p1.4.m4.1.1.1.1.1.1.2a.cmml" xref="S3.SS2.SSS1.Px2.p1.4.m4.1.1.1.1.1.1.2"><mtext id="S3.SS2.SSS1.Px2.p1.4.m4.1.1.1.1.1.1.2.cmml" xref="S3.SS2.SSS1.Px2.p1.4.m4.1.1.1.1.1.1.2">HiRE</mtext></ci><ci id="S3.SS2.SSS1.Px2.p1.4.m4.1.1.1.1.1.1.3a.cmml" xref="S3.SS2.SSS1.Px2.p1.4.m4.1.1.1.1.1.1.3"><mtext id="S3.SS2.SSS1.Px2.p1.4.m4.1.1.1.1.1.1.3.cmml" xref="S3.SS2.SSS1.Px2.p1.4.m4.1.1.1.1.1.1.3">Q</mtext></ci></apply></apply><apply id="S3.SS2.SSS1.Px2.p1.4.m4.1.1.3.cmml" xref="S3.SS2.SSS1.Px2.p1.4.m4.1.1.3"><plus id="S3.SS2.SSS1.Px2.p1.4.m4.1.1.3.1.cmml" xref="S3.SS2.SSS1.Px2.p1.4.m4.1.1.3.1"></plus><apply id="S3.SS2.SSS1.Px2.p1.4.m4.1.1.3.2.cmml" xref="S3.SS2.SSS1.Px2.p1.4.m4.1.1.3.2"><divide id="S3.SS2.SSS1.Px2.p1.4.m4.1.1.3.2.1.cmml" xref="S3.SS2.SSS1.Px2.p1.4.m4.1.1.3.2"></divide><apply id="S3.SS2.SSS1.Px2.p1.4.m4.1.1.3.2.2.cmml" xref="S3.SS2.SSS1.Px2.p1.4.m4.1.1.3.2.2"><times id="S3.SS2.SSS1.Px2.p1.4.m4.1.1.3.2.2.1.cmml" xref="S3.SS2.SSS1.Px2.p1.4.m4.1.1.3.2.2.1"></times><ci id="S3.SS2.SSS1.Px2.p1.4.m4.1.1.3.2.2.2.cmml" xref="S3.SS2.SSS1.Px2.p1.4.m4.1.1.3.2.2.2">𝑑</ci><ci id="S3.SS2.SSS1.Px2.p1.4.m4.1.1.3.2.2.3.cmml" xref="S3.SS2.SSS1.Px2.p1.4.m4.1.1.3.2.2.3">ℓ</ci></apply><cn id="S3.SS2.SSS1.Px2.p1.4.m4.1.1.3.2.3.cmml" type="integer" xref="S3.SS2.SSS1.Px2.p1.4.m4.1.1.3.2.3">2</cn></apply><apply id="S3.SS2.SSS1.Px2.p1.4.m4.1.1.3.3.cmml" xref="S3.SS2.SSS1.Px2.p1.4.m4.1.1.3.3"><times id="S3.SS2.SSS1.Px2.p1.4.m4.1.1.3.3.1.cmml" xref="S3.SS2.SSS1.Px2.p1.4.m4.1.1.3.3.1"></times><cn id="S3.SS2.SSS1.Px2.p1.4.m4.1.1.3.3.2.cmml" type="integer" xref="S3.SS2.SSS1.Px2.p1.4.m4.1.1.3.3.2">2</cn><ci id="S3.SS2.SSS1.Px2.p1.4.m4.1.1.3.3.3.cmml" xref="S3.SS2.SSS1.Px2.p1.4.m4.1.1.3.3.3">𝑑</ci><apply id="S3.SS2.SSS1.Px2.p1.4.m4.1.1.3.3.4.cmml" xref="S3.SS2.SSS1.Px2.p1.4.m4.1.1.3.3.4"><csymbol cd="ambiguous" id="S3.SS2.SSS1.Px2.p1.4.m4.1.1.3.3.4.1.cmml" xref="S3.SS2.SSS1.Px2.p1.4.m4.1.1.3.3.4">superscript</csymbol><ci id="S3.SS2.SSS1.Px2.p1.4.m4.1.1.3.3.4.2.cmml" xref="S3.SS2.SSS1.Px2.p1.4.m4.1.1.3.3.4.2">𝑘</ci><ci id="S3.SS2.SSS1.Px2.p1.4.m4.1.1.3.3.4.3.cmml" xref="S3.SS2.SSS1.Px2.p1.4.m4.1.1.3.3.4.3">′</ci></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.SSS1.Px2.p1.4.m4.1c">\textrm{PS}\left(\textrm{HiRE}-\textrm{Q}\right)=\frac{d\ell}{2}+2dk^{\prime}</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.SSS1.Px2.p1.4.m4.1d">PS ( HiRE - Q ) = divide start_ARG italic_d roman_ℓ end_ARG start_ARG 2 end_ARG + 2 italic_d italic_k start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT</annotation></semantics></math>, which will be much smaller than <math alttext="2d\ell" class="ltx_Math" display="inline" id="S3.SS2.SSS1.Px2.p1.5.m5.1"><semantics id="S3.SS2.SSS1.Px2.p1.5.m5.1a"><mrow id="S3.SS2.SSS1.Px2.p1.5.m5.1.1" xref="S3.SS2.SSS1.Px2.p1.5.m5.1.1.cmml"><mn id="S3.SS2.SSS1.Px2.p1.5.m5.1.1.2" xref="S3.SS2.SSS1.Px2.p1.5.m5.1.1.2.cmml">2</mn><mo id="S3.SS2.SSS1.Px2.p1.5.m5.1.1.1" xref="S3.SS2.SSS1.Px2.p1.5.m5.1.1.1.cmml">⁢</mo><mi id="S3.SS2.SSS1.Px2.p1.5.m5.1.1.3" xref="S3.SS2.SSS1.Px2.p1.5.m5.1.1.3.cmml">d</mi><mo id="S3.SS2.SSS1.Px2.p1.5.m5.1.1.1a" xref="S3.SS2.SSS1.Px2.p1.5.m5.1.1.1.cmml">⁢</mo><mi id="S3.SS2.SSS1.Px2.p1.5.m5.1.1.4" mathvariant="normal" xref="S3.SS2.SSS1.Px2.p1.5.m5.1.1.4.cmml">ℓ</mi></mrow><annotation-xml encoding="MathML-Content" id="S3.SS2.SSS1.Px2.p1.5.m5.1b"><apply id="S3.SS2.SSS1.Px2.p1.5.m5.1.1.cmml" xref="S3.SS2.SSS1.Px2.p1.5.m5.1.1"><times id="S3.SS2.SSS1.Px2.p1.5.m5.1.1.1.cmml" xref="S3.SS2.SSS1.Px2.p1.5.m5.1.1.1"></times><cn id="S3.SS2.SSS1.Px2.p1.5.m5.1.1.2.cmml" type="integer" xref="S3.SS2.SSS1.Px2.p1.5.m5.1.1.2">2</cn><ci id="S3.SS2.SSS1.Px2.p1.5.m5.1.1.3.cmml" xref="S3.SS2.SSS1.Px2.p1.5.m5.1.1.3">𝑑</ci><ci id="S3.SS2.SSS1.Px2.p1.5.m5.1.1.4.cmml" xref="S3.SS2.SSS1.Px2.p1.5.m5.1.1.4">ℓ</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.SSS1.Px2.p1.5.m5.1c">2d\ell</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.SSS1.Px2.p1.5.m5.1d">2 italic_d roman_ℓ</annotation></semantics></math> since <math alttext="k^{\prime}\ll\ell" class="ltx_Math" display="inline" id="S3.SS2.SSS1.Px2.p1.6.m6.1"><semantics id="S3.SS2.SSS1.Px2.p1.6.m6.1a"><mrow id="S3.SS2.SSS1.Px2.p1.6.m6.1.1" xref="S3.SS2.SSS1.Px2.p1.6.m6.1.1.cmml"><msup id="S3.SS2.SSS1.Px2.p1.6.m6.1.1.2" xref="S3.SS2.SSS1.Px2.p1.6.m6.1.1.2.cmml"><mi id="S3.SS2.SSS1.Px2.p1.6.m6.1.1.2.2" xref="S3.SS2.SSS1.Px2.p1.6.m6.1.1.2.2.cmml">k</mi><mo id="S3.SS2.SSS1.Px2.p1.6.m6.1.1.2.3" xref="S3.SS2.SSS1.Px2.p1.6.m6.1.1.2.3.cmml">′</mo></msup><mo id="S3.SS2.SSS1.Px2.p1.6.m6.1.1.1" xref="S3.SS2.SSS1.Px2.p1.6.m6.1.1.1.cmml">≪</mo><mi id="S3.SS2.SSS1.Px2.p1.6.m6.1.1.3" mathvariant="normal" xref="S3.SS2.SSS1.Px2.p1.6.m6.1.1.3.cmml">ℓ</mi></mrow><annotation-xml encoding="MathML-Content" id="S3.SS2.SSS1.Px2.p1.6.m6.1b"><apply id="S3.SS2.SSS1.Px2.p1.6.m6.1.1.cmml" xref="S3.SS2.SSS1.Px2.p1.6.m6.1.1"><csymbol cd="latexml" id="S3.SS2.SSS1.Px2.p1.6.m6.1.1.1.cmml" xref="S3.SS2.SSS1.Px2.p1.6.m6.1.1.1">much-less-than</csymbol><apply id="S3.SS2.SSS1.Px2.p1.6.m6.1.1.2.cmml" xref="S3.SS2.SSS1.Px2.p1.6.m6.1.1.2"><csymbol cd="ambiguous" id="S3.SS2.SSS1.Px2.p1.6.m6.1.1.2.1.cmml" xref="S3.SS2.SSS1.Px2.p1.6.m6.1.1.2">superscript</csymbol><ci id="S3.SS2.SSS1.Px2.p1.6.m6.1.1.2.2.cmml" xref="S3.SS2.SSS1.Px2.p1.6.m6.1.1.2.2">𝑘</ci><ci id="S3.SS2.SSS1.Px2.p1.6.m6.1.1.2.3.cmml" xref="S3.SS2.SSS1.Px2.p1.6.m6.1.1.2.3">′</ci></apply><ci id="S3.SS2.SSS1.Px2.p1.6.m6.1.1.3.cmml" xref="S3.SS2.SSS1.Px2.p1.6.m6.1.1.3">ℓ</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.SSS1.Px2.p1.6.m6.1c">k^{\prime}\ll\ell</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.SSS1.Px2.p1.6.m6.1d">italic_k start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT ≪ roman_ℓ</annotation></semantics></math>. Note that this does not require any training since we can just apply a standard quantization routine to <math alttext="{\mathbf{Z}}" class="ltx_Math" display="inline" id="S3.SS2.SSS1.Px2.p1.7.m7.1"><semantics id="S3.SS2.SSS1.Px2.p1.7.m7.1a"><mi id="S3.SS2.SSS1.Px2.p1.7.m7.1.1" xref="S3.SS2.SSS1.Px2.p1.7.m7.1.1.cmml">𝐙</mi><annotation-xml encoding="MathML-Content" id="S3.SS2.SSS1.Px2.p1.7.m7.1b"><ci id="S3.SS2.SSS1.Px2.p1.7.m7.1.1.cmml" xref="S3.SS2.SSS1.Px2.p1.7.m7.1.1">𝐙</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.SSS1.Px2.p1.7.m7.1c">{\mathbf{Z}}</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.SSS1.Px2.p1.7.m7.1d">bold_Z</annotation></semantics></math> to obtain <math alttext="{\mathbf{Z}_{\textrm{approx}}}" class="ltx_Math" display="inline" id="S3.SS2.SSS1.Px2.p1.8.m8.1"><semantics id="S3.SS2.SSS1.Px2.p1.8.m8.1a"><msub id="S3.SS2.SSS1.Px2.p1.8.m8.1.1" xref="S3.SS2.SSS1.Px2.p1.8.m8.1.1.cmml"><mi id="S3.SS2.SSS1.Px2.p1.8.m8.1.1.2" xref="S3.SS2.SSS1.Px2.p1.8.m8.1.1.2.cmml">𝐙</mi><mtext id="S3.SS2.SSS1.Px2.p1.8.m8.1.1.3" xref="S3.SS2.SSS1.Px2.p1.8.m8.1.1.3a.cmml">approx</mtext></msub><annotation-xml encoding="MathML-Content" id="S3.SS2.SSS1.Px2.p1.8.m8.1b"><apply id="S3.SS2.SSS1.Px2.p1.8.m8.1.1.cmml" xref="S3.SS2.SSS1.Px2.p1.8.m8.1.1"><csymbol cd="ambiguous" id="S3.SS2.SSS1.Px2.p1.8.m8.1.1.1.cmml" xref="S3.SS2.SSS1.Px2.p1.8.m8.1.1">subscript</csymbol><ci id="S3.SS2.SSS1.Px2.p1.8.m8.1.1.2.cmml" xref="S3.SS2.SSS1.Px2.p1.8.m8.1.1.2">𝐙</ci><ci id="S3.SS2.SSS1.Px2.p1.8.m8.1.1.3a.cmml" xref="S3.SS2.SSS1.Px2.p1.8.m8.1.1.3"><mtext id="S3.SS2.SSS1.Px2.p1.8.m8.1.1.3.cmml" mathsize="70%" xref="S3.SS2.SSS1.Px2.p1.8.m8.1.1.3">approx</mtext></ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.SSS1.Px2.p1.8.m8.1c">{\mathbf{Z}_{\textrm{approx}}}</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.SSS1.Px2.p1.8.m8.1d">bold_Z start_POSTSUBSCRIPT approx end_POSTSUBSCRIPT</annotation></semantics></math>. However, the potential gains are limited due to inherent limits on quantization.
Note that we can also combine both HiRE-LR and HiRE-Q to obtain further inference latency improvements.</p>
</div>
</section>
</section>
<section class="ltx_subsubsection" id="S3.SS2.SSS2">
<h4 class="ltx_title ltx_title_subsubsection">
<span class="ltx_tag ltx_tag_subsubsection">3.2.2 </span><math alttext="\textrm{DA-TOP-}k" class="ltx_Math" display="inline" id="S3.SS2.SSS2.1.m1.1"><semantics id="S3.SS2.SSS2.1.m1.1b"><mrow id="S3.SS2.SSS2.1.m1.1.1" xref="S3.SS2.SSS2.1.m1.1.1.cmml"><mtext id="S3.SS2.SSS2.1.m1.1.1.2" xref="S3.SS2.SSS2.1.m1.1.1.2a.cmml">DA-TOP-</mtext><mo id="S3.SS2.SSS2.1.m1.1.1.1" xref="S3.SS2.SSS2.1.m1.1.1.1.cmml">⁢</mo><mi id="S3.SS2.SSS2.1.m1.1.1.3" xref="S3.SS2.SSS2.1.m1.1.1.3.cmml">k</mi></mrow><annotation-xml encoding="MathML-Content" id="S3.SS2.SSS2.1.m1.1c"><apply id="S3.SS2.SSS2.1.m1.1.1.cmml" xref="S3.SS2.SSS2.1.m1.1.1"><times id="S3.SS2.SSS2.1.m1.1.1.1.cmml" xref="S3.SS2.SSS2.1.m1.1.1.1"></times><ci id="S3.SS2.SSS2.1.m1.1.1.2a.cmml" xref="S3.SS2.SSS2.1.m1.1.1.2"><mtext id="S3.SS2.SSS2.1.m1.1.1.2.cmml" xref="S3.SS2.SSS2.1.m1.1.1.2">DA-TOP-</mtext></ci><ci id="S3.SS2.SSS2.1.m1.1.1.3.cmml" xref="S3.SS2.SSS2.1.m1.1.1.3">𝑘</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.SSS2.1.m1.1d">\textrm{DA-TOP-}k</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.SSS2.1.m1.1e">DA-TOP- italic_k</annotation></semantics></math>: Multi-device serving with approximate distributed top-<math alttext="k" class="ltx_Math" display="inline" id="S3.SS2.SSS2.2.m2.1"><semantics id="S3.SS2.SSS2.2.m2.1b"><mi id="S3.SS2.SSS2.2.m2.1.1" xref="S3.SS2.SSS2.2.m2.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="S3.SS2.SSS2.2.m2.1c"><ci id="S3.SS2.SSS2.2.m2.1.1.cmml" xref="S3.SS2.SSS2.2.m2.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.SSS2.2.m2.1d">k</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.SSS2.2.m2.1e">italic_k</annotation></semantics></math> operation</h4>
<figure class="ltx_float ltx_float_algorithm ltx_framed_top" id="alg2">
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_float"><span class="ltx_text ltx_font_bold" id="alg2.2.1.1">Algorithm 2</span> </span> Pseudocode for HiRE with DA-TOP-k </figcaption>
<div class="ltx_listing ltx_listing" id="alg2.3">
<div class="ltx_listingline" id="alg2.l0">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg2.l0.1.1.1" style="font-size:80%;">0:</span></span>  <math alttext="\overrightarrow{\mathbf{x}},{\mathbf{Z}},{\mathbf{Z}_{\textrm{approx}}},k,k^{\prime}" class="ltx_Math" display="inline" id="alg2.l0.m1.5"><semantics id="alg2.l0.m1.5a"><mrow id="alg2.l0.m1.5.5.2" xref="alg2.l0.m1.5.5.3.cmml"><mover accent="true" id="alg2.l0.m1.1.1" xref="alg2.l0.m1.1.1.cmml"><mi id="alg2.l0.m1.1.1.2" xref="alg2.l0.m1.1.1.2.cmml">𝐱</mi><mo id="alg2.l0.m1.1.1.1" stretchy="false" xref="alg2.l0.m1.1.1.1.cmml">→</mo></mover><mo id="alg2.l0.m1.5.5.2.3" xref="alg2.l0.m1.5.5.3.cmml">,</mo><mi id="alg2.l0.m1.2.2" xref="alg2.l0.m1.2.2.cmml">𝐙</mi><mo id="alg2.l0.m1.5.5.2.4" xref="alg2.l0.m1.5.5.3.cmml">,</mo><msub id="alg2.l0.m1.4.4.1.1" xref="alg2.l0.m1.4.4.1.1.cmml"><mi id="alg2.l0.m1.4.4.1.1.2" xref="alg2.l0.m1.4.4.1.1.2.cmml">𝐙</mi><mtext id="alg2.l0.m1.4.4.1.1.3" xref="alg2.l0.m1.4.4.1.1.3a.cmml">approx</mtext></msub><mo id="alg2.l0.m1.5.5.2.5" xref="alg2.l0.m1.5.5.3.cmml">,</mo><mi id="alg2.l0.m1.3.3" xref="alg2.l0.m1.3.3.cmml">k</mi><mo id="alg2.l0.m1.5.5.2.6" xref="alg2.l0.m1.5.5.3.cmml">,</mo><msup id="alg2.l0.m1.5.5.2.2" xref="alg2.l0.m1.5.5.2.2.cmml"><mi id="alg2.l0.m1.5.5.2.2.2" xref="alg2.l0.m1.5.5.2.2.2.cmml">k</mi><mo id="alg2.l0.m1.5.5.2.2.3" xref="alg2.l0.m1.5.5.2.2.3.cmml">′</mo></msup></mrow><annotation-xml encoding="MathML-Content" id="alg2.l0.m1.5b"><list id="alg2.l0.m1.5.5.3.cmml" xref="alg2.l0.m1.5.5.2"><apply id="alg2.l0.m1.1.1.cmml" xref="alg2.l0.m1.1.1"><ci id="alg2.l0.m1.1.1.1.cmml" xref="alg2.l0.m1.1.1.1">→</ci><ci id="alg2.l0.m1.1.1.2.cmml" xref="alg2.l0.m1.1.1.2">𝐱</ci></apply><ci id="alg2.l0.m1.2.2.cmml" xref="alg2.l0.m1.2.2">𝐙</ci><apply id="alg2.l0.m1.4.4.1.1.cmml" xref="alg2.l0.m1.4.4.1.1"><csymbol cd="ambiguous" id="alg2.l0.m1.4.4.1.1.1.cmml" xref="alg2.l0.m1.4.4.1.1">subscript</csymbol><ci id="alg2.l0.m1.4.4.1.1.2.cmml" xref="alg2.l0.m1.4.4.1.1.2">𝐙</ci><ci id="alg2.l0.m1.4.4.1.1.3a.cmml" xref="alg2.l0.m1.4.4.1.1.3"><mtext id="alg2.l0.m1.4.4.1.1.3.cmml" mathsize="70%" xref="alg2.l0.m1.4.4.1.1.3">approx</mtext></ci></apply><ci id="alg2.l0.m1.3.3.cmml" xref="alg2.l0.m1.3.3">𝑘</ci><apply id="alg2.l0.m1.5.5.2.2.cmml" xref="alg2.l0.m1.5.5.2.2"><csymbol cd="ambiguous" id="alg2.l0.m1.5.5.2.2.1.cmml" xref="alg2.l0.m1.5.5.2.2">superscript</csymbol><ci id="alg2.l0.m1.5.5.2.2.2.cmml" xref="alg2.l0.m1.5.5.2.2.2">𝑘</ci><ci id="alg2.l0.m1.5.5.2.2.3.cmml" xref="alg2.l0.m1.5.5.2.2.3">′</ci></apply></list></annotation-xml><annotation encoding="application/x-tex" id="alg2.l0.m1.5c">\overrightarrow{\mathbf{x}},{\mathbf{Z}},{\mathbf{Z}_{\textrm{approx}}},k,k^{\prime}</annotation><annotation encoding="application/x-llamapun" id="alg2.l0.m1.5d">over→ start_ARG bold_x end_ARG , bold_Z , bold_Z start_POSTSUBSCRIPT approx end_POSTSUBSCRIPT , italic_k , italic_k start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT</annotation></semantics></math> with <math alttext="{\mathbf{Z}}" class="ltx_Math" display="inline" id="alg2.l0.m2.1"><semantics id="alg2.l0.m2.1a"><mi id="alg2.l0.m2.1.1" xref="alg2.l0.m2.1.1.cmml">𝐙</mi><annotation-xml encoding="MathML-Content" id="alg2.l0.m2.1b"><ci id="alg2.l0.m2.1.1.cmml" xref="alg2.l0.m2.1.1">𝐙</ci></annotation-xml><annotation encoding="application/x-tex" id="alg2.l0.m2.1c">{\mathbf{Z}}</annotation><annotation encoding="application/x-llamapun" id="alg2.l0.m2.1d">bold_Z</annotation></semantics></math> and <math alttext="{\mathbf{Z}_{\textrm{approx}}}" class="ltx_Math" display="inline" id="alg2.l0.m3.1"><semantics id="alg2.l0.m3.1a"><msub id="alg2.l0.m3.1.1" xref="alg2.l0.m3.1.1.cmml"><mi id="alg2.l0.m3.1.1.2" xref="alg2.l0.m3.1.1.2.cmml">𝐙</mi><mtext id="alg2.l0.m3.1.1.3" xref="alg2.l0.m3.1.1.3a.cmml">approx</mtext></msub><annotation-xml encoding="MathML-Content" id="alg2.l0.m3.1b"><apply id="alg2.l0.m3.1.1.cmml" xref="alg2.l0.m3.1.1"><csymbol cd="ambiguous" id="alg2.l0.m3.1.1.1.cmml" xref="alg2.l0.m3.1.1">subscript</csymbol><ci id="alg2.l0.m3.1.1.2.cmml" xref="alg2.l0.m3.1.1.2">𝐙</ci><ci id="alg2.l0.m3.1.1.3a.cmml" xref="alg2.l0.m3.1.1.3"><mtext id="alg2.l0.m3.1.1.3.cmml" mathsize="70%" xref="alg2.l0.m3.1.1.3">approx</mtext></ci></apply></annotation-xml><annotation encoding="application/x-tex" id="alg2.l0.m3.1c">{\mathbf{Z}_{\textrm{approx}}}</annotation><annotation encoding="application/x-llamapun" id="alg2.l0.m3.1d">bold_Z start_POSTSUBSCRIPT approx end_POSTSUBSCRIPT</annotation></semantics></math> distributed across <math alttext="s" class="ltx_Math" display="inline" id="alg2.l0.m4.1"><semantics id="alg2.l0.m4.1a"><mi id="alg2.l0.m4.1.1" xref="alg2.l0.m4.1.1.cmml">s</mi><annotation-xml encoding="MathML-Content" id="alg2.l0.m4.1b"><ci id="alg2.l0.m4.1.1.cmml" xref="alg2.l0.m4.1.1">𝑠</ci></annotation-xml><annotation encoding="application/x-tex" id="alg2.l0.m4.1c">s</annotation><annotation encoding="application/x-llamapun" id="alg2.l0.m4.1d">italic_s</annotation></semantics></math> machines.

</div>
<div class="ltx_listingline" id="alg2.l1">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg2.l1.1.1.1" style="font-size:80%;">1:</span></span>  On machine <math alttext="i\in[s]" class="ltx_Math" display="inline" id="alg2.l1.m1.1"><semantics id="alg2.l1.m1.1a"><mrow id="alg2.l1.m1.1.2" xref="alg2.l1.m1.1.2.cmml"><mi id="alg2.l1.m1.1.2.2" xref="alg2.l1.m1.1.2.2.cmml">i</mi><mo id="alg2.l1.m1.1.2.1" xref="alg2.l1.m1.1.2.1.cmml">∈</mo><mrow id="alg2.l1.m1.1.2.3.2" xref="alg2.l1.m1.1.2.3.1.cmml"><mo id="alg2.l1.m1.1.2.3.2.1" stretchy="false" xref="alg2.l1.m1.1.2.3.1.1.cmml">[</mo><mi id="alg2.l1.m1.1.1" xref="alg2.l1.m1.1.1.cmml">s</mi><mo id="alg2.l1.m1.1.2.3.2.2" stretchy="false" xref="alg2.l1.m1.1.2.3.1.1.cmml">]</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="alg2.l1.m1.1b"><apply id="alg2.l1.m1.1.2.cmml" xref="alg2.l1.m1.1.2"><in id="alg2.l1.m1.1.2.1.cmml" xref="alg2.l1.m1.1.2.1"></in><ci id="alg2.l1.m1.1.2.2.cmml" xref="alg2.l1.m1.1.2.2">𝑖</ci><apply id="alg2.l1.m1.1.2.3.1.cmml" xref="alg2.l1.m1.1.2.3.2"><csymbol cd="latexml" id="alg2.l1.m1.1.2.3.1.1.cmml" xref="alg2.l1.m1.1.2.3.2.1">delimited-[]</csymbol><ci id="alg2.l1.m1.1.1.cmml" xref="alg2.l1.m1.1.1">𝑠</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg2.l1.m1.1c">i\in[s]</annotation><annotation encoding="application/x-llamapun" id="alg2.l1.m1.1d">italic_i ∈ [ italic_s ]</annotation></semantics></math>: <math alttext="S^{\prime}_{i}\leftarrow\textrm{TopInd}_{\frac{k^{\prime}}{s}}\left(\phi\left(%
{\mathbf{Z}_{\textrm{approx}}}_{i}^{\top}{\overrightarrow{\mathbf{x}}}\right)\right)" class="ltx_Math" display="inline" id="alg2.l1.m2.1"><semantics id="alg2.l1.m2.1a"><mrow id="alg2.l1.m2.1.1" xref="alg2.l1.m2.1.1.cmml"><msubsup id="alg2.l1.m2.1.1.3" xref="alg2.l1.m2.1.1.3.cmml"><mi id="alg2.l1.m2.1.1.3.2.2" xref="alg2.l1.m2.1.1.3.2.2.cmml">S</mi><mi id="alg2.l1.m2.1.1.3.3" xref="alg2.l1.m2.1.1.3.3.cmml">i</mi><mo id="alg2.l1.m2.1.1.3.2.3" xref="alg2.l1.m2.1.1.3.2.3.cmml">′</mo></msubsup><mo id="alg2.l1.m2.1.1.2" stretchy="false" xref="alg2.l1.m2.1.1.2.cmml">←</mo><mrow id="alg2.l1.m2.1.1.1" xref="alg2.l1.m2.1.1.1.cmml"><msub id="alg2.l1.m2.1.1.1.3" xref="alg2.l1.m2.1.1.1.3.cmml"><mtext id="alg2.l1.m2.1.1.1.3.2" xref="alg2.l1.m2.1.1.1.3.2a.cmml">TopInd</mtext><mfrac id="alg2.l1.m2.1.1.1.3.3" xref="alg2.l1.m2.1.1.1.3.3.cmml"><msup id="alg2.l1.m2.1.1.1.3.3.2" xref="alg2.l1.m2.1.1.1.3.3.2.cmml"><mi id="alg2.l1.m2.1.1.1.3.3.2.2" xref="alg2.l1.m2.1.1.1.3.3.2.2.cmml">k</mi><mo id="alg2.l1.m2.1.1.1.3.3.2.3" xref="alg2.l1.m2.1.1.1.3.3.2.3.cmml">′</mo></msup><mi id="alg2.l1.m2.1.1.1.3.3.3" xref="alg2.l1.m2.1.1.1.3.3.3.cmml">s</mi></mfrac></msub><mo id="alg2.l1.m2.1.1.1.2" xref="alg2.l1.m2.1.1.1.2.cmml">⁢</mo><mrow id="alg2.l1.m2.1.1.1.1.1" xref="alg2.l1.m2.1.1.1.1.1.1.cmml"><mo id="alg2.l1.m2.1.1.1.1.1.2" xref="alg2.l1.m2.1.1.1.1.1.1.cmml">(</mo><mrow id="alg2.l1.m2.1.1.1.1.1.1" xref="alg2.l1.m2.1.1.1.1.1.1.cmml"><mi id="alg2.l1.m2.1.1.1.1.1.1.3" xref="alg2.l1.m2.1.1.1.1.1.1.3.cmml">ϕ</mi><mo id="alg2.l1.m2.1.1.1.1.1.1.2" xref="alg2.l1.m2.1.1.1.1.1.1.2.cmml">⁢</mo><mrow id="alg2.l1.m2.1.1.1.1.1.1.1.1" xref="alg2.l1.m2.1.1.1.1.1.1.1.1.1.cmml"><mo id="alg2.l1.m2.1.1.1.1.1.1.1.1.2" xref="alg2.l1.m2.1.1.1.1.1.1.1.1.1.cmml">(</mo><mrow id="alg2.l1.m2.1.1.1.1.1.1.1.1.1" xref="alg2.l1.m2.1.1.1.1.1.1.1.1.1.cmml"><mmultiscripts id="alg2.l1.m2.1.1.1.1.1.1.1.1.1.2" xref="alg2.l1.m2.1.1.1.1.1.1.1.1.1.2.cmml"><mi id="alg2.l1.m2.1.1.1.1.1.1.1.1.1.2.2.2.2" xref="alg2.l1.m2.1.1.1.1.1.1.1.1.1.2.2.2.2.cmml">𝐙</mi><mtext id="alg2.l1.m2.1.1.1.1.1.1.1.1.1.2.2.2.3" xref="alg2.l1.m2.1.1.1.1.1.1.1.1.1.2.2.2.3a.cmml">approx</mtext><mrow id="alg2.l1.m2.1.1.1.1.1.1.1.1.1.2a" xref="alg2.l1.m2.1.1.1.1.1.1.1.1.1.2.cmml"></mrow><mi id="alg2.l1.m2.1.1.1.1.1.1.1.1.1.2.2.3" xref="alg2.l1.m2.1.1.1.1.1.1.1.1.1.2.2.3.cmml">i</mi><mo id="alg2.l1.m2.1.1.1.1.1.1.1.1.1.2.3" xref="alg2.l1.m2.1.1.1.1.1.1.1.1.1.2.3.cmml">⊤</mo></mmultiscripts><mo id="alg2.l1.m2.1.1.1.1.1.1.1.1.1.1" xref="alg2.l1.m2.1.1.1.1.1.1.1.1.1.1.cmml">⁢</mo><mover accent="true" id="alg2.l1.m2.1.1.1.1.1.1.1.1.1.3" xref="alg2.l1.m2.1.1.1.1.1.1.1.1.1.3.cmml"><mi id="alg2.l1.m2.1.1.1.1.1.1.1.1.1.3.2" xref="alg2.l1.m2.1.1.1.1.1.1.1.1.1.3.2.cmml">𝐱</mi><mo id="alg2.l1.m2.1.1.1.1.1.1.1.1.1.3.1" stretchy="false" xref="alg2.l1.m2.1.1.1.1.1.1.1.1.1.3.1.cmml">→</mo></mover></mrow><mo id="alg2.l1.m2.1.1.1.1.1.1.1.1.3" xref="alg2.l1.m2.1.1.1.1.1.1.1.1.1.cmml">)</mo></mrow></mrow><mo id="alg2.l1.m2.1.1.1.1.1.3" xref="alg2.l1.m2.1.1.1.1.1.1.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="alg2.l1.m2.1b"><apply id="alg2.l1.m2.1.1.cmml" xref="alg2.l1.m2.1.1"><ci id="alg2.l1.m2.1.1.2.cmml" xref="alg2.l1.m2.1.1.2">←</ci><apply id="alg2.l1.m2.1.1.3.cmml" xref="alg2.l1.m2.1.1.3"><csymbol cd="ambiguous" id="alg2.l1.m2.1.1.3.1.cmml" xref="alg2.l1.m2.1.1.3">subscript</csymbol><apply id="alg2.l1.m2.1.1.3.2.cmml" xref="alg2.l1.m2.1.1.3"><csymbol cd="ambiguous" id="alg2.l1.m2.1.1.3.2.1.cmml" xref="alg2.l1.m2.1.1.3">superscript</csymbol><ci id="alg2.l1.m2.1.1.3.2.2.cmml" xref="alg2.l1.m2.1.1.3.2.2">𝑆</ci><ci id="alg2.l1.m2.1.1.3.2.3.cmml" xref="alg2.l1.m2.1.1.3.2.3">′</ci></apply><ci id="alg2.l1.m2.1.1.3.3.cmml" xref="alg2.l1.m2.1.1.3.3">𝑖</ci></apply><apply id="alg2.l1.m2.1.1.1.cmml" xref="alg2.l1.m2.1.1.1"><times id="alg2.l1.m2.1.1.1.2.cmml" xref="alg2.l1.m2.1.1.1.2"></times><apply id="alg2.l1.m2.1.1.1.3.cmml" xref="alg2.l1.m2.1.1.1.3"><csymbol cd="ambiguous" id="alg2.l1.m2.1.1.1.3.1.cmml" xref="alg2.l1.m2.1.1.1.3">subscript</csymbol><ci id="alg2.l1.m2.1.1.1.3.2a.cmml" xref="alg2.l1.m2.1.1.1.3.2"><mtext id="alg2.l1.m2.1.1.1.3.2.cmml" xref="alg2.l1.m2.1.1.1.3.2">TopInd</mtext></ci><apply id="alg2.l1.m2.1.1.1.3.3.cmml" xref="alg2.l1.m2.1.1.1.3.3"><divide id="alg2.l1.m2.1.1.1.3.3.1.cmml" xref="alg2.l1.m2.1.1.1.3.3"></divide><apply id="alg2.l1.m2.1.1.1.3.3.2.cmml" xref="alg2.l1.m2.1.1.1.3.3.2"><csymbol cd="ambiguous" id="alg2.l1.m2.1.1.1.3.3.2.1.cmml" xref="alg2.l1.m2.1.1.1.3.3.2">superscript</csymbol><ci id="alg2.l1.m2.1.1.1.3.3.2.2.cmml" xref="alg2.l1.m2.1.1.1.3.3.2.2">𝑘</ci><ci id="alg2.l1.m2.1.1.1.3.3.2.3.cmml" xref="alg2.l1.m2.1.1.1.3.3.2.3">′</ci></apply><ci id="alg2.l1.m2.1.1.1.3.3.3.cmml" xref="alg2.l1.m2.1.1.1.3.3.3">𝑠</ci></apply></apply><apply id="alg2.l1.m2.1.1.1.1.1.1.cmml" xref="alg2.l1.m2.1.1.1.1.1"><times id="alg2.l1.m2.1.1.1.1.1.1.2.cmml" xref="alg2.l1.m2.1.1.1.1.1.1.2"></times><ci id="alg2.l1.m2.1.1.1.1.1.1.3.cmml" xref="alg2.l1.m2.1.1.1.1.1.1.3">italic-ϕ</ci><apply id="alg2.l1.m2.1.1.1.1.1.1.1.1.1.cmml" xref="alg2.l1.m2.1.1.1.1.1.1.1.1"><times id="alg2.l1.m2.1.1.1.1.1.1.1.1.1.1.cmml" xref="alg2.l1.m2.1.1.1.1.1.1.1.1.1.1"></times><apply id="alg2.l1.m2.1.1.1.1.1.1.1.1.1.2.cmml" xref="alg2.l1.m2.1.1.1.1.1.1.1.1.1.2"><csymbol cd="ambiguous" id="alg2.l1.m2.1.1.1.1.1.1.1.1.1.2.1.cmml" xref="alg2.l1.m2.1.1.1.1.1.1.1.1.1.2">superscript</csymbol><apply id="alg2.l1.m2.1.1.1.1.1.1.1.1.1.2.2.cmml" xref="alg2.l1.m2.1.1.1.1.1.1.1.1.1.2"><csymbol cd="ambiguous" id="alg2.l1.m2.1.1.1.1.1.1.1.1.1.2.2.1.cmml" xref="alg2.l1.m2.1.1.1.1.1.1.1.1.1.2">subscript</csymbol><apply id="alg2.l1.m2.1.1.1.1.1.1.1.1.1.2.2.2.cmml" xref="alg2.l1.m2.1.1.1.1.1.1.1.1.1.2"><csymbol cd="ambiguous" id="alg2.l1.m2.1.1.1.1.1.1.1.1.1.2.2.2.1.cmml" xref="alg2.l1.m2.1.1.1.1.1.1.1.1.1.2">subscript</csymbol><ci id="alg2.l1.m2.1.1.1.1.1.1.1.1.1.2.2.2.2.cmml" xref="alg2.l1.m2.1.1.1.1.1.1.1.1.1.2.2.2.2">𝐙</ci><ci id="alg2.l1.m2.1.1.1.1.1.1.1.1.1.2.2.2.3a.cmml" xref="alg2.l1.m2.1.1.1.1.1.1.1.1.1.2.2.2.3"><mtext id="alg2.l1.m2.1.1.1.1.1.1.1.1.1.2.2.2.3.cmml" mathsize="70%" xref="alg2.l1.m2.1.1.1.1.1.1.1.1.1.2.2.2.3">approx</mtext></ci></apply><ci id="alg2.l1.m2.1.1.1.1.1.1.1.1.1.2.2.3.cmml" xref="alg2.l1.m2.1.1.1.1.1.1.1.1.1.2.2.3">𝑖</ci></apply><csymbol cd="latexml" id="alg2.l1.m2.1.1.1.1.1.1.1.1.1.2.3.cmml" xref="alg2.l1.m2.1.1.1.1.1.1.1.1.1.2.3">top</csymbol></apply><apply id="alg2.l1.m2.1.1.1.1.1.1.1.1.1.3.cmml" xref="alg2.l1.m2.1.1.1.1.1.1.1.1.1.3"><ci id="alg2.l1.m2.1.1.1.1.1.1.1.1.1.3.1.cmml" xref="alg2.l1.m2.1.1.1.1.1.1.1.1.1.3.1">→</ci><ci id="alg2.l1.m2.1.1.1.1.1.1.1.1.1.3.2.cmml" xref="alg2.l1.m2.1.1.1.1.1.1.1.1.1.3.2">𝐱</ci></apply></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg2.l1.m2.1c">S^{\prime}_{i}\leftarrow\textrm{TopInd}_{\frac{k^{\prime}}{s}}\left(\phi\left(%
{\mathbf{Z}_{\textrm{approx}}}_{i}^{\top}{\overrightarrow{\mathbf{x}}}\right)\right)</annotation><annotation encoding="application/x-llamapun" id="alg2.l1.m2.1d">italic_S start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT ← TopInd start_POSTSUBSCRIPT divide start_ARG italic_k start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT end_ARG start_ARG italic_s end_ARG end_POSTSUBSCRIPT ( italic_ϕ ( bold_Z start_POSTSUBSCRIPT approx end_POSTSUBSCRIPT start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT start_POSTSUPERSCRIPT ⊤ end_POSTSUPERSCRIPT over→ start_ARG bold_x end_ARG ) )</annotation></semantics></math> {Top-<math alttext="\frac{k^{\prime}}{s}" class="ltx_Math" display="inline" id="alg2.l1.m3.1"><semantics id="alg2.l1.m3.1a"><mfrac id="alg2.l1.m3.1.1" xref="alg2.l1.m3.1.1.cmml"><msup id="alg2.l1.m3.1.1.2" xref="alg2.l1.m3.1.1.2.cmml"><mi id="alg2.l1.m3.1.1.2.2" xref="alg2.l1.m3.1.1.2.2.cmml">k</mi><mo id="alg2.l1.m3.1.1.2.3" xref="alg2.l1.m3.1.1.2.3.cmml">′</mo></msup><mi id="alg2.l1.m3.1.1.3" xref="alg2.l1.m3.1.1.3.cmml">s</mi></mfrac><annotation-xml encoding="MathML-Content" id="alg2.l1.m3.1b"><apply id="alg2.l1.m3.1.1.cmml" xref="alg2.l1.m3.1.1"><divide id="alg2.l1.m3.1.1.1.cmml" xref="alg2.l1.m3.1.1"></divide><apply id="alg2.l1.m3.1.1.2.cmml" xref="alg2.l1.m3.1.1.2"><csymbol cd="ambiguous" id="alg2.l1.m3.1.1.2.1.cmml" xref="alg2.l1.m3.1.1.2">superscript</csymbol><ci id="alg2.l1.m3.1.1.2.2.cmml" xref="alg2.l1.m3.1.1.2.2">𝑘</ci><ci id="alg2.l1.m3.1.1.2.3.cmml" xref="alg2.l1.m3.1.1.2.3">′</ci></apply><ci id="alg2.l1.m3.1.1.3.cmml" xref="alg2.l1.m3.1.1.3">𝑠</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="alg2.l1.m3.1c">\frac{k^{\prime}}{s}</annotation><annotation encoding="application/x-llamapun" id="alg2.l1.m3.1d">divide start_ARG italic_k start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT end_ARG start_ARG italic_s end_ARG</annotation></semantics></math> indices of <math alttext="\phi\left({\mathbf{Z}_{\textrm{approx}}}_{i}^{\top}{\overrightarrow{\mathbf{x}%
}}\right)" class="ltx_Math" display="inline" id="alg2.l1.m4.1"><semantics id="alg2.l1.m4.1a"><mrow id="alg2.l1.m4.1.1" xref="alg2.l1.m4.1.1.cmml"><mi id="alg2.l1.m4.1.1.3" xref="alg2.l1.m4.1.1.3.cmml">ϕ</mi><mo id="alg2.l1.m4.1.1.2" xref="alg2.l1.m4.1.1.2.cmml">⁢</mo><mrow id="alg2.l1.m4.1.1.1.1" xref="alg2.l1.m4.1.1.1.1.1.cmml"><mo id="alg2.l1.m4.1.1.1.1.2" xref="alg2.l1.m4.1.1.1.1.1.cmml">(</mo><mrow id="alg2.l1.m4.1.1.1.1.1" xref="alg2.l1.m4.1.1.1.1.1.cmml"><mmultiscripts id="alg2.l1.m4.1.1.1.1.1.2" xref="alg2.l1.m4.1.1.1.1.1.2.cmml"><mi id="alg2.l1.m4.1.1.1.1.1.2.2.2.2" xref="alg2.l1.m4.1.1.1.1.1.2.2.2.2.cmml">𝐙</mi><mtext id="alg2.l1.m4.1.1.1.1.1.2.2.2.3" xref="alg2.l1.m4.1.1.1.1.1.2.2.2.3a.cmml">approx</mtext><mrow id="alg2.l1.m4.1.1.1.1.1.2a" xref="alg2.l1.m4.1.1.1.1.1.2.cmml"></mrow><mi id="alg2.l1.m4.1.1.1.1.1.2.2.3" xref="alg2.l1.m4.1.1.1.1.1.2.2.3.cmml">i</mi><mo id="alg2.l1.m4.1.1.1.1.1.2.3" xref="alg2.l1.m4.1.1.1.1.1.2.3.cmml">⊤</mo></mmultiscripts><mo id="alg2.l1.m4.1.1.1.1.1.1" xref="alg2.l1.m4.1.1.1.1.1.1.cmml">⁢</mo><mover accent="true" id="alg2.l1.m4.1.1.1.1.1.3" xref="alg2.l1.m4.1.1.1.1.1.3.cmml"><mi id="alg2.l1.m4.1.1.1.1.1.3.2" xref="alg2.l1.m4.1.1.1.1.1.3.2.cmml">𝐱</mi><mo id="alg2.l1.m4.1.1.1.1.1.3.1" stretchy="false" xref="alg2.l1.m4.1.1.1.1.1.3.1.cmml">→</mo></mover></mrow><mo id="alg2.l1.m4.1.1.1.1.3" xref="alg2.l1.m4.1.1.1.1.1.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="alg2.l1.m4.1b"><apply id="alg2.l1.m4.1.1.cmml" xref="alg2.l1.m4.1.1"><times id="alg2.l1.m4.1.1.2.cmml" xref="alg2.l1.m4.1.1.2"></times><ci id="alg2.l1.m4.1.1.3.cmml" xref="alg2.l1.m4.1.1.3">italic-ϕ</ci><apply id="alg2.l1.m4.1.1.1.1.1.cmml" xref="alg2.l1.m4.1.1.1.1"><times id="alg2.l1.m4.1.1.1.1.1.1.cmml" xref="alg2.l1.m4.1.1.1.1.1.1"></times><apply id="alg2.l1.m4.1.1.1.1.1.2.cmml" xref="alg2.l1.m4.1.1.1.1.1.2"><csymbol cd="ambiguous" id="alg2.l1.m4.1.1.1.1.1.2.1.cmml" xref="alg2.l1.m4.1.1.1.1.1.2">superscript</csymbol><apply id="alg2.l1.m4.1.1.1.1.1.2.2.cmml" xref="alg2.l1.m4.1.1.1.1.1.2"><csymbol cd="ambiguous" id="alg2.l1.m4.1.1.1.1.1.2.2.1.cmml" xref="alg2.l1.m4.1.1.1.1.1.2">subscript</csymbol><apply id="alg2.l1.m4.1.1.1.1.1.2.2.2.cmml" xref="alg2.l1.m4.1.1.1.1.1.2"><csymbol cd="ambiguous" id="alg2.l1.m4.1.1.1.1.1.2.2.2.1.cmml" xref="alg2.l1.m4.1.1.1.1.1.2">subscript</csymbol><ci id="alg2.l1.m4.1.1.1.1.1.2.2.2.2.cmml" xref="alg2.l1.m4.1.1.1.1.1.2.2.2.2">𝐙</ci><ci id="alg2.l1.m4.1.1.1.1.1.2.2.2.3a.cmml" xref="alg2.l1.m4.1.1.1.1.1.2.2.2.3"><mtext id="alg2.l1.m4.1.1.1.1.1.2.2.2.3.cmml" mathsize="70%" xref="alg2.l1.m4.1.1.1.1.1.2.2.2.3">approx</mtext></ci></apply><ci id="alg2.l1.m4.1.1.1.1.1.2.2.3.cmml" xref="alg2.l1.m4.1.1.1.1.1.2.2.3">𝑖</ci></apply><csymbol cd="latexml" id="alg2.l1.m4.1.1.1.1.1.2.3.cmml" xref="alg2.l1.m4.1.1.1.1.1.2.3">top</csymbol></apply><apply id="alg2.l1.m4.1.1.1.1.1.3.cmml" xref="alg2.l1.m4.1.1.1.1.1.3"><ci id="alg2.l1.m4.1.1.1.1.1.3.1.cmml" xref="alg2.l1.m4.1.1.1.1.1.3.1">→</ci><ci id="alg2.l1.m4.1.1.1.1.1.3.2.cmml" xref="alg2.l1.m4.1.1.1.1.1.3.2">𝐱</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg2.l1.m4.1c">\phi\left({\mathbf{Z}_{\textrm{approx}}}_{i}^{\top}{\overrightarrow{\mathbf{x}%
}}\right)</annotation><annotation encoding="application/x-llamapun" id="alg2.l1.m4.1d">italic_ϕ ( bold_Z start_POSTSUBSCRIPT approx end_POSTSUBSCRIPT start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT start_POSTSUPERSCRIPT ⊤ end_POSTSUPERSCRIPT over→ start_ARG bold_x end_ARG )</annotation></semantics></math> on machine <math alttext="i" class="ltx_Math" display="inline" id="alg2.l1.m5.1"><semantics id="alg2.l1.m5.1a"><mi id="alg2.l1.m5.1.1" xref="alg2.l1.m5.1.1.cmml">i</mi><annotation-xml encoding="MathML-Content" id="alg2.l1.m5.1b"><ci id="alg2.l1.m5.1.1.cmml" xref="alg2.l1.m5.1.1">𝑖</ci></annotation-xml><annotation encoding="application/x-tex" id="alg2.l1.m5.1c">i</annotation><annotation encoding="application/x-llamapun" id="alg2.l1.m5.1d">italic_i</annotation></semantics></math>.}

</div>
<div class="ltx_listingline" id="alg2.l2">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg2.l2.1.1.1" style="font-size:80%;">2:</span></span>  <math alttext="\overrightarrow{\mathbf{y}}_{i}\leftarrow{\textrm{Top}_{\frac{k}{s}}\left({%
\mathbf{Z}}|_{S^{\prime}}^{\top}\overrightarrow{\mathbf{x}}\right)}" class="ltx_Math" display="inline" id="alg2.l2.m1.4"><semantics id="alg2.l2.m1.4a"><mrow id="alg2.l2.m1.4.4" xref="alg2.l2.m1.4.4.cmml"><msub id="alg2.l2.m1.4.4.3" xref="alg2.l2.m1.4.4.3.cmml"><mover accent="true" id="alg2.l2.m1.4.4.3.2" xref="alg2.l2.m1.4.4.3.2.cmml"><mi id="alg2.l2.m1.4.4.3.2.2" xref="alg2.l2.m1.4.4.3.2.2.cmml">𝐲</mi><mo id="alg2.l2.m1.4.4.3.2.1" stretchy="false" xref="alg2.l2.m1.4.4.3.2.1.cmml">→</mo></mover><mi id="alg2.l2.m1.4.4.3.3" xref="alg2.l2.m1.4.4.3.3.cmml">i</mi></msub><mo id="alg2.l2.m1.4.4.2" stretchy="false" xref="alg2.l2.m1.4.4.2.cmml">←</mo><mrow id="alg2.l2.m1.4.4.1" xref="alg2.l2.m1.4.4.1.cmml"><msub id="alg2.l2.m1.4.4.1.3" xref="alg2.l2.m1.4.4.1.3.cmml"><mtext id="alg2.l2.m1.4.4.1.3.2" xref="alg2.l2.m1.4.4.1.3.2a.cmml">Top</mtext><mfrac id="alg2.l2.m1.4.4.1.3.3" xref="alg2.l2.m1.4.4.1.3.3.cmml"><mi id="alg2.l2.m1.4.4.1.3.3.2" xref="alg2.l2.m1.4.4.1.3.3.2.cmml">k</mi><mi id="alg2.l2.m1.4.4.1.3.3.3" xref="alg2.l2.m1.4.4.1.3.3.3.cmml">s</mi></mfrac></msub><mo id="alg2.l2.m1.4.4.1.2" xref="alg2.l2.m1.4.4.1.2.cmml">⁢</mo><mrow id="alg2.l2.m1.4.4.1.1.1" xref="alg2.l2.m1.4.4.1.1.1.1.cmml"><mo id="alg2.l2.m1.4.4.1.1.1.2" xref="alg2.l2.m1.4.4.1.1.1.1.cmml">(</mo><mrow id="alg2.l2.m1.4.4.1.1.1.1" xref="alg2.l2.m1.4.4.1.1.1.1.cmml"><msubsup id="alg2.l2.m1.4.4.1.1.1.1.2.2" xref="alg2.l2.m1.4.4.1.1.1.1.2.1.cmml"><mrow id="alg2.l2.m1.4.4.1.1.1.1.2.2.2.2" xref="alg2.l2.m1.4.4.1.1.1.1.2.1.cmml"><mi id="alg2.l2.m1.1.1" xref="alg2.l2.m1.1.1.cmml">𝐙</mi><mo id="alg2.l2.m1.4.4.1.1.1.1.2.2.2.2.1" stretchy="false" xref="alg2.l2.m1.4.4.1.1.1.1.2.1.1.cmml">|</mo></mrow><msup id="alg2.l2.m1.2.2.1" xref="alg2.l2.m1.2.2.1.cmml"><mi id="alg2.l2.m1.2.2.1.2" xref="alg2.l2.m1.2.2.1.2.cmml">S</mi><mo id="alg2.l2.m1.2.2.1.3" xref="alg2.l2.m1.2.2.1.3.cmml">′</mo></msup><mo id="alg2.l2.m1.3.3.1" xref="alg2.l2.m1.3.3.1.cmml">⊤</mo></msubsup><mo id="alg2.l2.m1.4.4.1.1.1.1.1" xref="alg2.l2.m1.4.4.1.1.1.1.1.cmml">⁢</mo><mover accent="true" id="alg2.l2.m1.4.4.1.1.1.1.3" xref="alg2.l2.m1.4.4.1.1.1.1.3.cmml"><mi id="alg2.l2.m1.4.4.1.1.1.1.3.2" xref="alg2.l2.m1.4.4.1.1.1.1.3.2.cmml">𝐱</mi><mo id="alg2.l2.m1.4.4.1.1.1.1.3.1" stretchy="false" xref="alg2.l2.m1.4.4.1.1.1.1.3.1.cmml">→</mo></mover></mrow><mo id="alg2.l2.m1.4.4.1.1.1.3" xref="alg2.l2.m1.4.4.1.1.1.1.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="alg2.l2.m1.4b"><apply id="alg2.l2.m1.4.4.cmml" xref="alg2.l2.m1.4.4"><ci id="alg2.l2.m1.4.4.2.cmml" xref="alg2.l2.m1.4.4.2">←</ci><apply id="alg2.l2.m1.4.4.3.cmml" xref="alg2.l2.m1.4.4.3"><csymbol cd="ambiguous" id="alg2.l2.m1.4.4.3.1.cmml" xref="alg2.l2.m1.4.4.3">subscript</csymbol><apply id="alg2.l2.m1.4.4.3.2.cmml" xref="alg2.l2.m1.4.4.3.2"><ci id="alg2.l2.m1.4.4.3.2.1.cmml" xref="alg2.l2.m1.4.4.3.2.1">→</ci><ci id="alg2.l2.m1.4.4.3.2.2.cmml" xref="alg2.l2.m1.4.4.3.2.2">𝐲</ci></apply><ci id="alg2.l2.m1.4.4.3.3.cmml" xref="alg2.l2.m1.4.4.3.3">𝑖</ci></apply><apply id="alg2.l2.m1.4.4.1.cmml" xref="alg2.l2.m1.4.4.1"><times id="alg2.l2.m1.4.4.1.2.cmml" xref="alg2.l2.m1.4.4.1.2"></times><apply id="alg2.l2.m1.4.4.1.3.cmml" xref="alg2.l2.m1.4.4.1.3"><csymbol cd="ambiguous" id="alg2.l2.m1.4.4.1.3.1.cmml" xref="alg2.l2.m1.4.4.1.3">subscript</csymbol><ci id="alg2.l2.m1.4.4.1.3.2a.cmml" xref="alg2.l2.m1.4.4.1.3.2"><mtext id="alg2.l2.m1.4.4.1.3.2.cmml" xref="alg2.l2.m1.4.4.1.3.2">Top</mtext></ci><apply id="alg2.l2.m1.4.4.1.3.3.cmml" xref="alg2.l2.m1.4.4.1.3.3"><divide id="alg2.l2.m1.4.4.1.3.3.1.cmml" xref="alg2.l2.m1.4.4.1.3.3"></divide><ci id="alg2.l2.m1.4.4.1.3.3.2.cmml" xref="alg2.l2.m1.4.4.1.3.3.2">𝑘</ci><ci id="alg2.l2.m1.4.4.1.3.3.3.cmml" xref="alg2.l2.m1.4.4.1.3.3.3">𝑠</ci></apply></apply><apply id="alg2.l2.m1.4.4.1.1.1.1.cmml" xref="alg2.l2.m1.4.4.1.1.1"><times id="alg2.l2.m1.4.4.1.1.1.1.1.cmml" xref="alg2.l2.m1.4.4.1.1.1.1.1"></times><apply id="alg2.l2.m1.4.4.1.1.1.1.2.1.cmml" xref="alg2.l2.m1.4.4.1.1.1.1.2.2"><csymbol cd="latexml" id="alg2.l2.m1.4.4.1.1.1.1.2.1.1.cmml" xref="alg2.l2.m1.4.4.1.1.1.1.2.2.2.2.1">evaluated-at</csymbol><ci id="alg2.l2.m1.1.1.cmml" xref="alg2.l2.m1.1.1">𝐙</ci><apply id="alg2.l2.m1.2.2.1.cmml" xref="alg2.l2.m1.2.2.1"><csymbol cd="ambiguous" id="alg2.l2.m1.2.2.1.1.cmml" xref="alg2.l2.m1.2.2.1">superscript</csymbol><ci id="alg2.l2.m1.2.2.1.2.cmml" xref="alg2.l2.m1.2.2.1.2">𝑆</ci><ci id="alg2.l2.m1.2.2.1.3.cmml" xref="alg2.l2.m1.2.2.1.3">′</ci></apply><csymbol cd="latexml" id="alg2.l2.m1.3.3.1.cmml" xref="alg2.l2.m1.3.3.1">top</csymbol></apply><apply id="alg2.l2.m1.4.4.1.1.1.1.3.cmml" xref="alg2.l2.m1.4.4.1.1.1.1.3"><ci id="alg2.l2.m1.4.4.1.1.1.1.3.1.cmml" xref="alg2.l2.m1.4.4.1.1.1.1.3.1">→</ci><ci id="alg2.l2.m1.4.4.1.1.1.1.3.2.cmml" xref="alg2.l2.m1.4.4.1.1.1.1.3.2">𝐱</ci></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg2.l2.m1.4c">\overrightarrow{\mathbf{y}}_{i}\leftarrow{\textrm{Top}_{\frac{k}{s}}\left({%
\mathbf{Z}}|_{S^{\prime}}^{\top}\overrightarrow{\mathbf{x}}\right)}</annotation><annotation encoding="application/x-llamapun" id="alg2.l2.m1.4d">over→ start_ARG bold_y end_ARG start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT ← Top start_POSTSUBSCRIPT divide start_ARG italic_k end_ARG start_ARG italic_s end_ARG end_POSTSUBSCRIPT ( bold_Z | start_POSTSUBSCRIPT italic_S start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT end_POSTSUBSCRIPT start_POSTSUPERSCRIPT ⊤ end_POSTSUPERSCRIPT over→ start_ARG bold_x end_ARG )</annotation></semantics></math>
</div>
<div class="ltx_listingline" id="alg2.l3">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg2.l3.1.1.1" style="font-size:80%;">3:</span></span>  <math alttext="y\leftarrow\textrm{Concat}(y_{i}:i\in[s])" class="ltx_math_unparsed" display="inline" id="alg2.l3.m1.1"><semantics id="alg2.l3.m1.1a"><mrow id="alg2.l3.m1.1b"><mi id="alg2.l3.m1.1.1">y</mi><mo id="alg2.l3.m1.1.2" stretchy="false">←</mo><mtext id="alg2.l3.m1.1.3">Concat</mtext><mrow id="alg2.l3.m1.1.4"><mo id="alg2.l3.m1.1.4.1" stretchy="false">(</mo><msub id="alg2.l3.m1.1.4.2"><mi id="alg2.l3.m1.1.4.2.2">y</mi><mi id="alg2.l3.m1.1.4.2.3">i</mi></msub><mo id="alg2.l3.m1.1.4.3" lspace="0.278em" rspace="0.278em">:</mo><mi id="alg2.l3.m1.1.4.4">i</mi><mo id="alg2.l3.m1.1.4.5">∈</mo><mrow id="alg2.l3.m1.1.4.6"><mo id="alg2.l3.m1.1.4.6.1" stretchy="false">[</mo><mi id="alg2.l3.m1.1.4.6.2">s</mi><mo id="alg2.l3.m1.1.4.6.3" stretchy="false">]</mo></mrow><mo id="alg2.l3.m1.1.4.7" stretchy="false">)</mo></mrow></mrow><annotation encoding="application/x-tex" id="alg2.l3.m1.1c">y\leftarrow\textrm{Concat}(y_{i}:i\in[s])</annotation><annotation encoding="application/x-llamapun" id="alg2.l3.m1.1d">italic_y ← Concat ( italic_y start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT : italic_i ∈ [ italic_s ] )</annotation></semantics></math>.

</div>
<div class="ltx_listingline" id="alg2.l3a">
<span class="ltx_tag ltx_tag_listingline"><span class="ltx_text" id="alg2.l3a.1.1.1" style="font-size:80%;">3:</span></span>  <math alttext="\overrightarrow{\mathbf{y}}" class="ltx_Math" display="inline" id="alg2.l3a.m1.1"><semantics id="alg2.l3a.m1.1a"><mover accent="true" id="alg2.l3a.m1.1.1" xref="alg2.l3a.m1.1.1.cmml"><mi id="alg2.l3a.m1.1.1.2" xref="alg2.l3a.m1.1.1.2.cmml">𝐲</mi><mo id="alg2.l3a.m1.1.1.1" stretchy="false" xref="alg2.l3a.m1.1.1.1.cmml">→</mo></mover><annotation-xml encoding="MathML-Content" id="alg2.l3a.m1.1b"><apply id="alg2.l3a.m1.1.1.cmml" xref="alg2.l3a.m1.1.1"><ci id="alg2.l3a.m1.1.1.1.cmml" xref="alg2.l3a.m1.1.1.1">→</ci><ci id="alg2.l3a.m1.1.1.2.cmml" xref="alg2.l3a.m1.1.1.2">𝐲</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="alg2.l3a.m1.1c">\overrightarrow{\mathbf{y}}</annotation><annotation encoding="application/x-llamapun" id="alg2.l3a.m1.1d">over→ start_ARG bold_y end_ARG</annotation></semantics></math>
</div>
</div>
</figure>
<div class="ltx_para" id="S3.SS2.SSS2.p1">
<p class="ltx_p" id="S3.SS2.SSS2.p1.1">Very large models do not fit on the RAM of a single GPU/TPU, so for serving such models, the parameters of the model are usually distributed on a cluster of multiple devices. In this case, using HiRE (Algorithm <a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#alg1" title="Algorithm 1 ‣ 3.2.1 Solving equation 5 accurately and efficiently ‣ 3.2 HiRE: Overall Approach ‣ 3 Main Ideas ‣ HiRE: High Recall Approximate Top-𝑘 Estimation for Efficient LLM Inference"><span class="ltx_text ltx_ref_tag">1</span></a>) as is leads to large costs in communication. To mitigate the communication costs, we modify HiRE to use <em class="ltx_emph ltx_font_italic" id="S3.SS2.SSS2.p1.1.1">distributed, approximate top-<math alttext="k" class="ltx_Math" display="inline" id="S3.SS2.SSS2.p1.1.1.m1.1"><semantics id="S3.SS2.SSS2.p1.1.1.m1.1a"><mi id="S3.SS2.SSS2.p1.1.1.m1.1.1" xref="S3.SS2.SSS2.p1.1.1.m1.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="S3.SS2.SSS2.p1.1.1.m1.1b"><ci id="S3.SS2.SSS2.p1.1.1.m1.1.1.cmml" xref="S3.SS2.SSS2.p1.1.1.m1.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.SSS2.p1.1.1.m1.1c">k</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.SSS2.p1.1.1.m1.1d">italic_k</annotation></semantics></math> computation</em>. The pseudocode for the resulting algorithm is given in Algorithm <a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#alg2" title='Algorithm 2 ‣ 3.2.2 "DA-TOP-"⁢𝑘: Multi-device serving with approximate distributed top-𝑘 operation ‣ 3.2 HiRE: Overall Approach ‣ 3 Main Ideas ‣ HiRE: High Recall Approximate Top-𝑘 Estimation for Efficient LLM Inference'><span class="ltx_text ltx_ref_tag">2</span></a>.
We will now present the application of Algorithms <a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#alg1" title="Algorithm 1 ‣ 3.2.1 Solving equation 5 accurately and efficiently ‣ 3.2 HiRE: Overall Approach ‣ 3 Main Ideas ‣ HiRE: High Recall Approximate Top-𝑘 Estimation for Efficient LLM Inference"><span class="ltx_text ltx_ref_tag">1</span></a> and <a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#alg2" title='Algorithm 2 ‣ 3.2.2 "DA-TOP-"⁢𝑘: Multi-device serving with approximate distributed top-𝑘 operation ‣ 3.2 HiRE: Overall Approach ‣ 3 Main Ideas ‣ HiRE: High Recall Approximate Top-𝑘 Estimation for Efficient LLM Inference'><span class="ltx_text ltx_ref_tag">2</span></a> to make softmax and FFN layers more efficient.</p>
</div>
</section>
</section>
<section class="ltx_subsection" id="S3.SS3">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">3.3 </span>HiRE-SoftMax: Efficient Softmax using HiRE</h3>
<div class="ltx_para" id="S3.SS3.p1">
<p class="ltx_p" id="S3.SS3.p1.6">Since we usually care only about the top-<math alttext="k" class="ltx_Math" display="inline" id="S3.SS3.p1.1.m1.1"><semantics id="S3.SS3.p1.1.m1.1a"><mi id="S3.SS3.p1.1.m1.1.1" xref="S3.SS3.p1.1.m1.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="S3.SS3.p1.1.m1.1b"><ci id="S3.SS3.p1.1.m1.1.1.cmml" xref="S3.SS3.p1.1.m1.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS3.p1.1.m1.1c">k</annotation><annotation encoding="application/x-llamapun" id="S3.SS3.p1.1.m1.1d">italic_k</annotation></semantics></math> logits of the softmax layer equation <a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#S3.E4" title="4 ‣ 3.1 Problem Setup ‣ 3 Main Ideas ‣ HiRE: High Recall Approximate Top-𝑘 Estimation for Efficient LLM Inference"><span class="ltx_text ltx_ref_tag">4</span></a>, we can directly apply Algorithms <a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#alg1" title="Algorithm 1 ‣ 3.2.1 Solving equation 5 accurately and efficiently ‣ 3.2 HiRE: Overall Approach ‣ 3 Main Ideas ‣ HiRE: High Recall Approximate Top-𝑘 Estimation for Efficient LLM Inference"><span class="ltx_text ltx_ref_tag">1</span></a> and <a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#alg2" title='Algorithm 2 ‣ 3.2.2 "DA-TOP-"⁢𝑘: Multi-device serving with approximate distributed top-𝑘 operation ‣ 3.2 HiRE: Overall Approach ‣ 3 Main Ideas ‣ HiRE: High Recall Approximate Top-𝑘 Estimation for Efficient LLM Inference'><span class="ltx_text ltx_ref_tag">2</span></a> to solve equation <a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#S3.E2" title="2 ‣ 3.1 Problem Setup ‣ 3 Main Ideas ‣ HiRE: High Recall Approximate Top-𝑘 Estimation for Efficient LLM Inference"><span class="ltx_text ltx_ref_tag">2</span></a> more efficiently. We note that while obtaining <math alttext="{\mathbf{W}_{\textrm{approx}}}" class="ltx_Math" display="inline" id="S3.SS3.p1.2.m2.1"><semantics id="S3.SS3.p1.2.m2.1a"><msub id="S3.SS3.p1.2.m2.1.1" xref="S3.SS3.p1.2.m2.1.1.cmml"><mi id="S3.SS3.p1.2.m2.1.1.2" xref="S3.SS3.p1.2.m2.1.1.2.cmml">𝐖</mi><mtext id="S3.SS3.p1.2.m2.1.1.3" xref="S3.SS3.p1.2.m2.1.1.3a.cmml">approx</mtext></msub><annotation-xml encoding="MathML-Content" id="S3.SS3.p1.2.m2.1b"><apply id="S3.SS3.p1.2.m2.1.1.cmml" xref="S3.SS3.p1.2.m2.1.1"><csymbol cd="ambiguous" id="S3.SS3.p1.2.m2.1.1.1.cmml" xref="S3.SS3.p1.2.m2.1.1">subscript</csymbol><ci id="S3.SS3.p1.2.m2.1.1.2.cmml" xref="S3.SS3.p1.2.m2.1.1.2">𝐖</ci><ci id="S3.SS3.p1.2.m2.1.1.3a.cmml" xref="S3.SS3.p1.2.m2.1.1.3"><mtext id="S3.SS3.p1.2.m2.1.1.3.cmml" mathsize="70%" xref="S3.SS3.p1.2.m2.1.1.3">approx</mtext></ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS3.p1.2.m2.1c">{\mathbf{W}_{\textrm{approx}}}</annotation><annotation encoding="application/x-llamapun" id="S3.SS3.p1.2.m2.1d">bold_W start_POSTSUBSCRIPT approx end_POSTSUBSCRIPT</annotation></semantics></math>, an approximate version of <math alttext="{\mathbf{W}}" class="ltx_Math" display="inline" id="S3.SS3.p1.3.m3.1"><semantics id="S3.SS3.p1.3.m3.1a"><mi id="S3.SS3.p1.3.m3.1.1" xref="S3.SS3.p1.3.m3.1.1.cmml">𝐖</mi><annotation-xml encoding="MathML-Content" id="S3.SS3.p1.3.m3.1b"><ci id="S3.SS3.p1.3.m3.1.1.cmml" xref="S3.SS3.p1.3.m3.1.1">𝐖</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS3.p1.3.m3.1c">{\mathbf{W}}</annotation><annotation encoding="application/x-llamapun" id="S3.SS3.p1.3.m3.1d">bold_W</annotation></semantics></math>, is straightforward with quantization, obtaining a low rank approximation of <math alttext="{\mathbf{W}_{\textrm{approx}}}" class="ltx_Math" display="inline" id="S3.SS3.p1.4.m4.1"><semantics id="S3.SS3.p1.4.m4.1a"><msub id="S3.SS3.p1.4.m4.1.1" xref="S3.SS3.p1.4.m4.1.1.cmml"><mi id="S3.SS3.p1.4.m4.1.1.2" xref="S3.SS3.p1.4.m4.1.1.2.cmml">𝐖</mi><mtext id="S3.SS3.p1.4.m4.1.1.3" xref="S3.SS3.p1.4.m4.1.1.3a.cmml">approx</mtext></msub><annotation-xml encoding="MathML-Content" id="S3.SS3.p1.4.m4.1b"><apply id="S3.SS3.p1.4.m4.1.1.cmml" xref="S3.SS3.p1.4.m4.1.1"><csymbol cd="ambiguous" id="S3.SS3.p1.4.m4.1.1.1.cmml" xref="S3.SS3.p1.4.m4.1.1">subscript</csymbol><ci id="S3.SS3.p1.4.m4.1.1.2.cmml" xref="S3.SS3.p1.4.m4.1.1.2">𝐖</ci><ci id="S3.SS3.p1.4.m4.1.1.3a.cmml" xref="S3.SS3.p1.4.m4.1.1.3"><mtext id="S3.SS3.p1.4.m4.1.1.3.cmml" mathsize="70%" xref="S3.SS3.p1.4.m4.1.1.3">approx</mtext></ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS3.p1.4.m4.1c">{\mathbf{W}_{\textrm{approx}}}</annotation><annotation encoding="application/x-llamapun" id="S3.SS3.p1.4.m4.1d">bold_W start_POSTSUBSCRIPT approx end_POSTSUBSCRIPT</annotation></semantics></math> is also relatively cheap since we can distill the inputs and outputs of <math alttext="{\mathbf{W}}" class="ltx_Math" display="inline" id="S3.SS3.p1.5.m5.1"><semantics id="S3.SS3.p1.5.m5.1a"><mi id="S3.SS3.p1.5.m5.1.1" xref="S3.SS3.p1.5.m5.1.1.cmml">𝐖</mi><annotation-xml encoding="MathML-Content" id="S3.SS3.p1.5.m5.1b"><ci id="S3.SS3.p1.5.m5.1.1.cmml" xref="S3.SS3.p1.5.m5.1.1">𝐖</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS3.p1.5.m5.1c">{\mathbf{W}}</annotation><annotation encoding="application/x-llamapun" id="S3.SS3.p1.5.m5.1d">bold_W</annotation></semantics></math> to obtain <math alttext="{\mathbf{W}_{\textrm{approx}}}" class="ltx_Math" display="inline" id="S3.SS3.p1.6.m6.1"><semantics id="S3.SS3.p1.6.m6.1a"><msub id="S3.SS3.p1.6.m6.1.1" xref="S3.SS3.p1.6.m6.1.1.cmml"><mi id="S3.SS3.p1.6.m6.1.1.2" xref="S3.SS3.p1.6.m6.1.1.2.cmml">𝐖</mi><mtext id="S3.SS3.p1.6.m6.1.1.3" xref="S3.SS3.p1.6.m6.1.1.3a.cmml">approx</mtext></msub><annotation-xml encoding="MathML-Content" id="S3.SS3.p1.6.m6.1b"><apply id="S3.SS3.p1.6.m6.1.1.cmml" xref="S3.SS3.p1.6.m6.1.1"><csymbol cd="ambiguous" id="S3.SS3.p1.6.m6.1.1.1.cmml" xref="S3.SS3.p1.6.m6.1.1">subscript</csymbol><ci id="S3.SS3.p1.6.m6.1.1.2.cmml" xref="S3.SS3.p1.6.m6.1.1.2">𝐖</ci><ci id="S3.SS3.p1.6.m6.1.1.3a.cmml" xref="S3.SS3.p1.6.m6.1.1.3"><mtext id="S3.SS3.p1.6.m6.1.1.3.cmml" mathsize="70%" xref="S3.SS3.p1.6.m6.1.1.3">approx</mtext></ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS3.p1.6.m6.1c">{\mathbf{W}_{\textrm{approx}}}</annotation><annotation encoding="application/x-llamapun" id="S3.SS3.p1.6.m6.1d">bold_W start_POSTSUBSCRIPT approx end_POSTSUBSCRIPT</annotation></semantics></math>.
</p>
</div>
</section>
<section class="ltx_subsection" id="S3.SS4">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">3.4 </span>HiRE-FFN: Efficient FFN using HiRE</h3>
<div class="ltx_para" id="S3.SS4.p1">
<p class="ltx_p" id="S3.SS4.p1.1">Recalling equation <a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#S3.E4" title="4 ‣ 3.1 Problem Setup ‣ 3 Main Ideas ‣ HiRE: High Recall Approximate Top-𝑘 Estimation for Efficient LLM Inference"><span class="ltx_text ltx_ref_tag">4</span></a>, we note that we can compute <math alttext="S(\overrightarrow{\mathbf{x}}):=\textrm{TopInd}_{k}\left(\phi(\mathbf{U}^{\top%
}{\overrightarrow{\mathbf{x}}})\right)" class="ltx_Math" display="inline" id="S3.SS4.p1.1.m1.2"><semantics id="S3.SS4.p1.1.m1.2a"><mrow id="S3.SS4.p1.1.m1.2.2" xref="S3.SS4.p1.1.m1.2.2.cmml"><mrow id="S3.SS4.p1.1.m1.2.2.3" xref="S3.SS4.p1.1.m1.2.2.3.cmml"><mi id="S3.SS4.p1.1.m1.2.2.3.2" xref="S3.SS4.p1.1.m1.2.2.3.2.cmml">S</mi><mo id="S3.SS4.p1.1.m1.2.2.3.1" xref="S3.SS4.p1.1.m1.2.2.3.1.cmml">⁢</mo><mrow id="S3.SS4.p1.1.m1.2.2.3.3.2" xref="S3.SS4.p1.1.m1.1.1.cmml"><mo id="S3.SS4.p1.1.m1.2.2.3.3.2.1" stretchy="false" xref="S3.SS4.p1.1.m1.1.1.cmml">(</mo><mover accent="true" id="S3.SS4.p1.1.m1.1.1" xref="S3.SS4.p1.1.m1.1.1.cmml"><mi id="S3.SS4.p1.1.m1.1.1.2" xref="S3.SS4.p1.1.m1.1.1.2.cmml">𝐱</mi><mo id="S3.SS4.p1.1.m1.1.1.1" stretchy="false" xref="S3.SS4.p1.1.m1.1.1.1.cmml">→</mo></mover><mo id="S3.SS4.p1.1.m1.2.2.3.3.2.2" rspace="0.278em" stretchy="false" xref="S3.SS4.p1.1.m1.1.1.cmml">)</mo></mrow></mrow><mo id="S3.SS4.p1.1.m1.2.2.2" rspace="0.278em" xref="S3.SS4.p1.1.m1.2.2.2.cmml">:=</mo><mrow id="S3.SS4.p1.1.m1.2.2.1" xref="S3.SS4.p1.1.m1.2.2.1.cmml"><msub id="S3.SS4.p1.1.m1.2.2.1.3" xref="S3.SS4.p1.1.m1.2.2.1.3.cmml"><mtext id="S3.SS4.p1.1.m1.2.2.1.3.2" xref="S3.SS4.p1.1.m1.2.2.1.3.2a.cmml">TopInd</mtext><mi id="S3.SS4.p1.1.m1.2.2.1.3.3" xref="S3.SS4.p1.1.m1.2.2.1.3.3.cmml">k</mi></msub><mo id="S3.SS4.p1.1.m1.2.2.1.2" xref="S3.SS4.p1.1.m1.2.2.1.2.cmml">⁢</mo><mrow id="S3.SS4.p1.1.m1.2.2.1.1.1" xref="S3.SS4.p1.1.m1.2.2.1.1.1.1.cmml"><mo id="S3.SS4.p1.1.m1.2.2.1.1.1.2" xref="S3.SS4.p1.1.m1.2.2.1.1.1.1.cmml">(</mo><mrow id="S3.SS4.p1.1.m1.2.2.1.1.1.1" xref="S3.SS4.p1.1.m1.2.2.1.1.1.1.cmml"><mi id="S3.SS4.p1.1.m1.2.2.1.1.1.1.3" xref="S3.SS4.p1.1.m1.2.2.1.1.1.1.3.cmml">ϕ</mi><mo id="S3.SS4.p1.1.m1.2.2.1.1.1.1.2" xref="S3.SS4.p1.1.m1.2.2.1.1.1.1.2.cmml">⁢</mo><mrow id="S3.SS4.p1.1.m1.2.2.1.1.1.1.1.1" xref="S3.SS4.p1.1.m1.2.2.1.1.1.1.1.1.1.cmml"><mo id="S3.SS4.p1.1.m1.2.2.1.1.1.1.1.1.2" stretchy="false" xref="S3.SS4.p1.1.m1.2.2.1.1.1.1.1.1.1.cmml">(</mo><mrow id="S3.SS4.p1.1.m1.2.2.1.1.1.1.1.1.1" xref="S3.SS4.p1.1.m1.2.2.1.1.1.1.1.1.1.cmml"><msup id="S3.SS4.p1.1.m1.2.2.1.1.1.1.1.1.1.2" xref="S3.SS4.p1.1.m1.2.2.1.1.1.1.1.1.1.2.cmml"><mi id="S3.SS4.p1.1.m1.2.2.1.1.1.1.1.1.1.2.2" xref="S3.SS4.p1.1.m1.2.2.1.1.1.1.1.1.1.2.2.cmml">𝐔</mi><mo id="S3.SS4.p1.1.m1.2.2.1.1.1.1.1.1.1.2.3" xref="S3.SS4.p1.1.m1.2.2.1.1.1.1.1.1.1.2.3.cmml">⊤</mo></msup><mo id="S3.SS4.p1.1.m1.2.2.1.1.1.1.1.1.1.1" xref="S3.SS4.p1.1.m1.2.2.1.1.1.1.1.1.1.1.cmml">⁢</mo><mover accent="true" id="S3.SS4.p1.1.m1.2.2.1.1.1.1.1.1.1.3" xref="S3.SS4.p1.1.m1.2.2.1.1.1.1.1.1.1.3.cmml"><mi id="S3.SS4.p1.1.m1.2.2.1.1.1.1.1.1.1.3.2" xref="S3.SS4.p1.1.m1.2.2.1.1.1.1.1.1.1.3.2.cmml">𝐱</mi><mo id="S3.SS4.p1.1.m1.2.2.1.1.1.1.1.1.1.3.1" stretchy="false" xref="S3.SS4.p1.1.m1.2.2.1.1.1.1.1.1.1.3.1.cmml">→</mo></mover></mrow><mo id="S3.SS4.p1.1.m1.2.2.1.1.1.1.1.1.3" stretchy="false" xref="S3.SS4.p1.1.m1.2.2.1.1.1.1.1.1.1.cmml">)</mo></mrow></mrow><mo id="S3.SS4.p1.1.m1.2.2.1.1.1.3" xref="S3.SS4.p1.1.m1.2.2.1.1.1.1.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.SS4.p1.1.m1.2b"><apply id="S3.SS4.p1.1.m1.2.2.cmml" xref="S3.SS4.p1.1.m1.2.2"><csymbol cd="latexml" id="S3.SS4.p1.1.m1.2.2.2.cmml" xref="S3.SS4.p1.1.m1.2.2.2">assign</csymbol><apply id="S3.SS4.p1.1.m1.2.2.3.cmml" xref="S3.SS4.p1.1.m1.2.2.3"><times id="S3.SS4.p1.1.m1.2.2.3.1.cmml" xref="S3.SS4.p1.1.m1.2.2.3.1"></times><ci id="S3.SS4.p1.1.m1.2.2.3.2.cmml" xref="S3.SS4.p1.1.m1.2.2.3.2">𝑆</ci><apply id="S3.SS4.p1.1.m1.1.1.cmml" xref="S3.SS4.p1.1.m1.2.2.3.3.2"><ci id="S3.SS4.p1.1.m1.1.1.1.cmml" xref="S3.SS4.p1.1.m1.1.1.1">→</ci><ci id="S3.SS4.p1.1.m1.1.1.2.cmml" xref="S3.SS4.p1.1.m1.1.1.2">𝐱</ci></apply></apply><apply id="S3.SS4.p1.1.m1.2.2.1.cmml" xref="S3.SS4.p1.1.m1.2.2.1"><times id="S3.SS4.p1.1.m1.2.2.1.2.cmml" xref="S3.SS4.p1.1.m1.2.2.1.2"></times><apply id="S3.SS4.p1.1.m1.2.2.1.3.cmml" xref="S3.SS4.p1.1.m1.2.2.1.3"><csymbol cd="ambiguous" id="S3.SS4.p1.1.m1.2.2.1.3.1.cmml" xref="S3.SS4.p1.1.m1.2.2.1.3">subscript</csymbol><ci id="S3.SS4.p1.1.m1.2.2.1.3.2a.cmml" xref="S3.SS4.p1.1.m1.2.2.1.3.2"><mtext id="S3.SS4.p1.1.m1.2.2.1.3.2.cmml" xref="S3.SS4.p1.1.m1.2.2.1.3.2">TopInd</mtext></ci><ci id="S3.SS4.p1.1.m1.2.2.1.3.3.cmml" xref="S3.SS4.p1.1.m1.2.2.1.3.3">𝑘</ci></apply><apply id="S3.SS4.p1.1.m1.2.2.1.1.1.1.cmml" xref="S3.SS4.p1.1.m1.2.2.1.1.1"><times id="S3.SS4.p1.1.m1.2.2.1.1.1.1.2.cmml" xref="S3.SS4.p1.1.m1.2.2.1.1.1.1.2"></times><ci id="S3.SS4.p1.1.m1.2.2.1.1.1.1.3.cmml" xref="S3.SS4.p1.1.m1.2.2.1.1.1.1.3">italic-ϕ</ci><apply id="S3.SS4.p1.1.m1.2.2.1.1.1.1.1.1.1.cmml" xref="S3.SS4.p1.1.m1.2.2.1.1.1.1.1.1"><times id="S3.SS4.p1.1.m1.2.2.1.1.1.1.1.1.1.1.cmml" xref="S3.SS4.p1.1.m1.2.2.1.1.1.1.1.1.1.1"></times><apply id="S3.SS4.p1.1.m1.2.2.1.1.1.1.1.1.1.2.cmml" xref="S3.SS4.p1.1.m1.2.2.1.1.1.1.1.1.1.2"><csymbol cd="ambiguous" id="S3.SS4.p1.1.m1.2.2.1.1.1.1.1.1.1.2.1.cmml" xref="S3.SS4.p1.1.m1.2.2.1.1.1.1.1.1.1.2">superscript</csymbol><ci id="S3.SS4.p1.1.m1.2.2.1.1.1.1.1.1.1.2.2.cmml" xref="S3.SS4.p1.1.m1.2.2.1.1.1.1.1.1.1.2.2">𝐔</ci><csymbol cd="latexml" id="S3.SS4.p1.1.m1.2.2.1.1.1.1.1.1.1.2.3.cmml" xref="S3.SS4.p1.1.m1.2.2.1.1.1.1.1.1.1.2.3">top</csymbol></apply><apply id="S3.SS4.p1.1.m1.2.2.1.1.1.1.1.1.1.3.cmml" xref="S3.SS4.p1.1.m1.2.2.1.1.1.1.1.1.1.3"><ci id="S3.SS4.p1.1.m1.2.2.1.1.1.1.1.1.1.3.1.cmml" xref="S3.SS4.p1.1.m1.2.2.1.1.1.1.1.1.1.3.1">→</ci><ci id="S3.SS4.p1.1.m1.2.2.1.1.1.1.1.1.1.3.2.cmml" xref="S3.SS4.p1.1.m1.2.2.1.1.1.1.1.1.1.3.2">𝐱</ci></apply></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS4.p1.1.m1.2c">S(\overrightarrow{\mathbf{x}}):=\textrm{TopInd}_{k}\left(\phi(\mathbf{U}^{\top%
}{\overrightarrow{\mathbf{x}}})\right)</annotation><annotation encoding="application/x-llamapun" id="S3.SS4.p1.1.m1.2d">italic_S ( over→ start_ARG bold_x end_ARG ) := TopInd start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT ( italic_ϕ ( bold_U start_POSTSUPERSCRIPT ⊤ end_POSTSUPERSCRIPT over→ start_ARG bold_x end_ARG ) )</annotation></semantics></math> using HiRE.
</p>
</div>
<div class="ltx_para" id="S3.SS4.p2">
<p class="ltx_p" id="S3.SS4.p2.10">While HiRE-FFN is indeed theoretically more efficient compared to a naive computation of equation <a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#S3.E4" title="4 ‣ 3.1 Problem Setup ‣ 3 Main Ideas ‣ HiRE: High Recall Approximate Top-𝑘 Estimation for Efficient LLM Inference"><span class="ltx_text ltx_ref_tag">4</span></a>, it turns out that for the relative values of <math alttext="k^{\prime}" class="ltx_Math" display="inline" id="S3.SS4.p2.1.m1.1"><semantics id="S3.SS4.p2.1.m1.1a"><msup id="S3.SS4.p2.1.m1.1.1" xref="S3.SS4.p2.1.m1.1.1.cmml"><mi id="S3.SS4.p2.1.m1.1.1.2" xref="S3.SS4.p2.1.m1.1.1.2.cmml">k</mi><mo id="S3.SS4.p2.1.m1.1.1.3" xref="S3.SS4.p2.1.m1.1.1.3.cmml">′</mo></msup><annotation-xml encoding="MathML-Content" id="S3.SS4.p2.1.m1.1b"><apply id="S3.SS4.p2.1.m1.1.1.cmml" xref="S3.SS4.p2.1.m1.1.1"><csymbol cd="ambiguous" id="S3.SS4.p2.1.m1.1.1.1.cmml" xref="S3.SS4.p2.1.m1.1.1">superscript</csymbol><ci id="S3.SS4.p2.1.m1.1.1.2.cmml" xref="S3.SS4.p2.1.m1.1.1.2">𝑘</ci><ci id="S3.SS4.p2.1.m1.1.1.3.cmml" xref="S3.SS4.p2.1.m1.1.1.3">′</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS4.p2.1.m1.1c">k^{\prime}</annotation><annotation encoding="application/x-llamapun" id="S3.SS4.p2.1.m1.1d">italic_k start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT</annotation></semantics></math> and <math alttext="m" class="ltx_Math" display="inline" id="S3.SS4.p2.2.m2.1"><semantics id="S3.SS4.p2.2.m2.1a"><mi id="S3.SS4.p2.2.m2.1.1" xref="S3.SS4.p2.2.m2.1.1.cmml">m</mi><annotation-xml encoding="MathML-Content" id="S3.SS4.p2.2.m2.1b"><ci id="S3.SS4.p2.2.m2.1.1.cmml" xref="S3.SS4.p2.2.m2.1.1">𝑚</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS4.p2.2.m2.1c">m</annotation><annotation encoding="application/x-llamapun" id="S3.SS4.p2.2.m2.1d">italic_m</annotation></semantics></math> that are needed to ensure that there is no accuracy drop (<math alttext="\frac{k^{\prime}}{m}\approx 0.05" class="ltx_Math" display="inline" id="S3.SS4.p2.3.m3.1"><semantics id="S3.SS4.p2.3.m3.1a"><mrow id="S3.SS4.p2.3.m3.1.1" xref="S3.SS4.p2.3.m3.1.1.cmml"><mfrac id="S3.SS4.p2.3.m3.1.1.2" xref="S3.SS4.p2.3.m3.1.1.2.cmml"><msup id="S3.SS4.p2.3.m3.1.1.2.2" xref="S3.SS4.p2.3.m3.1.1.2.2.cmml"><mi id="S3.SS4.p2.3.m3.1.1.2.2.2" xref="S3.SS4.p2.3.m3.1.1.2.2.2.cmml">k</mi><mo id="S3.SS4.p2.3.m3.1.1.2.2.3" xref="S3.SS4.p2.3.m3.1.1.2.2.3.cmml">′</mo></msup><mi id="S3.SS4.p2.3.m3.1.1.2.3" xref="S3.SS4.p2.3.m3.1.1.2.3.cmml">m</mi></mfrac><mo id="S3.SS4.p2.3.m3.1.1.1" xref="S3.SS4.p2.3.m3.1.1.1.cmml">≈</mo><mn id="S3.SS4.p2.3.m3.1.1.3" xref="S3.SS4.p2.3.m3.1.1.3.cmml">0.05</mn></mrow><annotation-xml encoding="MathML-Content" id="S3.SS4.p2.3.m3.1b"><apply id="S3.SS4.p2.3.m3.1.1.cmml" xref="S3.SS4.p2.3.m3.1.1"><approx id="S3.SS4.p2.3.m3.1.1.1.cmml" xref="S3.SS4.p2.3.m3.1.1.1"></approx><apply id="S3.SS4.p2.3.m3.1.1.2.cmml" xref="S3.SS4.p2.3.m3.1.1.2"><divide id="S3.SS4.p2.3.m3.1.1.2.1.cmml" xref="S3.SS4.p2.3.m3.1.1.2"></divide><apply id="S3.SS4.p2.3.m3.1.1.2.2.cmml" xref="S3.SS4.p2.3.m3.1.1.2.2"><csymbol cd="ambiguous" id="S3.SS4.p2.3.m3.1.1.2.2.1.cmml" xref="S3.SS4.p2.3.m3.1.1.2.2">superscript</csymbol><ci id="S3.SS4.p2.3.m3.1.1.2.2.2.cmml" xref="S3.SS4.p2.3.m3.1.1.2.2.2">𝑘</ci><ci id="S3.SS4.p2.3.m3.1.1.2.2.3.cmml" xref="S3.SS4.p2.3.m3.1.1.2.2.3">′</ci></apply><ci id="S3.SS4.p2.3.m3.1.1.2.3.cmml" xref="S3.SS4.p2.3.m3.1.1.2.3">𝑚</ci></apply><cn id="S3.SS4.p2.3.m3.1.1.3.cmml" type="float" xref="S3.SS4.p2.3.m3.1.1.3">0.05</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS4.p2.3.m3.1c">\frac{k^{\prime}}{m}\approx 0.05</annotation><annotation encoding="application/x-llamapun" id="S3.SS4.p2.3.m3.1d">divide start_ARG italic_k start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT end_ARG start_ARG italic_m end_ARG ≈ 0.05</annotation></semantics></math>), the transfer of parameters across different hierarchies of memory is too inefficient to give any gains<span class="ltx_note ltx_role_footnote" id="footnote2"><sup class="ltx_note_mark">2</sup><span class="ltx_note_outer"><span class="ltx_note_content"><sup class="ltx_note_mark">2</sup><span class="ltx_tag ltx_tag_note">2</span>In contrast, the corresponding factor in the softmax layer is much smaller, around <math alttext="10^{-4}" class="ltx_Math" display="inline" id="footnote2.m1.1"><semantics id="footnote2.m1.1b"><msup id="footnote2.m1.1.1" xref="footnote2.m1.1.1.cmml"><mn id="footnote2.m1.1.1.2" xref="footnote2.m1.1.1.2.cmml">10</mn><mrow id="footnote2.m1.1.1.3" xref="footnote2.m1.1.1.3.cmml"><mo id="footnote2.m1.1.1.3b" xref="footnote2.m1.1.1.3.cmml">−</mo><mn id="footnote2.m1.1.1.3.2" xref="footnote2.m1.1.1.3.2.cmml">4</mn></mrow></msup><annotation-xml encoding="MathML-Content" id="footnote2.m1.1c"><apply id="footnote2.m1.1.1.cmml" xref="footnote2.m1.1.1"><csymbol cd="ambiguous" id="footnote2.m1.1.1.1.cmml" xref="footnote2.m1.1.1">superscript</csymbol><cn id="footnote2.m1.1.1.2.cmml" type="integer" xref="footnote2.m1.1.1.2">10</cn><apply id="footnote2.m1.1.1.3.cmml" xref="footnote2.m1.1.1.3"><minus id="footnote2.m1.1.1.3.1.cmml" xref="footnote2.m1.1.1.3"></minus><cn id="footnote2.m1.1.1.3.2.cmml" type="integer" xref="footnote2.m1.1.1.3.2">4</cn></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="footnote2.m1.1d">10^{-4}</annotation><annotation encoding="application/x-llamapun" id="footnote2.m1.1e">10 start_POSTSUPERSCRIPT - 4 end_POSTSUPERSCRIPT</annotation></semantics></math>, which gives us inference latency improvements, despite this inefficiency in memory transfer.</span></span></span>. Our key insight is that group sparse structure substantially improves the efficiency of parameter transfer across different hierarchies of memory. For example, Figure <a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#A2.F3" title="Figure 3 ‣ Appendix B Additional Results ‣ HiRE: High Recall Approximate Top-𝑘 Estimation for Efficient LLM Inference"><span class="ltx_text ltx_ref_tag">3</span></a> in Appendix <a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#A2" title="Appendix B Additional Results ‣ HiRE: High Recall Approximate Top-𝑘 Estimation for Efficient LLM Inference"><span class="ltx_text ltx_ref_tag">B</span></a> shows that the efficiency of the transfer operation of columns of a matrix across different hierarchies of memory improves substantially when we transfer <em class="ltx_emph ltx_font_italic" id="S3.SS4.p2.10.1">groups</em> of adjacent columns instead of single columns.
More concretely, we first divide the entire set of <math alttext="m" class="ltx_Math" display="inline" id="S3.SS4.p2.4.m4.1"><semantics id="S3.SS4.p2.4.m4.1a"><mi id="S3.SS4.p2.4.m4.1.1" xref="S3.SS4.p2.4.m4.1.1.cmml">m</mi><annotation-xml encoding="MathML-Content" id="S3.SS4.p2.4.m4.1b"><ci id="S3.SS4.p2.4.m4.1.1.cmml" xref="S3.SS4.p2.4.m4.1.1">𝑚</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS4.p2.4.m4.1c">m</annotation><annotation encoding="application/x-llamapun" id="S3.SS4.p2.4.m4.1d">italic_m</annotation></semantics></math> hidden units into <math alttext="m/g" class="ltx_Math" display="inline" id="S3.SS4.p2.5.m5.1"><semantics id="S3.SS4.p2.5.m5.1a"><mrow id="S3.SS4.p2.5.m5.1.1" xref="S3.SS4.p2.5.m5.1.1.cmml"><mi id="S3.SS4.p2.5.m5.1.1.2" xref="S3.SS4.p2.5.m5.1.1.2.cmml">m</mi><mo id="S3.SS4.p2.5.m5.1.1.1" xref="S3.SS4.p2.5.m5.1.1.1.cmml">/</mo><mi id="S3.SS4.p2.5.m5.1.1.3" xref="S3.SS4.p2.5.m5.1.1.3.cmml">g</mi></mrow><annotation-xml encoding="MathML-Content" id="S3.SS4.p2.5.m5.1b"><apply id="S3.SS4.p2.5.m5.1.1.cmml" xref="S3.SS4.p2.5.m5.1.1"><divide id="S3.SS4.p2.5.m5.1.1.1.cmml" xref="S3.SS4.p2.5.m5.1.1.1"></divide><ci id="S3.SS4.p2.5.m5.1.1.2.cmml" xref="S3.SS4.p2.5.m5.1.1.2">𝑚</ci><ci id="S3.SS4.p2.5.m5.1.1.3.cmml" xref="S3.SS4.p2.5.m5.1.1.3">𝑔</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS4.p2.5.m5.1c">m/g</annotation><annotation encoding="application/x-llamapun" id="S3.SS4.p2.5.m5.1d">italic_m / italic_g</annotation></semantics></math> groups with <math alttext="g" class="ltx_Math" display="inline" id="S3.SS4.p2.6.m6.1"><semantics id="S3.SS4.p2.6.m6.1a"><mi id="S3.SS4.p2.6.m6.1.1" xref="S3.SS4.p2.6.m6.1.1.cmml">g</mi><annotation-xml encoding="MathML-Content" id="S3.SS4.p2.6.m6.1b"><ci id="S3.SS4.p2.6.m6.1.1.cmml" xref="S3.SS4.p2.6.m6.1.1">𝑔</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS4.p2.6.m6.1c">g</annotation><annotation encoding="application/x-llamapun" id="S3.SS4.p2.6.m6.1d">italic_g</annotation></semantics></math> hidden units each (in all our experiments, we use <math alttext="g=8" class="ltx_Math" display="inline" id="S3.SS4.p2.7.m7.1"><semantics id="S3.SS4.p2.7.m7.1a"><mrow id="S3.SS4.p2.7.m7.1.1" xref="S3.SS4.p2.7.m7.1.1.cmml"><mi id="S3.SS4.p2.7.m7.1.1.2" xref="S3.SS4.p2.7.m7.1.1.2.cmml">g</mi><mo id="S3.SS4.p2.7.m7.1.1.1" xref="S3.SS4.p2.7.m7.1.1.1.cmml">=</mo><mn id="S3.SS4.p2.7.m7.1.1.3" xref="S3.SS4.p2.7.m7.1.1.3.cmml">8</mn></mrow><annotation-xml encoding="MathML-Content" id="S3.SS4.p2.7.m7.1b"><apply id="S3.SS4.p2.7.m7.1.1.cmml" xref="S3.SS4.p2.7.m7.1.1"><eq id="S3.SS4.p2.7.m7.1.1.1.cmml" xref="S3.SS4.p2.7.m7.1.1.1"></eq><ci id="S3.SS4.p2.7.m7.1.1.2.cmml" xref="S3.SS4.p2.7.m7.1.1.2">𝑔</ci><cn id="S3.SS4.p2.7.m7.1.1.3.cmml" type="integer" xref="S3.SS4.p2.7.m7.1.1.3">8</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS4.p2.7.m7.1c">g=8</annotation><annotation encoding="application/x-llamapun" id="S3.SS4.p2.7.m7.1d">italic_g = 8</annotation></semantics></math>). Given an approximate group activation computation procedure <math alttext="\Phi:\mathbb{R}^{d}\rightarrow\mathbb{R}^{{\frac{m}{g}}}" class="ltx_Math" display="inline" id="S3.SS4.p2.8.m8.1"><semantics id="S3.SS4.p2.8.m8.1a"><mrow id="S3.SS4.p2.8.m8.1.1" xref="S3.SS4.p2.8.m8.1.1.cmml"><mi id="S3.SS4.p2.8.m8.1.1.2" mathvariant="normal" xref="S3.SS4.p2.8.m8.1.1.2.cmml">Φ</mi><mo id="S3.SS4.p2.8.m8.1.1.1" lspace="0.278em" rspace="0.278em" xref="S3.SS4.p2.8.m8.1.1.1.cmml">:</mo><mrow id="S3.SS4.p2.8.m8.1.1.3" xref="S3.SS4.p2.8.m8.1.1.3.cmml"><msup id="S3.SS4.p2.8.m8.1.1.3.2" xref="S3.SS4.p2.8.m8.1.1.3.2.cmml"><mi id="S3.SS4.p2.8.m8.1.1.3.2.2" xref="S3.SS4.p2.8.m8.1.1.3.2.2.cmml">ℝ</mi><mi id="S3.SS4.p2.8.m8.1.1.3.2.3" xref="S3.SS4.p2.8.m8.1.1.3.2.3.cmml">d</mi></msup><mo id="S3.SS4.p2.8.m8.1.1.3.1" stretchy="false" xref="S3.SS4.p2.8.m8.1.1.3.1.cmml">→</mo><msup id="S3.SS4.p2.8.m8.1.1.3.3" xref="S3.SS4.p2.8.m8.1.1.3.3.cmml"><mi id="S3.SS4.p2.8.m8.1.1.3.3.2" xref="S3.SS4.p2.8.m8.1.1.3.3.2.cmml">ℝ</mi><mfrac id="S3.SS4.p2.8.m8.1.1.3.3.3" xref="S3.SS4.p2.8.m8.1.1.3.3.3.cmml"><mi id="S3.SS4.p2.8.m8.1.1.3.3.3.2" xref="S3.SS4.p2.8.m8.1.1.3.3.3.2.cmml">m</mi><mi id="S3.SS4.p2.8.m8.1.1.3.3.3.3" xref="S3.SS4.p2.8.m8.1.1.3.3.3.3.cmml">g</mi></mfrac></msup></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.SS4.p2.8.m8.1b"><apply id="S3.SS4.p2.8.m8.1.1.cmml" xref="S3.SS4.p2.8.m8.1.1"><ci id="S3.SS4.p2.8.m8.1.1.1.cmml" xref="S3.SS4.p2.8.m8.1.1.1">:</ci><ci id="S3.SS4.p2.8.m8.1.1.2.cmml" xref="S3.SS4.p2.8.m8.1.1.2">Φ</ci><apply id="S3.SS4.p2.8.m8.1.1.3.cmml" xref="S3.SS4.p2.8.m8.1.1.3"><ci id="S3.SS4.p2.8.m8.1.1.3.1.cmml" xref="S3.SS4.p2.8.m8.1.1.3.1">→</ci><apply id="S3.SS4.p2.8.m8.1.1.3.2.cmml" xref="S3.SS4.p2.8.m8.1.1.3.2"><csymbol cd="ambiguous" id="S3.SS4.p2.8.m8.1.1.3.2.1.cmml" xref="S3.SS4.p2.8.m8.1.1.3.2">superscript</csymbol><ci id="S3.SS4.p2.8.m8.1.1.3.2.2.cmml" xref="S3.SS4.p2.8.m8.1.1.3.2.2">ℝ</ci><ci id="S3.SS4.p2.8.m8.1.1.3.2.3.cmml" xref="S3.SS4.p2.8.m8.1.1.3.2.3">𝑑</ci></apply><apply id="S3.SS4.p2.8.m8.1.1.3.3.cmml" xref="S3.SS4.p2.8.m8.1.1.3.3"><csymbol cd="ambiguous" id="S3.SS4.p2.8.m8.1.1.3.3.1.cmml" xref="S3.SS4.p2.8.m8.1.1.3.3">superscript</csymbol><ci id="S3.SS4.p2.8.m8.1.1.3.3.2.cmml" xref="S3.SS4.p2.8.m8.1.1.3.3.2">ℝ</ci><apply id="S3.SS4.p2.8.m8.1.1.3.3.3.cmml" xref="S3.SS4.p2.8.m8.1.1.3.3.3"><divide id="S3.SS4.p2.8.m8.1.1.3.3.3.1.cmml" xref="S3.SS4.p2.8.m8.1.1.3.3.3"></divide><ci id="S3.SS4.p2.8.m8.1.1.3.3.3.2.cmml" xref="S3.SS4.p2.8.m8.1.1.3.3.3.2">𝑚</ci><ci id="S3.SS4.p2.8.m8.1.1.3.3.3.3.cmml" xref="S3.SS4.p2.8.m8.1.1.3.3.3.3">𝑔</ci></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS4.p2.8.m8.1c">\Phi:\mathbb{R}^{d}\rightarrow\mathbb{R}^{{\frac{m}{g}}}</annotation><annotation encoding="application/x-llamapun" id="S3.SS4.p2.8.m8.1d">roman_Φ : blackboard_R start_POSTSUPERSCRIPT italic_d end_POSTSUPERSCRIPT → blackboard_R start_POSTSUPERSCRIPT divide start_ARG italic_m end_ARG start_ARG italic_g end_ARG end_POSTSUPERSCRIPT</annotation></semantics></math>, i.e., <math alttext="\Phi(\overrightarrow{\mathbf{x}})\approx\left(\sum_{k=0}^{g-1}\left|\phi(%
\langle\overrightarrow{\mathbf{u}}_{jg+k},\overrightarrow{\mathbf{x}}\rangle)%
\right|:j\in[m/g]\right)" class="ltx_math_unparsed" display="inline" id="S3.SS4.p2.9.m9.2"><semantics id="S3.SS4.p2.9.m9.2a"><mrow id="S3.SS4.p2.9.m9.2b"><mi id="S3.SS4.p2.9.m9.2.3" mathvariant="normal">Φ</mi><mrow id="S3.SS4.p2.9.m9.2.4"><mo id="S3.SS4.p2.9.m9.2.4.1" stretchy="false">(</mo><mover accent="true" id="S3.SS4.p2.9.m9.1.1"><mi id="S3.SS4.p2.9.m9.1.1.2">𝐱</mi><mo id="S3.SS4.p2.9.m9.1.1.1" stretchy="false">→</mo></mover><mo id="S3.SS4.p2.9.m9.2.4.2" stretchy="false">)</mo></mrow><mo id="S3.SS4.p2.9.m9.2.5">≈</mo><mrow id="S3.SS4.p2.9.m9.2.6"><mo id="S3.SS4.p2.9.m9.2.6.1">(</mo><msubsup id="S3.SS4.p2.9.m9.2.6.2"><mo id="S3.SS4.p2.9.m9.2.6.2.2.2" lspace="0em" rspace="0em">∑</mo><mrow id="S3.SS4.p2.9.m9.2.6.2.2.3"><mi id="S3.SS4.p2.9.m9.2.6.2.2.3.2">k</mi><mo id="S3.SS4.p2.9.m9.2.6.2.2.3.1">=</mo><mn id="S3.SS4.p2.9.m9.2.6.2.2.3.3">0</mn></mrow><mrow id="S3.SS4.p2.9.m9.2.6.2.3"><mi id="S3.SS4.p2.9.m9.2.6.2.3.2">g</mi><mo id="S3.SS4.p2.9.m9.2.6.2.3.1">−</mo><mn id="S3.SS4.p2.9.m9.2.6.2.3.3">1</mn></mrow></msubsup><mo fence="false" id="S3.SS4.p2.9.m9.2.6.3" rspace="0.167em">|</mo><mi id="S3.SS4.p2.9.m9.2.6.4">ϕ</mi><mrow id="S3.SS4.p2.9.m9.2.6.5"><mo id="S3.SS4.p2.9.m9.2.6.5.1" stretchy="false">(</mo><mrow id="S3.SS4.p2.9.m9.2.6.5.2"><mo id="S3.SS4.p2.9.m9.2.6.5.2.1" stretchy="false">⟨</mo><msub id="S3.SS4.p2.9.m9.2.6.5.2.2"><mover accent="true" id="S3.SS4.p2.9.m9.2.6.5.2.2.2"><mi id="S3.SS4.p2.9.m9.2.6.5.2.2.2.2">𝐮</mi><mo id="S3.SS4.p2.9.m9.2.6.5.2.2.2.1" stretchy="false">→</mo></mover><mrow id="S3.SS4.p2.9.m9.2.6.5.2.2.3"><mrow id="S3.SS4.p2.9.m9.2.6.5.2.2.3.2"><mi id="S3.SS4.p2.9.m9.2.6.5.2.2.3.2.2">j</mi><mo id="S3.SS4.p2.9.m9.2.6.5.2.2.3.2.1">⁢</mo><mi id="S3.SS4.p2.9.m9.2.6.5.2.2.3.2.3">g</mi></mrow><mo id="S3.SS4.p2.9.m9.2.6.5.2.2.3.1">+</mo><mi id="S3.SS4.p2.9.m9.2.6.5.2.2.3.3">k</mi></mrow></msub><mo id="S3.SS4.p2.9.m9.2.6.5.2.3">,</mo><mover accent="true" id="S3.SS4.p2.9.m9.2.2"><mi id="S3.SS4.p2.9.m9.2.2.2">𝐱</mi><mo id="S3.SS4.p2.9.m9.2.2.1" stretchy="false">→</mo></mover><mo id="S3.SS4.p2.9.m9.2.6.5.2.4" stretchy="false">⟩</mo></mrow><mo id="S3.SS4.p2.9.m9.2.6.5.3" stretchy="false">)</mo></mrow><mo fence="false" id="S3.SS4.p2.9.m9.2.6.6" rspace="0.167em">|</mo><mo id="S3.SS4.p2.9.m9.2.6.7" rspace="0.278em">:</mo><mi id="S3.SS4.p2.9.m9.2.6.8">j</mi><mo id="S3.SS4.p2.9.m9.2.6.9">∈</mo><mrow id="S3.SS4.p2.9.m9.2.6.10"><mo id="S3.SS4.p2.9.m9.2.6.10.1" stretchy="false">[</mo><mi id="S3.SS4.p2.9.m9.2.6.10.2">m</mi><mo id="S3.SS4.p2.9.m9.2.6.10.3">/</mo><mi id="S3.SS4.p2.9.m9.2.6.10.4">g</mi><mo id="S3.SS4.p2.9.m9.2.6.10.5" stretchy="false">]</mo></mrow><mo id="S3.SS4.p2.9.m9.2.6.11">)</mo></mrow></mrow><annotation encoding="application/x-tex" id="S3.SS4.p2.9.m9.2c">\Phi(\overrightarrow{\mathbf{x}})\approx\left(\sum_{k=0}^{g-1}\left|\phi(%
\langle\overrightarrow{\mathbf{u}}_{jg+k},\overrightarrow{\mathbf{x}}\rangle)%
\right|:j\in[m/g]\right)</annotation><annotation encoding="application/x-llamapun" id="S3.SS4.p2.9.m9.2d">roman_Φ ( over→ start_ARG bold_x end_ARG ) ≈ ( ∑ start_POSTSUBSCRIPT italic_k = 0 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_g - 1 end_POSTSUPERSCRIPT | italic_ϕ ( ⟨ over→ start_ARG bold_u end_ARG start_POSTSUBSCRIPT italic_j italic_g + italic_k end_POSTSUBSCRIPT , over→ start_ARG bold_x end_ARG ⟩ ) | : italic_j ∈ [ italic_m / italic_g ] )</annotation></semantics></math> let us denote <math alttext="S^{\prime}_{g}:=\textrm{TopInd}_{k^{\prime}}\left(\Phi(\overrightarrow{\mathbf%
{x}})\right)" class="ltx_Math" display="inline" id="S3.SS4.p2.10.m10.2"><semantics id="S3.SS4.p2.10.m10.2a"><mrow id="S3.SS4.p2.10.m10.2.2" xref="S3.SS4.p2.10.m10.2.2.cmml"><msubsup id="S3.SS4.p2.10.m10.2.2.3" xref="S3.SS4.p2.10.m10.2.2.3.cmml"><mi id="S3.SS4.p2.10.m10.2.2.3.2.2" xref="S3.SS4.p2.10.m10.2.2.3.2.2.cmml">S</mi><mi id="S3.SS4.p2.10.m10.2.2.3.3" xref="S3.SS4.p2.10.m10.2.2.3.3.cmml">g</mi><mo id="S3.SS4.p2.10.m10.2.2.3.2.3" xref="S3.SS4.p2.10.m10.2.2.3.2.3.cmml">′</mo></msubsup><mo id="S3.SS4.p2.10.m10.2.2.2" lspace="0.278em" rspace="0.278em" xref="S3.SS4.p2.10.m10.2.2.2.cmml">:=</mo><mrow id="S3.SS4.p2.10.m10.2.2.1" xref="S3.SS4.p2.10.m10.2.2.1.cmml"><msub id="S3.SS4.p2.10.m10.2.2.1.3" xref="S3.SS4.p2.10.m10.2.2.1.3.cmml"><mtext id="S3.SS4.p2.10.m10.2.2.1.3.2" xref="S3.SS4.p2.10.m10.2.2.1.3.2a.cmml">TopInd</mtext><msup id="S3.SS4.p2.10.m10.2.2.1.3.3" xref="S3.SS4.p2.10.m10.2.2.1.3.3.cmml"><mi id="S3.SS4.p2.10.m10.2.2.1.3.3.2" xref="S3.SS4.p2.10.m10.2.2.1.3.3.2.cmml">k</mi><mo id="S3.SS4.p2.10.m10.2.2.1.3.3.3" xref="S3.SS4.p2.10.m10.2.2.1.3.3.3.cmml">′</mo></msup></msub><mo id="S3.SS4.p2.10.m10.2.2.1.2" xref="S3.SS4.p2.10.m10.2.2.1.2.cmml">⁢</mo><mrow id="S3.SS4.p2.10.m10.2.2.1.1.1" xref="S3.SS4.p2.10.m10.2.2.1.1.1.1.cmml"><mo id="S3.SS4.p2.10.m10.2.2.1.1.1.2" xref="S3.SS4.p2.10.m10.2.2.1.1.1.1.cmml">(</mo><mrow id="S3.SS4.p2.10.m10.2.2.1.1.1.1" xref="S3.SS4.p2.10.m10.2.2.1.1.1.1.cmml"><mi id="S3.SS4.p2.10.m10.2.2.1.1.1.1.2" mathvariant="normal" xref="S3.SS4.p2.10.m10.2.2.1.1.1.1.2.cmml">Φ</mi><mo id="S3.SS4.p2.10.m10.2.2.1.1.1.1.1" xref="S3.SS4.p2.10.m10.2.2.1.1.1.1.1.cmml">⁢</mo><mrow id="S3.SS4.p2.10.m10.2.2.1.1.1.1.3.2" xref="S3.SS4.p2.10.m10.1.1.cmml"><mo id="S3.SS4.p2.10.m10.2.2.1.1.1.1.3.2.1" stretchy="false" xref="S3.SS4.p2.10.m10.1.1.cmml">(</mo><mover accent="true" id="S3.SS4.p2.10.m10.1.1" xref="S3.SS4.p2.10.m10.1.1.cmml"><mi id="S3.SS4.p2.10.m10.1.1.2" xref="S3.SS4.p2.10.m10.1.1.2.cmml">𝐱</mi><mo id="S3.SS4.p2.10.m10.1.1.1" stretchy="false" xref="S3.SS4.p2.10.m10.1.1.1.cmml">→</mo></mover><mo id="S3.SS4.p2.10.m10.2.2.1.1.1.1.3.2.2" stretchy="false" xref="S3.SS4.p2.10.m10.1.1.cmml">)</mo></mrow></mrow><mo id="S3.SS4.p2.10.m10.2.2.1.1.1.3" xref="S3.SS4.p2.10.m10.2.2.1.1.1.1.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.SS4.p2.10.m10.2b"><apply id="S3.SS4.p2.10.m10.2.2.cmml" xref="S3.SS4.p2.10.m10.2.2"><csymbol cd="latexml" id="S3.SS4.p2.10.m10.2.2.2.cmml" xref="S3.SS4.p2.10.m10.2.2.2">assign</csymbol><apply id="S3.SS4.p2.10.m10.2.2.3.cmml" xref="S3.SS4.p2.10.m10.2.2.3"><csymbol cd="ambiguous" id="S3.SS4.p2.10.m10.2.2.3.1.cmml" xref="S3.SS4.p2.10.m10.2.2.3">subscript</csymbol><apply id="S3.SS4.p2.10.m10.2.2.3.2.cmml" xref="S3.SS4.p2.10.m10.2.2.3"><csymbol cd="ambiguous" id="S3.SS4.p2.10.m10.2.2.3.2.1.cmml" xref="S3.SS4.p2.10.m10.2.2.3">superscript</csymbol><ci id="S3.SS4.p2.10.m10.2.2.3.2.2.cmml" xref="S3.SS4.p2.10.m10.2.2.3.2.2">𝑆</ci><ci id="S3.SS4.p2.10.m10.2.2.3.2.3.cmml" xref="S3.SS4.p2.10.m10.2.2.3.2.3">′</ci></apply><ci id="S3.SS4.p2.10.m10.2.2.3.3.cmml" xref="S3.SS4.p2.10.m10.2.2.3.3">𝑔</ci></apply><apply id="S3.SS4.p2.10.m10.2.2.1.cmml" xref="S3.SS4.p2.10.m10.2.2.1"><times id="S3.SS4.p2.10.m10.2.2.1.2.cmml" xref="S3.SS4.p2.10.m10.2.2.1.2"></times><apply id="S3.SS4.p2.10.m10.2.2.1.3.cmml" xref="S3.SS4.p2.10.m10.2.2.1.3"><csymbol cd="ambiguous" id="S3.SS4.p2.10.m10.2.2.1.3.1.cmml" xref="S3.SS4.p2.10.m10.2.2.1.3">subscript</csymbol><ci id="S3.SS4.p2.10.m10.2.2.1.3.2a.cmml" xref="S3.SS4.p2.10.m10.2.2.1.3.2"><mtext id="S3.SS4.p2.10.m10.2.2.1.3.2.cmml" xref="S3.SS4.p2.10.m10.2.2.1.3.2">TopInd</mtext></ci><apply id="S3.SS4.p2.10.m10.2.2.1.3.3.cmml" xref="S3.SS4.p2.10.m10.2.2.1.3.3"><csymbol cd="ambiguous" id="S3.SS4.p2.10.m10.2.2.1.3.3.1.cmml" xref="S3.SS4.p2.10.m10.2.2.1.3.3">superscript</csymbol><ci id="S3.SS4.p2.10.m10.2.2.1.3.3.2.cmml" xref="S3.SS4.p2.10.m10.2.2.1.3.3.2">𝑘</ci><ci id="S3.SS4.p2.10.m10.2.2.1.3.3.3.cmml" xref="S3.SS4.p2.10.m10.2.2.1.3.3.3">′</ci></apply></apply><apply id="S3.SS4.p2.10.m10.2.2.1.1.1.1.cmml" xref="S3.SS4.p2.10.m10.2.2.1.1.1"><times id="S3.SS4.p2.10.m10.2.2.1.1.1.1.1.cmml" xref="S3.SS4.p2.10.m10.2.2.1.1.1.1.1"></times><ci id="S3.SS4.p2.10.m10.2.2.1.1.1.1.2.cmml" xref="S3.SS4.p2.10.m10.2.2.1.1.1.1.2">Φ</ci><apply id="S3.SS4.p2.10.m10.1.1.cmml" xref="S3.SS4.p2.10.m10.2.2.1.1.1.1.3.2"><ci id="S3.SS4.p2.10.m10.1.1.1.cmml" xref="S3.SS4.p2.10.m10.1.1.1">→</ci><ci id="S3.SS4.p2.10.m10.1.1.2.cmml" xref="S3.SS4.p2.10.m10.1.1.2">𝐱</ci></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS4.p2.10.m10.2c">S^{\prime}_{g}:=\textrm{TopInd}_{k^{\prime}}\left(\Phi(\overrightarrow{\mathbf%
{x}})\right)</annotation><annotation encoding="application/x-llamapun" id="S3.SS4.p2.10.m10.2d">italic_S start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT start_POSTSUBSCRIPT italic_g end_POSTSUBSCRIPT := TopInd start_POSTSUBSCRIPT italic_k start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT end_POSTSUBSCRIPT ( roman_Φ ( over→ start_ARG bold_x end_ARG ) )</annotation></semantics></math>, and use:</p>
<table class="ltx_equationgroup ltx_eqn_align ltx_eqn_table" id="A2.EGx6">
<tbody id="S3.E6"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_align_right ltx_eqn_cell"><math alttext="\displaystyle\widetilde{\textrm{FF}}_{g,\frac{k^{\prime}}{g}}\left(%
\overrightarrow{\mathbf{x}}\right):=\sum_{j\in\widetilde{S}_{g}}\sum_{\ell=0}^%
{g}\phi(\langle\overrightarrow{\mathbf{u}}_{g*j+\ell},\overrightarrow{\mathbf{%
x}}\rangle)\overrightarrow{\mathbf{v}}_{g*j+\ell}," class="ltx_Math" display="inline" id="S3.E6.m1.5"><semantics id="S3.E6.m1.5a"><mrow id="S3.E6.m1.5.5.1" xref="S3.E6.m1.5.5.1.1.cmml"><mrow id="S3.E6.m1.5.5.1.1" xref="S3.E6.m1.5.5.1.1.cmml"><mrow id="S3.E6.m1.5.5.1.1.3" xref="S3.E6.m1.5.5.1.1.3.cmml"><msub id="S3.E6.m1.5.5.1.1.3.2" xref="S3.E6.m1.5.5.1.1.3.2.cmml"><mover accent="true" id="S3.E6.m1.5.5.1.1.3.2.2" xref="S3.E6.m1.5.5.1.1.3.2.2.cmml"><mtext id="S3.E6.m1.5.5.1.1.3.2.2.2" xref="S3.E6.m1.5.5.1.1.3.2.2.2a.cmml">FF</mtext><mo id="S3.E6.m1.5.5.1.1.3.2.2.1" xref="S3.E6.m1.5.5.1.1.3.2.2.1.cmml">~</mo></mover><mrow id="S3.E6.m1.2.2.2.4" xref="S3.E6.m1.2.2.2.3.cmml"><mi id="S3.E6.m1.1.1.1.1" xref="S3.E6.m1.1.1.1.1.cmml">g</mi><mo id="S3.E6.m1.2.2.2.4.1" xref="S3.E6.m1.2.2.2.3.cmml">,</mo><mfrac id="S3.E6.m1.2.2.2.2" xref="S3.E6.m1.2.2.2.2.cmml"><msup id="S3.E6.m1.2.2.2.2.2" xref="S3.E6.m1.2.2.2.2.2.cmml"><mi id="S3.E6.m1.2.2.2.2.2.2" xref="S3.E6.m1.2.2.2.2.2.2.cmml">k</mi><mo id="S3.E6.m1.2.2.2.2.2.3" xref="S3.E6.m1.2.2.2.2.2.3.cmml">′</mo></msup><mi id="S3.E6.m1.2.2.2.2.3" xref="S3.E6.m1.2.2.2.2.3.cmml">g</mi></mfrac></mrow></msub><mo id="S3.E6.m1.5.5.1.1.3.1" xref="S3.E6.m1.5.5.1.1.3.1.cmml">⁢</mo><mrow id="S3.E6.m1.5.5.1.1.3.3.2" xref="S3.E6.m1.3.3.cmml"><mo id="S3.E6.m1.5.5.1.1.3.3.2.1" xref="S3.E6.m1.3.3.cmml">(</mo><mover accent="true" id="S3.E6.m1.3.3" xref="S3.E6.m1.3.3.cmml"><mi id="S3.E6.m1.3.3.2" xref="S3.E6.m1.3.3.2.cmml">𝐱</mi><mo id="S3.E6.m1.3.3.1" stretchy="false" xref="S3.E6.m1.3.3.1.cmml">→</mo></mover><mo id="S3.E6.m1.5.5.1.1.3.3.2.2" rspace="0.278em" xref="S3.E6.m1.3.3.cmml">)</mo></mrow></mrow><mo id="S3.E6.m1.5.5.1.1.2" rspace="0.278em" xref="S3.E6.m1.5.5.1.1.2.cmml">:=</mo><mrow id="S3.E6.m1.5.5.1.1.1" xref="S3.E6.m1.5.5.1.1.1.cmml"><mstyle displaystyle="true" id="S3.E6.m1.5.5.1.1.1.2" xref="S3.E6.m1.5.5.1.1.1.2.cmml"><munder id="S3.E6.m1.5.5.1.1.1.2a" xref="S3.E6.m1.5.5.1.1.1.2.cmml"><mo id="S3.E6.m1.5.5.1.1.1.2.2" movablelimits="false" xref="S3.E6.m1.5.5.1.1.1.2.2.cmml">∑</mo><mrow id="S3.E6.m1.5.5.1.1.1.2.3" xref="S3.E6.m1.5.5.1.1.1.2.3.cmml"><mi id="S3.E6.m1.5.5.1.1.1.2.3.2" xref="S3.E6.m1.5.5.1.1.1.2.3.2.cmml">j</mi><mo id="S3.E6.m1.5.5.1.1.1.2.3.1" xref="S3.E6.m1.5.5.1.1.1.2.3.1.cmml">∈</mo><msub id="S3.E6.m1.5.5.1.1.1.2.3.3" xref="S3.E6.m1.5.5.1.1.1.2.3.3.cmml"><mover accent="true" id="S3.E6.m1.5.5.1.1.1.2.3.3.2" xref="S3.E6.m1.5.5.1.1.1.2.3.3.2.cmml"><mi id="S3.E6.m1.5.5.1.1.1.2.3.3.2.2" xref="S3.E6.m1.5.5.1.1.1.2.3.3.2.2.cmml">S</mi><mo id="S3.E6.m1.5.5.1.1.1.2.3.3.2.1" xref="S3.E6.m1.5.5.1.1.1.2.3.3.2.1.cmml">~</mo></mover><mi id="S3.E6.m1.5.5.1.1.1.2.3.3.3" xref="S3.E6.m1.5.5.1.1.1.2.3.3.3.cmml">g</mi></msub></mrow></munder></mstyle><mrow id="S3.E6.m1.5.5.1.1.1.1" xref="S3.E6.m1.5.5.1.1.1.1.cmml"><mstyle displaystyle="true" id="S3.E6.m1.5.5.1.1.1.1.2" xref="S3.E6.m1.5.5.1.1.1.1.2.cmml"><munderover id="S3.E6.m1.5.5.1.1.1.1.2a" xref="S3.E6.m1.5.5.1.1.1.1.2.cmml"><mo id="S3.E6.m1.5.5.1.1.1.1.2.2.2" movablelimits="false" xref="S3.E6.m1.5.5.1.1.1.1.2.2.2.cmml">∑</mo><mrow id="S3.E6.m1.5.5.1.1.1.1.2.2.3" xref="S3.E6.m1.5.5.1.1.1.1.2.2.3.cmml"><mi id="S3.E6.m1.5.5.1.1.1.1.2.2.3.2" mathvariant="normal" xref="S3.E6.m1.5.5.1.1.1.1.2.2.3.2.cmml">ℓ</mi><mo id="S3.E6.m1.5.5.1.1.1.1.2.2.3.1" xref="S3.E6.m1.5.5.1.1.1.1.2.2.3.1.cmml">=</mo><mn id="S3.E6.m1.5.5.1.1.1.1.2.2.3.3" xref="S3.E6.m1.5.5.1.1.1.1.2.2.3.3.cmml">0</mn></mrow><mi id="S3.E6.m1.5.5.1.1.1.1.2.3" xref="S3.E6.m1.5.5.1.1.1.1.2.3.cmml">g</mi></munderover></mstyle><mrow id="S3.E6.m1.5.5.1.1.1.1.1" xref="S3.E6.m1.5.5.1.1.1.1.1.cmml"><mi id="S3.E6.m1.5.5.1.1.1.1.1.3" xref="S3.E6.m1.5.5.1.1.1.1.1.3.cmml">ϕ</mi><mo id="S3.E6.m1.5.5.1.1.1.1.1.2" xref="S3.E6.m1.5.5.1.1.1.1.1.2.cmml">⁢</mo><mrow id="S3.E6.m1.5.5.1.1.1.1.1.1.1" xref="S3.E6.m1.5.5.1.1.1.1.1.cmml"><mo id="S3.E6.m1.5.5.1.1.1.1.1.1.1.2" stretchy="false" xref="S3.E6.m1.5.5.1.1.1.1.1.cmml">(</mo><mrow id="S3.E6.m1.5.5.1.1.1.1.1.1.1.1.1" xref="S3.E6.m1.5.5.1.1.1.1.1.1.1.1.2.cmml"><mo id="S3.E6.m1.5.5.1.1.1.1.1.1.1.1.1.2" stretchy="false" xref="S3.E6.m1.5.5.1.1.1.1.1.1.1.1.2.cmml">⟨</mo><msub id="S3.E6.m1.5.5.1.1.1.1.1.1.1.1.1.1" xref="S3.E6.m1.5.5.1.1.1.1.1.1.1.1.1.1.cmml"><mover accent="true" id="S3.E6.m1.5.5.1.1.1.1.1.1.1.1.1.1.2" xref="S3.E6.m1.5.5.1.1.1.1.1.1.1.1.1.1.2.cmml"><mi id="S3.E6.m1.5.5.1.1.1.1.1.1.1.1.1.1.2.2" xref="S3.E6.m1.5.5.1.1.1.1.1.1.1.1.1.1.2.2.cmml">𝐮</mi><mo id="S3.E6.m1.5.5.1.1.1.1.1.1.1.1.1.1.2.1" stretchy="false" xref="S3.E6.m1.5.5.1.1.1.1.1.1.1.1.1.1.2.1.cmml">→</mo></mover><mrow id="S3.E6.m1.5.5.1.1.1.1.1.1.1.1.1.1.3" xref="S3.E6.m1.5.5.1.1.1.1.1.1.1.1.1.1.3.cmml"><mrow id="S3.E6.m1.5.5.1.1.1.1.1.1.1.1.1.1.3.2" xref="S3.E6.m1.5.5.1.1.1.1.1.1.1.1.1.1.3.2.cmml"><mi id="S3.E6.m1.5.5.1.1.1.1.1.1.1.1.1.1.3.2.2" xref="S3.E6.m1.5.5.1.1.1.1.1.1.1.1.1.1.3.2.2.cmml">g</mi><mo id="S3.E6.m1.5.5.1.1.1.1.1.1.1.1.1.1.3.2.1" lspace="0.222em" rspace="0.222em" xref="S3.E6.m1.5.5.1.1.1.1.1.1.1.1.1.1.3.2.1.cmml">*</mo><mi id="S3.E6.m1.5.5.1.1.1.1.1.1.1.1.1.1.3.2.3" xref="S3.E6.m1.5.5.1.1.1.1.1.1.1.1.1.1.3.2.3.cmml">j</mi></mrow><mo id="S3.E6.m1.5.5.1.1.1.1.1.1.1.1.1.1.3.1" xref="S3.E6.m1.5.5.1.1.1.1.1.1.1.1.1.1.3.1.cmml">+</mo><mi id="S3.E6.m1.5.5.1.1.1.1.1.1.1.1.1.1.3.3" mathvariant="normal" xref="S3.E6.m1.5.5.1.1.1.1.1.1.1.1.1.1.3.3.cmml">ℓ</mi></mrow></msub><mo id="S3.E6.m1.5.5.1.1.1.1.1.1.1.1.1.3" xref="S3.E6.m1.5.5.1.1.1.1.1.1.1.1.2.cmml">,</mo><mover accent="true" id="S3.E6.m1.4.4" xref="S3.E6.m1.4.4.cmml"><mi id="S3.E6.m1.4.4.2" xref="S3.E6.m1.4.4.2.cmml">𝐱</mi><mo id="S3.E6.m1.4.4.1" stretchy="false" xref="S3.E6.m1.4.4.1.cmml">→</mo></mover><mo id="S3.E6.m1.5.5.1.1.1.1.1.1.1.1.1.4" stretchy="false" xref="S3.E6.m1.5.5.1.1.1.1.1.1.1.1.2.cmml">⟩</mo></mrow><mo id="S3.E6.m1.5.5.1.1.1.1.1.1.1.3" stretchy="false" xref="S3.E6.m1.5.5.1.1.1.1.1.cmml">)</mo></mrow><mo id="S3.E6.m1.5.5.1.1.1.1.1.2a" xref="S3.E6.m1.5.5.1.1.1.1.1.2.cmml">⁢</mo><msub id="S3.E6.m1.5.5.1.1.1.1.1.4" xref="S3.E6.m1.5.5.1.1.1.1.1.4.cmml"><mover accent="true" id="S3.E6.m1.5.5.1.1.1.1.1.4.2" xref="S3.E6.m1.5.5.1.1.1.1.1.4.2.cmml"><mi id="S3.E6.m1.5.5.1.1.1.1.1.4.2.2" xref="S3.E6.m1.5.5.1.1.1.1.1.4.2.2.cmml">𝐯</mi><mo id="S3.E6.m1.5.5.1.1.1.1.1.4.2.1" stretchy="false" xref="S3.E6.m1.5.5.1.1.1.1.1.4.2.1.cmml">→</mo></mover><mrow id="S3.E6.m1.5.5.1.1.1.1.1.4.3" xref="S3.E6.m1.5.5.1.1.1.1.1.4.3.cmml"><mrow id="S3.E6.m1.5.5.1.1.1.1.1.4.3.2" xref="S3.E6.m1.5.5.1.1.1.1.1.4.3.2.cmml"><mi id="S3.E6.m1.5.5.1.1.1.1.1.4.3.2.2" xref="S3.E6.m1.5.5.1.1.1.1.1.4.3.2.2.cmml">g</mi><mo id="S3.E6.m1.5.5.1.1.1.1.1.4.3.2.1" lspace="0.222em" rspace="0.222em" xref="S3.E6.m1.5.5.1.1.1.1.1.4.3.2.1.cmml">*</mo><mi id="S3.E6.m1.5.5.1.1.1.1.1.4.3.2.3" xref="S3.E6.m1.5.5.1.1.1.1.1.4.3.2.3.cmml">j</mi></mrow><mo id="S3.E6.m1.5.5.1.1.1.1.1.4.3.1" xref="S3.E6.m1.5.5.1.1.1.1.1.4.3.1.cmml">+</mo><mi id="S3.E6.m1.5.5.1.1.1.1.1.4.3.3" mathvariant="normal" xref="S3.E6.m1.5.5.1.1.1.1.1.4.3.3.cmml">ℓ</mi></mrow></msub></mrow></mrow></mrow></mrow><mo id="S3.E6.m1.5.5.1.2" xref="S3.E6.m1.5.5.1.1.cmml">,</mo></mrow><annotation-xml encoding="MathML-Content" id="S3.E6.m1.5b"><apply id="S3.E6.m1.5.5.1.1.cmml" xref="S3.E6.m1.5.5.1"><csymbol cd="latexml" id="S3.E6.m1.5.5.1.1.2.cmml" xref="S3.E6.m1.5.5.1.1.2">assign</csymbol><apply id="S3.E6.m1.5.5.1.1.3.cmml" xref="S3.E6.m1.5.5.1.1.3"><times id="S3.E6.m1.5.5.1.1.3.1.cmml" xref="S3.E6.m1.5.5.1.1.3.1"></times><apply id="S3.E6.m1.5.5.1.1.3.2.cmml" xref="S3.E6.m1.5.5.1.1.3.2"><csymbol cd="ambiguous" id="S3.E6.m1.5.5.1.1.3.2.1.cmml" xref="S3.E6.m1.5.5.1.1.3.2">subscript</csymbol><apply id="S3.E6.m1.5.5.1.1.3.2.2.cmml" xref="S3.E6.m1.5.5.1.1.3.2.2"><ci id="S3.E6.m1.5.5.1.1.3.2.2.1.cmml" xref="S3.E6.m1.5.5.1.1.3.2.2.1">~</ci><ci id="S3.E6.m1.5.5.1.1.3.2.2.2a.cmml" xref="S3.E6.m1.5.5.1.1.3.2.2.2"><mtext id="S3.E6.m1.5.5.1.1.3.2.2.2.cmml" xref="S3.E6.m1.5.5.1.1.3.2.2.2">FF</mtext></ci></apply><list id="S3.E6.m1.2.2.2.3.cmml" xref="S3.E6.m1.2.2.2.4"><ci id="S3.E6.m1.1.1.1.1.cmml" xref="S3.E6.m1.1.1.1.1">𝑔</ci><apply id="S3.E6.m1.2.2.2.2.cmml" xref="S3.E6.m1.2.2.2.2"><divide id="S3.E6.m1.2.2.2.2.1.cmml" xref="S3.E6.m1.2.2.2.2"></divide><apply id="S3.E6.m1.2.2.2.2.2.cmml" xref="S3.E6.m1.2.2.2.2.2"><csymbol cd="ambiguous" id="S3.E6.m1.2.2.2.2.2.1.cmml" xref="S3.E6.m1.2.2.2.2.2">superscript</csymbol><ci id="S3.E6.m1.2.2.2.2.2.2.cmml" xref="S3.E6.m1.2.2.2.2.2.2">𝑘</ci><ci id="S3.E6.m1.2.2.2.2.2.3.cmml" xref="S3.E6.m1.2.2.2.2.2.3">′</ci></apply><ci id="S3.E6.m1.2.2.2.2.3.cmml" xref="S3.E6.m1.2.2.2.2.3">𝑔</ci></apply></list></apply><apply id="S3.E6.m1.3.3.cmml" xref="S3.E6.m1.5.5.1.1.3.3.2"><ci id="S3.E6.m1.3.3.1.cmml" xref="S3.E6.m1.3.3.1">→</ci><ci id="S3.E6.m1.3.3.2.cmml" xref="S3.E6.m1.3.3.2">𝐱</ci></apply></apply><apply id="S3.E6.m1.5.5.1.1.1.cmml" xref="S3.E6.m1.5.5.1.1.1"><apply id="S3.E6.m1.5.5.1.1.1.2.cmml" xref="S3.E6.m1.5.5.1.1.1.2"><csymbol cd="ambiguous" id="S3.E6.m1.5.5.1.1.1.2.1.cmml" xref="S3.E6.m1.5.5.1.1.1.2">subscript</csymbol><sum id="S3.E6.m1.5.5.1.1.1.2.2.cmml" xref="S3.E6.m1.5.5.1.1.1.2.2"></sum><apply id="S3.E6.m1.5.5.1.1.1.2.3.cmml" xref="S3.E6.m1.5.5.1.1.1.2.3"><in id="S3.E6.m1.5.5.1.1.1.2.3.1.cmml" xref="S3.E6.m1.5.5.1.1.1.2.3.1"></in><ci id="S3.E6.m1.5.5.1.1.1.2.3.2.cmml" xref="S3.E6.m1.5.5.1.1.1.2.3.2">𝑗</ci><apply id="S3.E6.m1.5.5.1.1.1.2.3.3.cmml" xref="S3.E6.m1.5.5.1.1.1.2.3.3"><csymbol cd="ambiguous" id="S3.E6.m1.5.5.1.1.1.2.3.3.1.cmml" xref="S3.E6.m1.5.5.1.1.1.2.3.3">subscript</csymbol><apply id="S3.E6.m1.5.5.1.1.1.2.3.3.2.cmml" xref="S3.E6.m1.5.5.1.1.1.2.3.3.2"><ci id="S3.E6.m1.5.5.1.1.1.2.3.3.2.1.cmml" xref="S3.E6.m1.5.5.1.1.1.2.3.3.2.1">~</ci><ci id="S3.E6.m1.5.5.1.1.1.2.3.3.2.2.cmml" xref="S3.E6.m1.5.5.1.1.1.2.3.3.2.2">𝑆</ci></apply><ci id="S3.E6.m1.5.5.1.1.1.2.3.3.3.cmml" xref="S3.E6.m1.5.5.1.1.1.2.3.3.3">𝑔</ci></apply></apply></apply><apply id="S3.E6.m1.5.5.1.1.1.1.cmml" xref="S3.E6.m1.5.5.1.1.1.1"><apply id="S3.E6.m1.5.5.1.1.1.1.2.cmml" xref="S3.E6.m1.5.5.1.1.1.1.2"><csymbol cd="ambiguous" id="S3.E6.m1.5.5.1.1.1.1.2.1.cmml" xref="S3.E6.m1.5.5.1.1.1.1.2">superscript</csymbol><apply id="S3.E6.m1.5.5.1.1.1.1.2.2.cmml" xref="S3.E6.m1.5.5.1.1.1.1.2"><csymbol cd="ambiguous" id="S3.E6.m1.5.5.1.1.1.1.2.2.1.cmml" xref="S3.E6.m1.5.5.1.1.1.1.2">subscript</csymbol><sum id="S3.E6.m1.5.5.1.1.1.1.2.2.2.cmml" xref="S3.E6.m1.5.5.1.1.1.1.2.2.2"></sum><apply id="S3.E6.m1.5.5.1.1.1.1.2.2.3.cmml" xref="S3.E6.m1.5.5.1.1.1.1.2.2.3"><eq id="S3.E6.m1.5.5.1.1.1.1.2.2.3.1.cmml" xref="S3.E6.m1.5.5.1.1.1.1.2.2.3.1"></eq><ci id="S3.E6.m1.5.5.1.1.1.1.2.2.3.2.cmml" xref="S3.E6.m1.5.5.1.1.1.1.2.2.3.2">ℓ</ci><cn id="S3.E6.m1.5.5.1.1.1.1.2.2.3.3.cmml" type="integer" xref="S3.E6.m1.5.5.1.1.1.1.2.2.3.3">0</cn></apply></apply><ci id="S3.E6.m1.5.5.1.1.1.1.2.3.cmml" xref="S3.E6.m1.5.5.1.1.1.1.2.3">𝑔</ci></apply><apply id="S3.E6.m1.5.5.1.1.1.1.1.cmml" xref="S3.E6.m1.5.5.1.1.1.1.1"><times id="S3.E6.m1.5.5.1.1.1.1.1.2.cmml" xref="S3.E6.m1.5.5.1.1.1.1.1.2"></times><ci id="S3.E6.m1.5.5.1.1.1.1.1.3.cmml" xref="S3.E6.m1.5.5.1.1.1.1.1.3">italic-ϕ</ci><list id="S3.E6.m1.5.5.1.1.1.1.1.1.1.1.2.cmml" xref="S3.E6.m1.5.5.1.1.1.1.1.1.1.1.1"><apply id="S3.E6.m1.5.5.1.1.1.1.1.1.1.1.1.1.cmml" xref="S3.E6.m1.5.5.1.1.1.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S3.E6.m1.5.5.1.1.1.1.1.1.1.1.1.1.1.cmml" xref="S3.E6.m1.5.5.1.1.1.1.1.1.1.1.1.1">subscript</csymbol><apply id="S3.E6.m1.5.5.1.1.1.1.1.1.1.1.1.1.2.cmml" xref="S3.E6.m1.5.5.1.1.1.1.1.1.1.1.1.1.2"><ci id="S3.E6.m1.5.5.1.1.1.1.1.1.1.1.1.1.2.1.cmml" xref="S3.E6.m1.5.5.1.1.1.1.1.1.1.1.1.1.2.1">→</ci><ci id="S3.E6.m1.5.5.1.1.1.1.1.1.1.1.1.1.2.2.cmml" xref="S3.E6.m1.5.5.1.1.1.1.1.1.1.1.1.1.2.2">𝐮</ci></apply><apply id="S3.E6.m1.5.5.1.1.1.1.1.1.1.1.1.1.3.cmml" xref="S3.E6.m1.5.5.1.1.1.1.1.1.1.1.1.1.3"><plus id="S3.E6.m1.5.5.1.1.1.1.1.1.1.1.1.1.3.1.cmml" xref="S3.E6.m1.5.5.1.1.1.1.1.1.1.1.1.1.3.1"></plus><apply id="S3.E6.m1.5.5.1.1.1.1.1.1.1.1.1.1.3.2.cmml" xref="S3.E6.m1.5.5.1.1.1.1.1.1.1.1.1.1.3.2"><times id="S3.E6.m1.5.5.1.1.1.1.1.1.1.1.1.1.3.2.1.cmml" xref="S3.E6.m1.5.5.1.1.1.1.1.1.1.1.1.1.3.2.1"></times><ci id="S3.E6.m1.5.5.1.1.1.1.1.1.1.1.1.1.3.2.2.cmml" xref="S3.E6.m1.5.5.1.1.1.1.1.1.1.1.1.1.3.2.2">𝑔</ci><ci id="S3.E6.m1.5.5.1.1.1.1.1.1.1.1.1.1.3.2.3.cmml" xref="S3.E6.m1.5.5.1.1.1.1.1.1.1.1.1.1.3.2.3">𝑗</ci></apply><ci id="S3.E6.m1.5.5.1.1.1.1.1.1.1.1.1.1.3.3.cmml" xref="S3.E6.m1.5.5.1.1.1.1.1.1.1.1.1.1.3.3">ℓ</ci></apply></apply><apply id="S3.E6.m1.4.4.cmml" xref="S3.E6.m1.4.4"><ci id="S3.E6.m1.4.4.1.cmml" xref="S3.E6.m1.4.4.1">→</ci><ci id="S3.E6.m1.4.4.2.cmml" xref="S3.E6.m1.4.4.2">𝐱</ci></apply></list><apply id="S3.E6.m1.5.5.1.1.1.1.1.4.cmml" xref="S3.E6.m1.5.5.1.1.1.1.1.4"><csymbol cd="ambiguous" id="S3.E6.m1.5.5.1.1.1.1.1.4.1.cmml" xref="S3.E6.m1.5.5.1.1.1.1.1.4">subscript</csymbol><apply id="S3.E6.m1.5.5.1.1.1.1.1.4.2.cmml" xref="S3.E6.m1.5.5.1.1.1.1.1.4.2"><ci id="S3.E6.m1.5.5.1.1.1.1.1.4.2.1.cmml" xref="S3.E6.m1.5.5.1.1.1.1.1.4.2.1">→</ci><ci id="S3.E6.m1.5.5.1.1.1.1.1.4.2.2.cmml" xref="S3.E6.m1.5.5.1.1.1.1.1.4.2.2">𝐯</ci></apply><apply id="S3.E6.m1.5.5.1.1.1.1.1.4.3.cmml" xref="S3.E6.m1.5.5.1.1.1.1.1.4.3"><plus id="S3.E6.m1.5.5.1.1.1.1.1.4.3.1.cmml" xref="S3.E6.m1.5.5.1.1.1.1.1.4.3.1"></plus><apply id="S3.E6.m1.5.5.1.1.1.1.1.4.3.2.cmml" xref="S3.E6.m1.5.5.1.1.1.1.1.4.3.2"><times id="S3.E6.m1.5.5.1.1.1.1.1.4.3.2.1.cmml" xref="S3.E6.m1.5.5.1.1.1.1.1.4.3.2.1"></times><ci id="S3.E6.m1.5.5.1.1.1.1.1.4.3.2.2.cmml" xref="S3.E6.m1.5.5.1.1.1.1.1.4.3.2.2">𝑔</ci><ci id="S3.E6.m1.5.5.1.1.1.1.1.4.3.2.3.cmml" xref="S3.E6.m1.5.5.1.1.1.1.1.4.3.2.3">𝑗</ci></apply><ci id="S3.E6.m1.5.5.1.1.1.1.1.4.3.3.cmml" xref="S3.E6.m1.5.5.1.1.1.1.1.4.3.3">ℓ</ci></apply></apply></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.E6.m1.5c">\displaystyle\widetilde{\textrm{FF}}_{g,\frac{k^{\prime}}{g}}\left(%
\overrightarrow{\mathbf{x}}\right):=\sum_{j\in\widetilde{S}_{g}}\sum_{\ell=0}^%
{g}\phi(\langle\overrightarrow{\mathbf{u}}_{g*j+\ell},\overrightarrow{\mathbf{%
x}}\rangle)\overrightarrow{\mathbf{v}}_{g*j+\ell},</annotation><annotation encoding="application/x-llamapun" id="S3.E6.m1.5d">over~ start_ARG FF end_ARG start_POSTSUBSCRIPT italic_g , divide start_ARG italic_k start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT end_ARG start_ARG italic_g end_ARG end_POSTSUBSCRIPT ( over→ start_ARG bold_x end_ARG ) := ∑ start_POSTSUBSCRIPT italic_j ∈ over~ start_ARG italic_S end_ARG start_POSTSUBSCRIPT italic_g end_POSTSUBSCRIPT end_POSTSUBSCRIPT ∑ start_POSTSUBSCRIPT roman_ℓ = 0 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_g end_POSTSUPERSCRIPT italic_ϕ ( ⟨ over→ start_ARG bold_u end_ARG start_POSTSUBSCRIPT italic_g * italic_j + roman_ℓ end_POSTSUBSCRIPT , over→ start_ARG bold_x end_ARG ⟩ ) over→ start_ARG bold_v end_ARG start_POSTSUBSCRIPT italic_g * italic_j + roman_ℓ end_POSTSUBSCRIPT ,</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(6)</span></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S3.SS4.p2.14">where <math alttext="\widetilde{S}_{g}\subseteq[m/g]" class="ltx_Math" display="inline" id="S3.SS4.p2.11.m1.1"><semantics id="S3.SS4.p2.11.m1.1a"><mrow id="S3.SS4.p2.11.m1.1.1" xref="S3.SS4.p2.11.m1.1.1.cmml"><msub id="S3.SS4.p2.11.m1.1.1.3" xref="S3.SS4.p2.11.m1.1.1.3.cmml"><mover accent="true" id="S3.SS4.p2.11.m1.1.1.3.2" xref="S3.SS4.p2.11.m1.1.1.3.2.cmml"><mi id="S3.SS4.p2.11.m1.1.1.3.2.2" xref="S3.SS4.p2.11.m1.1.1.3.2.2.cmml">S</mi><mo id="S3.SS4.p2.11.m1.1.1.3.2.1" xref="S3.SS4.p2.11.m1.1.1.3.2.1.cmml">~</mo></mover><mi id="S3.SS4.p2.11.m1.1.1.3.3" xref="S3.SS4.p2.11.m1.1.1.3.3.cmml">g</mi></msub><mo id="S3.SS4.p2.11.m1.1.1.2" xref="S3.SS4.p2.11.m1.1.1.2.cmml">⊆</mo><mrow id="S3.SS4.p2.11.m1.1.1.1.1" xref="S3.SS4.p2.11.m1.1.1.1.2.cmml"><mo id="S3.SS4.p2.11.m1.1.1.1.1.2" stretchy="false" xref="S3.SS4.p2.11.m1.1.1.1.2.1.cmml">[</mo><mrow id="S3.SS4.p2.11.m1.1.1.1.1.1" xref="S3.SS4.p2.11.m1.1.1.1.1.1.cmml"><mi id="S3.SS4.p2.11.m1.1.1.1.1.1.2" xref="S3.SS4.p2.11.m1.1.1.1.1.1.2.cmml">m</mi><mo id="S3.SS4.p2.11.m1.1.1.1.1.1.1" xref="S3.SS4.p2.11.m1.1.1.1.1.1.1.cmml">/</mo><mi id="S3.SS4.p2.11.m1.1.1.1.1.1.3" xref="S3.SS4.p2.11.m1.1.1.1.1.1.3.cmml">g</mi></mrow><mo id="S3.SS4.p2.11.m1.1.1.1.1.3" stretchy="false" xref="S3.SS4.p2.11.m1.1.1.1.2.1.cmml">]</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.SS4.p2.11.m1.1b"><apply id="S3.SS4.p2.11.m1.1.1.cmml" xref="S3.SS4.p2.11.m1.1.1"><subset id="S3.SS4.p2.11.m1.1.1.2.cmml" xref="S3.SS4.p2.11.m1.1.1.2"></subset><apply id="S3.SS4.p2.11.m1.1.1.3.cmml" xref="S3.SS4.p2.11.m1.1.1.3"><csymbol cd="ambiguous" id="S3.SS4.p2.11.m1.1.1.3.1.cmml" xref="S3.SS4.p2.11.m1.1.1.3">subscript</csymbol><apply id="S3.SS4.p2.11.m1.1.1.3.2.cmml" xref="S3.SS4.p2.11.m1.1.1.3.2"><ci id="S3.SS4.p2.11.m1.1.1.3.2.1.cmml" xref="S3.SS4.p2.11.m1.1.1.3.2.1">~</ci><ci id="S3.SS4.p2.11.m1.1.1.3.2.2.cmml" xref="S3.SS4.p2.11.m1.1.1.3.2.2">𝑆</ci></apply><ci id="S3.SS4.p2.11.m1.1.1.3.3.cmml" xref="S3.SS4.p2.11.m1.1.1.3.3">𝑔</ci></apply><apply id="S3.SS4.p2.11.m1.1.1.1.2.cmml" xref="S3.SS4.p2.11.m1.1.1.1.1"><csymbol cd="latexml" id="S3.SS4.p2.11.m1.1.1.1.2.1.cmml" xref="S3.SS4.p2.11.m1.1.1.1.1.2">delimited-[]</csymbol><apply id="S3.SS4.p2.11.m1.1.1.1.1.1.cmml" xref="S3.SS4.p2.11.m1.1.1.1.1.1"><divide id="S3.SS4.p2.11.m1.1.1.1.1.1.1.cmml" xref="S3.SS4.p2.11.m1.1.1.1.1.1.1"></divide><ci id="S3.SS4.p2.11.m1.1.1.1.1.1.2.cmml" xref="S3.SS4.p2.11.m1.1.1.1.1.1.2">𝑚</ci><ci id="S3.SS4.p2.11.m1.1.1.1.1.1.3.cmml" xref="S3.SS4.p2.11.m1.1.1.1.1.1.3">𝑔</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS4.p2.11.m1.1c">\widetilde{S}_{g}\subseteq[m/g]</annotation><annotation encoding="application/x-llamapun" id="S3.SS4.p2.11.m1.1d">over~ start_ARG italic_S end_ARG start_POSTSUBSCRIPT italic_g end_POSTSUBSCRIPT ⊆ [ italic_m / italic_g ]</annotation></semantics></math> is a subset of groups selected as <math alttext="\widetilde{S}_{g}:=\textrm{GroupTopInd}_{g,k/g}\left(\phi({\mathbf{U}}|_{{S^{%
\prime}}_{g}}^{\top}\overrightarrow{\mathbf{x}})\right)" class="ltx_Math" display="inline" id="S3.SS4.p2.12.m2.6"><semantics id="S3.SS4.p2.12.m2.6a"><mrow id="S3.SS4.p2.12.m2.6.6" xref="S3.SS4.p2.12.m2.6.6.cmml"><msub id="S3.SS4.p2.12.m2.6.6.3" xref="S3.SS4.p2.12.m2.6.6.3.cmml"><mover accent="true" id="S3.SS4.p2.12.m2.6.6.3.2" xref="S3.SS4.p2.12.m2.6.6.3.2.cmml"><mi id="S3.SS4.p2.12.m2.6.6.3.2.2" xref="S3.SS4.p2.12.m2.6.6.3.2.2.cmml">S</mi><mo id="S3.SS4.p2.12.m2.6.6.3.2.1" xref="S3.SS4.p2.12.m2.6.6.3.2.1.cmml">~</mo></mover><mi id="S3.SS4.p2.12.m2.6.6.3.3" xref="S3.SS4.p2.12.m2.6.6.3.3.cmml">g</mi></msub><mo id="S3.SS4.p2.12.m2.6.6.2" lspace="0.278em" rspace="0.278em" xref="S3.SS4.p2.12.m2.6.6.2.cmml">:=</mo><mrow id="S3.SS4.p2.12.m2.6.6.1" xref="S3.SS4.p2.12.m2.6.6.1.cmml"><msub id="S3.SS4.p2.12.m2.6.6.1.3" xref="S3.SS4.p2.12.m2.6.6.1.3.cmml"><mtext id="S3.SS4.p2.12.m2.6.6.1.3.2" xref="S3.SS4.p2.12.m2.6.6.1.3.2a.cmml">GroupTopInd</mtext><mrow id="S3.SS4.p2.12.m2.2.2.2.2" xref="S3.SS4.p2.12.m2.2.2.2.3.cmml"><mi id="S3.SS4.p2.12.m2.1.1.1.1" xref="S3.SS4.p2.12.m2.1.1.1.1.cmml">g</mi><mo id="S3.SS4.p2.12.m2.2.2.2.2.2" xref="S3.SS4.p2.12.m2.2.2.2.3.cmml">,</mo><mrow id="S3.SS4.p2.12.m2.2.2.2.2.1" xref="S3.SS4.p2.12.m2.2.2.2.2.1.cmml"><mi id="S3.SS4.p2.12.m2.2.2.2.2.1.2" xref="S3.SS4.p2.12.m2.2.2.2.2.1.2.cmml">k</mi><mo id="S3.SS4.p2.12.m2.2.2.2.2.1.1" xref="S3.SS4.p2.12.m2.2.2.2.2.1.1.cmml">/</mo><mi id="S3.SS4.p2.12.m2.2.2.2.2.1.3" xref="S3.SS4.p2.12.m2.2.2.2.2.1.3.cmml">g</mi></mrow></mrow></msub><mo id="S3.SS4.p2.12.m2.6.6.1.2" xref="S3.SS4.p2.12.m2.6.6.1.2.cmml">⁢</mo><mrow id="S3.SS4.p2.12.m2.6.6.1.1.1" xref="S3.SS4.p2.12.m2.6.6.1.1.1.1.cmml"><mo id="S3.SS4.p2.12.m2.6.6.1.1.1.2" xref="S3.SS4.p2.12.m2.6.6.1.1.1.1.cmml">(</mo><mrow id="S3.SS4.p2.12.m2.6.6.1.1.1.1" xref="S3.SS4.p2.12.m2.6.6.1.1.1.1.cmml"><mi id="S3.SS4.p2.12.m2.6.6.1.1.1.1.3" xref="S3.SS4.p2.12.m2.6.6.1.1.1.1.3.cmml">ϕ</mi><mo id="S3.SS4.p2.12.m2.6.6.1.1.1.1.2" xref="S3.SS4.p2.12.m2.6.6.1.1.1.1.2.cmml">⁢</mo><mrow id="S3.SS4.p2.12.m2.6.6.1.1.1.1.1.1" xref="S3.SS4.p2.12.m2.6.6.1.1.1.1.1.1.1.cmml"><mo id="S3.SS4.p2.12.m2.6.6.1.1.1.1.1.1.2" stretchy="false" xref="S3.SS4.p2.12.m2.6.6.1.1.1.1.1.1.1.cmml">(</mo><mrow id="S3.SS4.p2.12.m2.6.6.1.1.1.1.1.1.1" xref="S3.SS4.p2.12.m2.6.6.1.1.1.1.1.1.1.cmml"><msubsup id="S3.SS4.p2.12.m2.6.6.1.1.1.1.1.1.1.2.2" xref="S3.SS4.p2.12.m2.6.6.1.1.1.1.1.1.1.2.1.cmml"><mrow id="S3.SS4.p2.12.m2.6.6.1.1.1.1.1.1.1.2.2.2.2" xref="S3.SS4.p2.12.m2.6.6.1.1.1.1.1.1.1.2.1.cmml"><mi id="S3.SS4.p2.12.m2.3.3" xref="S3.SS4.p2.12.m2.3.3.cmml">𝐔</mi><mo id="S3.SS4.p2.12.m2.6.6.1.1.1.1.1.1.1.2.2.2.2.1" stretchy="false" xref="S3.SS4.p2.12.m2.6.6.1.1.1.1.1.1.1.2.1.1.cmml">|</mo></mrow><mmultiscripts id="S3.SS4.p2.12.m2.4.4.1" xref="S3.SS4.p2.12.m2.4.4.1.cmml"><mi id="S3.SS4.p2.12.m2.4.4.1.2.2" xref="S3.SS4.p2.12.m2.4.4.1.2.2.cmml">S</mi><mrow id="S3.SS4.p2.12.m2.4.4.1a" xref="S3.SS4.p2.12.m2.4.4.1.cmml"></mrow><mo id="S3.SS4.p2.12.m2.4.4.1.2.3" xref="S3.SS4.p2.12.m2.4.4.1.2.3.cmml">′</mo><mi id="S3.SS4.p2.12.m2.4.4.1.3" xref="S3.SS4.p2.12.m2.4.4.1.3.cmml">g</mi><mrow id="S3.SS4.p2.12.m2.4.4.1b" xref="S3.SS4.p2.12.m2.4.4.1.cmml"></mrow></mmultiscripts><mo id="S3.SS4.p2.12.m2.5.5.1" xref="S3.SS4.p2.12.m2.5.5.1.cmml">⊤</mo></msubsup><mo id="S3.SS4.p2.12.m2.6.6.1.1.1.1.1.1.1.1" xref="S3.SS4.p2.12.m2.6.6.1.1.1.1.1.1.1.1.cmml">⁢</mo><mover accent="true" id="S3.SS4.p2.12.m2.6.6.1.1.1.1.1.1.1.3" xref="S3.SS4.p2.12.m2.6.6.1.1.1.1.1.1.1.3.cmml"><mi id="S3.SS4.p2.12.m2.6.6.1.1.1.1.1.1.1.3.2" xref="S3.SS4.p2.12.m2.6.6.1.1.1.1.1.1.1.3.2.cmml">𝐱</mi><mo id="S3.SS4.p2.12.m2.6.6.1.1.1.1.1.1.1.3.1" stretchy="false" xref="S3.SS4.p2.12.m2.6.6.1.1.1.1.1.1.1.3.1.cmml">→</mo></mover></mrow><mo id="S3.SS4.p2.12.m2.6.6.1.1.1.1.1.1.3" stretchy="false" xref="S3.SS4.p2.12.m2.6.6.1.1.1.1.1.1.1.cmml">)</mo></mrow></mrow><mo id="S3.SS4.p2.12.m2.6.6.1.1.1.3" xref="S3.SS4.p2.12.m2.6.6.1.1.1.1.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.SS4.p2.12.m2.6b"><apply id="S3.SS4.p2.12.m2.6.6.cmml" xref="S3.SS4.p2.12.m2.6.6"><csymbol cd="latexml" id="S3.SS4.p2.12.m2.6.6.2.cmml" xref="S3.SS4.p2.12.m2.6.6.2">assign</csymbol><apply id="S3.SS4.p2.12.m2.6.6.3.cmml" xref="S3.SS4.p2.12.m2.6.6.3"><csymbol cd="ambiguous" id="S3.SS4.p2.12.m2.6.6.3.1.cmml" xref="S3.SS4.p2.12.m2.6.6.3">subscript</csymbol><apply id="S3.SS4.p2.12.m2.6.6.3.2.cmml" xref="S3.SS4.p2.12.m2.6.6.3.2"><ci id="S3.SS4.p2.12.m2.6.6.3.2.1.cmml" xref="S3.SS4.p2.12.m2.6.6.3.2.1">~</ci><ci id="S3.SS4.p2.12.m2.6.6.3.2.2.cmml" xref="S3.SS4.p2.12.m2.6.6.3.2.2">𝑆</ci></apply><ci id="S3.SS4.p2.12.m2.6.6.3.3.cmml" xref="S3.SS4.p2.12.m2.6.6.3.3">𝑔</ci></apply><apply id="S3.SS4.p2.12.m2.6.6.1.cmml" xref="S3.SS4.p2.12.m2.6.6.1"><times id="S3.SS4.p2.12.m2.6.6.1.2.cmml" xref="S3.SS4.p2.12.m2.6.6.1.2"></times><apply id="S3.SS4.p2.12.m2.6.6.1.3.cmml" xref="S3.SS4.p2.12.m2.6.6.1.3"><csymbol cd="ambiguous" id="S3.SS4.p2.12.m2.6.6.1.3.1.cmml" xref="S3.SS4.p2.12.m2.6.6.1.3">subscript</csymbol><ci id="S3.SS4.p2.12.m2.6.6.1.3.2a.cmml" xref="S3.SS4.p2.12.m2.6.6.1.3.2"><mtext id="S3.SS4.p2.12.m2.6.6.1.3.2.cmml" xref="S3.SS4.p2.12.m2.6.6.1.3.2">GroupTopInd</mtext></ci><list id="S3.SS4.p2.12.m2.2.2.2.3.cmml" xref="S3.SS4.p2.12.m2.2.2.2.2"><ci id="S3.SS4.p2.12.m2.1.1.1.1.cmml" xref="S3.SS4.p2.12.m2.1.1.1.1">𝑔</ci><apply id="S3.SS4.p2.12.m2.2.2.2.2.1.cmml" xref="S3.SS4.p2.12.m2.2.2.2.2.1"><divide id="S3.SS4.p2.12.m2.2.2.2.2.1.1.cmml" xref="S3.SS4.p2.12.m2.2.2.2.2.1.1"></divide><ci id="S3.SS4.p2.12.m2.2.2.2.2.1.2.cmml" xref="S3.SS4.p2.12.m2.2.2.2.2.1.2">𝑘</ci><ci id="S3.SS4.p2.12.m2.2.2.2.2.1.3.cmml" xref="S3.SS4.p2.12.m2.2.2.2.2.1.3">𝑔</ci></apply></list></apply><apply id="S3.SS4.p2.12.m2.6.6.1.1.1.1.cmml" xref="S3.SS4.p2.12.m2.6.6.1.1.1"><times id="S3.SS4.p2.12.m2.6.6.1.1.1.1.2.cmml" xref="S3.SS4.p2.12.m2.6.6.1.1.1.1.2"></times><ci id="S3.SS4.p2.12.m2.6.6.1.1.1.1.3.cmml" xref="S3.SS4.p2.12.m2.6.6.1.1.1.1.3">italic-ϕ</ci><apply id="S3.SS4.p2.12.m2.6.6.1.1.1.1.1.1.1.cmml" xref="S3.SS4.p2.12.m2.6.6.1.1.1.1.1.1"><times id="S3.SS4.p2.12.m2.6.6.1.1.1.1.1.1.1.1.cmml" xref="S3.SS4.p2.12.m2.6.6.1.1.1.1.1.1.1.1"></times><apply id="S3.SS4.p2.12.m2.6.6.1.1.1.1.1.1.1.2.1.cmml" xref="S3.SS4.p2.12.m2.6.6.1.1.1.1.1.1.1.2.2"><csymbol cd="latexml" id="S3.SS4.p2.12.m2.6.6.1.1.1.1.1.1.1.2.1.1.cmml" xref="S3.SS4.p2.12.m2.6.6.1.1.1.1.1.1.1.2.2.2.2.1">evaluated-at</csymbol><ci id="S3.SS4.p2.12.m2.3.3.cmml" xref="S3.SS4.p2.12.m2.3.3">𝐔</ci><apply id="S3.SS4.p2.12.m2.4.4.1.cmml" xref="S3.SS4.p2.12.m2.4.4.1"><csymbol cd="ambiguous" id="S3.SS4.p2.12.m2.4.4.1.1.cmml" xref="S3.SS4.p2.12.m2.4.4.1">subscript</csymbol><apply id="S3.SS4.p2.12.m2.4.4.1.2.cmml" xref="S3.SS4.p2.12.m2.4.4.1"><csymbol cd="ambiguous" id="S3.SS4.p2.12.m2.4.4.1.2.1.cmml" xref="S3.SS4.p2.12.m2.4.4.1">superscript</csymbol><ci id="S3.SS4.p2.12.m2.4.4.1.2.2.cmml" xref="S3.SS4.p2.12.m2.4.4.1.2.2">𝑆</ci><ci id="S3.SS4.p2.12.m2.4.4.1.2.3.cmml" xref="S3.SS4.p2.12.m2.4.4.1.2.3">′</ci></apply><ci id="S3.SS4.p2.12.m2.4.4.1.3.cmml" xref="S3.SS4.p2.12.m2.4.4.1.3">𝑔</ci></apply><csymbol cd="latexml" id="S3.SS4.p2.12.m2.5.5.1.cmml" xref="S3.SS4.p2.12.m2.5.5.1">top</csymbol></apply><apply id="S3.SS4.p2.12.m2.6.6.1.1.1.1.1.1.1.3.cmml" xref="S3.SS4.p2.12.m2.6.6.1.1.1.1.1.1.1.3"><ci id="S3.SS4.p2.12.m2.6.6.1.1.1.1.1.1.1.3.1.cmml" xref="S3.SS4.p2.12.m2.6.6.1.1.1.1.1.1.1.3.1">→</ci><ci id="S3.SS4.p2.12.m2.6.6.1.1.1.1.1.1.1.3.2.cmml" xref="S3.SS4.p2.12.m2.6.6.1.1.1.1.1.1.1.3.2">𝐱</ci></apply></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS4.p2.12.m2.6c">\widetilde{S}_{g}:=\textrm{GroupTopInd}_{g,k/g}\left(\phi({\mathbf{U}}|_{{S^{%
\prime}}_{g}}^{\top}\overrightarrow{\mathbf{x}})\right)</annotation><annotation encoding="application/x-llamapun" id="S3.SS4.p2.12.m2.6d">over~ start_ARG italic_S end_ARG start_POSTSUBSCRIPT italic_g end_POSTSUBSCRIPT := GroupTopInd start_POSTSUBSCRIPT italic_g , italic_k / italic_g end_POSTSUBSCRIPT ( italic_ϕ ( bold_U | start_POSTSUBSCRIPT italic_S start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT start_POSTSUBSCRIPT italic_g end_POSTSUBSCRIPT end_POSTSUBSCRIPT start_POSTSUPERSCRIPT ⊤ end_POSTSUPERSCRIPT over→ start_ARG bold_x end_ARG ) )</annotation></semantics></math>, where <math alttext="{S^{\prime}}_{g}" class="ltx_Math" display="inline" id="S3.SS4.p2.13.m3.1"><semantics id="S3.SS4.p2.13.m3.1a"><mmultiscripts id="S3.SS4.p2.13.m3.1.1" xref="S3.SS4.p2.13.m3.1.1.cmml"><mi id="S3.SS4.p2.13.m3.1.1.2.2" xref="S3.SS4.p2.13.m3.1.1.2.2.cmml">S</mi><mrow id="S3.SS4.p2.13.m3.1.1a" xref="S3.SS4.p2.13.m3.1.1.cmml"></mrow><mo id="S3.SS4.p2.13.m3.1.1.2.3" xref="S3.SS4.p2.13.m3.1.1.2.3.cmml">′</mo><mi id="S3.SS4.p2.13.m3.1.1.3" xref="S3.SS4.p2.13.m3.1.1.3.cmml">g</mi><mrow id="S3.SS4.p2.13.m3.1.1b" xref="S3.SS4.p2.13.m3.1.1.cmml"></mrow></mmultiscripts><annotation-xml encoding="MathML-Content" id="S3.SS4.p2.13.m3.1b"><apply id="S3.SS4.p2.13.m3.1.1.cmml" xref="S3.SS4.p2.13.m3.1.1"><csymbol cd="ambiguous" id="S3.SS4.p2.13.m3.1.1.1.cmml" xref="S3.SS4.p2.13.m3.1.1">subscript</csymbol><apply id="S3.SS4.p2.13.m3.1.1.2.cmml" xref="S3.SS4.p2.13.m3.1.1"><csymbol cd="ambiguous" id="S3.SS4.p2.13.m3.1.1.2.1.cmml" xref="S3.SS4.p2.13.m3.1.1">superscript</csymbol><ci id="S3.SS4.p2.13.m3.1.1.2.2.cmml" xref="S3.SS4.p2.13.m3.1.1.2.2">𝑆</ci><ci id="S3.SS4.p2.13.m3.1.1.2.3.cmml" xref="S3.SS4.p2.13.m3.1.1.2.3">′</ci></apply><ci id="S3.SS4.p2.13.m3.1.1.3.cmml" xref="S3.SS4.p2.13.m3.1.1.3">𝑔</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS4.p2.13.m3.1c">{S^{\prime}}_{g}</annotation><annotation encoding="application/x-llamapun" id="S3.SS4.p2.13.m3.1d">italic_S start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT start_POSTSUBSCRIPT italic_g end_POSTSUBSCRIPT</annotation></semantics></math> is an estimate of the groups of neurons that will actually be activated. We can again use Algorithm <a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#alg1" title="Algorithm 1 ‣ 3.2.1 Solving equation 5 accurately and efficiently ‣ 3.2 HiRE: Overall Approach ‣ 3 Main Ideas ‣ HiRE: High Recall Approximate Top-𝑘 Estimation for Efficient LLM Inference"><span class="ltx_text ltx_ref_tag">1</span></a> (resp. Algorithm <a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#alg2" title='Algorithm 2 ‣ 3.2.2 "DA-TOP-"⁢𝑘: Multi-device serving with approximate distributed top-𝑘 operation ‣ 3.2 HiRE: Overall Approach ‣ 3 Main Ideas ‣ HiRE: High Recall Approximate Top-𝑘 Estimation for Efficient LLM Inference'><span class="ltx_text ltx_ref_tag">2</span></a>) to compute <math alttext="\widetilde{S}_{g}" class="ltx_Math" display="inline" id="S3.SS4.p2.14.m4.1"><semantics id="S3.SS4.p2.14.m4.1a"><msub id="S3.SS4.p2.14.m4.1.1" xref="S3.SS4.p2.14.m4.1.1.cmml"><mover accent="true" id="S3.SS4.p2.14.m4.1.1.2" xref="S3.SS4.p2.14.m4.1.1.2.cmml"><mi id="S3.SS4.p2.14.m4.1.1.2.2" xref="S3.SS4.p2.14.m4.1.1.2.2.cmml">S</mi><mo id="S3.SS4.p2.14.m4.1.1.2.1" xref="S3.SS4.p2.14.m4.1.1.2.1.cmml">~</mo></mover><mi id="S3.SS4.p2.14.m4.1.1.3" xref="S3.SS4.p2.14.m4.1.1.3.cmml">g</mi></msub><annotation-xml encoding="MathML-Content" id="S3.SS4.p2.14.m4.1b"><apply id="S3.SS4.p2.14.m4.1.1.cmml" xref="S3.SS4.p2.14.m4.1.1"><csymbol cd="ambiguous" id="S3.SS4.p2.14.m4.1.1.1.cmml" xref="S3.SS4.p2.14.m4.1.1">subscript</csymbol><apply id="S3.SS4.p2.14.m4.1.1.2.cmml" xref="S3.SS4.p2.14.m4.1.1.2"><ci id="S3.SS4.p2.14.m4.1.1.2.1.cmml" xref="S3.SS4.p2.14.m4.1.1.2.1">~</ci><ci id="S3.SS4.p2.14.m4.1.1.2.2.cmml" xref="S3.SS4.p2.14.m4.1.1.2.2">𝑆</ci></apply><ci id="S3.SS4.p2.14.m4.1.1.3.cmml" xref="S3.SS4.p2.14.m4.1.1.3">𝑔</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS4.p2.14.m4.1c">\widetilde{S}_{g}</annotation><annotation encoding="application/x-llamapun" id="S3.SS4.p2.14.m4.1d">over~ start_ARG italic_S end_ARG start_POSTSUBSCRIPT italic_g end_POSTSUBSCRIPT</annotation></semantics></math> in the single (resp. multiple) device settings.
</p>
</div>
<section class="ltx_subsubsection" id="S3.SS4.SSS1">
<h4 class="ltx_title ltx_title_subsubsection">
<span class="ltx_tag ltx_tag_subsubsection">3.4.1 </span>Enhancing sparsity further by exploiting static and dynamic activation overlap</h4>
<div class="ltx_para" id="S3.SS4.SSS1.p1">
<p class="ltx_p" id="S3.SS4.SSS1.p1.1">Motivated by the observation that there is substantial overlap in non-zero activations across tokens, we also propose the following approaches to exploit static and dynamic activation overlap.</p>
</div>
<section class="ltx_paragraph" id="S3.SS4.SSS1.Px1">
<h5 class="ltx_title ltx_title_paragraph">Static overlap</h5>
<div class="ltx_para" id="S3.SS4.SSS1.Px1.p1">
<p class="ltx_p" id="S3.SS4.SSS1.Px1.p1.2">: The first idea is to augment the sparse FFN layer with a <em class="ltx_emph ltx_font_italic" id="S3.SS4.SSS1.Px1.p1.2.1">dense common path</em> of neurons that are activated for all tokens, so that the number of non-zeros in the sparse part can be reduced further. More concretely, the feedforward layer comprises of two sets of <math alttext="m_{1}" class="ltx_Math" display="inline" id="S3.SS4.SSS1.Px1.p1.1.m1.1"><semantics id="S3.SS4.SSS1.Px1.p1.1.m1.1a"><msub id="S3.SS4.SSS1.Px1.p1.1.m1.1.1" xref="S3.SS4.SSS1.Px1.p1.1.m1.1.1.cmml"><mi id="S3.SS4.SSS1.Px1.p1.1.m1.1.1.2" xref="S3.SS4.SSS1.Px1.p1.1.m1.1.1.2.cmml">m</mi><mn id="S3.SS4.SSS1.Px1.p1.1.m1.1.1.3" xref="S3.SS4.SSS1.Px1.p1.1.m1.1.1.3.cmml">1</mn></msub><annotation-xml encoding="MathML-Content" id="S3.SS4.SSS1.Px1.p1.1.m1.1b"><apply id="S3.SS4.SSS1.Px1.p1.1.m1.1.1.cmml" xref="S3.SS4.SSS1.Px1.p1.1.m1.1.1"><csymbol cd="ambiguous" id="S3.SS4.SSS1.Px1.p1.1.m1.1.1.1.cmml" xref="S3.SS4.SSS1.Px1.p1.1.m1.1.1">subscript</csymbol><ci id="S3.SS4.SSS1.Px1.p1.1.m1.1.1.2.cmml" xref="S3.SS4.SSS1.Px1.p1.1.m1.1.1.2">𝑚</ci><cn id="S3.SS4.SSS1.Px1.p1.1.m1.1.1.3.cmml" type="integer" xref="S3.SS4.SSS1.Px1.p1.1.m1.1.1.3">1</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS4.SSS1.Px1.p1.1.m1.1c">m_{1}</annotation><annotation encoding="application/x-llamapun" id="S3.SS4.SSS1.Px1.p1.1.m1.1d">italic_m start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT</annotation></semantics></math> and <math alttext="m_{2}" class="ltx_Math" display="inline" id="S3.SS4.SSS1.Px1.p1.2.m2.1"><semantics id="S3.SS4.SSS1.Px1.p1.2.m2.1a"><msub id="S3.SS4.SSS1.Px1.p1.2.m2.1.1" xref="S3.SS4.SSS1.Px1.p1.2.m2.1.1.cmml"><mi id="S3.SS4.SSS1.Px1.p1.2.m2.1.1.2" xref="S3.SS4.SSS1.Px1.p1.2.m2.1.1.2.cmml">m</mi><mn id="S3.SS4.SSS1.Px1.p1.2.m2.1.1.3" xref="S3.SS4.SSS1.Px1.p1.2.m2.1.1.3.cmml">2</mn></msub><annotation-xml encoding="MathML-Content" id="S3.SS4.SSS1.Px1.p1.2.m2.1b"><apply id="S3.SS4.SSS1.Px1.p1.2.m2.1.1.cmml" xref="S3.SS4.SSS1.Px1.p1.2.m2.1.1"><csymbol cd="ambiguous" id="S3.SS4.SSS1.Px1.p1.2.m2.1.1.1.cmml" xref="S3.SS4.SSS1.Px1.p1.2.m2.1.1">subscript</csymbol><ci id="S3.SS4.SSS1.Px1.p1.2.m2.1.1.2.cmml" xref="S3.SS4.SSS1.Px1.p1.2.m2.1.1.2">𝑚</ci><cn id="S3.SS4.SSS1.Px1.p1.2.m2.1.1.3.cmml" type="integer" xref="S3.SS4.SSS1.Px1.p1.2.m2.1.1.3">2</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS4.SSS1.Px1.p1.2.m2.1c">m_{2}</annotation><annotation encoding="application/x-llamapun" id="S3.SS4.SSS1.Px1.p1.2.m2.1d">italic_m start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT</annotation></semantics></math> hidden units respectively, where the first set of neurons is used in a dense manner equation <a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#S3.E3" title="3 ‣ 3.1 Problem Setup ‣ 3 Main Ideas ‣ HiRE: High Recall Approximate Top-𝑘 Estimation for Efficient LLM Inference"><span class="ltx_text ltx_ref_tag">3</span></a>, while the second set is used in a group sparse manner equation <a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#S3.E6" title="6 ‣ 3.4 HiRE-FFN: Efficient FFN using HiRE ‣ 3 Main Ideas ‣ HiRE: High Recall Approximate Top-𝑘 Estimation for Efficient LLM Inference"><span class="ltx_text ltx_ref_tag">6</span></a>. We have:
</p>
<table class="ltx_equationgroup ltx_eqn_align ltx_eqn_table" id="A2.EGx7">
<tbody id="S3.Ex1"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle\widetilde{\textrm{FF}}_{\textrm{CommonPath}}\left(%
\overrightarrow{\mathbf{x}}\right)=\sum_{j=1}^{m_{1}}\phi(\langle%
\overrightarrow{\mathbf{u}}_{j}^{d},\overrightarrow{\mathbf{x}}\rangle)%
\overrightarrow{\mathbf{v}}_{j}^{d}" class="ltx_Math" display="inline" id="S3.Ex1.m1.3"><semantics id="S3.Ex1.m1.3a"><mrow id="S3.Ex1.m1.3.3" xref="S3.Ex1.m1.3.3.cmml"><mrow id="S3.Ex1.m1.3.3.3" xref="S3.Ex1.m1.3.3.3.cmml"><msub id="S3.Ex1.m1.3.3.3.2" xref="S3.Ex1.m1.3.3.3.2.cmml"><mover accent="true" id="S3.Ex1.m1.3.3.3.2.2" xref="S3.Ex1.m1.3.3.3.2.2.cmml"><mtext id="S3.Ex1.m1.3.3.3.2.2.2" xref="S3.Ex1.m1.3.3.3.2.2.2a.cmml">FF</mtext><mo id="S3.Ex1.m1.3.3.3.2.2.1" xref="S3.Ex1.m1.3.3.3.2.2.1.cmml">~</mo></mover><mtext id="S3.Ex1.m1.3.3.3.2.3" xref="S3.Ex1.m1.3.3.3.2.3a.cmml">CommonPath</mtext></msub><mo id="S3.Ex1.m1.3.3.3.1" xref="S3.Ex1.m1.3.3.3.1.cmml">⁢</mo><mrow id="S3.Ex1.m1.3.3.3.3.2" xref="S3.Ex1.m1.1.1.cmml"><mo id="S3.Ex1.m1.3.3.3.3.2.1" xref="S3.Ex1.m1.1.1.cmml">(</mo><mover accent="true" id="S3.Ex1.m1.1.1" xref="S3.Ex1.m1.1.1.cmml"><mi id="S3.Ex1.m1.1.1.2" xref="S3.Ex1.m1.1.1.2.cmml">𝐱</mi><mo id="S3.Ex1.m1.1.1.1" stretchy="false" xref="S3.Ex1.m1.1.1.1.cmml">→</mo></mover><mo id="S3.Ex1.m1.3.3.3.3.2.2" xref="S3.Ex1.m1.1.1.cmml">)</mo></mrow></mrow><mo id="S3.Ex1.m1.3.3.2" xref="S3.Ex1.m1.3.3.2.cmml">=</mo><mrow id="S3.Ex1.m1.3.3.1" xref="S3.Ex1.m1.3.3.1.cmml"><mstyle displaystyle="true" id="S3.Ex1.m1.3.3.1.2" xref="S3.Ex1.m1.3.3.1.2.cmml"><munderover id="S3.Ex1.m1.3.3.1.2a" xref="S3.Ex1.m1.3.3.1.2.cmml"><mo id="S3.Ex1.m1.3.3.1.2.2.2" movablelimits="false" xref="S3.Ex1.m1.3.3.1.2.2.2.cmml">∑</mo><mrow id="S3.Ex1.m1.3.3.1.2.2.3" xref="S3.Ex1.m1.3.3.1.2.2.3.cmml"><mi id="S3.Ex1.m1.3.3.1.2.2.3.2" xref="S3.Ex1.m1.3.3.1.2.2.3.2.cmml">j</mi><mo id="S3.Ex1.m1.3.3.1.2.2.3.1" xref="S3.Ex1.m1.3.3.1.2.2.3.1.cmml">=</mo><mn id="S3.Ex1.m1.3.3.1.2.2.3.3" xref="S3.Ex1.m1.3.3.1.2.2.3.3.cmml">1</mn></mrow><msub id="S3.Ex1.m1.3.3.1.2.3" xref="S3.Ex1.m1.3.3.1.2.3.cmml"><mi id="S3.Ex1.m1.3.3.1.2.3.2" xref="S3.Ex1.m1.3.3.1.2.3.2.cmml">m</mi><mn id="S3.Ex1.m1.3.3.1.2.3.3" xref="S3.Ex1.m1.3.3.1.2.3.3.cmml">1</mn></msub></munderover></mstyle><mrow id="S3.Ex1.m1.3.3.1.1" xref="S3.Ex1.m1.3.3.1.1.cmml"><mi id="S3.Ex1.m1.3.3.1.1.3" xref="S3.Ex1.m1.3.3.1.1.3.cmml">ϕ</mi><mo id="S3.Ex1.m1.3.3.1.1.2" xref="S3.Ex1.m1.3.3.1.1.2.cmml">⁢</mo><mrow id="S3.Ex1.m1.3.3.1.1.1.1" xref="S3.Ex1.m1.3.3.1.1.cmml"><mo id="S3.Ex1.m1.3.3.1.1.1.1.2" stretchy="false" xref="S3.Ex1.m1.3.3.1.1.cmml">(</mo><mrow id="S3.Ex1.m1.3.3.1.1.1.1.1.1" xref="S3.Ex1.m1.3.3.1.1.1.1.1.2.cmml"><mo id="S3.Ex1.m1.3.3.1.1.1.1.1.1.2" stretchy="false" xref="S3.Ex1.m1.3.3.1.1.1.1.1.2.cmml">⟨</mo><msubsup id="S3.Ex1.m1.3.3.1.1.1.1.1.1.1" xref="S3.Ex1.m1.3.3.1.1.1.1.1.1.1.cmml"><mover accent="true" id="S3.Ex1.m1.3.3.1.1.1.1.1.1.1.2.2" xref="S3.Ex1.m1.3.3.1.1.1.1.1.1.1.2.2.cmml"><mi id="S3.Ex1.m1.3.3.1.1.1.1.1.1.1.2.2.2" xref="S3.Ex1.m1.3.3.1.1.1.1.1.1.1.2.2.2.cmml">𝐮</mi><mo id="S3.Ex1.m1.3.3.1.1.1.1.1.1.1.2.2.1" stretchy="false" xref="S3.Ex1.m1.3.3.1.1.1.1.1.1.1.2.2.1.cmml">→</mo></mover><mi id="S3.Ex1.m1.3.3.1.1.1.1.1.1.1.2.3" xref="S3.Ex1.m1.3.3.1.1.1.1.1.1.1.2.3.cmml">j</mi><mi id="S3.Ex1.m1.3.3.1.1.1.1.1.1.1.3" xref="S3.Ex1.m1.3.3.1.1.1.1.1.1.1.3.cmml">d</mi></msubsup><mo id="S3.Ex1.m1.3.3.1.1.1.1.1.1.3" xref="S3.Ex1.m1.3.3.1.1.1.1.1.2.cmml">,</mo><mover accent="true" id="S3.Ex1.m1.2.2" xref="S3.Ex1.m1.2.2.cmml"><mi id="S3.Ex1.m1.2.2.2" xref="S3.Ex1.m1.2.2.2.cmml">𝐱</mi><mo id="S3.Ex1.m1.2.2.1" stretchy="false" xref="S3.Ex1.m1.2.2.1.cmml">→</mo></mover><mo id="S3.Ex1.m1.3.3.1.1.1.1.1.1.4" stretchy="false" xref="S3.Ex1.m1.3.3.1.1.1.1.1.2.cmml">⟩</mo></mrow><mo id="S3.Ex1.m1.3.3.1.1.1.1.3" stretchy="false" xref="S3.Ex1.m1.3.3.1.1.cmml">)</mo></mrow><mo id="S3.Ex1.m1.3.3.1.1.2a" xref="S3.Ex1.m1.3.3.1.1.2.cmml">⁢</mo><msubsup id="S3.Ex1.m1.3.3.1.1.4" xref="S3.Ex1.m1.3.3.1.1.4.cmml"><mover accent="true" id="S3.Ex1.m1.3.3.1.1.4.2.2" xref="S3.Ex1.m1.3.3.1.1.4.2.2.cmml"><mi id="S3.Ex1.m1.3.3.1.1.4.2.2.2" xref="S3.Ex1.m1.3.3.1.1.4.2.2.2.cmml">𝐯</mi><mo id="S3.Ex1.m1.3.3.1.1.4.2.2.1" stretchy="false" xref="S3.Ex1.m1.3.3.1.1.4.2.2.1.cmml">→</mo></mover><mi id="S3.Ex1.m1.3.3.1.1.4.2.3" xref="S3.Ex1.m1.3.3.1.1.4.2.3.cmml">j</mi><mi id="S3.Ex1.m1.3.3.1.1.4.3" xref="S3.Ex1.m1.3.3.1.1.4.3.cmml">d</mi></msubsup></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.Ex1.m1.3b"><apply id="S3.Ex1.m1.3.3.cmml" xref="S3.Ex1.m1.3.3"><eq id="S3.Ex1.m1.3.3.2.cmml" xref="S3.Ex1.m1.3.3.2"></eq><apply id="S3.Ex1.m1.3.3.3.cmml" xref="S3.Ex1.m1.3.3.3"><times id="S3.Ex1.m1.3.3.3.1.cmml" xref="S3.Ex1.m1.3.3.3.1"></times><apply id="S3.Ex1.m1.3.3.3.2.cmml" xref="S3.Ex1.m1.3.3.3.2"><csymbol cd="ambiguous" id="S3.Ex1.m1.3.3.3.2.1.cmml" xref="S3.Ex1.m1.3.3.3.2">subscript</csymbol><apply id="S3.Ex1.m1.3.3.3.2.2.cmml" xref="S3.Ex1.m1.3.3.3.2.2"><ci id="S3.Ex1.m1.3.3.3.2.2.1.cmml" xref="S3.Ex1.m1.3.3.3.2.2.1">~</ci><ci id="S3.Ex1.m1.3.3.3.2.2.2a.cmml" xref="S3.Ex1.m1.3.3.3.2.2.2"><mtext id="S3.Ex1.m1.3.3.3.2.2.2.cmml" xref="S3.Ex1.m1.3.3.3.2.2.2">FF</mtext></ci></apply><ci id="S3.Ex1.m1.3.3.3.2.3a.cmml" xref="S3.Ex1.m1.3.3.3.2.3"><mtext id="S3.Ex1.m1.3.3.3.2.3.cmml" mathsize="70%" xref="S3.Ex1.m1.3.3.3.2.3">CommonPath</mtext></ci></apply><apply id="S3.Ex1.m1.1.1.cmml" xref="S3.Ex1.m1.3.3.3.3.2"><ci id="S3.Ex1.m1.1.1.1.cmml" xref="S3.Ex1.m1.1.1.1">→</ci><ci id="S3.Ex1.m1.1.1.2.cmml" xref="S3.Ex1.m1.1.1.2">𝐱</ci></apply></apply><apply id="S3.Ex1.m1.3.3.1.cmml" xref="S3.Ex1.m1.3.3.1"><apply id="S3.Ex1.m1.3.3.1.2.cmml" xref="S3.Ex1.m1.3.3.1.2"><csymbol cd="ambiguous" id="S3.Ex1.m1.3.3.1.2.1.cmml" xref="S3.Ex1.m1.3.3.1.2">superscript</csymbol><apply id="S3.Ex1.m1.3.3.1.2.2.cmml" xref="S3.Ex1.m1.3.3.1.2"><csymbol cd="ambiguous" id="S3.Ex1.m1.3.3.1.2.2.1.cmml" xref="S3.Ex1.m1.3.3.1.2">subscript</csymbol><sum id="S3.Ex1.m1.3.3.1.2.2.2.cmml" xref="S3.Ex1.m1.3.3.1.2.2.2"></sum><apply id="S3.Ex1.m1.3.3.1.2.2.3.cmml" xref="S3.Ex1.m1.3.3.1.2.2.3"><eq id="S3.Ex1.m1.3.3.1.2.2.3.1.cmml" xref="S3.Ex1.m1.3.3.1.2.2.3.1"></eq><ci id="S3.Ex1.m1.3.3.1.2.2.3.2.cmml" xref="S3.Ex1.m1.3.3.1.2.2.3.2">𝑗</ci><cn id="S3.Ex1.m1.3.3.1.2.2.3.3.cmml" type="integer" xref="S3.Ex1.m1.3.3.1.2.2.3.3">1</cn></apply></apply><apply id="S3.Ex1.m1.3.3.1.2.3.cmml" xref="S3.Ex1.m1.3.3.1.2.3"><csymbol cd="ambiguous" id="S3.Ex1.m1.3.3.1.2.3.1.cmml" xref="S3.Ex1.m1.3.3.1.2.3">subscript</csymbol><ci id="S3.Ex1.m1.3.3.1.2.3.2.cmml" xref="S3.Ex1.m1.3.3.1.2.3.2">𝑚</ci><cn id="S3.Ex1.m1.3.3.1.2.3.3.cmml" type="integer" xref="S3.Ex1.m1.3.3.1.2.3.3">1</cn></apply></apply><apply id="S3.Ex1.m1.3.3.1.1.cmml" xref="S3.Ex1.m1.3.3.1.1"><times id="S3.Ex1.m1.3.3.1.1.2.cmml" xref="S3.Ex1.m1.3.3.1.1.2"></times><ci id="S3.Ex1.m1.3.3.1.1.3.cmml" xref="S3.Ex1.m1.3.3.1.1.3">italic-ϕ</ci><list id="S3.Ex1.m1.3.3.1.1.1.1.1.2.cmml" xref="S3.Ex1.m1.3.3.1.1.1.1.1.1"><apply id="S3.Ex1.m1.3.3.1.1.1.1.1.1.1.cmml" xref="S3.Ex1.m1.3.3.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S3.Ex1.m1.3.3.1.1.1.1.1.1.1.1.cmml" xref="S3.Ex1.m1.3.3.1.1.1.1.1.1.1">superscript</csymbol><apply id="S3.Ex1.m1.3.3.1.1.1.1.1.1.1.2.cmml" xref="S3.Ex1.m1.3.3.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S3.Ex1.m1.3.3.1.1.1.1.1.1.1.2.1.cmml" xref="S3.Ex1.m1.3.3.1.1.1.1.1.1.1">subscript</csymbol><apply id="S3.Ex1.m1.3.3.1.1.1.1.1.1.1.2.2.cmml" xref="S3.Ex1.m1.3.3.1.1.1.1.1.1.1.2.2"><ci id="S3.Ex1.m1.3.3.1.1.1.1.1.1.1.2.2.1.cmml" xref="S3.Ex1.m1.3.3.1.1.1.1.1.1.1.2.2.1">→</ci><ci id="S3.Ex1.m1.3.3.1.1.1.1.1.1.1.2.2.2.cmml" xref="S3.Ex1.m1.3.3.1.1.1.1.1.1.1.2.2.2">𝐮</ci></apply><ci id="S3.Ex1.m1.3.3.1.1.1.1.1.1.1.2.3.cmml" xref="S3.Ex1.m1.3.3.1.1.1.1.1.1.1.2.3">𝑗</ci></apply><ci id="S3.Ex1.m1.3.3.1.1.1.1.1.1.1.3.cmml" xref="S3.Ex1.m1.3.3.1.1.1.1.1.1.1.3">𝑑</ci></apply><apply id="S3.Ex1.m1.2.2.cmml" xref="S3.Ex1.m1.2.2"><ci id="S3.Ex1.m1.2.2.1.cmml" xref="S3.Ex1.m1.2.2.1">→</ci><ci id="S3.Ex1.m1.2.2.2.cmml" xref="S3.Ex1.m1.2.2.2">𝐱</ci></apply></list><apply id="S3.Ex1.m1.3.3.1.1.4.cmml" xref="S3.Ex1.m1.3.3.1.1.4"><csymbol cd="ambiguous" id="S3.Ex1.m1.3.3.1.1.4.1.cmml" xref="S3.Ex1.m1.3.3.1.1.4">superscript</csymbol><apply id="S3.Ex1.m1.3.3.1.1.4.2.cmml" xref="S3.Ex1.m1.3.3.1.1.4"><csymbol cd="ambiguous" id="S3.Ex1.m1.3.3.1.1.4.2.1.cmml" xref="S3.Ex1.m1.3.3.1.1.4">subscript</csymbol><apply id="S3.Ex1.m1.3.3.1.1.4.2.2.cmml" xref="S3.Ex1.m1.3.3.1.1.4.2.2"><ci id="S3.Ex1.m1.3.3.1.1.4.2.2.1.cmml" xref="S3.Ex1.m1.3.3.1.1.4.2.2.1">→</ci><ci id="S3.Ex1.m1.3.3.1.1.4.2.2.2.cmml" xref="S3.Ex1.m1.3.3.1.1.4.2.2.2">𝐯</ci></apply><ci id="S3.Ex1.m1.3.3.1.1.4.2.3.cmml" xref="S3.Ex1.m1.3.3.1.1.4.2.3">𝑗</ci></apply><ci id="S3.Ex1.m1.3.3.1.1.4.3.cmml" xref="S3.Ex1.m1.3.3.1.1.4.3">𝑑</ci></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.Ex1.m1.3c">\displaystyle\widetilde{\textrm{FF}}_{\textrm{CommonPath}}\left(%
\overrightarrow{\mathbf{x}}\right)=\sum_{j=1}^{m_{1}}\phi(\langle%
\overrightarrow{\mathbf{u}}_{j}^{d},\overrightarrow{\mathbf{x}}\rangle)%
\overrightarrow{\mathbf{v}}_{j}^{d}</annotation><annotation encoding="application/x-llamapun" id="S3.Ex1.m1.3d">over~ start_ARG FF end_ARG start_POSTSUBSCRIPT CommonPath end_POSTSUBSCRIPT ( over→ start_ARG bold_x end_ARG ) = ∑ start_POSTSUBSCRIPT italic_j = 1 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_m start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT end_POSTSUPERSCRIPT italic_ϕ ( ⟨ over→ start_ARG bold_u end_ARG start_POSTSUBSCRIPT italic_j end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_d end_POSTSUPERSCRIPT , over→ start_ARG bold_x end_ARG ⟩ ) over→ start_ARG bold_v end_ARG start_POSTSUBSCRIPT italic_j end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_d end_POSTSUPERSCRIPT</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
<tbody id="S3.E7"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle\quad+\sum_{j\in\widetilde{S}_{g}(\overrightarrow{\mathbf{x}})}%
\sum_{\ell=0}^{g}\phi(\langle\overrightarrow{\mathbf{u}}_{g*j+\ell}^{gs},%
\overrightarrow{\mathbf{x}}\rangle)\overrightarrow{\mathbf{v}}_{g*j+\ell}^{gs}," class="ltx_Math" display="inline" id="S3.E7.m1.3"><semantics id="S3.E7.m1.3a"><mrow id="S3.E7.m1.3.3.1" xref="S3.E7.m1.3.3.1.1.cmml"><mrow id="S3.E7.m1.3.3.1.1" xref="S3.E7.m1.3.3.1.1.cmml"><mo id="S3.E7.m1.3.3.1.1a" xref="S3.E7.m1.3.3.1.1.cmml">+</mo><mrow id="S3.E7.m1.3.3.1.1.1" xref="S3.E7.m1.3.3.1.1.1.cmml"><mstyle displaystyle="true" id="S3.E7.m1.3.3.1.1.1.2" xref="S3.E7.m1.3.3.1.1.1.2.cmml"><munder id="S3.E7.m1.3.3.1.1.1.2a" xref="S3.E7.m1.3.3.1.1.1.2.cmml"><mo id="S3.E7.m1.3.3.1.1.1.2.2" movablelimits="false" xref="S3.E7.m1.3.3.1.1.1.2.2.cmml">∑</mo><mrow id="S3.E7.m1.1.1.1" xref="S3.E7.m1.1.1.1.cmml"><mi id="S3.E7.m1.1.1.1.3" xref="S3.E7.m1.1.1.1.3.cmml">j</mi><mo id="S3.E7.m1.1.1.1.2" xref="S3.E7.m1.1.1.1.2.cmml">∈</mo><mrow id="S3.E7.m1.1.1.1.4" xref="S3.E7.m1.1.1.1.4.cmml"><msub id="S3.E7.m1.1.1.1.4.2" xref="S3.E7.m1.1.1.1.4.2.cmml"><mover accent="true" id="S3.E7.m1.1.1.1.4.2.2" xref="S3.E7.m1.1.1.1.4.2.2.cmml"><mi id="S3.E7.m1.1.1.1.4.2.2.2" xref="S3.E7.m1.1.1.1.4.2.2.2.cmml">S</mi><mo id="S3.E7.m1.1.1.1.4.2.2.1" xref="S3.E7.m1.1.1.1.4.2.2.1.cmml">~</mo></mover><mi id="S3.E7.m1.1.1.1.4.2.3" xref="S3.E7.m1.1.1.1.4.2.3.cmml">g</mi></msub><mo id="S3.E7.m1.1.1.1.4.1" xref="S3.E7.m1.1.1.1.4.1.cmml">⁢</mo><mrow id="S3.E7.m1.1.1.1.4.3.2" xref="S3.E7.m1.1.1.1.1.cmml"><mo id="S3.E7.m1.1.1.1.4.3.2.1" stretchy="false" xref="S3.E7.m1.1.1.1.1.cmml">(</mo><mover accent="true" id="S3.E7.m1.1.1.1.1" xref="S3.E7.m1.1.1.1.1.cmml"><mi id="S3.E7.m1.1.1.1.1.2" xref="S3.E7.m1.1.1.1.1.2.cmml">𝐱</mi><mo id="S3.E7.m1.1.1.1.1.1" stretchy="false" xref="S3.E7.m1.1.1.1.1.1.cmml">→</mo></mover><mo id="S3.E7.m1.1.1.1.4.3.2.2" stretchy="false" xref="S3.E7.m1.1.1.1.1.cmml">)</mo></mrow></mrow></mrow></munder></mstyle><mrow id="S3.E7.m1.3.3.1.1.1.1" xref="S3.E7.m1.3.3.1.1.1.1.cmml"><mstyle displaystyle="true" id="S3.E7.m1.3.3.1.1.1.1.2" xref="S3.E7.m1.3.3.1.1.1.1.2.cmml"><munderover id="S3.E7.m1.3.3.1.1.1.1.2a" xref="S3.E7.m1.3.3.1.1.1.1.2.cmml"><mo id="S3.E7.m1.3.3.1.1.1.1.2.2.2" movablelimits="false" xref="S3.E7.m1.3.3.1.1.1.1.2.2.2.cmml">∑</mo><mrow id="S3.E7.m1.3.3.1.1.1.1.2.2.3" xref="S3.E7.m1.3.3.1.1.1.1.2.2.3.cmml"><mi id="S3.E7.m1.3.3.1.1.1.1.2.2.3.2" mathvariant="normal" xref="S3.E7.m1.3.3.1.1.1.1.2.2.3.2.cmml">ℓ</mi><mo id="S3.E7.m1.3.3.1.1.1.1.2.2.3.1" xref="S3.E7.m1.3.3.1.1.1.1.2.2.3.1.cmml">=</mo><mn id="S3.E7.m1.3.3.1.1.1.1.2.2.3.3" xref="S3.E7.m1.3.3.1.1.1.1.2.2.3.3.cmml">0</mn></mrow><mi id="S3.E7.m1.3.3.1.1.1.1.2.3" xref="S3.E7.m1.3.3.1.1.1.1.2.3.cmml">g</mi></munderover></mstyle><mrow id="S3.E7.m1.3.3.1.1.1.1.1" xref="S3.E7.m1.3.3.1.1.1.1.1.cmml"><mi id="S3.E7.m1.3.3.1.1.1.1.1.3" xref="S3.E7.m1.3.3.1.1.1.1.1.3.cmml">ϕ</mi><mo id="S3.E7.m1.3.3.1.1.1.1.1.2" xref="S3.E7.m1.3.3.1.1.1.1.1.2.cmml">⁢</mo><mrow id="S3.E7.m1.3.3.1.1.1.1.1.1.1" xref="S3.E7.m1.3.3.1.1.1.1.1.cmml"><mo id="S3.E7.m1.3.3.1.1.1.1.1.1.1.2" stretchy="false" xref="S3.E7.m1.3.3.1.1.1.1.1.cmml">(</mo><mrow id="S3.E7.m1.3.3.1.1.1.1.1.1.1.1.1" xref="S3.E7.m1.3.3.1.1.1.1.1.1.1.1.2.cmml"><mo id="S3.E7.m1.3.3.1.1.1.1.1.1.1.1.1.2" stretchy="false" xref="S3.E7.m1.3.3.1.1.1.1.1.1.1.1.2.cmml">⟨</mo><msubsup id="S3.E7.m1.3.3.1.1.1.1.1.1.1.1.1.1" xref="S3.E7.m1.3.3.1.1.1.1.1.1.1.1.1.1.cmml"><mover accent="true" id="S3.E7.m1.3.3.1.1.1.1.1.1.1.1.1.1.2.2" xref="S3.E7.m1.3.3.1.1.1.1.1.1.1.1.1.1.2.2.cmml"><mi id="S3.E7.m1.3.3.1.1.1.1.1.1.1.1.1.1.2.2.2" xref="S3.E7.m1.3.3.1.1.1.1.1.1.1.1.1.1.2.2.2.cmml">𝐮</mi><mo id="S3.E7.m1.3.3.1.1.1.1.1.1.1.1.1.1.2.2.1" stretchy="false" xref="S3.E7.m1.3.3.1.1.1.1.1.1.1.1.1.1.2.2.1.cmml">→</mo></mover><mrow id="S3.E7.m1.3.3.1.1.1.1.1.1.1.1.1.1.2.3" xref="S3.E7.m1.3.3.1.1.1.1.1.1.1.1.1.1.2.3.cmml"><mrow id="S3.E7.m1.3.3.1.1.1.1.1.1.1.1.1.1.2.3.2" xref="S3.E7.m1.3.3.1.1.1.1.1.1.1.1.1.1.2.3.2.cmml"><mi id="S3.E7.m1.3.3.1.1.1.1.1.1.1.1.1.1.2.3.2.2" xref="S3.E7.m1.3.3.1.1.1.1.1.1.1.1.1.1.2.3.2.2.cmml">g</mi><mo id="S3.E7.m1.3.3.1.1.1.1.1.1.1.1.1.1.2.3.2.1" lspace="0.222em" rspace="0.222em" xref="S3.E7.m1.3.3.1.1.1.1.1.1.1.1.1.1.2.3.2.1.cmml">*</mo><mi id="S3.E7.m1.3.3.1.1.1.1.1.1.1.1.1.1.2.3.2.3" xref="S3.E7.m1.3.3.1.1.1.1.1.1.1.1.1.1.2.3.2.3.cmml">j</mi></mrow><mo id="S3.E7.m1.3.3.1.1.1.1.1.1.1.1.1.1.2.3.1" xref="S3.E7.m1.3.3.1.1.1.1.1.1.1.1.1.1.2.3.1.cmml">+</mo><mi id="S3.E7.m1.3.3.1.1.1.1.1.1.1.1.1.1.2.3.3" mathvariant="normal" xref="S3.E7.m1.3.3.1.1.1.1.1.1.1.1.1.1.2.3.3.cmml">ℓ</mi></mrow><mrow id="S3.E7.m1.3.3.1.1.1.1.1.1.1.1.1.1.3" xref="S3.E7.m1.3.3.1.1.1.1.1.1.1.1.1.1.3.cmml"><mi id="S3.E7.m1.3.3.1.1.1.1.1.1.1.1.1.1.3.2" xref="S3.E7.m1.3.3.1.1.1.1.1.1.1.1.1.1.3.2.cmml">g</mi><mo id="S3.E7.m1.3.3.1.1.1.1.1.1.1.1.1.1.3.1" xref="S3.E7.m1.3.3.1.1.1.1.1.1.1.1.1.1.3.1.cmml">⁢</mo><mi id="S3.E7.m1.3.3.1.1.1.1.1.1.1.1.1.1.3.3" xref="S3.E7.m1.3.3.1.1.1.1.1.1.1.1.1.1.3.3.cmml">s</mi></mrow></msubsup><mo id="S3.E7.m1.3.3.1.1.1.1.1.1.1.1.1.3" xref="S3.E7.m1.3.3.1.1.1.1.1.1.1.1.2.cmml">,</mo><mover accent="true" id="S3.E7.m1.2.2" xref="S3.E7.m1.2.2.cmml"><mi id="S3.E7.m1.2.2.2" xref="S3.E7.m1.2.2.2.cmml">𝐱</mi><mo id="S3.E7.m1.2.2.1" stretchy="false" xref="S3.E7.m1.2.2.1.cmml">→</mo></mover><mo id="S3.E7.m1.3.3.1.1.1.1.1.1.1.1.1.4" stretchy="false" xref="S3.E7.m1.3.3.1.1.1.1.1.1.1.1.2.cmml">⟩</mo></mrow><mo id="S3.E7.m1.3.3.1.1.1.1.1.1.1.3" stretchy="false" xref="S3.E7.m1.3.3.1.1.1.1.1.cmml">)</mo></mrow><mo id="S3.E7.m1.3.3.1.1.1.1.1.2a" xref="S3.E7.m1.3.3.1.1.1.1.1.2.cmml">⁢</mo><msubsup id="S3.E7.m1.3.3.1.1.1.1.1.4" xref="S3.E7.m1.3.3.1.1.1.1.1.4.cmml"><mover accent="true" id="S3.E7.m1.3.3.1.1.1.1.1.4.2.2" xref="S3.E7.m1.3.3.1.1.1.1.1.4.2.2.cmml"><mi id="S3.E7.m1.3.3.1.1.1.1.1.4.2.2.2" xref="S3.E7.m1.3.3.1.1.1.1.1.4.2.2.2.cmml">𝐯</mi><mo id="S3.E7.m1.3.3.1.1.1.1.1.4.2.2.1" stretchy="false" xref="S3.E7.m1.3.3.1.1.1.1.1.4.2.2.1.cmml">→</mo></mover><mrow id="S3.E7.m1.3.3.1.1.1.1.1.4.2.3" xref="S3.E7.m1.3.3.1.1.1.1.1.4.2.3.cmml"><mrow id="S3.E7.m1.3.3.1.1.1.1.1.4.2.3.2" xref="S3.E7.m1.3.3.1.1.1.1.1.4.2.3.2.cmml"><mi id="S3.E7.m1.3.3.1.1.1.1.1.4.2.3.2.2" xref="S3.E7.m1.3.3.1.1.1.1.1.4.2.3.2.2.cmml">g</mi><mo id="S3.E7.m1.3.3.1.1.1.1.1.4.2.3.2.1" lspace="0.222em" rspace="0.222em" xref="S3.E7.m1.3.3.1.1.1.1.1.4.2.3.2.1.cmml">*</mo><mi id="S3.E7.m1.3.3.1.1.1.1.1.4.2.3.2.3" xref="S3.E7.m1.3.3.1.1.1.1.1.4.2.3.2.3.cmml">j</mi></mrow><mo id="S3.E7.m1.3.3.1.1.1.1.1.4.2.3.1" xref="S3.E7.m1.3.3.1.1.1.1.1.4.2.3.1.cmml">+</mo><mi id="S3.E7.m1.3.3.1.1.1.1.1.4.2.3.3" mathvariant="normal" xref="S3.E7.m1.3.3.1.1.1.1.1.4.2.3.3.cmml">ℓ</mi></mrow><mrow id="S3.E7.m1.3.3.1.1.1.1.1.4.3" xref="S3.E7.m1.3.3.1.1.1.1.1.4.3.cmml"><mi id="S3.E7.m1.3.3.1.1.1.1.1.4.3.2" xref="S3.E7.m1.3.3.1.1.1.1.1.4.3.2.cmml">g</mi><mo id="S3.E7.m1.3.3.1.1.1.1.1.4.3.1" xref="S3.E7.m1.3.3.1.1.1.1.1.4.3.1.cmml">⁢</mo><mi id="S3.E7.m1.3.3.1.1.1.1.1.4.3.3" xref="S3.E7.m1.3.3.1.1.1.1.1.4.3.3.cmml">s</mi></mrow></msubsup></mrow></mrow></mrow></mrow><mo id="S3.E7.m1.3.3.1.2" xref="S3.E7.m1.3.3.1.1.cmml">,</mo></mrow><annotation-xml encoding="MathML-Content" id="S3.E7.m1.3b"><apply id="S3.E7.m1.3.3.1.1.cmml" xref="S3.E7.m1.3.3.1"><plus id="S3.E7.m1.3.3.1.1.2.cmml" xref="S3.E7.m1.3.3.1"></plus><apply id="S3.E7.m1.3.3.1.1.1.cmml" xref="S3.E7.m1.3.3.1.1.1"><apply id="S3.E7.m1.3.3.1.1.1.2.cmml" xref="S3.E7.m1.3.3.1.1.1.2"><csymbol cd="ambiguous" id="S3.E7.m1.3.3.1.1.1.2.1.cmml" xref="S3.E7.m1.3.3.1.1.1.2">subscript</csymbol><sum id="S3.E7.m1.3.3.1.1.1.2.2.cmml" xref="S3.E7.m1.3.3.1.1.1.2.2"></sum><apply id="S3.E7.m1.1.1.1.cmml" xref="S3.E7.m1.1.1.1"><in id="S3.E7.m1.1.1.1.2.cmml" xref="S3.E7.m1.1.1.1.2"></in><ci id="S3.E7.m1.1.1.1.3.cmml" xref="S3.E7.m1.1.1.1.3">𝑗</ci><apply id="S3.E7.m1.1.1.1.4.cmml" xref="S3.E7.m1.1.1.1.4"><times id="S3.E7.m1.1.1.1.4.1.cmml" xref="S3.E7.m1.1.1.1.4.1"></times><apply id="S3.E7.m1.1.1.1.4.2.cmml" xref="S3.E7.m1.1.1.1.4.2"><csymbol cd="ambiguous" id="S3.E7.m1.1.1.1.4.2.1.cmml" xref="S3.E7.m1.1.1.1.4.2">subscript</csymbol><apply id="S3.E7.m1.1.1.1.4.2.2.cmml" xref="S3.E7.m1.1.1.1.4.2.2"><ci id="S3.E7.m1.1.1.1.4.2.2.1.cmml" xref="S3.E7.m1.1.1.1.4.2.2.1">~</ci><ci id="S3.E7.m1.1.1.1.4.2.2.2.cmml" xref="S3.E7.m1.1.1.1.4.2.2.2">𝑆</ci></apply><ci id="S3.E7.m1.1.1.1.4.2.3.cmml" xref="S3.E7.m1.1.1.1.4.2.3">𝑔</ci></apply><apply id="S3.E7.m1.1.1.1.1.cmml" xref="S3.E7.m1.1.1.1.4.3.2"><ci id="S3.E7.m1.1.1.1.1.1.cmml" xref="S3.E7.m1.1.1.1.1.1">→</ci><ci id="S3.E7.m1.1.1.1.1.2.cmml" xref="S3.E7.m1.1.1.1.1.2">𝐱</ci></apply></apply></apply></apply><apply id="S3.E7.m1.3.3.1.1.1.1.cmml" xref="S3.E7.m1.3.3.1.1.1.1"><apply id="S3.E7.m1.3.3.1.1.1.1.2.cmml" xref="S3.E7.m1.3.3.1.1.1.1.2"><csymbol cd="ambiguous" id="S3.E7.m1.3.3.1.1.1.1.2.1.cmml" xref="S3.E7.m1.3.3.1.1.1.1.2">superscript</csymbol><apply id="S3.E7.m1.3.3.1.1.1.1.2.2.cmml" xref="S3.E7.m1.3.3.1.1.1.1.2"><csymbol cd="ambiguous" id="S3.E7.m1.3.3.1.1.1.1.2.2.1.cmml" xref="S3.E7.m1.3.3.1.1.1.1.2">subscript</csymbol><sum id="S3.E7.m1.3.3.1.1.1.1.2.2.2.cmml" xref="S3.E7.m1.3.3.1.1.1.1.2.2.2"></sum><apply id="S3.E7.m1.3.3.1.1.1.1.2.2.3.cmml" xref="S3.E7.m1.3.3.1.1.1.1.2.2.3"><eq id="S3.E7.m1.3.3.1.1.1.1.2.2.3.1.cmml" xref="S3.E7.m1.3.3.1.1.1.1.2.2.3.1"></eq><ci id="S3.E7.m1.3.3.1.1.1.1.2.2.3.2.cmml" xref="S3.E7.m1.3.3.1.1.1.1.2.2.3.2">ℓ</ci><cn id="S3.E7.m1.3.3.1.1.1.1.2.2.3.3.cmml" type="integer" xref="S3.E7.m1.3.3.1.1.1.1.2.2.3.3">0</cn></apply></apply><ci id="S3.E7.m1.3.3.1.1.1.1.2.3.cmml" xref="S3.E7.m1.3.3.1.1.1.1.2.3">𝑔</ci></apply><apply id="S3.E7.m1.3.3.1.1.1.1.1.cmml" xref="S3.E7.m1.3.3.1.1.1.1.1"><times id="S3.E7.m1.3.3.1.1.1.1.1.2.cmml" xref="S3.E7.m1.3.3.1.1.1.1.1.2"></times><ci id="S3.E7.m1.3.3.1.1.1.1.1.3.cmml" xref="S3.E7.m1.3.3.1.1.1.1.1.3">italic-ϕ</ci><list id="S3.E7.m1.3.3.1.1.1.1.1.1.1.1.2.cmml" xref="S3.E7.m1.3.3.1.1.1.1.1.1.1.1.1"><apply id="S3.E7.m1.3.3.1.1.1.1.1.1.1.1.1.1.cmml" xref="S3.E7.m1.3.3.1.1.1.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S3.E7.m1.3.3.1.1.1.1.1.1.1.1.1.1.1.cmml" xref="S3.E7.m1.3.3.1.1.1.1.1.1.1.1.1.1">superscript</csymbol><apply id="S3.E7.m1.3.3.1.1.1.1.1.1.1.1.1.1.2.cmml" xref="S3.E7.m1.3.3.1.1.1.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S3.E7.m1.3.3.1.1.1.1.1.1.1.1.1.1.2.1.cmml" xref="S3.E7.m1.3.3.1.1.1.1.1.1.1.1.1.1">subscript</csymbol><apply id="S3.E7.m1.3.3.1.1.1.1.1.1.1.1.1.1.2.2.cmml" xref="S3.E7.m1.3.3.1.1.1.1.1.1.1.1.1.1.2.2"><ci id="S3.E7.m1.3.3.1.1.1.1.1.1.1.1.1.1.2.2.1.cmml" xref="S3.E7.m1.3.3.1.1.1.1.1.1.1.1.1.1.2.2.1">→</ci><ci id="S3.E7.m1.3.3.1.1.1.1.1.1.1.1.1.1.2.2.2.cmml" xref="S3.E7.m1.3.3.1.1.1.1.1.1.1.1.1.1.2.2.2">𝐮</ci></apply><apply id="S3.E7.m1.3.3.1.1.1.1.1.1.1.1.1.1.2.3.cmml" xref="S3.E7.m1.3.3.1.1.1.1.1.1.1.1.1.1.2.3"><plus id="S3.E7.m1.3.3.1.1.1.1.1.1.1.1.1.1.2.3.1.cmml" xref="S3.E7.m1.3.3.1.1.1.1.1.1.1.1.1.1.2.3.1"></plus><apply id="S3.E7.m1.3.3.1.1.1.1.1.1.1.1.1.1.2.3.2.cmml" xref="S3.E7.m1.3.3.1.1.1.1.1.1.1.1.1.1.2.3.2"><times id="S3.E7.m1.3.3.1.1.1.1.1.1.1.1.1.1.2.3.2.1.cmml" xref="S3.E7.m1.3.3.1.1.1.1.1.1.1.1.1.1.2.3.2.1"></times><ci id="S3.E7.m1.3.3.1.1.1.1.1.1.1.1.1.1.2.3.2.2.cmml" xref="S3.E7.m1.3.3.1.1.1.1.1.1.1.1.1.1.2.3.2.2">𝑔</ci><ci id="S3.E7.m1.3.3.1.1.1.1.1.1.1.1.1.1.2.3.2.3.cmml" xref="S3.E7.m1.3.3.1.1.1.1.1.1.1.1.1.1.2.3.2.3">𝑗</ci></apply><ci id="S3.E7.m1.3.3.1.1.1.1.1.1.1.1.1.1.2.3.3.cmml" xref="S3.E7.m1.3.3.1.1.1.1.1.1.1.1.1.1.2.3.3">ℓ</ci></apply></apply><apply id="S3.E7.m1.3.3.1.1.1.1.1.1.1.1.1.1.3.cmml" xref="S3.E7.m1.3.3.1.1.1.1.1.1.1.1.1.1.3"><times id="S3.E7.m1.3.3.1.1.1.1.1.1.1.1.1.1.3.1.cmml" xref="S3.E7.m1.3.3.1.1.1.1.1.1.1.1.1.1.3.1"></times><ci id="S3.E7.m1.3.3.1.1.1.1.1.1.1.1.1.1.3.2.cmml" xref="S3.E7.m1.3.3.1.1.1.1.1.1.1.1.1.1.3.2">𝑔</ci><ci id="S3.E7.m1.3.3.1.1.1.1.1.1.1.1.1.1.3.3.cmml" xref="S3.E7.m1.3.3.1.1.1.1.1.1.1.1.1.1.3.3">𝑠</ci></apply></apply><apply id="S3.E7.m1.2.2.cmml" xref="S3.E7.m1.2.2"><ci id="S3.E7.m1.2.2.1.cmml" xref="S3.E7.m1.2.2.1">→</ci><ci id="S3.E7.m1.2.2.2.cmml" xref="S3.E7.m1.2.2.2">𝐱</ci></apply></list><apply id="S3.E7.m1.3.3.1.1.1.1.1.4.cmml" xref="S3.E7.m1.3.3.1.1.1.1.1.4"><csymbol cd="ambiguous" id="S3.E7.m1.3.3.1.1.1.1.1.4.1.cmml" xref="S3.E7.m1.3.3.1.1.1.1.1.4">superscript</csymbol><apply id="S3.E7.m1.3.3.1.1.1.1.1.4.2.cmml" xref="S3.E7.m1.3.3.1.1.1.1.1.4"><csymbol cd="ambiguous" id="S3.E7.m1.3.3.1.1.1.1.1.4.2.1.cmml" xref="S3.E7.m1.3.3.1.1.1.1.1.4">subscript</csymbol><apply id="S3.E7.m1.3.3.1.1.1.1.1.4.2.2.cmml" xref="S3.E7.m1.3.3.1.1.1.1.1.4.2.2"><ci id="S3.E7.m1.3.3.1.1.1.1.1.4.2.2.1.cmml" xref="S3.E7.m1.3.3.1.1.1.1.1.4.2.2.1">→</ci><ci id="S3.E7.m1.3.3.1.1.1.1.1.4.2.2.2.cmml" xref="S3.E7.m1.3.3.1.1.1.1.1.4.2.2.2">𝐯</ci></apply><apply id="S3.E7.m1.3.3.1.1.1.1.1.4.2.3.cmml" xref="S3.E7.m1.3.3.1.1.1.1.1.4.2.3"><plus id="S3.E7.m1.3.3.1.1.1.1.1.4.2.3.1.cmml" xref="S3.E7.m1.3.3.1.1.1.1.1.4.2.3.1"></plus><apply id="S3.E7.m1.3.3.1.1.1.1.1.4.2.3.2.cmml" xref="S3.E7.m1.3.3.1.1.1.1.1.4.2.3.2"><times id="S3.E7.m1.3.3.1.1.1.1.1.4.2.3.2.1.cmml" xref="S3.E7.m1.3.3.1.1.1.1.1.4.2.3.2.1"></times><ci id="S3.E7.m1.3.3.1.1.1.1.1.4.2.3.2.2.cmml" xref="S3.E7.m1.3.3.1.1.1.1.1.4.2.3.2.2">𝑔</ci><ci id="S3.E7.m1.3.3.1.1.1.1.1.4.2.3.2.3.cmml" xref="S3.E7.m1.3.3.1.1.1.1.1.4.2.3.2.3">𝑗</ci></apply><ci id="S3.E7.m1.3.3.1.1.1.1.1.4.2.3.3.cmml" xref="S3.E7.m1.3.3.1.1.1.1.1.4.2.3.3">ℓ</ci></apply></apply><apply id="S3.E7.m1.3.3.1.1.1.1.1.4.3.cmml" xref="S3.E7.m1.3.3.1.1.1.1.1.4.3"><times id="S3.E7.m1.3.3.1.1.1.1.1.4.3.1.cmml" xref="S3.E7.m1.3.3.1.1.1.1.1.4.3.1"></times><ci id="S3.E7.m1.3.3.1.1.1.1.1.4.3.2.cmml" xref="S3.E7.m1.3.3.1.1.1.1.1.4.3.2">𝑔</ci><ci id="S3.E7.m1.3.3.1.1.1.1.1.4.3.3.cmml" xref="S3.E7.m1.3.3.1.1.1.1.1.4.3.3">𝑠</ci></apply></apply></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.E7.m1.3c">\displaystyle\quad+\sum_{j\in\widetilde{S}_{g}(\overrightarrow{\mathbf{x}})}%
\sum_{\ell=0}^{g}\phi(\langle\overrightarrow{\mathbf{u}}_{g*j+\ell}^{gs},%
\overrightarrow{\mathbf{x}}\rangle)\overrightarrow{\mathbf{v}}_{g*j+\ell}^{gs},</annotation><annotation encoding="application/x-llamapun" id="S3.E7.m1.3d">+ ∑ start_POSTSUBSCRIPT italic_j ∈ over~ start_ARG italic_S end_ARG start_POSTSUBSCRIPT italic_g end_POSTSUBSCRIPT ( over→ start_ARG bold_x end_ARG ) end_POSTSUBSCRIPT ∑ start_POSTSUBSCRIPT roman_ℓ = 0 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_g end_POSTSUPERSCRIPT italic_ϕ ( ⟨ over→ start_ARG bold_u end_ARG start_POSTSUBSCRIPT italic_g * italic_j + roman_ℓ end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_g italic_s end_POSTSUPERSCRIPT , over→ start_ARG bold_x end_ARG ⟩ ) over→ start_ARG bold_v end_ARG start_POSTSUBSCRIPT italic_g * italic_j + roman_ℓ end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_g italic_s end_POSTSUPERSCRIPT ,</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(7)</span></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S3.SS4.SSS1.Px1.p1.4">where <math alttext="\overrightarrow{\mathbf{u}}^{d},\overrightarrow{\mathbf{v}}^{d}" class="ltx_Math" display="inline" id="S3.SS4.SSS1.Px1.p1.3.m1.2"><semantics id="S3.SS4.SSS1.Px1.p1.3.m1.2a"><mrow id="S3.SS4.SSS1.Px1.p1.3.m1.2.2.2" xref="S3.SS4.SSS1.Px1.p1.3.m1.2.2.3.cmml"><msup id="S3.SS4.SSS1.Px1.p1.3.m1.1.1.1.1" xref="S3.SS4.SSS1.Px1.p1.3.m1.1.1.1.1.cmml"><mover accent="true" id="S3.SS4.SSS1.Px1.p1.3.m1.1.1.1.1.2" xref="S3.SS4.SSS1.Px1.p1.3.m1.1.1.1.1.2.cmml"><mi id="S3.SS4.SSS1.Px1.p1.3.m1.1.1.1.1.2.2" xref="S3.SS4.SSS1.Px1.p1.3.m1.1.1.1.1.2.2.cmml">𝐮</mi><mo id="S3.SS4.SSS1.Px1.p1.3.m1.1.1.1.1.2.1" stretchy="false" xref="S3.SS4.SSS1.Px1.p1.3.m1.1.1.1.1.2.1.cmml">→</mo></mover><mi id="S3.SS4.SSS1.Px1.p1.3.m1.1.1.1.1.3" xref="S3.SS4.SSS1.Px1.p1.3.m1.1.1.1.1.3.cmml">d</mi></msup><mo id="S3.SS4.SSS1.Px1.p1.3.m1.2.2.2.3" xref="S3.SS4.SSS1.Px1.p1.3.m1.2.2.3.cmml">,</mo><msup id="S3.SS4.SSS1.Px1.p1.3.m1.2.2.2.2" xref="S3.SS4.SSS1.Px1.p1.3.m1.2.2.2.2.cmml"><mover accent="true" id="S3.SS4.SSS1.Px1.p1.3.m1.2.2.2.2.2" xref="S3.SS4.SSS1.Px1.p1.3.m1.2.2.2.2.2.cmml"><mi id="S3.SS4.SSS1.Px1.p1.3.m1.2.2.2.2.2.2" xref="S3.SS4.SSS1.Px1.p1.3.m1.2.2.2.2.2.2.cmml">𝐯</mi><mo id="S3.SS4.SSS1.Px1.p1.3.m1.2.2.2.2.2.1" stretchy="false" xref="S3.SS4.SSS1.Px1.p1.3.m1.2.2.2.2.2.1.cmml">→</mo></mover><mi id="S3.SS4.SSS1.Px1.p1.3.m1.2.2.2.2.3" xref="S3.SS4.SSS1.Px1.p1.3.m1.2.2.2.2.3.cmml">d</mi></msup></mrow><annotation-xml encoding="MathML-Content" id="S3.SS4.SSS1.Px1.p1.3.m1.2b"><list id="S3.SS4.SSS1.Px1.p1.3.m1.2.2.3.cmml" xref="S3.SS4.SSS1.Px1.p1.3.m1.2.2.2"><apply id="S3.SS4.SSS1.Px1.p1.3.m1.1.1.1.1.cmml" xref="S3.SS4.SSS1.Px1.p1.3.m1.1.1.1.1"><csymbol cd="ambiguous" id="S3.SS4.SSS1.Px1.p1.3.m1.1.1.1.1.1.cmml" xref="S3.SS4.SSS1.Px1.p1.3.m1.1.1.1.1">superscript</csymbol><apply id="S3.SS4.SSS1.Px1.p1.3.m1.1.1.1.1.2.cmml" xref="S3.SS4.SSS1.Px1.p1.3.m1.1.1.1.1.2"><ci id="S3.SS4.SSS1.Px1.p1.3.m1.1.1.1.1.2.1.cmml" xref="S3.SS4.SSS1.Px1.p1.3.m1.1.1.1.1.2.1">→</ci><ci id="S3.SS4.SSS1.Px1.p1.3.m1.1.1.1.1.2.2.cmml" xref="S3.SS4.SSS1.Px1.p1.3.m1.1.1.1.1.2.2">𝐮</ci></apply><ci id="S3.SS4.SSS1.Px1.p1.3.m1.1.1.1.1.3.cmml" xref="S3.SS4.SSS1.Px1.p1.3.m1.1.1.1.1.3">𝑑</ci></apply><apply id="S3.SS4.SSS1.Px1.p1.3.m1.2.2.2.2.cmml" xref="S3.SS4.SSS1.Px1.p1.3.m1.2.2.2.2"><csymbol cd="ambiguous" id="S3.SS4.SSS1.Px1.p1.3.m1.2.2.2.2.1.cmml" xref="S3.SS4.SSS1.Px1.p1.3.m1.2.2.2.2">superscript</csymbol><apply id="S3.SS4.SSS1.Px1.p1.3.m1.2.2.2.2.2.cmml" xref="S3.SS4.SSS1.Px1.p1.3.m1.2.2.2.2.2"><ci id="S3.SS4.SSS1.Px1.p1.3.m1.2.2.2.2.2.1.cmml" xref="S3.SS4.SSS1.Px1.p1.3.m1.2.2.2.2.2.1">→</ci><ci id="S3.SS4.SSS1.Px1.p1.3.m1.2.2.2.2.2.2.cmml" xref="S3.SS4.SSS1.Px1.p1.3.m1.2.2.2.2.2.2">𝐯</ci></apply><ci id="S3.SS4.SSS1.Px1.p1.3.m1.2.2.2.2.3.cmml" xref="S3.SS4.SSS1.Px1.p1.3.m1.2.2.2.2.3">𝑑</ci></apply></list></annotation-xml><annotation encoding="application/x-tex" id="S3.SS4.SSS1.Px1.p1.3.m1.2c">\overrightarrow{\mathbf{u}}^{d},\overrightarrow{\mathbf{v}}^{d}</annotation><annotation encoding="application/x-llamapun" id="S3.SS4.SSS1.Px1.p1.3.m1.2d">over→ start_ARG bold_u end_ARG start_POSTSUPERSCRIPT italic_d end_POSTSUPERSCRIPT , over→ start_ARG bold_v end_ARG start_POSTSUPERSCRIPT italic_d end_POSTSUPERSCRIPT</annotation></semantics></math> denote the first set of hidden units used in a dense manner, while <math alttext="\overrightarrow{\mathbf{u}}^{gs},\overrightarrow{\mathbf{v}}^{gs}" class="ltx_Math" display="inline" id="S3.SS4.SSS1.Px1.p1.4.m2.2"><semantics id="S3.SS4.SSS1.Px1.p1.4.m2.2a"><mrow id="S3.SS4.SSS1.Px1.p1.4.m2.2.2.2" xref="S3.SS4.SSS1.Px1.p1.4.m2.2.2.3.cmml"><msup id="S3.SS4.SSS1.Px1.p1.4.m2.1.1.1.1" xref="S3.SS4.SSS1.Px1.p1.4.m2.1.1.1.1.cmml"><mover accent="true" id="S3.SS4.SSS1.Px1.p1.4.m2.1.1.1.1.2" xref="S3.SS4.SSS1.Px1.p1.4.m2.1.1.1.1.2.cmml"><mi id="S3.SS4.SSS1.Px1.p1.4.m2.1.1.1.1.2.2" xref="S3.SS4.SSS1.Px1.p1.4.m2.1.1.1.1.2.2.cmml">𝐮</mi><mo id="S3.SS4.SSS1.Px1.p1.4.m2.1.1.1.1.2.1" stretchy="false" xref="S3.SS4.SSS1.Px1.p1.4.m2.1.1.1.1.2.1.cmml">→</mo></mover><mrow id="S3.SS4.SSS1.Px1.p1.4.m2.1.1.1.1.3" xref="S3.SS4.SSS1.Px1.p1.4.m2.1.1.1.1.3.cmml"><mi id="S3.SS4.SSS1.Px1.p1.4.m2.1.1.1.1.3.2" xref="S3.SS4.SSS1.Px1.p1.4.m2.1.1.1.1.3.2.cmml">g</mi><mo id="S3.SS4.SSS1.Px1.p1.4.m2.1.1.1.1.3.1" xref="S3.SS4.SSS1.Px1.p1.4.m2.1.1.1.1.3.1.cmml">⁢</mo><mi id="S3.SS4.SSS1.Px1.p1.4.m2.1.1.1.1.3.3" xref="S3.SS4.SSS1.Px1.p1.4.m2.1.1.1.1.3.3.cmml">s</mi></mrow></msup><mo id="S3.SS4.SSS1.Px1.p1.4.m2.2.2.2.3" xref="S3.SS4.SSS1.Px1.p1.4.m2.2.2.3.cmml">,</mo><msup id="S3.SS4.SSS1.Px1.p1.4.m2.2.2.2.2" xref="S3.SS4.SSS1.Px1.p1.4.m2.2.2.2.2.cmml"><mover accent="true" id="S3.SS4.SSS1.Px1.p1.4.m2.2.2.2.2.2" xref="S3.SS4.SSS1.Px1.p1.4.m2.2.2.2.2.2.cmml"><mi id="S3.SS4.SSS1.Px1.p1.4.m2.2.2.2.2.2.2" xref="S3.SS4.SSS1.Px1.p1.4.m2.2.2.2.2.2.2.cmml">𝐯</mi><mo id="S3.SS4.SSS1.Px1.p1.4.m2.2.2.2.2.2.1" stretchy="false" xref="S3.SS4.SSS1.Px1.p1.4.m2.2.2.2.2.2.1.cmml">→</mo></mover><mrow id="S3.SS4.SSS1.Px1.p1.4.m2.2.2.2.2.3" xref="S3.SS4.SSS1.Px1.p1.4.m2.2.2.2.2.3.cmml"><mi id="S3.SS4.SSS1.Px1.p1.4.m2.2.2.2.2.3.2" xref="S3.SS4.SSS1.Px1.p1.4.m2.2.2.2.2.3.2.cmml">g</mi><mo id="S3.SS4.SSS1.Px1.p1.4.m2.2.2.2.2.3.1" xref="S3.SS4.SSS1.Px1.p1.4.m2.2.2.2.2.3.1.cmml">⁢</mo><mi id="S3.SS4.SSS1.Px1.p1.4.m2.2.2.2.2.3.3" xref="S3.SS4.SSS1.Px1.p1.4.m2.2.2.2.2.3.3.cmml">s</mi></mrow></msup></mrow><annotation-xml encoding="MathML-Content" id="S3.SS4.SSS1.Px1.p1.4.m2.2b"><list id="S3.SS4.SSS1.Px1.p1.4.m2.2.2.3.cmml" xref="S3.SS4.SSS1.Px1.p1.4.m2.2.2.2"><apply id="S3.SS4.SSS1.Px1.p1.4.m2.1.1.1.1.cmml" xref="S3.SS4.SSS1.Px1.p1.4.m2.1.1.1.1"><csymbol cd="ambiguous" id="S3.SS4.SSS1.Px1.p1.4.m2.1.1.1.1.1.cmml" xref="S3.SS4.SSS1.Px1.p1.4.m2.1.1.1.1">superscript</csymbol><apply id="S3.SS4.SSS1.Px1.p1.4.m2.1.1.1.1.2.cmml" xref="S3.SS4.SSS1.Px1.p1.4.m2.1.1.1.1.2"><ci id="S3.SS4.SSS1.Px1.p1.4.m2.1.1.1.1.2.1.cmml" xref="S3.SS4.SSS1.Px1.p1.4.m2.1.1.1.1.2.1">→</ci><ci id="S3.SS4.SSS1.Px1.p1.4.m2.1.1.1.1.2.2.cmml" xref="S3.SS4.SSS1.Px1.p1.4.m2.1.1.1.1.2.2">𝐮</ci></apply><apply id="S3.SS4.SSS1.Px1.p1.4.m2.1.1.1.1.3.cmml" xref="S3.SS4.SSS1.Px1.p1.4.m2.1.1.1.1.3"><times id="S3.SS4.SSS1.Px1.p1.4.m2.1.1.1.1.3.1.cmml" xref="S3.SS4.SSS1.Px1.p1.4.m2.1.1.1.1.3.1"></times><ci id="S3.SS4.SSS1.Px1.p1.4.m2.1.1.1.1.3.2.cmml" xref="S3.SS4.SSS1.Px1.p1.4.m2.1.1.1.1.3.2">𝑔</ci><ci id="S3.SS4.SSS1.Px1.p1.4.m2.1.1.1.1.3.3.cmml" xref="S3.SS4.SSS1.Px1.p1.4.m2.1.1.1.1.3.3">𝑠</ci></apply></apply><apply id="S3.SS4.SSS1.Px1.p1.4.m2.2.2.2.2.cmml" xref="S3.SS4.SSS1.Px1.p1.4.m2.2.2.2.2"><csymbol cd="ambiguous" id="S3.SS4.SSS1.Px1.p1.4.m2.2.2.2.2.1.cmml" xref="S3.SS4.SSS1.Px1.p1.4.m2.2.2.2.2">superscript</csymbol><apply id="S3.SS4.SSS1.Px1.p1.4.m2.2.2.2.2.2.cmml" xref="S3.SS4.SSS1.Px1.p1.4.m2.2.2.2.2.2"><ci id="S3.SS4.SSS1.Px1.p1.4.m2.2.2.2.2.2.1.cmml" xref="S3.SS4.SSS1.Px1.p1.4.m2.2.2.2.2.2.1">→</ci><ci id="S3.SS4.SSS1.Px1.p1.4.m2.2.2.2.2.2.2.cmml" xref="S3.SS4.SSS1.Px1.p1.4.m2.2.2.2.2.2.2">𝐯</ci></apply><apply id="S3.SS4.SSS1.Px1.p1.4.m2.2.2.2.2.3.cmml" xref="S3.SS4.SSS1.Px1.p1.4.m2.2.2.2.2.3"><times id="S3.SS4.SSS1.Px1.p1.4.m2.2.2.2.2.3.1.cmml" xref="S3.SS4.SSS1.Px1.p1.4.m2.2.2.2.2.3.1"></times><ci id="S3.SS4.SSS1.Px1.p1.4.m2.2.2.2.2.3.2.cmml" xref="S3.SS4.SSS1.Px1.p1.4.m2.2.2.2.2.3.2">𝑔</ci><ci id="S3.SS4.SSS1.Px1.p1.4.m2.2.2.2.2.3.3.cmml" xref="S3.SS4.SSS1.Px1.p1.4.m2.2.2.2.2.3.3">𝑠</ci></apply></apply></list></annotation-xml><annotation encoding="application/x-tex" id="S3.SS4.SSS1.Px1.p1.4.m2.2c">\overrightarrow{\mathbf{u}}^{gs},\overrightarrow{\mathbf{v}}^{gs}</annotation><annotation encoding="application/x-llamapun" id="S3.SS4.SSS1.Px1.p1.4.m2.2d">over→ start_ARG bold_u end_ARG start_POSTSUPERSCRIPT italic_g italic_s end_POSTSUPERSCRIPT , over→ start_ARG bold_v end_ARG start_POSTSUPERSCRIPT italic_g italic_s end_POSTSUPERSCRIPT</annotation></semantics></math> denote the second set of neurons used in a sparse manner.</p>
</div>
</section>
<section class="ltx_paragraph" id="S3.SS4.SSS1.Px2">
<h5 class="ltx_title ltx_title_paragraph">Dynamic overlap</h5>
<div class="ltx_para" id="S3.SS4.SSS1.Px2.p1">
<p class="ltx_p" id="S3.SS4.SSS1.Px2.p1.4">: In order to further improve efficiency while producing a larger number of samples for the same query (e.g., to rank these responses and output the best one <cite class="ltx_cite ltx_citemacro_citep">(Mudgal et al., <a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#bib.bib40" title="">2023</a>)</cite>), we first compute <math alttext="\widetilde{S}_{g}(\overrightarrow{\mathbf{x}}_{1}),\cdots,\widetilde{S}_{g}(%
\overrightarrow{\mathbf{x}}_{s})" class="ltx_Math" display="inline" id="S3.SS4.SSS1.Px2.p1.1.m1.3"><semantics id="S3.SS4.SSS1.Px2.p1.1.m1.3a"><mrow id="S3.SS4.SSS1.Px2.p1.1.m1.3.3.2" xref="S3.SS4.SSS1.Px2.p1.1.m1.3.3.3.cmml"><mrow id="S3.SS4.SSS1.Px2.p1.1.m1.2.2.1.1" xref="S3.SS4.SSS1.Px2.p1.1.m1.2.2.1.1.cmml"><msub id="S3.SS4.SSS1.Px2.p1.1.m1.2.2.1.1.3" xref="S3.SS4.SSS1.Px2.p1.1.m1.2.2.1.1.3.cmml"><mover accent="true" id="S3.SS4.SSS1.Px2.p1.1.m1.2.2.1.1.3.2" xref="S3.SS4.SSS1.Px2.p1.1.m1.2.2.1.1.3.2.cmml"><mi id="S3.SS4.SSS1.Px2.p1.1.m1.2.2.1.1.3.2.2" xref="S3.SS4.SSS1.Px2.p1.1.m1.2.2.1.1.3.2.2.cmml">S</mi><mo id="S3.SS4.SSS1.Px2.p1.1.m1.2.2.1.1.3.2.1" xref="S3.SS4.SSS1.Px2.p1.1.m1.2.2.1.1.3.2.1.cmml">~</mo></mover><mi id="S3.SS4.SSS1.Px2.p1.1.m1.2.2.1.1.3.3" xref="S3.SS4.SSS1.Px2.p1.1.m1.2.2.1.1.3.3.cmml">g</mi></msub><mo id="S3.SS4.SSS1.Px2.p1.1.m1.2.2.1.1.2" xref="S3.SS4.SSS1.Px2.p1.1.m1.2.2.1.1.2.cmml">⁢</mo><mrow id="S3.SS4.SSS1.Px2.p1.1.m1.2.2.1.1.1.1" xref="S3.SS4.SSS1.Px2.p1.1.m1.2.2.1.1.1.1.1.cmml"><mo id="S3.SS4.SSS1.Px2.p1.1.m1.2.2.1.1.1.1.2" stretchy="false" xref="S3.SS4.SSS1.Px2.p1.1.m1.2.2.1.1.1.1.1.cmml">(</mo><msub id="S3.SS4.SSS1.Px2.p1.1.m1.2.2.1.1.1.1.1" xref="S3.SS4.SSS1.Px2.p1.1.m1.2.2.1.1.1.1.1.cmml"><mover accent="true" id="S3.SS4.SSS1.Px2.p1.1.m1.2.2.1.1.1.1.1.2" xref="S3.SS4.SSS1.Px2.p1.1.m1.2.2.1.1.1.1.1.2.cmml"><mi id="S3.SS4.SSS1.Px2.p1.1.m1.2.2.1.1.1.1.1.2.2" xref="S3.SS4.SSS1.Px2.p1.1.m1.2.2.1.1.1.1.1.2.2.cmml">𝐱</mi><mo id="S3.SS4.SSS1.Px2.p1.1.m1.2.2.1.1.1.1.1.2.1" stretchy="false" xref="S3.SS4.SSS1.Px2.p1.1.m1.2.2.1.1.1.1.1.2.1.cmml">→</mo></mover><mn id="S3.SS4.SSS1.Px2.p1.1.m1.2.2.1.1.1.1.1.3" xref="S3.SS4.SSS1.Px2.p1.1.m1.2.2.1.1.1.1.1.3.cmml">1</mn></msub><mo id="S3.SS4.SSS1.Px2.p1.1.m1.2.2.1.1.1.1.3" stretchy="false" xref="S3.SS4.SSS1.Px2.p1.1.m1.2.2.1.1.1.1.1.cmml">)</mo></mrow></mrow><mo id="S3.SS4.SSS1.Px2.p1.1.m1.3.3.2.3" xref="S3.SS4.SSS1.Px2.p1.1.m1.3.3.3.cmml">,</mo><mi id="S3.SS4.SSS1.Px2.p1.1.m1.1.1" mathvariant="normal" xref="S3.SS4.SSS1.Px2.p1.1.m1.1.1.cmml">⋯</mi><mo id="S3.SS4.SSS1.Px2.p1.1.m1.3.3.2.4" xref="S3.SS4.SSS1.Px2.p1.1.m1.3.3.3.cmml">,</mo><mrow id="S3.SS4.SSS1.Px2.p1.1.m1.3.3.2.2" xref="S3.SS4.SSS1.Px2.p1.1.m1.3.3.2.2.cmml"><msub id="S3.SS4.SSS1.Px2.p1.1.m1.3.3.2.2.3" xref="S3.SS4.SSS1.Px2.p1.1.m1.3.3.2.2.3.cmml"><mover accent="true" id="S3.SS4.SSS1.Px2.p1.1.m1.3.3.2.2.3.2" xref="S3.SS4.SSS1.Px2.p1.1.m1.3.3.2.2.3.2.cmml"><mi id="S3.SS4.SSS1.Px2.p1.1.m1.3.3.2.2.3.2.2" xref="S3.SS4.SSS1.Px2.p1.1.m1.3.3.2.2.3.2.2.cmml">S</mi><mo id="S3.SS4.SSS1.Px2.p1.1.m1.3.3.2.2.3.2.1" xref="S3.SS4.SSS1.Px2.p1.1.m1.3.3.2.2.3.2.1.cmml">~</mo></mover><mi id="S3.SS4.SSS1.Px2.p1.1.m1.3.3.2.2.3.3" xref="S3.SS4.SSS1.Px2.p1.1.m1.3.3.2.2.3.3.cmml">g</mi></msub><mo id="S3.SS4.SSS1.Px2.p1.1.m1.3.3.2.2.2" xref="S3.SS4.SSS1.Px2.p1.1.m1.3.3.2.2.2.cmml">⁢</mo><mrow id="S3.SS4.SSS1.Px2.p1.1.m1.3.3.2.2.1.1" xref="S3.SS4.SSS1.Px2.p1.1.m1.3.3.2.2.1.1.1.cmml"><mo id="S3.SS4.SSS1.Px2.p1.1.m1.3.3.2.2.1.1.2" stretchy="false" xref="S3.SS4.SSS1.Px2.p1.1.m1.3.3.2.2.1.1.1.cmml">(</mo><msub id="S3.SS4.SSS1.Px2.p1.1.m1.3.3.2.2.1.1.1" xref="S3.SS4.SSS1.Px2.p1.1.m1.3.3.2.2.1.1.1.cmml"><mover accent="true" id="S3.SS4.SSS1.Px2.p1.1.m1.3.3.2.2.1.1.1.2" xref="S3.SS4.SSS1.Px2.p1.1.m1.3.3.2.2.1.1.1.2.cmml"><mi id="S3.SS4.SSS1.Px2.p1.1.m1.3.3.2.2.1.1.1.2.2" xref="S3.SS4.SSS1.Px2.p1.1.m1.3.3.2.2.1.1.1.2.2.cmml">𝐱</mi><mo id="S3.SS4.SSS1.Px2.p1.1.m1.3.3.2.2.1.1.1.2.1" stretchy="false" xref="S3.SS4.SSS1.Px2.p1.1.m1.3.3.2.2.1.1.1.2.1.cmml">→</mo></mover><mi id="S3.SS4.SSS1.Px2.p1.1.m1.3.3.2.2.1.1.1.3" xref="S3.SS4.SSS1.Px2.p1.1.m1.3.3.2.2.1.1.1.3.cmml">s</mi></msub><mo id="S3.SS4.SSS1.Px2.p1.1.m1.3.3.2.2.1.1.3" stretchy="false" xref="S3.SS4.SSS1.Px2.p1.1.m1.3.3.2.2.1.1.1.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.SS4.SSS1.Px2.p1.1.m1.3b"><list id="S3.SS4.SSS1.Px2.p1.1.m1.3.3.3.cmml" xref="S3.SS4.SSS1.Px2.p1.1.m1.3.3.2"><apply id="S3.SS4.SSS1.Px2.p1.1.m1.2.2.1.1.cmml" xref="S3.SS4.SSS1.Px2.p1.1.m1.2.2.1.1"><times id="S3.SS4.SSS1.Px2.p1.1.m1.2.2.1.1.2.cmml" xref="S3.SS4.SSS1.Px2.p1.1.m1.2.2.1.1.2"></times><apply id="S3.SS4.SSS1.Px2.p1.1.m1.2.2.1.1.3.cmml" xref="S3.SS4.SSS1.Px2.p1.1.m1.2.2.1.1.3"><csymbol cd="ambiguous" id="S3.SS4.SSS1.Px2.p1.1.m1.2.2.1.1.3.1.cmml" xref="S3.SS4.SSS1.Px2.p1.1.m1.2.2.1.1.3">subscript</csymbol><apply id="S3.SS4.SSS1.Px2.p1.1.m1.2.2.1.1.3.2.cmml" xref="S3.SS4.SSS1.Px2.p1.1.m1.2.2.1.1.3.2"><ci id="S3.SS4.SSS1.Px2.p1.1.m1.2.2.1.1.3.2.1.cmml" xref="S3.SS4.SSS1.Px2.p1.1.m1.2.2.1.1.3.2.1">~</ci><ci id="S3.SS4.SSS1.Px2.p1.1.m1.2.2.1.1.3.2.2.cmml" xref="S3.SS4.SSS1.Px2.p1.1.m1.2.2.1.1.3.2.2">𝑆</ci></apply><ci id="S3.SS4.SSS1.Px2.p1.1.m1.2.2.1.1.3.3.cmml" xref="S3.SS4.SSS1.Px2.p1.1.m1.2.2.1.1.3.3">𝑔</ci></apply><apply id="S3.SS4.SSS1.Px2.p1.1.m1.2.2.1.1.1.1.1.cmml" xref="S3.SS4.SSS1.Px2.p1.1.m1.2.2.1.1.1.1"><csymbol cd="ambiguous" id="S3.SS4.SSS1.Px2.p1.1.m1.2.2.1.1.1.1.1.1.cmml" xref="S3.SS4.SSS1.Px2.p1.1.m1.2.2.1.1.1.1">subscript</csymbol><apply id="S3.SS4.SSS1.Px2.p1.1.m1.2.2.1.1.1.1.1.2.cmml" xref="S3.SS4.SSS1.Px2.p1.1.m1.2.2.1.1.1.1.1.2"><ci id="S3.SS4.SSS1.Px2.p1.1.m1.2.2.1.1.1.1.1.2.1.cmml" xref="S3.SS4.SSS1.Px2.p1.1.m1.2.2.1.1.1.1.1.2.1">→</ci><ci id="S3.SS4.SSS1.Px2.p1.1.m1.2.2.1.1.1.1.1.2.2.cmml" xref="S3.SS4.SSS1.Px2.p1.1.m1.2.2.1.1.1.1.1.2.2">𝐱</ci></apply><cn id="S3.SS4.SSS1.Px2.p1.1.m1.2.2.1.1.1.1.1.3.cmml" type="integer" xref="S3.SS4.SSS1.Px2.p1.1.m1.2.2.1.1.1.1.1.3">1</cn></apply></apply><ci id="S3.SS4.SSS1.Px2.p1.1.m1.1.1.cmml" xref="S3.SS4.SSS1.Px2.p1.1.m1.1.1">⋯</ci><apply id="S3.SS4.SSS1.Px2.p1.1.m1.3.3.2.2.cmml" xref="S3.SS4.SSS1.Px2.p1.1.m1.3.3.2.2"><times id="S3.SS4.SSS1.Px2.p1.1.m1.3.3.2.2.2.cmml" xref="S3.SS4.SSS1.Px2.p1.1.m1.3.3.2.2.2"></times><apply id="S3.SS4.SSS1.Px2.p1.1.m1.3.3.2.2.3.cmml" xref="S3.SS4.SSS1.Px2.p1.1.m1.3.3.2.2.3"><csymbol cd="ambiguous" id="S3.SS4.SSS1.Px2.p1.1.m1.3.3.2.2.3.1.cmml" xref="S3.SS4.SSS1.Px2.p1.1.m1.3.3.2.2.3">subscript</csymbol><apply id="S3.SS4.SSS1.Px2.p1.1.m1.3.3.2.2.3.2.cmml" xref="S3.SS4.SSS1.Px2.p1.1.m1.3.3.2.2.3.2"><ci id="S3.SS4.SSS1.Px2.p1.1.m1.3.3.2.2.3.2.1.cmml" xref="S3.SS4.SSS1.Px2.p1.1.m1.3.3.2.2.3.2.1">~</ci><ci id="S3.SS4.SSS1.Px2.p1.1.m1.3.3.2.2.3.2.2.cmml" xref="S3.SS4.SSS1.Px2.p1.1.m1.3.3.2.2.3.2.2">𝑆</ci></apply><ci id="S3.SS4.SSS1.Px2.p1.1.m1.3.3.2.2.3.3.cmml" xref="S3.SS4.SSS1.Px2.p1.1.m1.3.3.2.2.3.3">𝑔</ci></apply><apply id="S3.SS4.SSS1.Px2.p1.1.m1.3.3.2.2.1.1.1.cmml" xref="S3.SS4.SSS1.Px2.p1.1.m1.3.3.2.2.1.1"><csymbol cd="ambiguous" id="S3.SS4.SSS1.Px2.p1.1.m1.3.3.2.2.1.1.1.1.cmml" xref="S3.SS4.SSS1.Px2.p1.1.m1.3.3.2.2.1.1">subscript</csymbol><apply id="S3.SS4.SSS1.Px2.p1.1.m1.3.3.2.2.1.1.1.2.cmml" xref="S3.SS4.SSS1.Px2.p1.1.m1.3.3.2.2.1.1.1.2"><ci id="S3.SS4.SSS1.Px2.p1.1.m1.3.3.2.2.1.1.1.2.1.cmml" xref="S3.SS4.SSS1.Px2.p1.1.m1.3.3.2.2.1.1.1.2.1">→</ci><ci id="S3.SS4.SSS1.Px2.p1.1.m1.3.3.2.2.1.1.1.2.2.cmml" xref="S3.SS4.SSS1.Px2.p1.1.m1.3.3.2.2.1.1.1.2.2">𝐱</ci></apply><ci id="S3.SS4.SSS1.Px2.p1.1.m1.3.3.2.2.1.1.1.3.cmml" xref="S3.SS4.SSS1.Px2.p1.1.m1.3.3.2.2.1.1.1.3">𝑠</ci></apply></apply></list></annotation-xml><annotation encoding="application/x-tex" id="S3.SS4.SSS1.Px2.p1.1.m1.3c">\widetilde{S}_{g}(\overrightarrow{\mathbf{x}}_{1}),\cdots,\widetilde{S}_{g}(%
\overrightarrow{\mathbf{x}}_{s})</annotation><annotation encoding="application/x-llamapun" id="S3.SS4.SSS1.Px2.p1.1.m1.3d">over~ start_ARG italic_S end_ARG start_POSTSUBSCRIPT italic_g end_POSTSUBSCRIPT ( over→ start_ARG bold_x end_ARG start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT ) , ⋯ , over~ start_ARG italic_S end_ARG start_POSTSUBSCRIPT italic_g end_POSTSUBSCRIPT ( over→ start_ARG bold_x end_ARG start_POSTSUBSCRIPT italic_s end_POSTSUBSCRIPT )</annotation></semantics></math> for the latest token from each of the <math alttext="s" class="ltx_Math" display="inline" id="S3.SS4.SSS1.Px2.p1.2.m2.1"><semantics id="S3.SS4.SSS1.Px2.p1.2.m2.1a"><mi id="S3.SS4.SSS1.Px2.p1.2.m2.1.1" xref="S3.SS4.SSS1.Px2.p1.2.m2.1.1.cmml">s</mi><annotation-xml encoding="MathML-Content" id="S3.SS4.SSS1.Px2.p1.2.m2.1b"><ci id="S3.SS4.SSS1.Px2.p1.2.m2.1.1.cmml" xref="S3.SS4.SSS1.Px2.p1.2.m2.1.1">𝑠</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS4.SSS1.Px2.p1.2.m2.1c">s</annotation><annotation encoding="application/x-llamapun" id="S3.SS4.SSS1.Px2.p1.2.m2.1d">italic_s</annotation></semantics></math> samples and use their union <math alttext="\cup_{u\in[s]}\widetilde{S}_{g}(\overrightarrow{\mathbf{x}}_{u})" class="ltx_Math" display="inline" id="S3.SS4.SSS1.Px2.p1.3.m3.2"><semantics id="S3.SS4.SSS1.Px2.p1.3.m3.2a"><mrow id="S3.SS4.SSS1.Px2.p1.3.m3.2.2" xref="S3.SS4.SSS1.Px2.p1.3.m3.2.2.cmml"><msub id="S3.SS4.SSS1.Px2.p1.3.m3.2.2.2" xref="S3.SS4.SSS1.Px2.p1.3.m3.2.2.2.cmml"><mo id="S3.SS4.SSS1.Px2.p1.3.m3.2.2.2.2" xref="S3.SS4.SSS1.Px2.p1.3.m3.2.2.2.2.cmml">∪</mo><mrow id="S3.SS4.SSS1.Px2.p1.3.m3.1.1.1" xref="S3.SS4.SSS1.Px2.p1.3.m3.1.1.1.cmml"><mi id="S3.SS4.SSS1.Px2.p1.3.m3.1.1.1.3" xref="S3.SS4.SSS1.Px2.p1.3.m3.1.1.1.3.cmml">u</mi><mo id="S3.SS4.SSS1.Px2.p1.3.m3.1.1.1.2" xref="S3.SS4.SSS1.Px2.p1.3.m3.1.1.1.2.cmml">∈</mo><mrow id="S3.SS4.SSS1.Px2.p1.3.m3.1.1.1.4.2" xref="S3.SS4.SSS1.Px2.p1.3.m3.1.1.1.4.1.cmml"><mo id="S3.SS4.SSS1.Px2.p1.3.m3.1.1.1.4.2.1" stretchy="false" xref="S3.SS4.SSS1.Px2.p1.3.m3.1.1.1.4.1.1.cmml">[</mo><mi id="S3.SS4.SSS1.Px2.p1.3.m3.1.1.1.1" xref="S3.SS4.SSS1.Px2.p1.3.m3.1.1.1.1.cmml">s</mi><mo id="S3.SS4.SSS1.Px2.p1.3.m3.1.1.1.4.2.2" stretchy="false" xref="S3.SS4.SSS1.Px2.p1.3.m3.1.1.1.4.1.1.cmml">]</mo></mrow></mrow></msub><mrow id="S3.SS4.SSS1.Px2.p1.3.m3.2.2.1" xref="S3.SS4.SSS1.Px2.p1.3.m3.2.2.1.cmml"><msub id="S3.SS4.SSS1.Px2.p1.3.m3.2.2.1.3" xref="S3.SS4.SSS1.Px2.p1.3.m3.2.2.1.3.cmml"><mover accent="true" id="S3.SS4.SSS1.Px2.p1.3.m3.2.2.1.3.2" xref="S3.SS4.SSS1.Px2.p1.3.m3.2.2.1.3.2.cmml"><mi id="S3.SS4.SSS1.Px2.p1.3.m3.2.2.1.3.2.2" xref="S3.SS4.SSS1.Px2.p1.3.m3.2.2.1.3.2.2.cmml">S</mi><mo id="S3.SS4.SSS1.Px2.p1.3.m3.2.2.1.3.2.1" xref="S3.SS4.SSS1.Px2.p1.3.m3.2.2.1.3.2.1.cmml">~</mo></mover><mi id="S3.SS4.SSS1.Px2.p1.3.m3.2.2.1.3.3" xref="S3.SS4.SSS1.Px2.p1.3.m3.2.2.1.3.3.cmml">g</mi></msub><mo id="S3.SS4.SSS1.Px2.p1.3.m3.2.2.1.2" xref="S3.SS4.SSS1.Px2.p1.3.m3.2.2.1.2.cmml">⁢</mo><mrow id="S3.SS4.SSS1.Px2.p1.3.m3.2.2.1.1.1" xref="S3.SS4.SSS1.Px2.p1.3.m3.2.2.1.1.1.1.cmml"><mo id="S3.SS4.SSS1.Px2.p1.3.m3.2.2.1.1.1.2" stretchy="false" xref="S3.SS4.SSS1.Px2.p1.3.m3.2.2.1.1.1.1.cmml">(</mo><msub id="S3.SS4.SSS1.Px2.p1.3.m3.2.2.1.1.1.1" xref="S3.SS4.SSS1.Px2.p1.3.m3.2.2.1.1.1.1.cmml"><mover accent="true" id="S3.SS4.SSS1.Px2.p1.3.m3.2.2.1.1.1.1.2" xref="S3.SS4.SSS1.Px2.p1.3.m3.2.2.1.1.1.1.2.cmml"><mi id="S3.SS4.SSS1.Px2.p1.3.m3.2.2.1.1.1.1.2.2" xref="S3.SS4.SSS1.Px2.p1.3.m3.2.2.1.1.1.1.2.2.cmml">𝐱</mi><mo id="S3.SS4.SSS1.Px2.p1.3.m3.2.2.1.1.1.1.2.1" stretchy="false" xref="S3.SS4.SSS1.Px2.p1.3.m3.2.2.1.1.1.1.2.1.cmml">→</mo></mover><mi id="S3.SS4.SSS1.Px2.p1.3.m3.2.2.1.1.1.1.3" xref="S3.SS4.SSS1.Px2.p1.3.m3.2.2.1.1.1.1.3.cmml">u</mi></msub><mo id="S3.SS4.SSS1.Px2.p1.3.m3.2.2.1.1.1.3" stretchy="false" xref="S3.SS4.SSS1.Px2.p1.3.m3.2.2.1.1.1.1.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.SS4.SSS1.Px2.p1.3.m3.2b"><apply id="S3.SS4.SSS1.Px2.p1.3.m3.2.2.cmml" xref="S3.SS4.SSS1.Px2.p1.3.m3.2.2"><apply id="S3.SS4.SSS1.Px2.p1.3.m3.2.2.2.cmml" xref="S3.SS4.SSS1.Px2.p1.3.m3.2.2.2"><csymbol cd="ambiguous" id="S3.SS4.SSS1.Px2.p1.3.m3.2.2.2.1.cmml" xref="S3.SS4.SSS1.Px2.p1.3.m3.2.2.2">subscript</csymbol><union id="S3.SS4.SSS1.Px2.p1.3.m3.2.2.2.2.cmml" xref="S3.SS4.SSS1.Px2.p1.3.m3.2.2.2.2"></union><apply id="S3.SS4.SSS1.Px2.p1.3.m3.1.1.1.cmml" xref="S3.SS4.SSS1.Px2.p1.3.m3.1.1.1"><in id="S3.SS4.SSS1.Px2.p1.3.m3.1.1.1.2.cmml" xref="S3.SS4.SSS1.Px2.p1.3.m3.1.1.1.2"></in><ci id="S3.SS4.SSS1.Px2.p1.3.m3.1.1.1.3.cmml" xref="S3.SS4.SSS1.Px2.p1.3.m3.1.1.1.3">𝑢</ci><apply id="S3.SS4.SSS1.Px2.p1.3.m3.1.1.1.4.1.cmml" xref="S3.SS4.SSS1.Px2.p1.3.m3.1.1.1.4.2"><csymbol cd="latexml" id="S3.SS4.SSS1.Px2.p1.3.m3.1.1.1.4.1.1.cmml" xref="S3.SS4.SSS1.Px2.p1.3.m3.1.1.1.4.2.1">delimited-[]</csymbol><ci id="S3.SS4.SSS1.Px2.p1.3.m3.1.1.1.1.cmml" xref="S3.SS4.SSS1.Px2.p1.3.m3.1.1.1.1">𝑠</ci></apply></apply></apply><apply id="S3.SS4.SSS1.Px2.p1.3.m3.2.2.1.cmml" xref="S3.SS4.SSS1.Px2.p1.3.m3.2.2.1"><times id="S3.SS4.SSS1.Px2.p1.3.m3.2.2.1.2.cmml" xref="S3.SS4.SSS1.Px2.p1.3.m3.2.2.1.2"></times><apply id="S3.SS4.SSS1.Px2.p1.3.m3.2.2.1.3.cmml" xref="S3.SS4.SSS1.Px2.p1.3.m3.2.2.1.3"><csymbol cd="ambiguous" id="S3.SS4.SSS1.Px2.p1.3.m3.2.2.1.3.1.cmml" xref="S3.SS4.SSS1.Px2.p1.3.m3.2.2.1.3">subscript</csymbol><apply id="S3.SS4.SSS1.Px2.p1.3.m3.2.2.1.3.2.cmml" xref="S3.SS4.SSS1.Px2.p1.3.m3.2.2.1.3.2"><ci id="S3.SS4.SSS1.Px2.p1.3.m3.2.2.1.3.2.1.cmml" xref="S3.SS4.SSS1.Px2.p1.3.m3.2.2.1.3.2.1">~</ci><ci id="S3.SS4.SSS1.Px2.p1.3.m3.2.2.1.3.2.2.cmml" xref="S3.SS4.SSS1.Px2.p1.3.m3.2.2.1.3.2.2">𝑆</ci></apply><ci id="S3.SS4.SSS1.Px2.p1.3.m3.2.2.1.3.3.cmml" xref="S3.SS4.SSS1.Px2.p1.3.m3.2.2.1.3.3">𝑔</ci></apply><apply id="S3.SS4.SSS1.Px2.p1.3.m3.2.2.1.1.1.1.cmml" xref="S3.SS4.SSS1.Px2.p1.3.m3.2.2.1.1.1"><csymbol cd="ambiguous" id="S3.SS4.SSS1.Px2.p1.3.m3.2.2.1.1.1.1.1.cmml" xref="S3.SS4.SSS1.Px2.p1.3.m3.2.2.1.1.1">subscript</csymbol><apply id="S3.SS4.SSS1.Px2.p1.3.m3.2.2.1.1.1.1.2.cmml" xref="S3.SS4.SSS1.Px2.p1.3.m3.2.2.1.1.1.1.2"><ci id="S3.SS4.SSS1.Px2.p1.3.m3.2.2.1.1.1.1.2.1.cmml" xref="S3.SS4.SSS1.Px2.p1.3.m3.2.2.1.1.1.1.2.1">→</ci><ci id="S3.SS4.SSS1.Px2.p1.3.m3.2.2.1.1.1.1.2.2.cmml" xref="S3.SS4.SSS1.Px2.p1.3.m3.2.2.1.1.1.1.2.2">𝐱</ci></apply><ci id="S3.SS4.SSS1.Px2.p1.3.m3.2.2.1.1.1.1.3.cmml" xref="S3.SS4.SSS1.Px2.p1.3.m3.2.2.1.1.1.1.3">𝑢</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS4.SSS1.Px2.p1.3.m3.2c">\cup_{u\in[s]}\widetilde{S}_{g}(\overrightarrow{\mathbf{x}}_{u})</annotation><annotation encoding="application/x-llamapun" id="S3.SS4.SSS1.Px2.p1.3.m3.2d">∪ start_POSTSUBSCRIPT italic_u ∈ [ italic_s ] end_POSTSUBSCRIPT over~ start_ARG italic_S end_ARG start_POSTSUBSCRIPT italic_g end_POSTSUBSCRIPT ( over→ start_ARG bold_x end_ARG start_POSTSUBSCRIPT italic_u end_POSTSUBSCRIPT )</annotation></semantics></math> on line <math alttext="1" class="ltx_Math" display="inline" id="S3.SS4.SSS1.Px2.p1.4.m4.1"><semantics id="S3.SS4.SSS1.Px2.p1.4.m4.1a"><mn id="S3.SS4.SSS1.Px2.p1.4.m4.1.1" xref="S3.SS4.SSS1.Px2.p1.4.m4.1.1.cmml">1</mn><annotation-xml encoding="MathML-Content" id="S3.SS4.SSS1.Px2.p1.4.m4.1b"><cn id="S3.SS4.SSS1.Px2.p1.4.m4.1.1.cmml" type="integer" xref="S3.SS4.SSS1.Px2.p1.4.m4.1.1">1</cn></annotation-xml><annotation encoding="application/x-tex" id="S3.SS4.SSS1.Px2.p1.4.m4.1c">1</annotation><annotation encoding="application/x-llamapun" id="S3.SS4.SSS1.Px2.p1.4.m4.1d">1</annotation></semantics></math> of Algorithm <a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#alg1" title="Algorithm 1 ‣ 3.2.1 Solving equation 5 accurately and efficiently ‣ 3.2 HiRE: Overall Approach ‣ 3 Main Ideas ‣ HiRE: High Recall Approximate Top-𝑘 Estimation for Efficient LLM Inference"><span class="ltx_text ltx_ref_tag">1</span></a> and <a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#alg2" title='Algorithm 2 ‣ 3.2.2 "DA-TOP-"⁢𝑘: Multi-device serving with approximate distributed top-𝑘 operation ‣ 3.2 HiRE: Overall Approach ‣ 3 Main Ideas ‣ HiRE: High Recall Approximate Top-𝑘 Estimation for Efficient LLM Inference'><span class="ltx_text ltx_ref_tag">2</span></a>.
</p>
</div>
<figure class="ltx_table" id="S3.T1">
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_table">Table 1: </span>Evaluation of HiRE-Softmax with the baseline dense model <math alttext="\mathcal{M}_{\textrm{base}}" class="ltx_Math" display="inline" id="S3.T1.3.m1.1"><semantics id="S3.T1.3.m1.1b"><msub id="S3.T1.3.m1.1.1" xref="S3.T1.3.m1.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S3.T1.3.m1.1.1.2" xref="S3.T1.3.m1.1.1.2.cmml">ℳ</mi><mtext id="S3.T1.3.m1.1.1.3" xref="S3.T1.3.m1.1.1.3a.cmml">base</mtext></msub><annotation-xml encoding="MathML-Content" id="S3.T1.3.m1.1c"><apply id="S3.T1.3.m1.1.1.cmml" xref="S3.T1.3.m1.1.1"><csymbol cd="ambiguous" id="S3.T1.3.m1.1.1.1.cmml" xref="S3.T1.3.m1.1.1">subscript</csymbol><ci id="S3.T1.3.m1.1.1.2.cmml" xref="S3.T1.3.m1.1.1.2">ℳ</ci><ci id="S3.T1.3.m1.1.1.3a.cmml" xref="S3.T1.3.m1.1.1.3"><mtext id="S3.T1.3.m1.1.1.3.cmml" mathsize="70%" xref="S3.T1.3.m1.1.1.3">base</mtext></ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.T1.3.m1.1d">\mathcal{M}_{\textrm{base}}</annotation><annotation encoding="application/x-llamapun" id="S3.T1.3.m1.1e">caligraphic_M start_POSTSUBSCRIPT base end_POSTSUBSCRIPT</annotation></semantics></math> on a single TPUv5e device. For HiRE-Softmax, we use three different kinds of approximation: HiRE-LR with low rank approximation, HiRE-Q with int4 quantization and then finally HiRE-LRQ with both low rank and int4 quantization. We notice similar speedups with both HiRE-Q and HiRE-LR as both of them reduce the size of parameters that are used for computation by <math alttext="25\%" class="ltx_Math" display="inline" id="S3.T1.4.m2.1"><semantics id="S3.T1.4.m2.1b"><mrow id="S3.T1.4.m2.1.1" xref="S3.T1.4.m2.1.1.cmml"><mn id="S3.T1.4.m2.1.1.2" xref="S3.T1.4.m2.1.1.2.cmml">25</mn><mo id="S3.T1.4.m2.1.1.1" xref="S3.T1.4.m2.1.1.1.cmml">%</mo></mrow><annotation-xml encoding="MathML-Content" id="S3.T1.4.m2.1c"><apply id="S3.T1.4.m2.1.1.cmml" xref="S3.T1.4.m2.1.1"><csymbol cd="latexml" id="S3.T1.4.m2.1.1.1.cmml" xref="S3.T1.4.m2.1.1.1">percent</csymbol><cn id="S3.T1.4.m2.1.1.2.cmml" type="integer" xref="S3.T1.4.m2.1.1.2">25</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.T1.4.m2.1d">25\%</annotation><annotation encoding="application/x-llamapun" id="S3.T1.4.m2.1e">25 %</annotation></semantics></math>.</figcaption>
<table class="ltx_tabular ltx_centering ltx_align_middle" id="S3.T1.11">
<tr class="ltx_tr" id="S3.T1.5.1">
<td class="ltx_td ltx_border_l ltx_border_r ltx_border_t" colspan="3" id="S3.T1.5.1.2"></td>
<td class="ltx_td ltx_align_center ltx_border_l ltx_border_r ltx_border_t" colspan="3" id="S3.T1.5.1.1">
<math alttext="\mathcal{M}_{\textrm{sm}}" class="ltx_Math" display="inline" id="S3.T1.5.1.1.m1.1"><semantics id="S3.T1.5.1.1.m1.1a"><msub id="S3.T1.5.1.1.m1.1.1" xref="S3.T1.5.1.1.m1.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S3.T1.5.1.1.m1.1.1.2" xref="S3.T1.5.1.1.m1.1.1.2.cmml">ℳ</mi><mtext id="S3.T1.5.1.1.m1.1.1.3" xref="S3.T1.5.1.1.m1.1.1.3a.cmml">sm</mtext></msub><annotation-xml encoding="MathML-Content" id="S3.T1.5.1.1.m1.1b"><apply id="S3.T1.5.1.1.m1.1.1.cmml" xref="S3.T1.5.1.1.m1.1.1"><csymbol cd="ambiguous" id="S3.T1.5.1.1.m1.1.1.1.cmml" xref="S3.T1.5.1.1.m1.1.1">subscript</csymbol><ci id="S3.T1.5.1.1.m1.1.1.2.cmml" xref="S3.T1.5.1.1.m1.1.1.2">ℳ</ci><ci id="S3.T1.5.1.1.m1.1.1.3a.cmml" xref="S3.T1.5.1.1.m1.1.1.3"><mtext id="S3.T1.5.1.1.m1.1.1.3.cmml" mathsize="70%" xref="S3.T1.5.1.1.m1.1.1.3">sm</mtext></ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.T1.5.1.1.m1.1c">\mathcal{M}_{\textrm{sm}}</annotation><annotation encoding="application/x-llamapun" id="S3.T1.5.1.1.m1.1d">caligraphic_M start_POSTSUBSCRIPT sm end_POSTSUBSCRIPT</annotation></semantics></math></td>
</tr>
<tr class="ltx_tr" id="S3.T1.11.7">
<td class="ltx_td ltx_border_l ltx_border_r ltx_border_t" colspan="2" id="S3.T1.11.7.7"></td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S3.T1.6.2.1">
<span class="ltx_text" id="S3.T1.6.2.1.2"></span> <span class="ltx_text" id="S3.T1.6.2.1.1">
<span class="ltx_tabular ltx_align_middle" id="S3.T1.6.2.1.1.1">
<span class="ltx_tr" id="S3.T1.6.2.1.1.1.1">
<span class="ltx_td ltx_align_center" id="S3.T1.6.2.1.1.1.1.1"><math alttext="\mathcal{M}_{\textrm{base}}" class="ltx_Math" display="inline" id="S3.T1.6.2.1.1.1.1.1.m1.1"><semantics id="S3.T1.6.2.1.1.1.1.1.m1.1a"><msub id="S3.T1.6.2.1.1.1.1.1.m1.1.1" xref="S3.T1.6.2.1.1.1.1.1.m1.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S3.T1.6.2.1.1.1.1.1.m1.1.1.2" xref="S3.T1.6.2.1.1.1.1.1.m1.1.1.2.cmml">ℳ</mi><mtext id="S3.T1.6.2.1.1.1.1.1.m1.1.1.3" xref="S3.T1.6.2.1.1.1.1.1.m1.1.1.3a.cmml">base</mtext></msub><annotation-xml encoding="MathML-Content" id="S3.T1.6.2.1.1.1.1.1.m1.1b"><apply id="S3.T1.6.2.1.1.1.1.1.m1.1.1.cmml" xref="S3.T1.6.2.1.1.1.1.1.m1.1.1"><csymbol cd="ambiguous" id="S3.T1.6.2.1.1.1.1.1.m1.1.1.1.cmml" xref="S3.T1.6.2.1.1.1.1.1.m1.1.1">subscript</csymbol><ci id="S3.T1.6.2.1.1.1.1.1.m1.1.1.2.cmml" xref="S3.T1.6.2.1.1.1.1.1.m1.1.1.2">ℳ</ci><ci id="S3.T1.6.2.1.1.1.1.1.m1.1.1.3a.cmml" xref="S3.T1.6.2.1.1.1.1.1.m1.1.1.3"><mtext id="S3.T1.6.2.1.1.1.1.1.m1.1.1.3.cmml" mathsize="70%" xref="S3.T1.6.2.1.1.1.1.1.m1.1.1.3">base</mtext></ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.T1.6.2.1.1.1.1.1.m1.1c">\mathcal{M}_{\textrm{base}}</annotation><annotation encoding="application/x-llamapun" id="S3.T1.6.2.1.1.1.1.1.m1.1d">caligraphic_M start_POSTSUBSCRIPT base end_POSTSUBSCRIPT</annotation></semantics></math></span></span>
</span></span> <span class="ltx_text" id="S3.T1.6.2.1.3"></span>
</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S3.T1.8.4.3">
<span class="ltx_text" id="S3.T1.8.4.3.3"></span> <span class="ltx_text" id="S3.T1.8.4.3.2">
<span class="ltx_tabular ltx_align_middle" id="S3.T1.8.4.3.2.2">
<span class="ltx_tr" id="S3.T1.8.4.3.2.2.3">
<span class="ltx_td ltx_align_center" id="S3.T1.8.4.3.2.2.3.1">HiRE-LR</span></span>
<span class="ltx_tr" id="S3.T1.8.4.3.2.2.2">
<span class="ltx_td ltx_align_center" id="S3.T1.8.4.3.2.2.2.2">(<math alttext="r=25\%" class="ltx_Math" display="inline" id="S3.T1.7.3.2.1.1.1.1.m1.1"><semantics id="S3.T1.7.3.2.1.1.1.1.m1.1a"><mrow id="S3.T1.7.3.2.1.1.1.1.m1.1.1" xref="S3.T1.7.3.2.1.1.1.1.m1.1.1.cmml"><mi id="S3.T1.7.3.2.1.1.1.1.m1.1.1.2" xref="S3.T1.7.3.2.1.1.1.1.m1.1.1.2.cmml">r</mi><mo id="S3.T1.7.3.2.1.1.1.1.m1.1.1.1" xref="S3.T1.7.3.2.1.1.1.1.m1.1.1.1.cmml">=</mo><mrow id="S3.T1.7.3.2.1.1.1.1.m1.1.1.3" xref="S3.T1.7.3.2.1.1.1.1.m1.1.1.3.cmml"><mn id="S3.T1.7.3.2.1.1.1.1.m1.1.1.3.2" xref="S3.T1.7.3.2.1.1.1.1.m1.1.1.3.2.cmml">25</mn><mo id="S3.T1.7.3.2.1.1.1.1.m1.1.1.3.1" xref="S3.T1.7.3.2.1.1.1.1.m1.1.1.3.1.cmml">%</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.T1.7.3.2.1.1.1.1.m1.1b"><apply id="S3.T1.7.3.2.1.1.1.1.m1.1.1.cmml" xref="S3.T1.7.3.2.1.1.1.1.m1.1.1"><eq id="S3.T1.7.3.2.1.1.1.1.m1.1.1.1.cmml" xref="S3.T1.7.3.2.1.1.1.1.m1.1.1.1"></eq><ci id="S3.T1.7.3.2.1.1.1.1.m1.1.1.2.cmml" xref="S3.T1.7.3.2.1.1.1.1.m1.1.1.2">𝑟</ci><apply id="S3.T1.7.3.2.1.1.1.1.m1.1.1.3.cmml" xref="S3.T1.7.3.2.1.1.1.1.m1.1.1.3"><csymbol cd="latexml" id="S3.T1.7.3.2.1.1.1.1.m1.1.1.3.1.cmml" xref="S3.T1.7.3.2.1.1.1.1.m1.1.1.3.1">percent</csymbol><cn id="S3.T1.7.3.2.1.1.1.1.m1.1.1.3.2.cmml" type="integer" xref="S3.T1.7.3.2.1.1.1.1.m1.1.1.3.2">25</cn></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.T1.7.3.2.1.1.1.1.m1.1c">r=25\%</annotation><annotation encoding="application/x-llamapun" id="S3.T1.7.3.2.1.1.1.1.m1.1d">italic_r = 25 %</annotation></semantics></math>, <math alttext="k^{\prime}=384" class="ltx_Math" display="inline" id="S3.T1.8.4.3.2.2.2.2.m2.1"><semantics id="S3.T1.8.4.3.2.2.2.2.m2.1a"><mrow id="S3.T1.8.4.3.2.2.2.2.m2.1.1" xref="S3.T1.8.4.3.2.2.2.2.m2.1.1.cmml"><msup id="S3.T1.8.4.3.2.2.2.2.m2.1.1.2" xref="S3.T1.8.4.3.2.2.2.2.m2.1.1.2.cmml"><mi id="S3.T1.8.4.3.2.2.2.2.m2.1.1.2.2" xref="S3.T1.8.4.3.2.2.2.2.m2.1.1.2.2.cmml">k</mi><mo id="S3.T1.8.4.3.2.2.2.2.m2.1.1.2.3" xref="S3.T1.8.4.3.2.2.2.2.m2.1.1.2.3.cmml">′</mo></msup><mo id="S3.T1.8.4.3.2.2.2.2.m2.1.1.1" xref="S3.T1.8.4.3.2.2.2.2.m2.1.1.1.cmml">=</mo><mn id="S3.T1.8.4.3.2.2.2.2.m2.1.1.3" xref="S3.T1.8.4.3.2.2.2.2.m2.1.1.3.cmml">384</mn></mrow><annotation-xml encoding="MathML-Content" id="S3.T1.8.4.3.2.2.2.2.m2.1b"><apply id="S3.T1.8.4.3.2.2.2.2.m2.1.1.cmml" xref="S3.T1.8.4.3.2.2.2.2.m2.1.1"><eq id="S3.T1.8.4.3.2.2.2.2.m2.1.1.1.cmml" xref="S3.T1.8.4.3.2.2.2.2.m2.1.1.1"></eq><apply id="S3.T1.8.4.3.2.2.2.2.m2.1.1.2.cmml" xref="S3.T1.8.4.3.2.2.2.2.m2.1.1.2"><csymbol cd="ambiguous" id="S3.T1.8.4.3.2.2.2.2.m2.1.1.2.1.cmml" xref="S3.T1.8.4.3.2.2.2.2.m2.1.1.2">superscript</csymbol><ci id="S3.T1.8.4.3.2.2.2.2.m2.1.1.2.2.cmml" xref="S3.T1.8.4.3.2.2.2.2.m2.1.1.2.2">𝑘</ci><ci id="S3.T1.8.4.3.2.2.2.2.m2.1.1.2.3.cmml" xref="S3.T1.8.4.3.2.2.2.2.m2.1.1.2.3">′</ci></apply><cn id="S3.T1.8.4.3.2.2.2.2.m2.1.1.3.cmml" type="integer" xref="S3.T1.8.4.3.2.2.2.2.m2.1.1.3">384</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.T1.8.4.3.2.2.2.2.m2.1c">k^{\prime}=384</annotation><annotation encoding="application/x-llamapun" id="S3.T1.8.4.3.2.2.2.2.m2.1d">italic_k start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT = 384</annotation></semantics></math>)</span></span>
</span></span> <span class="ltx_text" id="S3.T1.8.4.3.4"></span>
</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S3.T1.9.5.4">
<span class="ltx_text" id="S3.T1.9.5.4.2"></span> <span class="ltx_text" id="S3.T1.9.5.4.1">
<span class="ltx_tabular ltx_align_middle" id="S3.T1.9.5.4.1.1">
<span class="ltx_tr" id="S3.T1.9.5.4.1.1.2">
<span class="ltx_td ltx_align_center" id="S3.T1.9.5.4.1.1.2.1">HiRE-Q</span></span>
<span class="ltx_tr" id="S3.T1.9.5.4.1.1.1">
<span class="ltx_td ltx_align_center" id="S3.T1.9.5.4.1.1.1.1">(int4, <math alttext="k^{\prime}=128" class="ltx_Math" display="inline" id="S3.T1.9.5.4.1.1.1.1.m1.1"><semantics id="S3.T1.9.5.4.1.1.1.1.m1.1a"><mrow id="S3.T1.9.5.4.1.1.1.1.m1.1.1" xref="S3.T1.9.5.4.1.1.1.1.m1.1.1.cmml"><msup id="S3.T1.9.5.4.1.1.1.1.m1.1.1.2" xref="S3.T1.9.5.4.1.1.1.1.m1.1.1.2.cmml"><mi id="S3.T1.9.5.4.1.1.1.1.m1.1.1.2.2" xref="S3.T1.9.5.4.1.1.1.1.m1.1.1.2.2.cmml">k</mi><mo id="S3.T1.9.5.4.1.1.1.1.m1.1.1.2.3" xref="S3.T1.9.5.4.1.1.1.1.m1.1.1.2.3.cmml">′</mo></msup><mo id="S3.T1.9.5.4.1.1.1.1.m1.1.1.1" xref="S3.T1.9.5.4.1.1.1.1.m1.1.1.1.cmml">=</mo><mn id="S3.T1.9.5.4.1.1.1.1.m1.1.1.3" xref="S3.T1.9.5.4.1.1.1.1.m1.1.1.3.cmml">128</mn></mrow><annotation-xml encoding="MathML-Content" id="S3.T1.9.5.4.1.1.1.1.m1.1b"><apply id="S3.T1.9.5.4.1.1.1.1.m1.1.1.cmml" xref="S3.T1.9.5.4.1.1.1.1.m1.1.1"><eq id="S3.T1.9.5.4.1.1.1.1.m1.1.1.1.cmml" xref="S3.T1.9.5.4.1.1.1.1.m1.1.1.1"></eq><apply id="S3.T1.9.5.4.1.1.1.1.m1.1.1.2.cmml" xref="S3.T1.9.5.4.1.1.1.1.m1.1.1.2"><csymbol cd="ambiguous" id="S3.T1.9.5.4.1.1.1.1.m1.1.1.2.1.cmml" xref="S3.T1.9.5.4.1.1.1.1.m1.1.1.2">superscript</csymbol><ci id="S3.T1.9.5.4.1.1.1.1.m1.1.1.2.2.cmml" xref="S3.T1.9.5.4.1.1.1.1.m1.1.1.2.2">𝑘</ci><ci id="S3.T1.9.5.4.1.1.1.1.m1.1.1.2.3.cmml" xref="S3.T1.9.5.4.1.1.1.1.m1.1.1.2.3">′</ci></apply><cn id="S3.T1.9.5.4.1.1.1.1.m1.1.1.3.cmml" type="integer" xref="S3.T1.9.5.4.1.1.1.1.m1.1.1.3">128</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.T1.9.5.4.1.1.1.1.m1.1c">k^{\prime}=128</annotation><annotation encoding="application/x-llamapun" id="S3.T1.9.5.4.1.1.1.1.m1.1d">italic_k start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT = 128</annotation></semantics></math>)</span></span>
</span></span> <span class="ltx_text" id="S3.T1.9.5.4.3"></span>
</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S3.T1.11.7.6">
<span class="ltx_text" id="S3.T1.11.7.6.3"></span> <span class="ltx_text" id="S3.T1.11.7.6.2">
<span class="ltx_tabular ltx_align_middle" id="S3.T1.11.7.6.2.2">
<span class="ltx_tr" id="S3.T1.11.7.6.2.2.3">
<span class="ltx_td ltx_align_center" id="S3.T1.11.7.6.2.2.3.1">HiRE-LR</span></span>
<span class="ltx_tr" id="S3.T1.11.7.6.2.2.2">
<span class="ltx_td ltx_align_center" id="S3.T1.11.7.6.2.2.2.2">(<math alttext="r=25\%" class="ltx_Math" display="inline" id="S3.T1.10.6.5.1.1.1.1.m1.1"><semantics id="S3.T1.10.6.5.1.1.1.1.m1.1a"><mrow id="S3.T1.10.6.5.1.1.1.1.m1.1.1" xref="S3.T1.10.6.5.1.1.1.1.m1.1.1.cmml"><mi id="S3.T1.10.6.5.1.1.1.1.m1.1.1.2" xref="S3.T1.10.6.5.1.1.1.1.m1.1.1.2.cmml">r</mi><mo id="S3.T1.10.6.5.1.1.1.1.m1.1.1.1" xref="S3.T1.10.6.5.1.1.1.1.m1.1.1.1.cmml">=</mo><mrow id="S3.T1.10.6.5.1.1.1.1.m1.1.1.3" xref="S3.T1.10.6.5.1.1.1.1.m1.1.1.3.cmml"><mn id="S3.T1.10.6.5.1.1.1.1.m1.1.1.3.2" xref="S3.T1.10.6.5.1.1.1.1.m1.1.1.3.2.cmml">25</mn><mo id="S3.T1.10.6.5.1.1.1.1.m1.1.1.3.1" xref="S3.T1.10.6.5.1.1.1.1.m1.1.1.3.1.cmml">%</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.T1.10.6.5.1.1.1.1.m1.1b"><apply id="S3.T1.10.6.5.1.1.1.1.m1.1.1.cmml" xref="S3.T1.10.6.5.1.1.1.1.m1.1.1"><eq id="S3.T1.10.6.5.1.1.1.1.m1.1.1.1.cmml" xref="S3.T1.10.6.5.1.1.1.1.m1.1.1.1"></eq><ci id="S3.T1.10.6.5.1.1.1.1.m1.1.1.2.cmml" xref="S3.T1.10.6.5.1.1.1.1.m1.1.1.2">𝑟</ci><apply id="S3.T1.10.6.5.1.1.1.1.m1.1.1.3.cmml" xref="S3.T1.10.6.5.1.1.1.1.m1.1.1.3"><csymbol cd="latexml" id="S3.T1.10.6.5.1.1.1.1.m1.1.1.3.1.cmml" xref="S3.T1.10.6.5.1.1.1.1.m1.1.1.3.1">percent</csymbol><cn id="S3.T1.10.6.5.1.1.1.1.m1.1.1.3.2.cmml" type="integer" xref="S3.T1.10.6.5.1.1.1.1.m1.1.1.3.2">25</cn></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.T1.10.6.5.1.1.1.1.m1.1c">r=25\%</annotation><annotation encoding="application/x-llamapun" id="S3.T1.10.6.5.1.1.1.1.m1.1d">italic_r = 25 %</annotation></semantics></math>, <math alttext="k^{\prime}=384" class="ltx_Math" display="inline" id="S3.T1.11.7.6.2.2.2.2.m2.1"><semantics id="S3.T1.11.7.6.2.2.2.2.m2.1a"><mrow id="S3.T1.11.7.6.2.2.2.2.m2.1.1" xref="S3.T1.11.7.6.2.2.2.2.m2.1.1.cmml"><msup id="S3.T1.11.7.6.2.2.2.2.m2.1.1.2" xref="S3.T1.11.7.6.2.2.2.2.m2.1.1.2.cmml"><mi id="S3.T1.11.7.6.2.2.2.2.m2.1.1.2.2" xref="S3.T1.11.7.6.2.2.2.2.m2.1.1.2.2.cmml">k</mi><mo id="S3.T1.11.7.6.2.2.2.2.m2.1.1.2.3" xref="S3.T1.11.7.6.2.2.2.2.m2.1.1.2.3.cmml">′</mo></msup><mo id="S3.T1.11.7.6.2.2.2.2.m2.1.1.1" xref="S3.T1.11.7.6.2.2.2.2.m2.1.1.1.cmml">=</mo><mn id="S3.T1.11.7.6.2.2.2.2.m2.1.1.3" xref="S3.T1.11.7.6.2.2.2.2.m2.1.1.3.cmml">384</mn></mrow><annotation-xml encoding="MathML-Content" id="S3.T1.11.7.6.2.2.2.2.m2.1b"><apply id="S3.T1.11.7.6.2.2.2.2.m2.1.1.cmml" xref="S3.T1.11.7.6.2.2.2.2.m2.1.1"><eq id="S3.T1.11.7.6.2.2.2.2.m2.1.1.1.cmml" xref="S3.T1.11.7.6.2.2.2.2.m2.1.1.1"></eq><apply id="S3.T1.11.7.6.2.2.2.2.m2.1.1.2.cmml" xref="S3.T1.11.7.6.2.2.2.2.m2.1.1.2"><csymbol cd="ambiguous" id="S3.T1.11.7.6.2.2.2.2.m2.1.1.2.1.cmml" xref="S3.T1.11.7.6.2.2.2.2.m2.1.1.2">superscript</csymbol><ci id="S3.T1.11.7.6.2.2.2.2.m2.1.1.2.2.cmml" xref="S3.T1.11.7.6.2.2.2.2.m2.1.1.2.2">𝑘</ci><ci id="S3.T1.11.7.6.2.2.2.2.m2.1.1.2.3.cmml" xref="S3.T1.11.7.6.2.2.2.2.m2.1.1.2.3">′</ci></apply><cn id="S3.T1.11.7.6.2.2.2.2.m2.1.1.3.cmml" type="integer" xref="S3.T1.11.7.6.2.2.2.2.m2.1.1.3">384</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.T1.11.7.6.2.2.2.2.m2.1c">k^{\prime}=384</annotation><annotation encoding="application/x-llamapun" id="S3.T1.11.7.6.2.2.2.2.m2.1d">italic_k start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT = 384</annotation></semantics></math>)</span></span>
<span class="ltx_tr" id="S3.T1.11.7.6.2.2.4">
<span class="ltx_td ltx_align_center" id="S3.T1.11.7.6.2.2.4.1">+ HiRE-Q (int4)</span></span>
</span></span> <span class="ltx_text" id="S3.T1.11.7.6.4"></span>
</td>
</tr>
<tr class="ltx_tr" id="S3.T1.11.8">
<td class="ltx_td ltx_align_center ltx_border_l ltx_border_r ltx_border_t" id="S3.T1.11.8.1" rowspan="2"><span class="ltx_text" id="S3.T1.11.8.1.1"><span class="ltx_text" id="S3.T1.11.8.1.1.1"></span> <span class="ltx_text" id="S3.T1.11.8.1.1.2">
<span class="ltx_tabular ltx_align_middle" id="S3.T1.11.8.1.1.2.1">
<span class="ltx_tr" id="S3.T1.11.8.1.1.2.1.1">
<span class="ltx_td ltx_align_center" id="S3.T1.11.8.1.1.2.1.1.1">Pre-training</span></span>
<span class="ltx_tr" id="S3.T1.11.8.1.1.2.1.2">
<span class="ltx_td ltx_align_center" id="S3.T1.11.8.1.1.2.1.2.1">Performance</span></span>
</span></span> <span class="ltx_text" id="S3.T1.11.8.1.1.3"></span></span></td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S3.T1.11.8.2">Top1 Accuracy</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S3.T1.11.8.3">57.15%</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S3.T1.11.8.4">57.07%</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S3.T1.11.8.5">57.12%</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S3.T1.11.8.6">57.07%</td>
</tr>
<tr class="ltx_tr" id="S3.T1.11.9">
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S3.T1.11.9.1">Top32 Intersection</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S3.T1.11.9.2">32.0</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S3.T1.11.9.3">29.26</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S3.T1.11.9.4">31.48</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S3.T1.11.9.5">29.03</td>
</tr>
<tr class="ltx_tr" id="S3.T1.11.10">
<td class="ltx_td ltx_align_center ltx_border_l ltx_border_r ltx_border_tt" id="S3.T1.11.10.1" rowspan="4"><span class="ltx_text" id="S3.T1.11.10.1.1"><span class="ltx_text" id="S3.T1.11.10.1.1.1"></span> <span class="ltx_text" id="S3.T1.11.10.1.1.2">
<span class="ltx_tabular ltx_align_middle" id="S3.T1.11.10.1.1.2.1">
<span class="ltx_tr" id="S3.T1.11.10.1.1.2.1.1">
<span class="ltx_td ltx_align_center" id="S3.T1.11.10.1.1.2.1.1.1">Downstream</span></span>
<span class="ltx_tr" id="S3.T1.11.10.1.1.2.1.2">
<span class="ltx_td ltx_align_center" id="S3.T1.11.10.1.1.2.1.2.1">Performance</span></span>
</span></span> <span class="ltx_text" id="S3.T1.11.10.1.1.3"></span></span></td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_tt" id="S3.T1.11.10.2">Machine Translation</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_tt" id="S3.T1.11.10.3">47.92</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_tt" id="S3.T1.11.10.4">47.73</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_tt" id="S3.T1.11.10.5">47.9</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_tt" id="S3.T1.11.10.6">47.77</td>
</tr>
<tr class="ltx_tr" id="S3.T1.11.11">
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S3.T1.11.11.1">SuperGLUE Benchmark</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S3.T1.11.11.2">62.0</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S3.T1.11.11.3">61.39</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S3.T1.11.11.4">61.56</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S3.T1.11.11.5">61.02</td>
</tr>
<tr class="ltx_tr" id="S3.T1.11.12">
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S3.T1.11.12.1">Question Answering</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S3.T1.11.12.2">29.65</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S3.T1.11.12.3">29.58</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S3.T1.11.12.4">29.54</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S3.T1.11.12.5">29.58</td>
</tr>
<tr class="ltx_tr" id="S3.T1.11.13">
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S3.T1.11.13.1">Discriminative Tasks</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S3.T1.11.13.2">51.69</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S3.T1.11.13.3">50.51</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S3.T1.11.13.4">50.92</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S3.T1.11.13.5">50.40</td>
</tr>
<tr class="ltx_tr" id="S3.T1.11.14">
<td class="ltx_td ltx_align_center ltx_border_b ltx_border_l ltx_border_r ltx_border_tt" colspan="2" id="S3.T1.11.14.1">
<em class="ltx_emph ltx_font_italic" id="S3.T1.11.14.1.1">Speedup</em></td>
<td class="ltx_td ltx_align_center ltx_border_b ltx_border_r ltx_border_tt" id="S3.T1.11.14.2">1.0x</td>
<td class="ltx_td ltx_align_center ltx_border_b ltx_border_r ltx_border_tt" id="S3.T1.11.14.3">1.16x</td>
<td class="ltx_td ltx_align_center ltx_border_b ltx_border_r ltx_border_tt" id="S3.T1.11.14.4">1.16x</td>
<td class="ltx_td ltx_align_center ltx_border_b ltx_border_r ltx_border_tt" id="S3.T1.11.14.5">1.22x</td>
</tr>
</table>
</figure>
</section>
</section>
</section>
</section>
<section class="ltx_section" id="S4">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">4 </span>Experiments</h2>
<div class="ltx_para" id="S4.p1">
<p class="ltx_p" id="S4.p1.1">In this section, we present experimental evaluation of HERD and demonstrate its efficacy in reducing inference latency.</p>
</div>
<section class="ltx_subsection" id="S4.SS1">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">4.1 </span>Training details</h3>
<div class="ltx_para" id="S4.SS1.p1">
<p class="ltx_p" id="S4.SS1.p1.3">We mostly follow the training setup described in <cite class="ltx_cite ltx_citemacro_citep">(Anil et al., <a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#bib.bib4" title="">2023</a>)</cite> including the training dataset and optimizer. Most experiments were conducted on a model with about <math alttext="1" class="ltx_Math" display="inline" id="S4.SS1.p1.1.m1.1"><semantics id="S4.SS1.p1.1.m1.1a"><mn id="S4.SS1.p1.1.m1.1.1" xref="S4.SS1.p1.1.m1.1.1.cmml">1</mn><annotation-xml encoding="MathML-Content" id="S4.SS1.p1.1.m1.1b"><cn id="S4.SS1.p1.1.m1.1.1.cmml" type="integer" xref="S4.SS1.p1.1.m1.1.1">1</cn></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.p1.1.m1.1c">1</annotation><annotation encoding="application/x-llamapun" id="S4.SS1.p1.1.m1.1d">1</annotation></semantics></math> billion parameters – we denote it by <math alttext="1B" class="ltx_Math" display="inline" id="S4.SS1.p1.2.m2.1"><semantics id="S4.SS1.p1.2.m2.1a"><mrow id="S4.SS1.p1.2.m2.1.1" xref="S4.SS1.p1.2.m2.1.1.cmml"><mn id="S4.SS1.p1.2.m2.1.1.2" xref="S4.SS1.p1.2.m2.1.1.2.cmml">1</mn><mo id="S4.SS1.p1.2.m2.1.1.1" xref="S4.SS1.p1.2.m2.1.1.1.cmml">⁢</mo><mi id="S4.SS1.p1.2.m2.1.1.3" xref="S4.SS1.p1.2.m2.1.1.3.cmml">B</mi></mrow><annotation-xml encoding="MathML-Content" id="S4.SS1.p1.2.m2.1b"><apply id="S4.SS1.p1.2.m2.1.1.cmml" xref="S4.SS1.p1.2.m2.1.1"><times id="S4.SS1.p1.2.m2.1.1.1.cmml" xref="S4.SS1.p1.2.m2.1.1.1"></times><cn id="S4.SS1.p1.2.m2.1.1.2.cmml" type="integer" xref="S4.SS1.p1.2.m2.1.1.2">1</cn><ci id="S4.SS1.p1.2.m2.1.1.3.cmml" xref="S4.SS1.p1.2.m2.1.1.3">𝐵</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.p1.2.m2.1c">1B</annotation><annotation encoding="application/x-llamapun" id="S4.SS1.p1.2.m2.1d">1 italic_B</annotation></semantics></math> model. <math alttext="d_{\textrm{m}}" class="ltx_Math" display="inline" id="S4.SS1.p1.3.m3.1"><semantics id="S4.SS1.p1.3.m3.1a"><msub id="S4.SS1.p1.3.m3.1.1" xref="S4.SS1.p1.3.m3.1.1.cmml"><mi id="S4.SS1.p1.3.m3.1.1.2" xref="S4.SS1.p1.3.m3.1.1.2.cmml">d</mi><mtext id="S4.SS1.p1.3.m3.1.1.3" xref="S4.SS1.p1.3.m3.1.1.3a.cmml">m</mtext></msub><annotation-xml encoding="MathML-Content" id="S4.SS1.p1.3.m3.1b"><apply id="S4.SS1.p1.3.m3.1.1.cmml" xref="S4.SS1.p1.3.m3.1.1"><csymbol cd="ambiguous" id="S4.SS1.p1.3.m3.1.1.1.cmml" xref="S4.SS1.p1.3.m3.1.1">subscript</csymbol><ci id="S4.SS1.p1.3.m3.1.1.2.cmml" xref="S4.SS1.p1.3.m3.1.1.2">𝑑</ci><ci id="S4.SS1.p1.3.m3.1.1.3a.cmml" xref="S4.SS1.p1.3.m3.1.1.3"><mtext id="S4.SS1.p1.3.m3.1.1.3.cmml" mathsize="70%" xref="S4.SS1.p1.3.m3.1.1.3">m</mtext></ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.p1.3.m3.1c">d_{\textrm{m}}</annotation><annotation encoding="application/x-llamapun" id="S4.SS1.p1.3.m3.1d">italic_d start_POSTSUBSCRIPT m end_POSTSUBSCRIPT</annotation></semantics></math> denotes its model dimensions, i.e., dimension of representations.
</p>
</div>
<div class="ltx_para" id="S4.SS1.p2">
<p class="ltx_p" id="S4.SS1.p2.13"><span class="ltx_text ltx_font_bold" id="S4.SS1.p2.13.1">HiRE-FFN</span>: After pretraining <math alttext="1B" class="ltx_Math" display="inline" id="S4.SS1.p2.1.m1.1"><semantics id="S4.SS1.p2.1.m1.1a"><mrow id="S4.SS1.p2.1.m1.1.1" xref="S4.SS1.p2.1.m1.1.1.cmml"><mn id="S4.SS1.p2.1.m1.1.1.2" xref="S4.SS1.p2.1.m1.1.1.2.cmml">1</mn><mo id="S4.SS1.p2.1.m1.1.1.1" xref="S4.SS1.p2.1.m1.1.1.1.cmml">⁢</mo><mi id="S4.SS1.p2.1.m1.1.1.3" xref="S4.SS1.p2.1.m1.1.1.3.cmml">B</mi></mrow><annotation-xml encoding="MathML-Content" id="S4.SS1.p2.1.m1.1b"><apply id="S4.SS1.p2.1.m1.1.1.cmml" xref="S4.SS1.p2.1.m1.1.1"><times id="S4.SS1.p2.1.m1.1.1.1.cmml" xref="S4.SS1.p2.1.m1.1.1.1"></times><cn id="S4.SS1.p2.1.m1.1.1.2.cmml" type="integer" xref="S4.SS1.p2.1.m1.1.1.2">1</cn><ci id="S4.SS1.p2.1.m1.1.1.3.cmml" xref="S4.SS1.p2.1.m1.1.1.3">𝐵</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.p2.1.m1.1c">1B</annotation><annotation encoding="application/x-llamapun" id="S4.SS1.p2.1.m1.1d">1 italic_B</annotation></semantics></math> for a large number of steps (<math alttext="\mathcal{M}" class="ltx_Math" display="inline" id="S4.SS1.p2.2.m2.1"><semantics id="S4.SS1.p2.2.m2.1a"><mi class="ltx_font_mathcaligraphic" id="S4.SS1.p2.2.m2.1.1" xref="S4.SS1.p2.2.m2.1.1.cmml">ℳ</mi><annotation-xml encoding="MathML-Content" id="S4.SS1.p2.2.m2.1b"><ci id="S4.SS1.p2.2.m2.1.1.cmml" xref="S4.SS1.p2.2.m2.1.1">ℳ</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.p2.2.m2.1c">\mathcal{M}</annotation><annotation encoding="application/x-llamapun" id="S4.SS1.p2.2.m2.1d">caligraphic_M</annotation></semantics></math>), we continue to pretrain it for a similar number of additional steps with group sparse top-<math alttext="k" class="ltx_Math" display="inline" id="S4.SS1.p2.3.m3.1"><semantics id="S4.SS1.p2.3.m3.1a"><mi id="S4.SS1.p2.3.m3.1.1" xref="S4.SS1.p2.3.m3.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="S4.SS1.p2.3.m3.1b"><ci id="S4.SS1.p2.3.m3.1.1.cmml" xref="S4.SS1.p2.3.m3.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.p2.3.m3.1c">k</annotation><annotation encoding="application/x-llamapun" id="S4.SS1.p2.3.m3.1d">italic_k</annotation></semantics></math> operation (equation <a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#S3.E6" title="6 ‣ 3.4 HiRE-FFN: Efficient FFN using HiRE ‣ 3 Main Ideas ‣ HiRE: High Recall Approximate Top-𝑘 Estimation for Efficient LLM Inference"><span class="ltx_text ltx_ref_tag">6</span></a>) on odd FFN layers to obtain <math alttext="\mathcal{M}_{\textrm{ffn}}" class="ltx_Math" display="inline" id="S4.SS1.p2.4.m4.1"><semantics id="S4.SS1.p2.4.m4.1a"><msub id="S4.SS1.p2.4.m4.1.1" xref="S4.SS1.p2.4.m4.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S4.SS1.p2.4.m4.1.1.2" xref="S4.SS1.p2.4.m4.1.1.2.cmml">ℳ</mi><mtext id="S4.SS1.p2.4.m4.1.1.3" xref="S4.SS1.p2.4.m4.1.1.3a.cmml">ffn</mtext></msub><annotation-xml encoding="MathML-Content" id="S4.SS1.p2.4.m4.1b"><apply id="S4.SS1.p2.4.m4.1.1.cmml" xref="S4.SS1.p2.4.m4.1.1"><csymbol cd="ambiguous" id="S4.SS1.p2.4.m4.1.1.1.cmml" xref="S4.SS1.p2.4.m4.1.1">subscript</csymbol><ci id="S4.SS1.p2.4.m4.1.1.2.cmml" xref="S4.SS1.p2.4.m4.1.1.2">ℳ</ci><ci id="S4.SS1.p2.4.m4.1.1.3a.cmml" xref="S4.SS1.p2.4.m4.1.1.3"><mtext id="S4.SS1.p2.4.m4.1.1.3.cmml" mathsize="70%" xref="S4.SS1.p2.4.m4.1.1.3">ffn</mtext></ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.p2.4.m4.1c">\mathcal{M}_{\textrm{ffn}}</annotation><annotation encoding="application/x-llamapun" id="S4.SS1.p2.4.m4.1d">caligraphic_M start_POSTSUBSCRIPT ffn end_POSTSUBSCRIPT</annotation></semantics></math> i.e., if the model has <math alttext="\ell" class="ltx_Math" display="inline" id="S4.SS1.p2.5.m5.1"><semantics id="S4.SS1.p2.5.m5.1a"><mi id="S4.SS1.p2.5.m5.1.1" mathvariant="normal" xref="S4.SS1.p2.5.m5.1.1.cmml">ℓ</mi><annotation-xml encoding="MathML-Content" id="S4.SS1.p2.5.m5.1b"><ci id="S4.SS1.p2.5.m5.1.1.cmml" xref="S4.SS1.p2.5.m5.1.1">ℓ</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.p2.5.m5.1c">\ell</annotation><annotation encoding="application/x-llamapun" id="S4.SS1.p2.5.m5.1d">roman_ℓ</annotation></semantics></math> layers, then we modify only the <math alttext="1^{\textrm{st}},3^{\textrm{rd}},...,(2*\lfloor\frac{\ell}{2}\rfloor-1)^{%
\textrm{th}}" class="ltx_Math" display="inline" id="S4.SS1.p2.6.m6.5"><semantics id="S4.SS1.p2.6.m6.5a"><mrow id="S4.SS1.p2.6.m6.5.5.3" xref="S4.SS1.p2.6.m6.5.5.4.cmml"><msup id="S4.SS1.p2.6.m6.3.3.1.1" xref="S4.SS1.p2.6.m6.3.3.1.1.cmml"><mn id="S4.SS1.p2.6.m6.3.3.1.1.2" xref="S4.SS1.p2.6.m6.3.3.1.1.2.cmml">1</mn><mtext id="S4.SS1.p2.6.m6.3.3.1.1.3" xref="S4.SS1.p2.6.m6.3.3.1.1.3a.cmml">st</mtext></msup><mo id="S4.SS1.p2.6.m6.5.5.3.4" xref="S4.SS1.p2.6.m6.5.5.4.cmml">,</mo><msup id="S4.SS1.p2.6.m6.4.4.2.2" xref="S4.SS1.p2.6.m6.4.4.2.2.cmml"><mn id="S4.SS1.p2.6.m6.4.4.2.2.2" xref="S4.SS1.p2.6.m6.4.4.2.2.2.cmml">3</mn><mtext id="S4.SS1.p2.6.m6.4.4.2.2.3" xref="S4.SS1.p2.6.m6.4.4.2.2.3a.cmml">rd</mtext></msup><mo id="S4.SS1.p2.6.m6.5.5.3.5" xref="S4.SS1.p2.6.m6.5.5.4.cmml">,</mo><mi id="S4.SS1.p2.6.m6.2.2" mathvariant="normal" xref="S4.SS1.p2.6.m6.2.2.cmml">…</mi><mo id="S4.SS1.p2.6.m6.5.5.3.6" xref="S4.SS1.p2.6.m6.5.5.4.cmml">,</mo><msup id="S4.SS1.p2.6.m6.5.5.3.3" xref="S4.SS1.p2.6.m6.5.5.3.3.cmml"><mrow id="S4.SS1.p2.6.m6.5.5.3.3.1.1" xref="S4.SS1.p2.6.m6.5.5.3.3.1.1.1.cmml"><mo id="S4.SS1.p2.6.m6.5.5.3.3.1.1.2" stretchy="false" xref="S4.SS1.p2.6.m6.5.5.3.3.1.1.1.cmml">(</mo><mrow id="S4.SS1.p2.6.m6.5.5.3.3.1.1.1" xref="S4.SS1.p2.6.m6.5.5.3.3.1.1.1.cmml"><mrow id="S4.SS1.p2.6.m6.5.5.3.3.1.1.1.2" xref="S4.SS1.p2.6.m6.5.5.3.3.1.1.1.2.cmml"><mn id="S4.SS1.p2.6.m6.5.5.3.3.1.1.1.2.2" xref="S4.SS1.p2.6.m6.5.5.3.3.1.1.1.2.2.cmml">2</mn><mo id="S4.SS1.p2.6.m6.5.5.3.3.1.1.1.2.1" lspace="0.222em" rspace="0.222em" xref="S4.SS1.p2.6.m6.5.5.3.3.1.1.1.2.1.cmml">*</mo><mrow id="S4.SS1.p2.6.m6.5.5.3.3.1.1.1.2.3.2" xref="S4.SS1.p2.6.m6.5.5.3.3.1.1.1.2.3.1.cmml"><mo id="S4.SS1.p2.6.m6.5.5.3.3.1.1.1.2.3.2.1" stretchy="false" xref="S4.SS1.p2.6.m6.5.5.3.3.1.1.1.2.3.1.1.cmml">⌊</mo><mfrac id="S4.SS1.p2.6.m6.1.1" xref="S4.SS1.p2.6.m6.1.1.cmml"><mi id="S4.SS1.p2.6.m6.1.1.2" mathvariant="normal" xref="S4.SS1.p2.6.m6.1.1.2.cmml">ℓ</mi><mn id="S4.SS1.p2.6.m6.1.1.3" xref="S4.SS1.p2.6.m6.1.1.3.cmml">2</mn></mfrac><mo id="S4.SS1.p2.6.m6.5.5.3.3.1.1.1.2.3.2.2" stretchy="false" xref="S4.SS1.p2.6.m6.5.5.3.3.1.1.1.2.3.1.1.cmml">⌋</mo></mrow></mrow><mo id="S4.SS1.p2.6.m6.5.5.3.3.1.1.1.1" xref="S4.SS1.p2.6.m6.5.5.3.3.1.1.1.1.cmml">−</mo><mn id="S4.SS1.p2.6.m6.5.5.3.3.1.1.1.3" xref="S4.SS1.p2.6.m6.5.5.3.3.1.1.1.3.cmml">1</mn></mrow><mo id="S4.SS1.p2.6.m6.5.5.3.3.1.1.3" stretchy="false" xref="S4.SS1.p2.6.m6.5.5.3.3.1.1.1.cmml">)</mo></mrow><mtext id="S4.SS1.p2.6.m6.5.5.3.3.3" xref="S4.SS1.p2.6.m6.5.5.3.3.3a.cmml">th</mtext></msup></mrow><annotation-xml encoding="MathML-Content" id="S4.SS1.p2.6.m6.5b"><list id="S4.SS1.p2.6.m6.5.5.4.cmml" xref="S4.SS1.p2.6.m6.5.5.3"><apply id="S4.SS1.p2.6.m6.3.3.1.1.cmml" xref="S4.SS1.p2.6.m6.3.3.1.1"><csymbol cd="ambiguous" id="S4.SS1.p2.6.m6.3.3.1.1.1.cmml" xref="S4.SS1.p2.6.m6.3.3.1.1">superscript</csymbol><cn id="S4.SS1.p2.6.m6.3.3.1.1.2.cmml" type="integer" xref="S4.SS1.p2.6.m6.3.3.1.1.2">1</cn><ci id="S4.SS1.p2.6.m6.3.3.1.1.3a.cmml" xref="S4.SS1.p2.6.m6.3.3.1.1.3"><mtext id="S4.SS1.p2.6.m6.3.3.1.1.3.cmml" mathsize="70%" xref="S4.SS1.p2.6.m6.3.3.1.1.3">st</mtext></ci></apply><apply id="S4.SS1.p2.6.m6.4.4.2.2.cmml" xref="S4.SS1.p2.6.m6.4.4.2.2"><csymbol cd="ambiguous" id="S4.SS1.p2.6.m6.4.4.2.2.1.cmml" xref="S4.SS1.p2.6.m6.4.4.2.2">superscript</csymbol><cn id="S4.SS1.p2.6.m6.4.4.2.2.2.cmml" type="integer" xref="S4.SS1.p2.6.m6.4.4.2.2.2">3</cn><ci id="S4.SS1.p2.6.m6.4.4.2.2.3a.cmml" xref="S4.SS1.p2.6.m6.4.4.2.2.3"><mtext id="S4.SS1.p2.6.m6.4.4.2.2.3.cmml" mathsize="70%" xref="S4.SS1.p2.6.m6.4.4.2.2.3">rd</mtext></ci></apply><ci id="S4.SS1.p2.6.m6.2.2.cmml" xref="S4.SS1.p2.6.m6.2.2">…</ci><apply id="S4.SS1.p2.6.m6.5.5.3.3.cmml" xref="S4.SS1.p2.6.m6.5.5.3.3"><csymbol cd="ambiguous" id="S4.SS1.p2.6.m6.5.5.3.3.2.cmml" xref="S4.SS1.p2.6.m6.5.5.3.3">superscript</csymbol><apply id="S4.SS1.p2.6.m6.5.5.3.3.1.1.1.cmml" xref="S4.SS1.p2.6.m6.5.5.3.3.1.1"><minus id="S4.SS1.p2.6.m6.5.5.3.3.1.1.1.1.cmml" xref="S4.SS1.p2.6.m6.5.5.3.3.1.1.1.1"></minus><apply id="S4.SS1.p2.6.m6.5.5.3.3.1.1.1.2.cmml" xref="S4.SS1.p2.6.m6.5.5.3.3.1.1.1.2"><times id="S4.SS1.p2.6.m6.5.5.3.3.1.1.1.2.1.cmml" xref="S4.SS1.p2.6.m6.5.5.3.3.1.1.1.2.1"></times><cn id="S4.SS1.p2.6.m6.5.5.3.3.1.1.1.2.2.cmml" type="integer" xref="S4.SS1.p2.6.m6.5.5.3.3.1.1.1.2.2">2</cn><apply id="S4.SS1.p2.6.m6.5.5.3.3.1.1.1.2.3.1.cmml" xref="S4.SS1.p2.6.m6.5.5.3.3.1.1.1.2.3.2"><floor id="S4.SS1.p2.6.m6.5.5.3.3.1.1.1.2.3.1.1.cmml" xref="S4.SS1.p2.6.m6.5.5.3.3.1.1.1.2.3.2.1"></floor><apply id="S4.SS1.p2.6.m6.1.1.cmml" xref="S4.SS1.p2.6.m6.1.1"><divide id="S4.SS1.p2.6.m6.1.1.1.cmml" xref="S4.SS1.p2.6.m6.1.1"></divide><ci id="S4.SS1.p2.6.m6.1.1.2.cmml" xref="S4.SS1.p2.6.m6.1.1.2">ℓ</ci><cn id="S4.SS1.p2.6.m6.1.1.3.cmml" type="integer" xref="S4.SS1.p2.6.m6.1.1.3">2</cn></apply></apply></apply><cn id="S4.SS1.p2.6.m6.5.5.3.3.1.1.1.3.cmml" type="integer" xref="S4.SS1.p2.6.m6.5.5.3.3.1.1.1.3">1</cn></apply><ci id="S4.SS1.p2.6.m6.5.5.3.3.3a.cmml" xref="S4.SS1.p2.6.m6.5.5.3.3.3"><mtext id="S4.SS1.p2.6.m6.5.5.3.3.3.cmml" mathsize="70%" xref="S4.SS1.p2.6.m6.5.5.3.3.3">th</mtext></ci></apply></list></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.p2.6.m6.5c">1^{\textrm{st}},3^{\textrm{rd}},...,(2*\lfloor\frac{\ell}{2}\rfloor-1)^{%
\textrm{th}}</annotation><annotation encoding="application/x-llamapun" id="S4.SS1.p2.6.m6.5d">1 start_POSTSUPERSCRIPT st end_POSTSUPERSCRIPT , 3 start_POSTSUPERSCRIPT rd end_POSTSUPERSCRIPT , … , ( 2 * ⌊ divide start_ARG roman_ℓ end_ARG start_ARG 2 end_ARG ⌋ - 1 ) start_POSTSUPERSCRIPT th end_POSTSUPERSCRIPT</annotation></semantics></math> layers to be group sparse. For fair comparison we continue to pretrain <math alttext="\mathcal{M}" class="ltx_Math" display="inline" id="S4.SS1.p2.7.m7.1"><semantics id="S4.SS1.p2.7.m7.1a"><mi class="ltx_font_mathcaligraphic" id="S4.SS1.p2.7.m7.1.1" xref="S4.SS1.p2.7.m7.1.1.cmml">ℳ</mi><annotation-xml encoding="MathML-Content" id="S4.SS1.p2.7.m7.1b"><ci id="S4.SS1.p2.7.m7.1.1.cmml" xref="S4.SS1.p2.7.m7.1.1">ℳ</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.p2.7.m7.1c">\mathcal{M}</annotation><annotation encoding="application/x-llamapun" id="S4.SS1.p2.7.m7.1d">caligraphic_M</annotation></semantics></math> for the same number of additional steps as <math alttext="\mathcal{M}_{\textrm{ffn}}" class="ltx_Math" display="inline" id="S4.SS1.p2.8.m8.1"><semantics id="S4.SS1.p2.8.m8.1a"><msub id="S4.SS1.p2.8.m8.1.1" xref="S4.SS1.p2.8.m8.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S4.SS1.p2.8.m8.1.1.2" xref="S4.SS1.p2.8.m8.1.1.2.cmml">ℳ</mi><mtext id="S4.SS1.p2.8.m8.1.1.3" xref="S4.SS1.p2.8.m8.1.1.3a.cmml">ffn</mtext></msub><annotation-xml encoding="MathML-Content" id="S4.SS1.p2.8.m8.1b"><apply id="S4.SS1.p2.8.m8.1.1.cmml" xref="S4.SS1.p2.8.m8.1.1"><csymbol cd="ambiguous" id="S4.SS1.p2.8.m8.1.1.1.cmml" xref="S4.SS1.p2.8.m8.1.1">subscript</csymbol><ci id="S4.SS1.p2.8.m8.1.1.2.cmml" xref="S4.SS1.p2.8.m8.1.1.2">ℳ</ci><ci id="S4.SS1.p2.8.m8.1.1.3a.cmml" xref="S4.SS1.p2.8.m8.1.1.3"><mtext id="S4.SS1.p2.8.m8.1.1.3.cmml" mathsize="70%" xref="S4.SS1.p2.8.m8.1.1.3">ffn</mtext></ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.p2.8.m8.1c">\mathcal{M}_{\textrm{ffn}}</annotation><annotation encoding="application/x-llamapun" id="S4.SS1.p2.8.m8.1d">caligraphic_M start_POSTSUBSCRIPT ffn end_POSTSUBSCRIPT</annotation></semantics></math>, but without the top-<math alttext="k" class="ltx_Math" display="inline" id="S4.SS1.p2.9.m9.1"><semantics id="S4.SS1.p2.9.m9.1a"><mi id="S4.SS1.p2.9.m9.1.1" xref="S4.SS1.p2.9.m9.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="S4.SS1.p2.9.m9.1b"><ci id="S4.SS1.p2.9.m9.1.1.cmml" xref="S4.SS1.p2.9.m9.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.p2.9.m9.1c">k</annotation><annotation encoding="application/x-llamapun" id="S4.SS1.p2.9.m9.1d">italic_k</annotation></semantics></math> operation to obtain the baseline model <math alttext="\mathcal{M}_{\textrm{base}}" class="ltx_Math" display="inline" id="S4.SS1.p2.10.m10.1"><semantics id="S4.SS1.p2.10.m10.1a"><msub id="S4.SS1.p2.10.m10.1.1" xref="S4.SS1.p2.10.m10.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S4.SS1.p2.10.m10.1.1.2" xref="S4.SS1.p2.10.m10.1.1.2.cmml">ℳ</mi><mtext id="S4.SS1.p2.10.m10.1.1.3" xref="S4.SS1.p2.10.m10.1.1.3a.cmml">base</mtext></msub><annotation-xml encoding="MathML-Content" id="S4.SS1.p2.10.m10.1b"><apply id="S4.SS1.p2.10.m10.1.1.cmml" xref="S4.SS1.p2.10.m10.1.1"><csymbol cd="ambiguous" id="S4.SS1.p2.10.m10.1.1.1.cmml" xref="S4.SS1.p2.10.m10.1.1">subscript</csymbol><ci id="S4.SS1.p2.10.m10.1.1.2.cmml" xref="S4.SS1.p2.10.m10.1.1.2">ℳ</ci><ci id="S4.SS1.p2.10.m10.1.1.3a.cmml" xref="S4.SS1.p2.10.m10.1.1.3"><mtext id="S4.SS1.p2.10.m10.1.1.3.cmml" mathsize="70%" xref="S4.SS1.p2.10.m10.1.1.3">base</mtext></ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.p2.10.m10.1c">\mathcal{M}_{\textrm{base}}</annotation><annotation encoding="application/x-llamapun" id="S4.SS1.p2.10.m10.1d">caligraphic_M start_POSTSUBSCRIPT base end_POSTSUBSCRIPT</annotation></semantics></math>. While the exact computations are all performed in <span class="ltx_text ltx_markedasmath" id="S4.SS1.p2.13.2">bf16</span> (i.e., <math alttext="16" class="ltx_Math" display="inline" id="S4.SS1.p2.12.m12.1"><semantics id="S4.SS1.p2.12.m12.1a"><mn id="S4.SS1.p2.12.m12.1.1" xref="S4.SS1.p2.12.m12.1.1.cmml">16</mn><annotation-xml encoding="MathML-Content" id="S4.SS1.p2.12.m12.1b"><cn id="S4.SS1.p2.12.m12.1.1.cmml" type="integer" xref="S4.SS1.p2.12.m12.1.1">16</cn></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.p2.12.m12.1c">16</annotation><annotation encoding="application/x-llamapun" id="S4.SS1.p2.12.m12.1d">16</annotation></semantics></math> bit floating point), the approximate computations in HiRE are performed in <span class="ltx_text ltx_markedasmath" id="S4.SS1.p2.13.3">int4</span>.</p>
</div>
<div class="ltx_para" id="S4.SS1.p3">
<p class="ltx_p" id="S4.SS1.p3.2"><span class="ltx_text ltx_font_bold" id="S4.SS1.p3.2.1">HiRE-Softmax</span>: We apply HiRE-Softmax to <math alttext="\mathcal{M}_{\textrm{base}}" class="ltx_Math" display="inline" id="S4.SS1.p3.1.m1.1"><semantics id="S4.SS1.p3.1.m1.1a"><msub id="S4.SS1.p3.1.m1.1.1" xref="S4.SS1.p3.1.m1.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S4.SS1.p3.1.m1.1.1.2" xref="S4.SS1.p3.1.m1.1.1.2.cmml">ℳ</mi><mtext id="S4.SS1.p3.1.m1.1.1.3" xref="S4.SS1.p3.1.m1.1.1.3a.cmml">base</mtext></msub><annotation-xml encoding="MathML-Content" id="S4.SS1.p3.1.m1.1b"><apply id="S4.SS1.p3.1.m1.1.1.cmml" xref="S4.SS1.p3.1.m1.1.1"><csymbol cd="ambiguous" id="S4.SS1.p3.1.m1.1.1.1.cmml" xref="S4.SS1.p3.1.m1.1.1">subscript</csymbol><ci id="S4.SS1.p3.1.m1.1.1.2.cmml" xref="S4.SS1.p3.1.m1.1.1.2">ℳ</ci><ci id="S4.SS1.p3.1.m1.1.1.3a.cmml" xref="S4.SS1.p3.1.m1.1.1.3"><mtext id="S4.SS1.p3.1.m1.1.1.3.cmml" mathsize="70%" xref="S4.SS1.p3.1.m1.1.1.3">base</mtext></ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.p3.1.m1.1c">\mathcal{M}_{\textrm{base}}</annotation><annotation encoding="application/x-llamapun" id="S4.SS1.p3.1.m1.1d">caligraphic_M start_POSTSUBSCRIPT base end_POSTSUBSCRIPT</annotation></semantics></math> or <math alttext="\mathcal{M}_{\textrm{ffn}}" class="ltx_Math" display="inline" id="S4.SS1.p3.2.m2.1"><semantics id="S4.SS1.p3.2.m2.1a"><msub id="S4.SS1.p3.2.m2.1.1" xref="S4.SS1.p3.2.m2.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S4.SS1.p3.2.m2.1.1.2" xref="S4.SS1.p3.2.m2.1.1.2.cmml">ℳ</mi><mtext id="S4.SS1.p3.2.m2.1.1.3" xref="S4.SS1.p3.2.m2.1.1.3a.cmml">ffn</mtext></msub><annotation-xml encoding="MathML-Content" id="S4.SS1.p3.2.m2.1b"><apply id="S4.SS1.p3.2.m2.1.1.cmml" xref="S4.SS1.p3.2.m2.1.1"><csymbol cd="ambiguous" id="S4.SS1.p3.2.m2.1.1.1.cmml" xref="S4.SS1.p3.2.m2.1.1">subscript</csymbol><ci id="S4.SS1.p3.2.m2.1.1.2.cmml" xref="S4.SS1.p3.2.m2.1.1.2">ℳ</ci><ci id="S4.SS1.p3.2.m2.1.1.3a.cmml" xref="S4.SS1.p3.2.m2.1.1.3"><mtext id="S4.SS1.p3.2.m2.1.1.3.cmml" mathsize="70%" xref="S4.SS1.p3.2.m2.1.1.3">ffn</mtext></ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.p3.2.m2.1c">\mathcal{M}_{\textrm{ffn}}</annotation><annotation encoding="application/x-llamapun" id="S4.SS1.p3.2.m2.1d">caligraphic_M start_POSTSUBSCRIPT ffn end_POSTSUBSCRIPT</annotation></semantics></math> with different choices for approximate computation.</p>
<ol class="ltx_enumerate" id="S4.I1">
<li class="ltx_item" id="S4.I1.i1" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">1.</span>
<div class="ltx_para" id="S4.I1.i1.p1">
<p class="ltx_p" id="S4.I1.i1.p1.3">For approximate computation with <em class="ltx_emph ltx_font_italic" id="S4.I1.i1.p1.3.1">low rank</em>, we train <math alttext="{\mathbf{W}_{\textrm{approx}}}" class="ltx_Math" display="inline" id="S4.I1.i1.p1.1.m1.1"><semantics id="S4.I1.i1.p1.1.m1.1a"><msub id="S4.I1.i1.p1.1.m1.1.1" xref="S4.I1.i1.p1.1.m1.1.1.cmml"><mi id="S4.I1.i1.p1.1.m1.1.1.2" xref="S4.I1.i1.p1.1.m1.1.1.2.cmml">𝐖</mi><mtext id="S4.I1.i1.p1.1.m1.1.1.3" xref="S4.I1.i1.p1.1.m1.1.1.3a.cmml">approx</mtext></msub><annotation-xml encoding="MathML-Content" id="S4.I1.i1.p1.1.m1.1b"><apply id="S4.I1.i1.p1.1.m1.1.1.cmml" xref="S4.I1.i1.p1.1.m1.1.1"><csymbol cd="ambiguous" id="S4.I1.i1.p1.1.m1.1.1.1.cmml" xref="S4.I1.i1.p1.1.m1.1.1">subscript</csymbol><ci id="S4.I1.i1.p1.1.m1.1.1.2.cmml" xref="S4.I1.i1.p1.1.m1.1.1.2">𝐖</ci><ci id="S4.I1.i1.p1.1.m1.1.1.3a.cmml" xref="S4.I1.i1.p1.1.m1.1.1.3"><mtext id="S4.I1.i1.p1.1.m1.1.1.3.cmml" mathsize="70%" xref="S4.I1.i1.p1.1.m1.1.1.3">approx</mtext></ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.I1.i1.p1.1.m1.1c">{\mathbf{W}_{\textrm{approx}}}</annotation><annotation encoding="application/x-llamapun" id="S4.I1.i1.p1.1.m1.1d">bold_W start_POSTSUBSCRIPT approx end_POSTSUBSCRIPT</annotation></semantics></math> using cross entropy (CE) loss with respect to ground truth labels, with rank <math alttext="r" class="ltx_Math" display="inline" id="S4.I1.i1.p1.2.m2.1"><semantics id="S4.I1.i1.p1.2.m2.1a"><mi id="S4.I1.i1.p1.2.m2.1.1" xref="S4.I1.i1.p1.2.m2.1.1.cmml">r</mi><annotation-xml encoding="MathML-Content" id="S4.I1.i1.p1.2.m2.1b"><ci id="S4.I1.i1.p1.2.m2.1.1.cmml" xref="S4.I1.i1.p1.2.m2.1.1">𝑟</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.I1.i1.p1.2.m2.1c">r</annotation><annotation encoding="application/x-llamapun" id="S4.I1.i1.p1.2.m2.1d">italic_r</annotation></semantics></math> chosen to be <math alttext="r=\frac{d_{\textrm{m}}}{4}" class="ltx_Math" display="inline" id="S4.I1.i1.p1.3.m3.1"><semantics id="S4.I1.i1.p1.3.m3.1a"><mrow id="S4.I1.i1.p1.3.m3.1.1" xref="S4.I1.i1.p1.3.m3.1.1.cmml"><mi id="S4.I1.i1.p1.3.m3.1.1.2" xref="S4.I1.i1.p1.3.m3.1.1.2.cmml">r</mi><mo id="S4.I1.i1.p1.3.m3.1.1.1" xref="S4.I1.i1.p1.3.m3.1.1.1.cmml">=</mo><mfrac id="S4.I1.i1.p1.3.m3.1.1.3" xref="S4.I1.i1.p1.3.m3.1.1.3.cmml"><msub id="S4.I1.i1.p1.3.m3.1.1.3.2" xref="S4.I1.i1.p1.3.m3.1.1.3.2.cmml"><mi id="S4.I1.i1.p1.3.m3.1.1.3.2.2" xref="S4.I1.i1.p1.3.m3.1.1.3.2.2.cmml">d</mi><mtext id="S4.I1.i1.p1.3.m3.1.1.3.2.3" xref="S4.I1.i1.p1.3.m3.1.1.3.2.3a.cmml">m</mtext></msub><mn id="S4.I1.i1.p1.3.m3.1.1.3.3" xref="S4.I1.i1.p1.3.m3.1.1.3.3.cmml">4</mn></mfrac></mrow><annotation-xml encoding="MathML-Content" id="S4.I1.i1.p1.3.m3.1b"><apply id="S4.I1.i1.p1.3.m3.1.1.cmml" xref="S4.I1.i1.p1.3.m3.1.1"><eq id="S4.I1.i1.p1.3.m3.1.1.1.cmml" xref="S4.I1.i1.p1.3.m3.1.1.1"></eq><ci id="S4.I1.i1.p1.3.m3.1.1.2.cmml" xref="S4.I1.i1.p1.3.m3.1.1.2">𝑟</ci><apply id="S4.I1.i1.p1.3.m3.1.1.3.cmml" xref="S4.I1.i1.p1.3.m3.1.1.3"><divide id="S4.I1.i1.p1.3.m3.1.1.3.1.cmml" xref="S4.I1.i1.p1.3.m3.1.1.3"></divide><apply id="S4.I1.i1.p1.3.m3.1.1.3.2.cmml" xref="S4.I1.i1.p1.3.m3.1.1.3.2"><csymbol cd="ambiguous" id="S4.I1.i1.p1.3.m3.1.1.3.2.1.cmml" xref="S4.I1.i1.p1.3.m3.1.1.3.2">subscript</csymbol><ci id="S4.I1.i1.p1.3.m3.1.1.3.2.2.cmml" xref="S4.I1.i1.p1.3.m3.1.1.3.2.2">𝑑</ci><ci id="S4.I1.i1.p1.3.m3.1.1.3.2.3a.cmml" xref="S4.I1.i1.p1.3.m3.1.1.3.2.3"><mtext id="S4.I1.i1.p1.3.m3.1.1.3.2.3.cmml" mathsize="50%" xref="S4.I1.i1.p1.3.m3.1.1.3.2.3">m</mtext></ci></apply><cn id="S4.I1.i1.p1.3.m3.1.1.3.3.cmml" type="integer" xref="S4.I1.i1.p1.3.m3.1.1.3.3">4</cn></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.I1.i1.p1.3.m3.1c">r=\frac{d_{\textrm{m}}}{4}</annotation><annotation encoding="application/x-llamapun" id="S4.I1.i1.p1.3.m3.1d">italic_r = divide start_ARG italic_d start_POSTSUBSCRIPT m end_POSTSUBSCRIPT end_ARG start_ARG 4 end_ARG</annotation></semantics></math>.</p>
</div>
</li>
<li class="ltx_item" id="S4.I1.i2" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">2.</span>
<div class="ltx_para" id="S4.I1.i2.p1">
<p class="ltx_p" id="S4.I1.i2.p1.1">For approximate computation with <em class="ltx_emph ltx_font_italic" id="S4.I1.i2.p1.1.1">quantization</em>, we perform the softmax computation in <span class="ltx_text ltx_markedasmath" id="S4.I1.i2.p1.1.2">int4</span>.
</p>
</div>
</li>
</ol>
<p class="ltx_p" id="S4.SS1.p3.5">We also present results combining both low rank and quantization approximation. We refer to the model with HiRE on both Softmax and FFN layers as <math alttext="\mathcal{M}_{\textrm{full}}" class="ltx_Math" display="inline" id="S4.SS1.p3.3.m1.1"><semantics id="S4.SS1.p3.3.m1.1a"><msub id="S4.SS1.p3.3.m1.1.1" xref="S4.SS1.p3.3.m1.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S4.SS1.p3.3.m1.1.1.2" xref="S4.SS1.p3.3.m1.1.1.2.cmml">ℳ</mi><mtext id="S4.SS1.p3.3.m1.1.1.3" xref="S4.SS1.p3.3.m1.1.1.3a.cmml">full</mtext></msub><annotation-xml encoding="MathML-Content" id="S4.SS1.p3.3.m1.1b"><apply id="S4.SS1.p3.3.m1.1.1.cmml" xref="S4.SS1.p3.3.m1.1.1"><csymbol cd="ambiguous" id="S4.SS1.p3.3.m1.1.1.1.cmml" xref="S4.SS1.p3.3.m1.1.1">subscript</csymbol><ci id="S4.SS1.p3.3.m1.1.1.2.cmml" xref="S4.SS1.p3.3.m1.1.1.2">ℳ</ci><ci id="S4.SS1.p3.3.m1.1.1.3a.cmml" xref="S4.SS1.p3.3.m1.1.1.3"><mtext id="S4.SS1.p3.3.m1.1.1.3.cmml" mathsize="70%" xref="S4.SS1.p3.3.m1.1.1.3">full</mtext></ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.p3.3.m1.1c">\mathcal{M}_{\textrm{full}}</annotation><annotation encoding="application/x-llamapun" id="S4.SS1.p3.3.m1.1d">caligraphic_M start_POSTSUBSCRIPT full end_POSTSUBSCRIPT</annotation></semantics></math>, while HiRE-Softmax applied to <math alttext="\mathcal{M}_{\textrm{base}}" class="ltx_Math" display="inline" id="S4.SS1.p3.4.m2.1"><semantics id="S4.SS1.p3.4.m2.1a"><msub id="S4.SS1.p3.4.m2.1.1" xref="S4.SS1.p3.4.m2.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S4.SS1.p3.4.m2.1.1.2" xref="S4.SS1.p3.4.m2.1.1.2.cmml">ℳ</mi><mtext id="S4.SS1.p3.4.m2.1.1.3" xref="S4.SS1.p3.4.m2.1.1.3a.cmml">base</mtext></msub><annotation-xml encoding="MathML-Content" id="S4.SS1.p3.4.m2.1b"><apply id="S4.SS1.p3.4.m2.1.1.cmml" xref="S4.SS1.p3.4.m2.1.1"><csymbol cd="ambiguous" id="S4.SS1.p3.4.m2.1.1.1.cmml" xref="S4.SS1.p3.4.m2.1.1">subscript</csymbol><ci id="S4.SS1.p3.4.m2.1.1.2.cmml" xref="S4.SS1.p3.4.m2.1.1.2">ℳ</ci><ci id="S4.SS1.p3.4.m2.1.1.3a.cmml" xref="S4.SS1.p3.4.m2.1.1.3"><mtext id="S4.SS1.p3.4.m2.1.1.3.cmml" mathsize="70%" xref="S4.SS1.p3.4.m2.1.1.3">base</mtext></ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.p3.4.m2.1c">\mathcal{M}_{\textrm{base}}</annotation><annotation encoding="application/x-llamapun" id="S4.SS1.p3.4.m2.1d">caligraphic_M start_POSTSUBSCRIPT base end_POSTSUBSCRIPT</annotation></semantics></math> is referred to as <math alttext="\mathcal{M}_{\textrm{sm}}" class="ltx_Math" display="inline" id="S4.SS1.p3.5.m3.1"><semantics id="S4.SS1.p3.5.m3.1a"><msub id="S4.SS1.p3.5.m3.1.1" xref="S4.SS1.p3.5.m3.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S4.SS1.p3.5.m3.1.1.2" xref="S4.SS1.p3.5.m3.1.1.2.cmml">ℳ</mi><mtext id="S4.SS1.p3.5.m3.1.1.3" xref="S4.SS1.p3.5.m3.1.1.3a.cmml">sm</mtext></msub><annotation-xml encoding="MathML-Content" id="S4.SS1.p3.5.m3.1b"><apply id="S4.SS1.p3.5.m3.1.1.cmml" xref="S4.SS1.p3.5.m3.1.1"><csymbol cd="ambiguous" id="S4.SS1.p3.5.m3.1.1.1.cmml" xref="S4.SS1.p3.5.m3.1.1">subscript</csymbol><ci id="S4.SS1.p3.5.m3.1.1.2.cmml" xref="S4.SS1.p3.5.m3.1.1.2">ℳ</ci><ci id="S4.SS1.p3.5.m3.1.1.3a.cmml" xref="S4.SS1.p3.5.m3.1.1.3"><mtext id="S4.SS1.p3.5.m3.1.1.3.cmml" mathsize="70%" xref="S4.SS1.p3.5.m3.1.1.3">sm</mtext></ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.p3.5.m3.1c">\mathcal{M}_{\textrm{sm}}</annotation><annotation encoding="application/x-llamapun" id="S4.SS1.p3.5.m3.1d">caligraphic_M start_POSTSUBSCRIPT sm end_POSTSUBSCRIPT</annotation></semantics></math>.</p>
</div>
<figure class="ltx_table" id="S4.T2">
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_table">Table 2: </span>Evaluation of HiRE-FFN, as well as a combination of HiRE-Softmax + HiRE-FFN with the baseline dense model <math alttext="\mathcal{M}_{\textrm{base}}" class="ltx_Math" display="inline" id="S4.T2.3.m1.1"><semantics id="S4.T2.3.m1.1b"><msub id="S4.T2.3.m1.1.1" xref="S4.T2.3.m1.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S4.T2.3.m1.1.1.2" xref="S4.T2.3.m1.1.1.2.cmml">ℳ</mi><mtext id="S4.T2.3.m1.1.1.3" xref="S4.T2.3.m1.1.1.3a.cmml">base</mtext></msub><annotation-xml encoding="MathML-Content" id="S4.T2.3.m1.1c"><apply id="S4.T2.3.m1.1.1.cmml" xref="S4.T2.3.m1.1.1"><csymbol cd="ambiguous" id="S4.T2.3.m1.1.1.1.cmml" xref="S4.T2.3.m1.1.1">subscript</csymbol><ci id="S4.T2.3.m1.1.1.2.cmml" xref="S4.T2.3.m1.1.1.2">ℳ</ci><ci id="S4.T2.3.m1.1.1.3a.cmml" xref="S4.T2.3.m1.1.1.3"><mtext id="S4.T2.3.m1.1.1.3.cmml" mathsize="70%" xref="S4.T2.3.m1.1.1.3">base</mtext></ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.T2.3.m1.1d">\mathcal{M}_{\textrm{base}}</annotation><annotation encoding="application/x-llamapun" id="S4.T2.3.m1.1e">caligraphic_M start_POSTSUBSCRIPT base end_POSTSUBSCRIPT</annotation></semantics></math> on a single TPUv5e device. For HiRE-FFN, we use quantization based HiRE, while for HiRE-Softmax, we use HiRE-LRQ. Note that the combination of HiRE-Softmax + HiRE-FFN is <math alttext="1.47\times" class="ltx_math_unparsed" display="inline" id="S4.T2.4.m2.1"><semantics id="S4.T2.4.m2.1b"><mrow id="S4.T2.4.m2.1c"><mn id="S4.T2.4.m2.1.1">1.47</mn><mo id="S4.T2.4.m2.1.2" lspace="0.222em">×</mo></mrow><annotation encoding="application/x-tex" id="S4.T2.4.m2.1d">1.47\times</annotation><annotation encoding="application/x-llamapun" id="S4.T2.4.m2.1e">1.47 ×</annotation></semantics></math> faster than baseline despite almost matching accuracy.</figcaption>
<table class="ltx_tabular ltx_centering ltx_align_middle" id="S4.T2.9">
<tr class="ltx_tr" id="S4.T2.7.3">
<td class="ltx_td ltx_border_l ltx_border_r ltx_border_t" colspan="2" id="S4.T2.7.3.4"></td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T2.7.3.5">Baseline</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T2.5.1.1">
<math alttext="\mathcal{M}_{\textrm{ffn}}" class="ltx_Math" display="inline" id="S4.T2.5.1.1.m1.1"><semantics id="S4.T2.5.1.1.m1.1a"><msub id="S4.T2.5.1.1.m1.1.1" xref="S4.T2.5.1.1.m1.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S4.T2.5.1.1.m1.1.1.2" xref="S4.T2.5.1.1.m1.1.1.2.cmml">ℳ</mi><mtext id="S4.T2.5.1.1.m1.1.1.3" xref="S4.T2.5.1.1.m1.1.1.3a.cmml">ffn</mtext></msub><annotation-xml encoding="MathML-Content" id="S4.T2.5.1.1.m1.1b"><apply id="S4.T2.5.1.1.m1.1.1.cmml" xref="S4.T2.5.1.1.m1.1.1"><csymbol cd="ambiguous" id="S4.T2.5.1.1.m1.1.1.1.cmml" xref="S4.T2.5.1.1.m1.1.1">subscript</csymbol><ci id="S4.T2.5.1.1.m1.1.1.2.cmml" xref="S4.T2.5.1.1.m1.1.1.2">ℳ</ci><ci id="S4.T2.5.1.1.m1.1.1.3a.cmml" xref="S4.T2.5.1.1.m1.1.1.3"><mtext id="S4.T2.5.1.1.m1.1.1.3.cmml" mathsize="70%" xref="S4.T2.5.1.1.m1.1.1.3">ffn</mtext></ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.T2.5.1.1.m1.1c">\mathcal{M}_{\textrm{ffn}}</annotation><annotation encoding="application/x-llamapun" id="S4.T2.5.1.1.m1.1d">caligraphic_M start_POSTSUBSCRIPT ffn end_POSTSUBSCRIPT</annotation></semantics></math> (HiRE-Q)</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T2.7.3.3">
<span class="ltx_text" id="S4.T2.7.3.3.3"></span> <span class="ltx_text" id="S4.T2.7.3.3.2">
<span class="ltx_tabular ltx_align_middle" id="S4.T2.7.3.3.2.2">
<span class="ltx_tr" id="S4.T2.6.2.2.1.1.1">
<span class="ltx_td ltx_align_center" id="S4.T2.6.2.2.1.1.1.1"><math alttext="\mathcal{M}_{\textrm{ffn}}" class="ltx_Math" display="inline" id="S4.T2.6.2.2.1.1.1.1.m1.1"><semantics id="S4.T2.6.2.2.1.1.1.1.m1.1a"><msub id="S4.T2.6.2.2.1.1.1.1.m1.1.1" xref="S4.T2.6.2.2.1.1.1.1.m1.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S4.T2.6.2.2.1.1.1.1.m1.1.1.2" xref="S4.T2.6.2.2.1.1.1.1.m1.1.1.2.cmml">ℳ</mi><mtext id="S4.T2.6.2.2.1.1.1.1.m1.1.1.3" xref="S4.T2.6.2.2.1.1.1.1.m1.1.1.3a.cmml">ffn</mtext></msub><annotation-xml encoding="MathML-Content" id="S4.T2.6.2.2.1.1.1.1.m1.1b"><apply id="S4.T2.6.2.2.1.1.1.1.m1.1.1.cmml" xref="S4.T2.6.2.2.1.1.1.1.m1.1.1"><csymbol cd="ambiguous" id="S4.T2.6.2.2.1.1.1.1.m1.1.1.1.cmml" xref="S4.T2.6.2.2.1.1.1.1.m1.1.1">subscript</csymbol><ci id="S4.T2.6.2.2.1.1.1.1.m1.1.1.2.cmml" xref="S4.T2.6.2.2.1.1.1.1.m1.1.1.2">ℳ</ci><ci id="S4.T2.6.2.2.1.1.1.1.m1.1.1.3a.cmml" xref="S4.T2.6.2.2.1.1.1.1.m1.1.1.3"><mtext id="S4.T2.6.2.2.1.1.1.1.m1.1.1.3.cmml" mathsize="70%" xref="S4.T2.6.2.2.1.1.1.1.m1.1.1.3">ffn</mtext></ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.T2.6.2.2.1.1.1.1.m1.1c">\mathcal{M}_{\textrm{ffn}}</annotation><annotation encoding="application/x-llamapun" id="S4.T2.6.2.2.1.1.1.1.m1.1d">caligraphic_M start_POSTSUBSCRIPT ffn end_POSTSUBSCRIPT</annotation></semantics></math> (HiRE-Q)</span></span>
<span class="ltx_tr" id="S4.T2.7.3.3.2.2.2">
<span class="ltx_td ltx_align_center" id="S4.T2.7.3.3.2.2.2.1">+ <math alttext="\mathcal{M}_{\textrm{sm}}" class="ltx_Math" display="inline" id="S4.T2.7.3.3.2.2.2.1.m1.1"><semantics id="S4.T2.7.3.3.2.2.2.1.m1.1a"><msub id="S4.T2.7.3.3.2.2.2.1.m1.1.1" xref="S4.T2.7.3.3.2.2.2.1.m1.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S4.T2.7.3.3.2.2.2.1.m1.1.1.2" xref="S4.T2.7.3.3.2.2.2.1.m1.1.1.2.cmml">ℳ</mi><mtext id="S4.T2.7.3.3.2.2.2.1.m1.1.1.3" xref="S4.T2.7.3.3.2.2.2.1.m1.1.1.3a.cmml">sm</mtext></msub><annotation-xml encoding="MathML-Content" id="S4.T2.7.3.3.2.2.2.1.m1.1b"><apply id="S4.T2.7.3.3.2.2.2.1.m1.1.1.cmml" xref="S4.T2.7.3.3.2.2.2.1.m1.1.1"><csymbol cd="ambiguous" id="S4.T2.7.3.3.2.2.2.1.m1.1.1.1.cmml" xref="S4.T2.7.3.3.2.2.2.1.m1.1.1">subscript</csymbol><ci id="S4.T2.7.3.3.2.2.2.1.m1.1.1.2.cmml" xref="S4.T2.7.3.3.2.2.2.1.m1.1.1.2">ℳ</ci><ci id="S4.T2.7.3.3.2.2.2.1.m1.1.1.3a.cmml" xref="S4.T2.7.3.3.2.2.2.1.m1.1.1.3"><mtext id="S4.T2.7.3.3.2.2.2.1.m1.1.1.3.cmml" mathsize="70%" xref="S4.T2.7.3.3.2.2.2.1.m1.1.1.3">sm</mtext></ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.T2.7.3.3.2.2.2.1.m1.1c">\mathcal{M}_{\textrm{sm}}</annotation><annotation encoding="application/x-llamapun" id="S4.T2.7.3.3.2.2.2.1.m1.1d">caligraphic_M start_POSTSUBSCRIPT sm end_POSTSUBSCRIPT</annotation></semantics></math> (HiRE-Q + HiRE-LR)</span></span>
</span></span> <span class="ltx_text" id="S4.T2.7.3.3.4"></span>
</td>
</tr>
<tr class="ltx_tr" id="S4.T2.9.6">
<td class="ltx_td ltx_align_center ltx_border_l ltx_border_r ltx_border_t" id="S4.T2.9.6.1" rowspan="2"><span class="ltx_text" id="S4.T2.9.6.1.1"><span class="ltx_text" id="S4.T2.9.6.1.1.1"></span> <span class="ltx_text" id="S4.T2.9.6.1.1.2">
<span class="ltx_tabular ltx_align_middle" id="S4.T2.9.6.1.1.2.1">
<span class="ltx_tr" id="S4.T2.9.6.1.1.2.1.1">
<span class="ltx_td ltx_align_center" id="S4.T2.9.6.1.1.2.1.1.1">Pre-training</span></span>
<span class="ltx_tr" id="S4.T2.9.6.1.1.2.1.2">
<span class="ltx_td ltx_align_center" id="S4.T2.9.6.1.1.2.1.2.1">Performance</span></span>
</span></span> <span class="ltx_text" id="S4.T2.9.6.1.1.3"></span></span></td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T2.9.6.2">Top1 Accuracy</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T2.9.6.3">57.15%</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T2.9.6.4">57.03%</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T2.9.6.5">56.93%</td>
</tr>
<tr class="ltx_tr" id="S4.T2.9.7">
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T2.9.7.1">Perplexity</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T2.9.7.2">2.045</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T2.9.7.3">2.056</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T2.9.7.4">NA</td>
</tr>
<tr class="ltx_tr" id="S4.T2.9.8">
<td class="ltx_td ltx_align_center ltx_border_l ltx_border_r ltx_border_tt" id="S4.T2.9.8.1" rowspan="4"><span class="ltx_text" id="S4.T2.9.8.1.1"><span class="ltx_text" id="S4.T2.9.8.1.1.1"></span> <span class="ltx_text" id="S4.T2.9.8.1.1.2">
<span class="ltx_tabular ltx_align_middle" id="S4.T2.9.8.1.1.2.1">
<span class="ltx_tr" id="S4.T2.9.8.1.1.2.1.1">
<span class="ltx_td ltx_align_center" id="S4.T2.9.8.1.1.2.1.1.1">Downstream</span></span>
<span class="ltx_tr" id="S4.T2.9.8.1.1.2.1.2">
<span class="ltx_td ltx_align_center" id="S4.T2.9.8.1.1.2.1.2.1">Performance</span></span>
</span></span> <span class="ltx_text" id="S4.T2.9.8.1.1.3"></span></span></td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_tt" id="S4.T2.9.8.2">Machine Translation</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_tt" id="S4.T2.9.8.3">47.92</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_tt" id="S4.T2.9.8.4">46.95</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_tt" id="S4.T2.9.8.5">46.94</td>
</tr>
<tr class="ltx_tr" id="S4.T2.9.9">
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T2.9.9.1">SuperGLUE Benchmark</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T2.9.9.2">62.0</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T2.9.9.3">62.49</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T2.9.9.4">61.74</td>
</tr>
<tr class="ltx_tr" id="S4.T2.9.10">
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T2.9.10.1">Question Answering</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T2.9.10.2">29.65</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T2.9.10.3">30.88</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T2.9.10.4">30.86</td>
</tr>
<tr class="ltx_tr" id="S4.T2.9.11">
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T2.9.11.1">Discriminative Tasks</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T2.9.11.2">51.69</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T2.9.11.3">51.14</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T2.9.11.4">50.08</td>
</tr>
<tr class="ltx_tr" id="S4.T2.9.5">
<td class="ltx_td ltx_align_center ltx_border_b ltx_border_l ltx_border_r ltx_border_tt" colspan="2" id="S4.T2.9.5.3">
<em class="ltx_emph ltx_font_italic" id="S4.T2.9.5.3.1">Speedup</em></td>
<td class="ltx_td ltx_align_center ltx_border_b ltx_border_r ltx_border_tt" id="S4.T2.9.5.4">1.0x</td>
<td class="ltx_td ltx_align_center ltx_border_b ltx_border_r ltx_border_tt" id="S4.T2.8.4.1">1.16<math alttext="\times" class="ltx_Math" display="inline" id="S4.T2.8.4.1.m1.1"><semantics id="S4.T2.8.4.1.m1.1a"><mo id="S4.T2.8.4.1.m1.1.1" xref="S4.T2.8.4.1.m1.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S4.T2.8.4.1.m1.1b"><times id="S4.T2.8.4.1.m1.1.1.cmml" xref="S4.T2.8.4.1.m1.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S4.T2.8.4.1.m1.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S4.T2.8.4.1.m1.1d">×</annotation></semantics></math>
</td>
<td class="ltx_td ltx_align_center ltx_border_b ltx_border_r ltx_border_tt" id="S4.T2.9.5.2">1.47<math alttext="\times" class="ltx_Math" display="inline" id="S4.T2.9.5.2.m1.1"><semantics id="S4.T2.9.5.2.m1.1a"><mo id="S4.T2.9.5.2.m1.1.1" xref="S4.T2.9.5.2.m1.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S4.T2.9.5.2.m1.1b"><times id="S4.T2.9.5.2.m1.1.1.cmml" xref="S4.T2.9.5.2.m1.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S4.T2.9.5.2.m1.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S4.T2.9.5.2.m1.1d">×</annotation></semantics></math>
</td>
</tr>
</table>
</figure>
<figure class="ltx_table" id="S4.T3">
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_table">Table 3: </span>DA-TOP-k (Algorithm <a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#alg2" title='Algorithm 2 ‣ 3.2.2 "DA-TOP-"⁢𝑘: Multi-device serving with approximate distributed top-𝑘 operation ‣ 3.2 HiRE: Overall Approach ‣ 3 Main Ideas ‣ HiRE: High Recall Approximate Top-𝑘 Estimation for Efficient LLM Inference'><span class="ltx_text ltx_ref_tag">2</span></a>): Quality and latency evaluations for the HiRE-FFN model deployed on a <math alttext="2\times 2" class="ltx_Math" display="inline" id="S4.T3.3.m1.1"><semantics id="S4.T3.3.m1.1b"><mrow id="S4.T3.3.m1.1.1" xref="S4.T3.3.m1.1.1.cmml"><mn id="S4.T3.3.m1.1.1.2" xref="S4.T3.3.m1.1.1.2.cmml">2</mn><mo id="S4.T3.3.m1.1.1.1" lspace="0.222em" rspace="0.222em" xref="S4.T3.3.m1.1.1.1.cmml">×</mo><mn id="S4.T3.3.m1.1.1.3" xref="S4.T3.3.m1.1.1.3.cmml">2</mn></mrow><annotation-xml encoding="MathML-Content" id="S4.T3.3.m1.1c"><apply id="S4.T3.3.m1.1.1.cmml" xref="S4.T3.3.m1.1.1"><times id="S4.T3.3.m1.1.1.1.cmml" xref="S4.T3.3.m1.1.1.1"></times><cn id="S4.T3.3.m1.1.1.2.cmml" type="integer" xref="S4.T3.3.m1.1.1.2">2</cn><cn id="S4.T3.3.m1.1.1.3.cmml" type="integer" xref="S4.T3.3.m1.1.1.3">2</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.T3.3.m1.1d">2\times 2</annotation><annotation encoding="application/x-llamapun" id="S4.T3.3.m1.1e">2 × 2</annotation></semantics></math> slice of Google Cloud TPUv5e. Clearly performing distributed, approximate top-<math alttext="k" class="ltx_Math" display="inline" id="S4.T3.4.m2.1"><semantics id="S4.T3.4.m2.1b"><mi id="S4.T3.4.m2.1.1" xref="S4.T3.4.m2.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="S4.T3.4.m2.1c"><ci id="S4.T3.4.m2.1.1.cmml" xref="S4.T3.4.m2.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.T3.4.m2.1d">k</annotation><annotation encoding="application/x-llamapun" id="S4.T3.4.m2.1e">italic_k</annotation></semantics></math> computation is critical to obtain speedups during deployment on multiple machines, while not losing any quality on average.</figcaption>
<table class="ltx_tabular ltx_centering ltx_align_middle" id="S4.T3.8">
<tr class="ltx_tr" id="S4.T3.6.2">
<td class="ltx_td ltx_border_l ltx_border_r ltx_border_t" colspan="2" id="S4.T3.6.2.3"></td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T3.5.1.1">
<span class="ltx_text" id="S4.T3.5.1.1.2"></span> <span class="ltx_text" id="S4.T3.5.1.1.1">
<span class="ltx_tabular ltx_align_middle" id="S4.T3.5.1.1.1.1">
<span class="ltx_tr" id="S4.T3.5.1.1.1.1.1">
<span class="ltx_td ltx_align_center" id="S4.T3.5.1.1.1.1.1.1"><math alttext="\mathcal{M}_{\textrm{ffn}}" class="ltx_Math" display="inline" id="S4.T3.5.1.1.1.1.1.1.m1.1"><semantics id="S4.T3.5.1.1.1.1.1.1.m1.1a"><msub id="S4.T3.5.1.1.1.1.1.1.m1.1.1" xref="S4.T3.5.1.1.1.1.1.1.m1.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S4.T3.5.1.1.1.1.1.1.m1.1.1.2" xref="S4.T3.5.1.1.1.1.1.1.m1.1.1.2.cmml">ℳ</mi><mtext id="S4.T3.5.1.1.1.1.1.1.m1.1.1.3" xref="S4.T3.5.1.1.1.1.1.1.m1.1.1.3a.cmml">ffn</mtext></msub><annotation-xml encoding="MathML-Content" id="S4.T3.5.1.1.1.1.1.1.m1.1b"><apply id="S4.T3.5.1.1.1.1.1.1.m1.1.1.cmml" xref="S4.T3.5.1.1.1.1.1.1.m1.1.1"><csymbol cd="ambiguous" id="S4.T3.5.1.1.1.1.1.1.m1.1.1.1.cmml" xref="S4.T3.5.1.1.1.1.1.1.m1.1.1">subscript</csymbol><ci id="S4.T3.5.1.1.1.1.1.1.m1.1.1.2.cmml" xref="S4.T3.5.1.1.1.1.1.1.m1.1.1.2">ℳ</ci><ci id="S4.T3.5.1.1.1.1.1.1.m1.1.1.3a.cmml" xref="S4.T3.5.1.1.1.1.1.1.m1.1.1.3"><mtext id="S4.T3.5.1.1.1.1.1.1.m1.1.1.3.cmml" mathsize="70%" xref="S4.T3.5.1.1.1.1.1.1.m1.1.1.3">ffn</mtext></ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.T3.5.1.1.1.1.1.1.m1.1c">\mathcal{M}_{\textrm{ffn}}</annotation><annotation encoding="application/x-llamapun" id="S4.T3.5.1.1.1.1.1.1.m1.1d">caligraphic_M start_POSTSUBSCRIPT ffn end_POSTSUBSCRIPT</annotation></semantics></math> (HiRE-Q)</span></span>
</span></span> <span class="ltx_text" id="S4.T3.5.1.1.3"></span>
</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T3.6.2.2">
<span class="ltx_text" id="S4.T3.6.2.2.2"></span> <span class="ltx_text" id="S4.T3.6.2.2.1">
<span class="ltx_tabular ltx_align_middle" id="S4.T3.6.2.2.1.1">
<span class="ltx_tr" id="S4.T3.6.2.2.1.1.1">
<span class="ltx_td ltx_align_center" id="S4.T3.6.2.2.1.1.1.1"><math alttext="\mathcal{M}_{\textrm{ffn}}" class="ltx_Math" display="inline" id="S4.T3.6.2.2.1.1.1.1.m1.1"><semantics id="S4.T3.6.2.2.1.1.1.1.m1.1a"><msub id="S4.T3.6.2.2.1.1.1.1.m1.1.1" xref="S4.T3.6.2.2.1.1.1.1.m1.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S4.T3.6.2.2.1.1.1.1.m1.1.1.2" xref="S4.T3.6.2.2.1.1.1.1.m1.1.1.2.cmml">ℳ</mi><mtext id="S4.T3.6.2.2.1.1.1.1.m1.1.1.3" xref="S4.T3.6.2.2.1.1.1.1.m1.1.1.3a.cmml">ffn</mtext></msub><annotation-xml encoding="MathML-Content" id="S4.T3.6.2.2.1.1.1.1.m1.1b"><apply id="S4.T3.6.2.2.1.1.1.1.m1.1.1.cmml" xref="S4.T3.6.2.2.1.1.1.1.m1.1.1"><csymbol cd="ambiguous" id="S4.T3.6.2.2.1.1.1.1.m1.1.1.1.cmml" xref="S4.T3.6.2.2.1.1.1.1.m1.1.1">subscript</csymbol><ci id="S4.T3.6.2.2.1.1.1.1.m1.1.1.2.cmml" xref="S4.T3.6.2.2.1.1.1.1.m1.1.1.2">ℳ</ci><ci id="S4.T3.6.2.2.1.1.1.1.m1.1.1.3a.cmml" xref="S4.T3.6.2.2.1.1.1.1.m1.1.1.3"><mtext id="S4.T3.6.2.2.1.1.1.1.m1.1.1.3.cmml" mathsize="70%" xref="S4.T3.6.2.2.1.1.1.1.m1.1.1.3">ffn</mtext></ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.T3.6.2.2.1.1.1.1.m1.1c">\mathcal{M}_{\textrm{ffn}}</annotation><annotation encoding="application/x-llamapun" id="S4.T3.6.2.2.1.1.1.1.m1.1d">caligraphic_M start_POSTSUBSCRIPT ffn end_POSTSUBSCRIPT</annotation></semantics></math> + HiRE-Q</span></span>
<span class="ltx_tr" id="S4.T3.6.2.2.1.1.2">
<span class="ltx_td ltx_align_center" id="S4.T3.6.2.2.1.1.2.1">+ (DA-TOP-k)</span></span>
</span></span> <span class="ltx_text" id="S4.T3.6.2.2.3"></span>
</td>
</tr>
<tr class="ltx_tr" id="S4.T3.8.5">
<td class="ltx_td ltx_align_center ltx_border_l ltx_border_r ltx_border_tt" id="S4.T3.8.5.1" rowspan="2"><span class="ltx_text" id="S4.T3.8.5.1.1"><span class="ltx_text" id="S4.T3.8.5.1.1.1"></span> <span class="ltx_text" id="S4.T3.8.5.1.1.2">
<span class="ltx_tabular ltx_align_middle" id="S4.T3.8.5.1.1.2.1">
<span class="ltx_tr" id="S4.T3.8.5.1.1.2.1.1">
<span class="ltx_td ltx_align_center" id="S4.T3.8.5.1.1.2.1.1.1">Pre-training</span></span>
<span class="ltx_tr" id="S4.T3.8.5.1.1.2.1.2">
<span class="ltx_td ltx_align_center" id="S4.T3.8.5.1.1.2.1.2.1">Performance</span></span>
</span></span> <span class="ltx_text" id="S4.T3.8.5.1.1.3"></span></span></td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_tt" id="S4.T3.8.5.2">Top1 Accuracy</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_tt" id="S4.T3.8.5.3">57.03%</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_tt" id="S4.T3.8.5.4">56.82%</td>
</tr>
<tr class="ltx_tr" id="S4.T3.8.6">
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T3.8.6.1">Perplexity</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T3.8.6.2">2.056</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T3.8.6.3">2.064</td>
</tr>
<tr class="ltx_tr" id="S4.T3.8.7">
<td class="ltx_td ltx_align_center ltx_border_l ltx_border_r ltx_border_tt" id="S4.T3.8.7.1" rowspan="4"><span class="ltx_text" id="S4.T3.8.7.1.1"><span class="ltx_text" id="S4.T3.8.7.1.1.1"></span> <span class="ltx_text" id="S4.T3.8.7.1.1.2">
<span class="ltx_tabular ltx_align_middle" id="S4.T3.8.7.1.1.2.1">
<span class="ltx_tr" id="S4.T3.8.7.1.1.2.1.1">
<span class="ltx_td ltx_align_center" id="S4.T3.8.7.1.1.2.1.1.1">Downstream</span></span>
<span class="ltx_tr" id="S4.T3.8.7.1.1.2.1.2">
<span class="ltx_td ltx_align_center" id="S4.T3.8.7.1.1.2.1.2.1">Performance</span></span>
</span></span> <span class="ltx_text" id="S4.T3.8.7.1.1.3"></span></span></td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_tt" id="S4.T3.8.7.2">Machine Translation</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_tt" id="S4.T3.8.7.3">46.95</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_tt" id="S4.T3.8.7.4">47.03</td>
</tr>
<tr class="ltx_tr" id="S4.T3.8.8">
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T3.8.8.1">SuperGLUE Benchmark</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T3.8.8.2">62.49</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T3.8.8.3">61.37</td>
</tr>
<tr class="ltx_tr" id="S4.T3.8.9">
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T3.8.9.1">Question Answering</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T3.8.9.2">30.88</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T3.8.9.3">30.11</td>
</tr>
<tr class="ltx_tr" id="S4.T3.8.10">
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T3.8.10.1">Discriminative Tasks</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T3.8.10.2">51.14</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T3.8.10.3">50.33</td>
</tr>
<tr class="ltx_tr" id="S4.T3.8.4">
<td class="ltx_td ltx_align_center ltx_border_b ltx_border_l ltx_border_r ltx_border_tt" colspan="2" id="S4.T3.8.4.3">
<em class="ltx_emph ltx_font_italic" id="S4.T3.8.4.3.1">Speedup</em></td>
<td class="ltx_td ltx_align_center ltx_border_b ltx_border_r ltx_border_tt" id="S4.T3.7.3.1">1.0<math alttext="\times" class="ltx_Math" display="inline" id="S4.T3.7.3.1.m1.1"><semantics id="S4.T3.7.3.1.m1.1a"><mo id="S4.T3.7.3.1.m1.1.1" xref="S4.T3.7.3.1.m1.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S4.T3.7.3.1.m1.1b"><times id="S4.T3.7.3.1.m1.1.1.cmml" xref="S4.T3.7.3.1.m1.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S4.T3.7.3.1.m1.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S4.T3.7.3.1.m1.1d">×</annotation></semantics></math>
</td>
<td class="ltx_td ltx_align_center ltx_border_b ltx_border_r ltx_border_tt" id="S4.T3.8.4.2">2.27<math alttext="\times" class="ltx_Math" display="inline" id="S4.T3.8.4.2.m1.1"><semantics id="S4.T3.8.4.2.m1.1a"><mo id="S4.T3.8.4.2.m1.1.1" xref="S4.T3.8.4.2.m1.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S4.T3.8.4.2.m1.1b"><times id="S4.T3.8.4.2.m1.1.1.cmml" xref="S4.T3.8.4.2.m1.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S4.T3.8.4.2.m1.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S4.T3.8.4.2.m1.1d">×</annotation></semantics></math>
</td>
</tr>
</table>
</figure>
</section>
<section class="ltx_subsection" id="S4.SS2">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">4.2 </span>Evaluation</h3>
<div class="ltx_para" id="S4.SS2.p1">
<p class="ltx_p" id="S4.SS2.p1.1">We evaluate the performance of different models both in terms of quality as well as inference latency. We measure quality using evaluation on pre-training dataset as well evaluations on multiple downstream datasets. Following standard works in the domain, we compute downstream performance of the model by applying it to multiple tasks, each focusing on a specific capability of LLMs. Collectively these datasets provide us a thorough assessment framework. To facilitate evaluation of our pretrained base models we perform 1-shot evaluations on all datasets.</p>
<ol class="ltx_enumerate" id="S4.I2">
<li class="ltx_item" id="S4.I2.i1" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">1.</span>
<div class="ltx_para" id="S4.I2.i1.p1">
<p class="ltx_p" id="S4.I2.i1.p1.1"><span class="ltx_text ltx_font_bold" id="S4.I2.i1.p1.1.1">Machine Translation</span>: We use English-French tasks from WMT14 <cite class="ltx_cite ltx_citemacro_citep">(Bojar et al., <a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#bib.bib9" title="">2014</a>)</cite> and German-French tasks from WMT22 <cite class="ltx_cite ltx_citemacro_citep">(Zerva et al., <a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#bib.bib60" title="">2022</a>)</cite>.</p>
</div>
</li>
<li class="ltx_item" id="S4.I2.i2" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">2.</span>
<div class="ltx_para" id="S4.I2.i2.p1">
<p class="ltx_p" id="S4.I2.i2.p1.1"><span class="ltx_text ltx_font_bold" id="S4.I2.i2.p1.1.1">SuperGLUE Benchmark</span>: We use multiple SuperGLUE <cite class="ltx_cite ltx_citemacro_citep">(Wang et al., <a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#bib.bib54" title="">2019</a>)</cite> tasks such as BoolQ <cite class="ltx_cite ltx_citemacro_citep">(Clark et al., <a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#bib.bib10" title="">2019</a>)</cite> etc. See appendix for the full list of datasets.
</p>
</div>
</li>
<li class="ltx_item" id="S4.I2.i3" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">3.</span>
<div class="ltx_para" id="S4.I2.i3.p1">
<p class="ltx_p" id="S4.I2.i3.p1.1"><span class="ltx_text ltx_font_bold" id="S4.I2.i3.p1.1.1">Question Answering</span>: We use SQuADv2 <cite class="ltx_cite ltx_citemacro_citep">(Rajpurkar et al., <a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#bib.bib47" title="">2018</a>)</cite>, TriviaQA <cite class="ltx_cite ltx_citemacro_citep">(Joshi et al., <a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#bib.bib25" title="">2017</a>)</cite>, NaturalQuestions <cite class="ltx_cite ltx_citemacro_citep">(Kwiatkowski et al., <a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#bib.bib27" title="">2019</a>)</cite>, WebQuestions <cite class="ltx_cite ltx_citemacro_citep">(Berant et al., <a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#bib.bib7" title="">2013</a>)</cite> and TyDiQA-English <cite class="ltx_cite ltx_citemacro_citep">(Clark et al., <a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#bib.bib11" title="">2020</a>)</cite>.</p>
</div>
</li>
<li class="ltx_item" id="S4.I2.i4" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">4.</span>
<div class="ltx_para" id="S4.I2.i4.p1">
<p class="ltx_p" id="S4.I2.i4.p1.1"><span class="ltx_text ltx_font_bold" id="S4.I2.i4.p1.1.1">Discriminative Tasks</span>: We use additional tasks to evaluate <em class="ltx_emph ltx_font_italic" id="S4.I2.i4.p1.1.2">commonsense reasoning</em>, <em class="ltx_emph ltx_font_italic" id="S4.I2.i4.p1.1.3">ranking</em> and <em class="ltx_emph ltx_font_italic" id="S4.I2.i4.p1.1.4">textual entailment</em>. See appendix for the full list of datasets.</p>
</div>
</li>
</ol>
<p class="ltx_p" id="S4.SS2.p1.2">For Question Answering evaluations we use <span class="ltx_text ltx_font_italic" id="S4.SS2.p1.2.1">Exact Match</span> as our metric (Except <span class="ltx_text ltx_font_italic" id="S4.SS2.p1.2.2">F1-score</span> for TyDiQA), <span class="ltx_text ltx_font_italic" id="S4.SS2.p1.2.3">Accuracy</span> for Discriminative tasks and <span class="ltx_text ltx_font_italic" id="S4.SS2.p1.2.4">Character n-gram F-score</span> <cite class="ltx_cite ltx_citemacro_citep">(Popović, <a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#bib.bib46" title="">2015</a>)</cite> for machine translation. For each task group, we report the Macro-Average of task metrics in our downstream evaluations.</p>
</div>
<div class="ltx_para" id="S4.SS2.p2">
<p class="ltx_p" id="S4.SS2.p2.1">For evaluating inference latency, we use a single TPUv5e device with batch size of one, and for generating one full response per query. We also demonstrate the importance of DA-TOP-k in scaling to multiple devices, by presenting results for a slice of <math alttext="4" class="ltx_Math" display="inline" id="S4.SS2.p2.1.m1.1"><semantics id="S4.SS2.p2.1.m1.1a"><mn id="S4.SS2.p2.1.m1.1.1" xref="S4.SS2.p2.1.m1.1.1.cmml">4</mn><annotation-xml encoding="MathML-Content" id="S4.SS2.p2.1.m1.1b"><cn id="S4.SS2.p2.1.m1.1.1.cmml" type="integer" xref="S4.SS2.p2.1.m1.1.1">4</cn></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p2.1.m1.1c">4</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.p2.1.m1.1d">4</annotation></semantics></math> TPUv5e devices. We report <em class="ltx_emph ltx_font_italic" id="S4.SS2.p2.1.1">Speedups</em> by measuring number of response tokens generated per unit time step.</p>
</div>
</section>
<section class="ltx_subsection" id="S4.SS3">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">4.3 </span>Results</h3>
<div class="ltx_para" id="S4.SS3.p1">
<p class="ltx_p" id="S4.SS3.p1.9">HiRE<span class="ltx_text ltx_font_bold" id="S4.SS3.p1.9.1">-</span>Softmax: Table <a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#S3.T1" title="Table 1 ‣ Dynamic overlap ‣ 3.4.1 Enhancing sparsity further by exploiting static and dynamic activation overlap ‣ 3.4 HiRE-FFN: Efficient FFN using HiRE ‣ 3 Main Ideas ‣ HiRE: High Recall Approximate Top-𝑘 Estimation for Efficient LLM Inference"><span class="ltx_text ltx_ref_tag">1</span></a> presents a comparison of <math alttext="\mathcal{M}_{\textrm{sm}}" class="ltx_Math" display="inline" id="S4.SS3.p1.1.m1.1"><semantics id="S4.SS3.p1.1.m1.1a"><msub id="S4.SS3.p1.1.m1.1.1" xref="S4.SS3.p1.1.m1.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S4.SS3.p1.1.m1.1.1.2" xref="S4.SS3.p1.1.m1.1.1.2.cmml">ℳ</mi><mtext id="S4.SS3.p1.1.m1.1.1.3" xref="S4.SS3.p1.1.m1.1.1.3a.cmml">sm</mtext></msub><annotation-xml encoding="MathML-Content" id="S4.SS3.p1.1.m1.1b"><apply id="S4.SS3.p1.1.m1.1.1.cmml" xref="S4.SS3.p1.1.m1.1.1"><csymbol cd="ambiguous" id="S4.SS3.p1.1.m1.1.1.1.cmml" xref="S4.SS3.p1.1.m1.1.1">subscript</csymbol><ci id="S4.SS3.p1.1.m1.1.1.2.cmml" xref="S4.SS3.p1.1.m1.1.1.2">ℳ</ci><ci id="S4.SS3.p1.1.m1.1.1.3a.cmml" xref="S4.SS3.p1.1.m1.1.1.3"><mtext id="S4.SS3.p1.1.m1.1.1.3.cmml" mathsize="70%" xref="S4.SS3.p1.1.m1.1.1.3">sm</mtext></ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS3.p1.1.m1.1c">\mathcal{M}_{\textrm{sm}}</annotation><annotation encoding="application/x-llamapun" id="S4.SS3.p1.1.m1.1d">caligraphic_M start_POSTSUBSCRIPT sm end_POSTSUBSCRIPT</annotation></semantics></math> (i.e., HiRE applied to the softmax layer of <math alttext="\mathcal{M}_{\textrm{base}}" class="ltx_Math" display="inline" id="S4.SS3.p1.2.m2.1"><semantics id="S4.SS3.p1.2.m2.1a"><msub id="S4.SS3.p1.2.m2.1.1" xref="S4.SS3.p1.2.m2.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S4.SS3.p1.2.m2.1.1.2" xref="S4.SS3.p1.2.m2.1.1.2.cmml">ℳ</mi><mtext id="S4.SS3.p1.2.m2.1.1.3" xref="S4.SS3.p1.2.m2.1.1.3a.cmml">base</mtext></msub><annotation-xml encoding="MathML-Content" id="S4.SS3.p1.2.m2.1b"><apply id="S4.SS3.p1.2.m2.1.1.cmml" xref="S4.SS3.p1.2.m2.1.1"><csymbol cd="ambiguous" id="S4.SS3.p1.2.m2.1.1.1.cmml" xref="S4.SS3.p1.2.m2.1.1">subscript</csymbol><ci id="S4.SS3.p1.2.m2.1.1.2.cmml" xref="S4.SS3.p1.2.m2.1.1.2">ℳ</ci><ci id="S4.SS3.p1.2.m2.1.1.3a.cmml" xref="S4.SS3.p1.2.m2.1.1.3"><mtext id="S4.SS3.p1.2.m2.1.1.3.cmml" mathsize="70%" xref="S4.SS3.p1.2.m2.1.1.3">base</mtext></ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS3.p1.2.m2.1c">\mathcal{M}_{\textrm{base}}</annotation><annotation encoding="application/x-llamapun" id="S4.SS3.p1.2.m2.1d">caligraphic_M start_POSTSUBSCRIPT base end_POSTSUBSCRIPT</annotation></semantics></math>) with the baseline dense model (<math alttext="\mathcal{M}_{\textrm{base}}" class="ltx_Math" display="inline" id="S4.SS3.p1.3.m3.1"><semantics id="S4.SS3.p1.3.m3.1a"><msub id="S4.SS3.p1.3.m3.1.1" xref="S4.SS3.p1.3.m3.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S4.SS3.p1.3.m3.1.1.2" xref="S4.SS3.p1.3.m3.1.1.2.cmml">ℳ</mi><mtext id="S4.SS3.p1.3.m3.1.1.3" xref="S4.SS3.p1.3.m3.1.1.3a.cmml">base</mtext></msub><annotation-xml encoding="MathML-Content" id="S4.SS3.p1.3.m3.1b"><apply id="S4.SS3.p1.3.m3.1.1.cmml" xref="S4.SS3.p1.3.m3.1.1"><csymbol cd="ambiguous" id="S4.SS3.p1.3.m3.1.1.1.cmml" xref="S4.SS3.p1.3.m3.1.1">subscript</csymbol><ci id="S4.SS3.p1.3.m3.1.1.2.cmml" xref="S4.SS3.p1.3.m3.1.1.2">ℳ</ci><ci id="S4.SS3.p1.3.m3.1.1.3a.cmml" xref="S4.SS3.p1.3.m3.1.1.3"><mtext id="S4.SS3.p1.3.m3.1.1.3.cmml" mathsize="70%" xref="S4.SS3.p1.3.m3.1.1.3">base</mtext></ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS3.p1.3.m3.1c">\mathcal{M}_{\textrm{base}}</annotation><annotation encoding="application/x-llamapun" id="S4.SS3.p1.3.m3.1d">caligraphic_M start_POSTSUBSCRIPT base end_POSTSUBSCRIPT</annotation></semantics></math>). Note that both HiRE-Q and HiRE-LR provide about <math alttext="1.16\times" class="ltx_math_unparsed" display="inline" id="S4.SS3.p1.4.m4.1"><semantics id="S4.SS3.p1.4.m4.1a"><mrow id="S4.SS3.p1.4.m4.1b"><mn id="S4.SS3.p1.4.m4.1.1">1.16</mn><mo id="S4.SS3.p1.4.m4.1.2" lspace="0.222em">×</mo></mrow><annotation encoding="application/x-tex" id="S4.SS3.p1.4.m4.1c">1.16\times</annotation><annotation encoding="application/x-llamapun" id="S4.SS3.p1.4.m4.1d">1.16 ×</annotation></semantics></math> speedup over baseline while providing almost the same next-token prediction accuracy on the pretraining dataset. Downstream accuracy is also within <math alttext="0.2\%" class="ltx_Math" display="inline" id="S4.SS3.p1.5.m5.1"><semantics id="S4.SS3.p1.5.m5.1a"><mrow id="S4.SS3.p1.5.m5.1.1" xref="S4.SS3.p1.5.m5.1.1.cmml"><mn id="S4.SS3.p1.5.m5.1.1.2" xref="S4.SS3.p1.5.m5.1.1.2.cmml">0.2</mn><mo id="S4.SS3.p1.5.m5.1.1.1" xref="S4.SS3.p1.5.m5.1.1.1.cmml">%</mo></mrow><annotation-xml encoding="MathML-Content" id="S4.SS3.p1.5.m5.1b"><apply id="S4.SS3.p1.5.m5.1.1.cmml" xref="S4.SS3.p1.5.m5.1.1"><csymbol cd="latexml" id="S4.SS3.p1.5.m5.1.1.1.cmml" xref="S4.SS3.p1.5.m5.1.1.1">percent</csymbol><cn id="S4.SS3.p1.5.m5.1.1.2.cmml" type="float" xref="S4.SS3.p1.5.m5.1.1.2">0.2</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS3.p1.5.m5.1c">0.2\%</annotation><annotation encoding="application/x-llamapun" id="S4.SS3.p1.5.m5.1d">0.2 %</annotation></semantics></math> of the baseline. We observe that combining <math alttext="\textrm{HiRE}-\textrm{Q}" class="ltx_Math" display="inline" id="S4.SS3.p1.6.m6.1"><semantics id="S4.SS3.p1.6.m6.1a"><mrow id="S4.SS3.p1.6.m6.1.1" xref="S4.SS3.p1.6.m6.1.1.cmml"><mtext id="S4.SS3.p1.6.m6.1.1.2" xref="S4.SS3.p1.6.m6.1.1.2a.cmml">HiRE</mtext><mo id="S4.SS3.p1.6.m6.1.1.1" xref="S4.SS3.p1.6.m6.1.1.1.cmml">−</mo><mtext id="S4.SS3.p1.6.m6.1.1.3" xref="S4.SS3.p1.6.m6.1.1.3a.cmml">Q</mtext></mrow><annotation-xml encoding="MathML-Content" id="S4.SS3.p1.6.m6.1b"><apply id="S4.SS3.p1.6.m6.1.1.cmml" xref="S4.SS3.p1.6.m6.1.1"><minus id="S4.SS3.p1.6.m6.1.1.1.cmml" xref="S4.SS3.p1.6.m6.1.1.1"></minus><ci id="S4.SS3.p1.6.m6.1.1.2a.cmml" xref="S4.SS3.p1.6.m6.1.1.2"><mtext id="S4.SS3.p1.6.m6.1.1.2.cmml" xref="S4.SS3.p1.6.m6.1.1.2">HiRE</mtext></ci><ci id="S4.SS3.p1.6.m6.1.1.3a.cmml" xref="S4.SS3.p1.6.m6.1.1.3"><mtext id="S4.SS3.p1.6.m6.1.1.3.cmml" xref="S4.SS3.p1.6.m6.1.1.3">Q</mtext></ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS3.p1.6.m6.1c">\textrm{HiRE}-\textrm{Q}</annotation><annotation encoding="application/x-llamapun" id="S4.SS3.p1.6.m6.1d">HiRE - Q</annotation></semantics></math> and <math alttext="\textrm{HiRE}-\textrm{LR}" class="ltx_Math" display="inline" id="S4.SS3.p1.7.m7.1"><semantics id="S4.SS3.p1.7.m7.1a"><mrow id="S4.SS3.p1.7.m7.1.1" xref="S4.SS3.p1.7.m7.1.1.cmml"><mtext id="S4.SS3.p1.7.m7.1.1.2" xref="S4.SS3.p1.7.m7.1.1.2a.cmml">HiRE</mtext><mo id="S4.SS3.p1.7.m7.1.1.1" xref="S4.SS3.p1.7.m7.1.1.1.cmml">−</mo><mtext id="S4.SS3.p1.7.m7.1.1.3" xref="S4.SS3.p1.7.m7.1.1.3a.cmml">LR</mtext></mrow><annotation-xml encoding="MathML-Content" id="S4.SS3.p1.7.m7.1b"><apply id="S4.SS3.p1.7.m7.1.1.cmml" xref="S4.SS3.p1.7.m7.1.1"><minus id="S4.SS3.p1.7.m7.1.1.1.cmml" xref="S4.SS3.p1.7.m7.1.1.1"></minus><ci id="S4.SS3.p1.7.m7.1.1.2a.cmml" xref="S4.SS3.p1.7.m7.1.1.2"><mtext id="S4.SS3.p1.7.m7.1.1.2.cmml" xref="S4.SS3.p1.7.m7.1.1.2">HiRE</mtext></ci><ci id="S4.SS3.p1.7.m7.1.1.3a.cmml" xref="S4.SS3.p1.7.m7.1.1.3"><mtext id="S4.SS3.p1.7.m7.1.1.3.cmml" xref="S4.SS3.p1.7.m7.1.1.3">LR</mtext></ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS3.p1.7.m7.1c">\textrm{HiRE}-\textrm{LR}</annotation><annotation encoding="application/x-llamapun" id="S4.SS3.p1.7.m7.1d">HiRE - LR</annotation></semantics></math> improves the latency speedup to <math alttext="1.22\times" class="ltx_math_unparsed" display="inline" id="S4.SS3.p1.8.m8.1"><semantics id="S4.SS3.p1.8.m8.1a"><mrow id="S4.SS3.p1.8.m8.1b"><mn id="S4.SS3.p1.8.m8.1.1">1.22</mn><mo id="S4.SS3.p1.8.m8.1.2" lspace="0.222em">×</mo></mrow><annotation encoding="application/x-tex" id="S4.SS3.p1.8.m8.1c">1.22\times</annotation><annotation encoding="application/x-llamapun" id="S4.SS3.p1.8.m8.1d">1.22 ×</annotation></semantics></math> with less than <math alttext="0.5\%" class="ltx_Math" display="inline" id="S4.SS3.p1.9.m9.1"><semantics id="S4.SS3.p1.9.m9.1a"><mrow id="S4.SS3.p1.9.m9.1.1" xref="S4.SS3.p1.9.m9.1.1.cmml"><mn id="S4.SS3.p1.9.m9.1.1.2" xref="S4.SS3.p1.9.m9.1.1.2.cmml">0.5</mn><mo id="S4.SS3.p1.9.m9.1.1.1" xref="S4.SS3.p1.9.m9.1.1.1.cmml">%</mo></mrow><annotation-xml encoding="MathML-Content" id="S4.SS3.p1.9.m9.1b"><apply id="S4.SS3.p1.9.m9.1.1.cmml" xref="S4.SS3.p1.9.m9.1.1"><csymbol cd="latexml" id="S4.SS3.p1.9.m9.1.1.1.cmml" xref="S4.SS3.p1.9.m9.1.1.1">percent</csymbol><cn id="S4.SS3.p1.9.m9.1.1.2.cmml" type="float" xref="S4.SS3.p1.9.m9.1.1.2">0.5</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS3.p1.9.m9.1c">0.5\%</annotation><annotation encoding="application/x-llamapun" id="S4.SS3.p1.9.m9.1d">0.5 %</annotation></semantics></math> overall drop in accuracy.</p>
</div>
<div class="ltx_para" id="S4.SS3.p2">
<p class="ltx_p" id="S4.SS3.p2.4">HiRE<span class="ltx_text ltx_font_bold" id="S4.SS3.p2.4.1">-</span>FFN: Table <a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#S4.T2" title="Table 2 ‣ 4.1 Training details ‣ 4 Experiments ‣ HiRE: High Recall Approximate Top-𝑘 Estimation for Efficient LLM Inference"><span class="ltx_text ltx_ref_tag">2</span></a> presents a comparison of both HiRE-FFN (<math alttext="\mathcal{M}_{\textrm{ffn}}" class="ltx_Math" display="inline" id="S4.SS3.p2.1.m1.1"><semantics id="S4.SS3.p2.1.m1.1a"><msub id="S4.SS3.p2.1.m1.1.1" xref="S4.SS3.p2.1.m1.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S4.SS3.p2.1.m1.1.1.2" xref="S4.SS3.p2.1.m1.1.1.2.cmml">ℳ</mi><mtext id="S4.SS3.p2.1.m1.1.1.3" xref="S4.SS3.p2.1.m1.1.1.3a.cmml">ffn</mtext></msub><annotation-xml encoding="MathML-Content" id="S4.SS3.p2.1.m1.1b"><apply id="S4.SS3.p2.1.m1.1.1.cmml" xref="S4.SS3.p2.1.m1.1.1"><csymbol cd="ambiguous" id="S4.SS3.p2.1.m1.1.1.1.cmml" xref="S4.SS3.p2.1.m1.1.1">subscript</csymbol><ci id="S4.SS3.p2.1.m1.1.1.2.cmml" xref="S4.SS3.p2.1.m1.1.1.2">ℳ</ci><ci id="S4.SS3.p2.1.m1.1.1.3a.cmml" xref="S4.SS3.p2.1.m1.1.1.3"><mtext id="S4.SS3.p2.1.m1.1.1.3.cmml" mathsize="70%" xref="S4.SS3.p2.1.m1.1.1.3">ffn</mtext></ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS3.p2.1.m1.1c">\mathcal{M}_{\textrm{ffn}}</annotation><annotation encoding="application/x-llamapun" id="S4.SS3.p2.1.m1.1d">caligraphic_M start_POSTSUBSCRIPT ffn end_POSTSUBSCRIPT</annotation></semantics></math>) as well as the full HiRE approach applied to both the Softmax and FFN layers (<math alttext="\mathcal{M}_{\textrm{full}}" class="ltx_Math" display="inline" id="S4.SS3.p2.2.m2.1"><semantics id="S4.SS3.p2.2.m2.1a"><msub id="S4.SS3.p2.2.m2.1.1" xref="S4.SS3.p2.2.m2.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S4.SS3.p2.2.m2.1.1.2" xref="S4.SS3.p2.2.m2.1.1.2.cmml">ℳ</mi><mtext id="S4.SS3.p2.2.m2.1.1.3" xref="S4.SS3.p2.2.m2.1.1.3a.cmml">full</mtext></msub><annotation-xml encoding="MathML-Content" id="S4.SS3.p2.2.m2.1b"><apply id="S4.SS3.p2.2.m2.1.1.cmml" xref="S4.SS3.p2.2.m2.1.1"><csymbol cd="ambiguous" id="S4.SS3.p2.2.m2.1.1.1.cmml" xref="S4.SS3.p2.2.m2.1.1">subscript</csymbol><ci id="S4.SS3.p2.2.m2.1.1.2.cmml" xref="S4.SS3.p2.2.m2.1.1.2">ℳ</ci><ci id="S4.SS3.p2.2.m2.1.1.3a.cmml" xref="S4.SS3.p2.2.m2.1.1.3"><mtext id="S4.SS3.p2.2.m2.1.1.3.cmml" mathsize="70%" xref="S4.SS3.p2.2.m2.1.1.3">full</mtext></ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS3.p2.2.m2.1c">\mathcal{M}_{\textrm{full}}</annotation><annotation encoding="application/x-llamapun" id="S4.SS3.p2.2.m2.1d">caligraphic_M start_POSTSUBSCRIPT full end_POSTSUBSCRIPT</annotation></semantics></math>), with respect to the original model (<math alttext="\mathcal{M}_{\textrm{base}}" class="ltx_Math" display="inline" id="S4.SS3.p2.3.m3.1"><semantics id="S4.SS3.p2.3.m3.1a"><msub id="S4.SS3.p2.3.m3.1.1" xref="S4.SS3.p2.3.m3.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S4.SS3.p2.3.m3.1.1.2" xref="S4.SS3.p2.3.m3.1.1.2.cmml">ℳ</mi><mtext id="S4.SS3.p2.3.m3.1.1.3" xref="S4.SS3.p2.3.m3.1.1.3a.cmml">base</mtext></msub><annotation-xml encoding="MathML-Content" id="S4.SS3.p2.3.m3.1b"><apply id="S4.SS3.p2.3.m3.1.1.cmml" xref="S4.SS3.p2.3.m3.1.1"><csymbol cd="ambiguous" id="S4.SS3.p2.3.m3.1.1.1.cmml" xref="S4.SS3.p2.3.m3.1.1">subscript</csymbol><ci id="S4.SS3.p2.3.m3.1.1.2.cmml" xref="S4.SS3.p2.3.m3.1.1.2">ℳ</ci><ci id="S4.SS3.p2.3.m3.1.1.3a.cmml" xref="S4.SS3.p2.3.m3.1.1.3"><mtext id="S4.SS3.p2.3.m3.1.1.3.cmml" mathsize="70%" xref="S4.SS3.p2.3.m3.1.1.3">base</mtext></ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS3.p2.3.m3.1c">\mathcal{M}_{\textrm{base}}</annotation><annotation encoding="application/x-llamapun" id="S4.SS3.p2.3.m3.1d">caligraphic_M start_POSTSUBSCRIPT base end_POSTSUBSCRIPT</annotation></semantics></math>). Similar to softmax layer, here again combining HiRE-LR and HiRE-Q leads to as much as <math alttext="1.47\times" class="ltx_math_unparsed" display="inline" id="S4.SS3.p2.4.m4.1"><semantics id="S4.SS3.p2.4.m4.1a"><mrow id="S4.SS3.p2.4.m4.1b"><mn id="S4.SS3.p2.4.m4.1.1">1.47</mn><mo id="S4.SS3.p2.4.m4.1.2" lspace="0.222em">×</mo></mrow><annotation encoding="application/x-tex" id="S4.SS3.p2.4.m4.1c">1.47\times</annotation><annotation encoding="application/x-llamapun" id="S4.SS3.p2.4.m4.1d">1.47 ×</annotation></semantics></math> latency reduction while maintaining almost similar pre-training and downstream evaluation accuracy.</p>
</div>
<div class="ltx_para" id="S4.SS3.p3">
<p class="ltx_p" id="S4.SS3.p3.6"><span class="ltx_text ltx_font_bold" id="S4.SS3.p3.6.1">Multiple devices</span>: In latency critical applications, LLMs are served on multiple accelerator devices, with their weights distributed across them.
Implementing HiRE as is on multiple devices in this fashion turns out to be suboptimal due to the cost of identifying top-<math alttext="k" class="ltx_Math" display="inline" id="S4.SS3.p3.1.m1.1"><semantics id="S4.SS3.p3.1.m1.1a"><mi id="S4.SS3.p3.1.m1.1.1" xref="S4.SS3.p3.1.m1.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="S4.SS3.p3.1.m1.1b"><ci id="S4.SS3.p3.1.m1.1.1.cmml" xref="S4.SS3.p3.1.m1.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.SS3.p3.1.m1.1c">k</annotation><annotation encoding="application/x-llamapun" id="S4.SS3.p3.1.m1.1d">italic_k</annotation></semantics></math> activations jointly across all the devices. To overcome this, we proposed a distributed version of the top-<math alttext="k^{\prime}" class="ltx_Math" display="inline" id="S4.SS3.p3.2.m2.1"><semantics id="S4.SS3.p3.2.m2.1a"><msup id="S4.SS3.p3.2.m2.1.1" xref="S4.SS3.p3.2.m2.1.1.cmml"><mi id="S4.SS3.p3.2.m2.1.1.2" xref="S4.SS3.p3.2.m2.1.1.2.cmml">k</mi><mo id="S4.SS3.p3.2.m2.1.1.3" xref="S4.SS3.p3.2.m2.1.1.3.cmml">′</mo></msup><annotation-xml encoding="MathML-Content" id="S4.SS3.p3.2.m2.1b"><apply id="S4.SS3.p3.2.m2.1.1.cmml" xref="S4.SS3.p3.2.m2.1.1"><csymbol cd="ambiguous" id="S4.SS3.p3.2.m2.1.1.1.cmml" xref="S4.SS3.p3.2.m2.1.1">superscript</csymbol><ci id="S4.SS3.p3.2.m2.1.1.2.cmml" xref="S4.SS3.p3.2.m2.1.1.2">𝑘</ci><ci id="S4.SS3.p3.2.m2.1.1.3.cmml" xref="S4.SS3.p3.2.m2.1.1.3">′</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS3.p3.2.m2.1c">k^{\prime}</annotation><annotation encoding="application/x-llamapun" id="S4.SS3.p3.2.m2.1d">italic_k start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT</annotation></semantics></math> operation DA-TOP-k, which first performs top-<math alttext="\frac{k^{\prime}}{d}" class="ltx_Math" display="inline" id="S4.SS3.p3.3.m3.1"><semantics id="S4.SS3.p3.3.m3.1a"><mfrac id="S4.SS3.p3.3.m3.1.1" xref="S4.SS3.p3.3.m3.1.1.cmml"><msup id="S4.SS3.p3.3.m3.1.1.2" xref="S4.SS3.p3.3.m3.1.1.2.cmml"><mi id="S4.SS3.p3.3.m3.1.1.2.2" xref="S4.SS3.p3.3.m3.1.1.2.2.cmml">k</mi><mo id="S4.SS3.p3.3.m3.1.1.2.3" xref="S4.SS3.p3.3.m3.1.1.2.3.cmml">′</mo></msup><mi id="S4.SS3.p3.3.m3.1.1.3" xref="S4.SS3.p3.3.m3.1.1.3.cmml">d</mi></mfrac><annotation-xml encoding="MathML-Content" id="S4.SS3.p3.3.m3.1b"><apply id="S4.SS3.p3.3.m3.1.1.cmml" xref="S4.SS3.p3.3.m3.1.1"><divide id="S4.SS3.p3.3.m3.1.1.1.cmml" xref="S4.SS3.p3.3.m3.1.1"></divide><apply id="S4.SS3.p3.3.m3.1.1.2.cmml" xref="S4.SS3.p3.3.m3.1.1.2"><csymbol cd="ambiguous" id="S4.SS3.p3.3.m3.1.1.2.1.cmml" xref="S4.SS3.p3.3.m3.1.1.2">superscript</csymbol><ci id="S4.SS3.p3.3.m3.1.1.2.2.cmml" xref="S4.SS3.p3.3.m3.1.1.2.2">𝑘</ci><ci id="S4.SS3.p3.3.m3.1.1.2.3.cmml" xref="S4.SS3.p3.3.m3.1.1.2.3">′</ci></apply><ci id="S4.SS3.p3.3.m3.1.1.3.cmml" xref="S4.SS3.p3.3.m3.1.1.3">𝑑</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS3.p3.3.m3.1c">\frac{k^{\prime}}{d}</annotation><annotation encoding="application/x-llamapun" id="S4.SS3.p3.3.m3.1d">divide start_ARG italic_k start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT end_ARG start_ARG italic_d end_ARG</annotation></semantics></math> operation on each of the <math alttext="d" class="ltx_Math" display="inline" id="S4.SS3.p3.4.m4.1"><semantics id="S4.SS3.p3.4.m4.1a"><mi id="S4.SS3.p3.4.m4.1.1" xref="S4.SS3.p3.4.m4.1.1.cmml">d</mi><annotation-xml encoding="MathML-Content" id="S4.SS3.p3.4.m4.1b"><ci id="S4.SS3.p3.4.m4.1.1.cmml" xref="S4.SS3.p3.4.m4.1.1">𝑑</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.SS3.p3.4.m4.1c">d</annotation><annotation encoding="application/x-llamapun" id="S4.SS3.p3.4.m4.1d">italic_d</annotation></semantics></math> devices and then takes a union of those activations to approximate top-<math alttext="k^{\prime}" class="ltx_Math" display="inline" id="S4.SS3.p3.5.m5.1"><semantics id="S4.SS3.p3.5.m5.1a"><msup id="S4.SS3.p3.5.m5.1.1" xref="S4.SS3.p3.5.m5.1.1.cmml"><mi id="S4.SS3.p3.5.m5.1.1.2" xref="S4.SS3.p3.5.m5.1.1.2.cmml">k</mi><mo id="S4.SS3.p3.5.m5.1.1.3" xref="S4.SS3.p3.5.m5.1.1.3.cmml">′</mo></msup><annotation-xml encoding="MathML-Content" id="S4.SS3.p3.5.m5.1b"><apply id="S4.SS3.p3.5.m5.1.1.cmml" xref="S4.SS3.p3.5.m5.1.1"><csymbol cd="ambiguous" id="S4.SS3.p3.5.m5.1.1.1.cmml" xref="S4.SS3.p3.5.m5.1.1">superscript</csymbol><ci id="S4.SS3.p3.5.m5.1.1.2.cmml" xref="S4.SS3.p3.5.m5.1.1.2">𝑘</ci><ci id="S4.SS3.p3.5.m5.1.1.3.cmml" xref="S4.SS3.p3.5.m5.1.1.3">′</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS3.p3.5.m5.1c">k^{\prime}</annotation><annotation encoding="application/x-llamapun" id="S4.SS3.p3.5.m5.1d">italic_k start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT</annotation></semantics></math> (Algorithm <a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#alg2" title='Algorithm 2 ‣ 3.2.2 "DA-TOP-"⁢𝑘: Multi-device serving with approximate distributed top-𝑘 operation ‣ 3.2 HiRE: Overall Approach ‣ 3 Main Ideas ‣ HiRE: High Recall Approximate Top-𝑘 Estimation for Efficient LLM Inference'><span class="ltx_text ltx_ref_tag">2</span></a>). As we can see from Table <a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#S4.T3" title="Table 3 ‣ 4.1 Training details ‣ 4 Experiments ‣ HiRE: High Recall Approximate Top-𝑘 Estimation for Efficient LLM Inference"><span class="ltx_text ltx_ref_tag">3</span></a> improves the latency by <math alttext="2.27\times" class="ltx_math_unparsed" display="inline" id="S4.SS3.p3.6.m6.1"><semantics id="S4.SS3.p3.6.m6.1a"><mrow id="S4.SS3.p3.6.m6.1b"><mn id="S4.SS3.p3.6.m6.1.1">2.27</mn><mo id="S4.SS3.p3.6.m6.1.2" lspace="0.222em">×</mo></mrow><annotation encoding="application/x-tex" id="S4.SS3.p3.6.m6.1c">2.27\times</annotation><annotation encoding="application/x-llamapun" id="S4.SS3.p3.6.m6.1d">2.27 ×</annotation></semantics></math>, compared to the vanilla implementation of HiRE (Algorithm <a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#alg1" title="Algorithm 1 ‣ 3.2.1 Solving equation 5 accurately and efficiently ‣ 3.2 HiRE: Overall Approach ‣ 3 Main Ideas ‣ HiRE: High Recall Approximate Top-𝑘 Estimation for Efficient LLM Inference"><span class="ltx_text ltx_ref_tag">1</span></a>), with comparable quality on average across downstream tasks.</p>
</div>
<div class="ltx_para" id="S4.SS3.p4">
<p class="ltx_p" id="S4.SS3.p4.1"><span class="ltx_text ltx_font_bold" id="S4.SS3.p4.1.1">Why high recall estimation?</span></p>
</div>
<figure class="ltx_table" id="S4.T4">
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_table">Table 4: </span>Importance of High Recall for HiRE-Softmax. This table presents the pretraining top-<math alttext="1" class="ltx_Math" display="inline" id="S4.T4.11.m1.1"><semantics id="S4.T4.11.m1.1b"><mn id="S4.T4.11.m1.1.1" xref="S4.T4.11.m1.1.1.cmml">1</mn><annotation-xml encoding="MathML-Content" id="S4.T4.11.m1.1c"><cn id="S4.T4.11.m1.1.1.cmml" type="integer" xref="S4.T4.11.m1.1.1">1</cn></annotation-xml><annotation encoding="application/x-tex" id="S4.T4.11.m1.1d">1</annotation><annotation encoding="application/x-llamapun" id="S4.T4.11.m1.1e">1</annotation></semantics></math> accuracy as well as the size of intersection with the top-<math alttext="k" class="ltx_Math" display="inline" id="S4.T4.12.m2.1"><semantics id="S4.T4.12.m2.1b"><mi id="S4.T4.12.m2.1.1" xref="S4.T4.12.m2.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="S4.T4.12.m2.1c"><ci id="S4.T4.12.m2.1.1.cmml" xref="S4.T4.12.m2.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.T4.12.m2.1d">k</annotation><annotation encoding="application/x-llamapun" id="S4.T4.12.m2.1e">italic_k</annotation></semantics></math> tokens of the original model, when we use different values of <math alttext="k^{\prime}" class="ltx_Math" display="inline" id="S4.T4.13.m3.1"><semantics id="S4.T4.13.m3.1b"><msup id="S4.T4.13.m3.1.1" xref="S4.T4.13.m3.1.1.cmml"><mi id="S4.T4.13.m3.1.1.2" xref="S4.T4.13.m3.1.1.2.cmml">k</mi><mo id="S4.T4.13.m3.1.1.3" xref="S4.T4.13.m3.1.1.3.cmml">′</mo></msup><annotation-xml encoding="MathML-Content" id="S4.T4.13.m3.1c"><apply id="S4.T4.13.m3.1.1.cmml" xref="S4.T4.13.m3.1.1"><csymbol cd="ambiguous" id="S4.T4.13.m3.1.1.1.cmml" xref="S4.T4.13.m3.1.1">superscript</csymbol><ci id="S4.T4.13.m3.1.1.2.cmml" xref="S4.T4.13.m3.1.1.2">𝑘</ci><ci id="S4.T4.13.m3.1.1.3.cmml" xref="S4.T4.13.m3.1.1.3">′</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.T4.13.m3.1d">k^{\prime}</annotation><annotation encoding="application/x-llamapun" id="S4.T4.13.m3.1e">italic_k start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT</annotation></semantics></math> in the approximate computation step and <math alttext="k=32" class="ltx_Math" display="inline" id="S4.T4.14.m4.1"><semantics id="S4.T4.14.m4.1b"><mrow id="S4.T4.14.m4.1.1" xref="S4.T4.14.m4.1.1.cmml"><mi id="S4.T4.14.m4.1.1.2" xref="S4.T4.14.m4.1.1.2.cmml">k</mi><mo id="S4.T4.14.m4.1.1.1" xref="S4.T4.14.m4.1.1.1.cmml">=</mo><mn id="S4.T4.14.m4.1.1.3" xref="S4.T4.14.m4.1.1.3.cmml">32</mn></mrow><annotation-xml encoding="MathML-Content" id="S4.T4.14.m4.1c"><apply id="S4.T4.14.m4.1.1.cmml" xref="S4.T4.14.m4.1.1"><eq id="S4.T4.14.m4.1.1.1.cmml" xref="S4.T4.14.m4.1.1.1"></eq><ci id="S4.T4.14.m4.1.1.2.cmml" xref="S4.T4.14.m4.1.1.2">𝑘</ci><cn id="S4.T4.14.m4.1.1.3.cmml" type="integer" xref="S4.T4.14.m4.1.1.3">32</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.T4.14.m4.1d">k=32</annotation><annotation encoding="application/x-llamapun" id="S4.T4.14.m4.1e">italic_k = 32</annotation></semantics></math>. <math alttext="k^{\prime}=\textrm{None}" class="ltx_Math" display="inline" id="S4.T4.15.m5.1"><semantics id="S4.T4.15.m5.1b"><mrow id="S4.T4.15.m5.1.1" xref="S4.T4.15.m5.1.1.cmml"><msup id="S4.T4.15.m5.1.1.2" xref="S4.T4.15.m5.1.1.2.cmml"><mi id="S4.T4.15.m5.1.1.2.2" xref="S4.T4.15.m5.1.1.2.2.cmml">k</mi><mo id="S4.T4.15.m5.1.1.2.3" xref="S4.T4.15.m5.1.1.2.3.cmml">′</mo></msup><mo id="S4.T4.15.m5.1.1.1" xref="S4.T4.15.m5.1.1.1.cmml">=</mo><mtext id="S4.T4.15.m5.1.1.3" xref="S4.T4.15.m5.1.1.3a.cmml">None</mtext></mrow><annotation-xml encoding="MathML-Content" id="S4.T4.15.m5.1c"><apply id="S4.T4.15.m5.1.1.cmml" xref="S4.T4.15.m5.1.1"><eq id="S4.T4.15.m5.1.1.1.cmml" xref="S4.T4.15.m5.1.1.1"></eq><apply id="S4.T4.15.m5.1.1.2.cmml" xref="S4.T4.15.m5.1.1.2"><csymbol cd="ambiguous" id="S4.T4.15.m5.1.1.2.1.cmml" xref="S4.T4.15.m5.1.1.2">superscript</csymbol><ci id="S4.T4.15.m5.1.1.2.2.cmml" xref="S4.T4.15.m5.1.1.2.2">𝑘</ci><ci id="S4.T4.15.m5.1.1.2.3.cmml" xref="S4.T4.15.m5.1.1.2.3">′</ci></apply><ci id="S4.T4.15.m5.1.1.3a.cmml" xref="S4.T4.15.m5.1.1.3"><mtext id="S4.T4.15.m5.1.1.3.cmml" xref="S4.T4.15.m5.1.1.3">None</mtext></ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.T4.15.m5.1d">k^{\prime}=\textrm{None}</annotation><annotation encoding="application/x-llamapun" id="S4.T4.15.m5.1e">italic_k start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT = None</annotation></semantics></math> refers to the setting where we do not follow the approximate computation by an exact computation. As we can see, (i) not doing the exact computation (i.e., <math alttext="k^{\prime}=\textrm{None}" class="ltx_Math" display="inline" id="S4.T4.16.m6.1"><semantics id="S4.T4.16.m6.1b"><mrow id="S4.T4.16.m6.1.1" xref="S4.T4.16.m6.1.1.cmml"><msup id="S4.T4.16.m6.1.1.2" xref="S4.T4.16.m6.1.1.2.cmml"><mi id="S4.T4.16.m6.1.1.2.2" xref="S4.T4.16.m6.1.1.2.2.cmml">k</mi><mo id="S4.T4.16.m6.1.1.2.3" xref="S4.T4.16.m6.1.1.2.3.cmml">′</mo></msup><mo id="S4.T4.16.m6.1.1.1" xref="S4.T4.16.m6.1.1.1.cmml">=</mo><mtext id="S4.T4.16.m6.1.1.3" xref="S4.T4.16.m6.1.1.3a.cmml">None</mtext></mrow><annotation-xml encoding="MathML-Content" id="S4.T4.16.m6.1c"><apply id="S4.T4.16.m6.1.1.cmml" xref="S4.T4.16.m6.1.1"><eq id="S4.T4.16.m6.1.1.1.cmml" xref="S4.T4.16.m6.1.1.1"></eq><apply id="S4.T4.16.m6.1.1.2.cmml" xref="S4.T4.16.m6.1.1.2"><csymbol cd="ambiguous" id="S4.T4.16.m6.1.1.2.1.cmml" xref="S4.T4.16.m6.1.1.2">superscript</csymbol><ci id="S4.T4.16.m6.1.1.2.2.cmml" xref="S4.T4.16.m6.1.1.2.2">𝑘</ci><ci id="S4.T4.16.m6.1.1.2.3.cmml" xref="S4.T4.16.m6.1.1.2.3">′</ci></apply><ci id="S4.T4.16.m6.1.1.3a.cmml" xref="S4.T4.16.m6.1.1.3"><mtext id="S4.T4.16.m6.1.1.3.cmml" xref="S4.T4.16.m6.1.1.3">None</mtext></ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.T4.16.m6.1d">k^{\prime}=\textrm{None}</annotation><annotation encoding="application/x-llamapun" id="S4.T4.16.m6.1e">italic_k start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT = None</annotation></semantics></math>) leads to large drop in top-<math alttext="1" class="ltx_Math" display="inline" id="S4.T4.17.m7.1"><semantics id="S4.T4.17.m7.1b"><mn id="S4.T4.17.m7.1.1" xref="S4.T4.17.m7.1.1.cmml">1</mn><annotation-xml encoding="MathML-Content" id="S4.T4.17.m7.1c"><cn id="S4.T4.17.m7.1.1.cmml" type="integer" xref="S4.T4.17.m7.1.1">1</cn></annotation-xml><annotation encoding="application/x-tex" id="S4.T4.17.m7.1d">1</annotation><annotation encoding="application/x-llamapun" id="S4.T4.17.m7.1e">1</annotation></semantics></math> accuracy. Similarly, using a <math alttext="k^{\prime}" class="ltx_Math" display="inline" id="S4.T4.18.m8.1"><semantics id="S4.T4.18.m8.1b"><msup id="S4.T4.18.m8.1.1" xref="S4.T4.18.m8.1.1.cmml"><mi id="S4.T4.18.m8.1.1.2" xref="S4.T4.18.m8.1.1.2.cmml">k</mi><mo id="S4.T4.18.m8.1.1.3" xref="S4.T4.18.m8.1.1.3.cmml">′</mo></msup><annotation-xml encoding="MathML-Content" id="S4.T4.18.m8.1c"><apply id="S4.T4.18.m8.1.1.cmml" xref="S4.T4.18.m8.1.1"><csymbol cd="ambiguous" id="S4.T4.18.m8.1.1.1.cmml" xref="S4.T4.18.m8.1.1">superscript</csymbol><ci id="S4.T4.18.m8.1.1.2.cmml" xref="S4.T4.18.m8.1.1.2">𝑘</ci><ci id="S4.T4.18.m8.1.1.3.cmml" xref="S4.T4.18.m8.1.1.3">′</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.T4.18.m8.1d">k^{\prime}</annotation><annotation encoding="application/x-llamapun" id="S4.T4.18.m8.1e">italic_k start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT</annotation></semantics></math> that is much larger than <math alttext="k" class="ltx_Math" display="inline" id="S4.T4.19.m9.1"><semantics id="S4.T4.19.m9.1b"><mi id="S4.T4.19.m9.1.1" xref="S4.T4.19.m9.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="S4.T4.19.m9.1c"><ci id="S4.T4.19.m9.1.1.cmml" xref="S4.T4.19.m9.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.T4.19.m9.1d">k</annotation><annotation encoding="application/x-llamapun" id="S4.T4.19.m9.1e">italic_k</annotation></semantics></math> is critical in obtaining the top-<math alttext="k" class="ltx_Math" display="inline" id="S4.T4.20.m10.1"><semantics id="S4.T4.20.m10.1b"><mi id="S4.T4.20.m10.1.1" xref="S4.T4.20.m10.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="S4.T4.20.m10.1c"><ci id="S4.T4.20.m10.1.1.cmml" xref="S4.T4.20.m10.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.T4.20.m10.1d">k</annotation><annotation encoding="application/x-llamapun" id="S4.T4.20.m10.1e">italic_k</annotation></semantics></math> tokens correctly.</figcaption>
<table class="ltx_tabular ltx_centering ltx_align_middle" id="S4.T4.34">
<tr class="ltx_tr" id="S4.T4.27.7">
<td class="ltx_td ltx_align_center ltx_border_l ltx_border_r ltx_border_t" colspan="2" id="S4.T4.27.7.8">HiRE-LR for Softmax (r=25%)</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T4.21.1.1"><math alttext="k^{\prime}=\textrm{None}" class="ltx_Math" display="inline" id="S4.T4.21.1.1.m1.1"><semantics id="S4.T4.21.1.1.m1.1a"><mrow id="S4.T4.21.1.1.m1.1.1" xref="S4.T4.21.1.1.m1.1.1.cmml"><msup id="S4.T4.21.1.1.m1.1.1.2" xref="S4.T4.21.1.1.m1.1.1.2.cmml"><mi id="S4.T4.21.1.1.m1.1.1.2.2" xref="S4.T4.21.1.1.m1.1.1.2.2.cmml">k</mi><mo id="S4.T4.21.1.1.m1.1.1.2.3" xref="S4.T4.21.1.1.m1.1.1.2.3.cmml">′</mo></msup><mo id="S4.T4.21.1.1.m1.1.1.1" xref="S4.T4.21.1.1.m1.1.1.1.cmml">=</mo><mtext id="S4.T4.21.1.1.m1.1.1.3" xref="S4.T4.21.1.1.m1.1.1.3a.cmml">None</mtext></mrow><annotation-xml encoding="MathML-Content" id="S4.T4.21.1.1.m1.1b"><apply id="S4.T4.21.1.1.m1.1.1.cmml" xref="S4.T4.21.1.1.m1.1.1"><eq id="S4.T4.21.1.1.m1.1.1.1.cmml" xref="S4.T4.21.1.1.m1.1.1.1"></eq><apply id="S4.T4.21.1.1.m1.1.1.2.cmml" xref="S4.T4.21.1.1.m1.1.1.2"><csymbol cd="ambiguous" id="S4.T4.21.1.1.m1.1.1.2.1.cmml" xref="S4.T4.21.1.1.m1.1.1.2">superscript</csymbol><ci id="S4.T4.21.1.1.m1.1.1.2.2.cmml" xref="S4.T4.21.1.1.m1.1.1.2.2">𝑘</ci><ci id="S4.T4.21.1.1.m1.1.1.2.3.cmml" xref="S4.T4.21.1.1.m1.1.1.2.3">′</ci></apply><ci id="S4.T4.21.1.1.m1.1.1.3a.cmml" xref="S4.T4.21.1.1.m1.1.1.3"><mtext id="S4.T4.21.1.1.m1.1.1.3.cmml" xref="S4.T4.21.1.1.m1.1.1.3">None</mtext></ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.T4.21.1.1.m1.1c">k^{\prime}=\textrm{None}</annotation><annotation encoding="application/x-llamapun" id="S4.T4.21.1.1.m1.1d">italic_k start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT = None</annotation></semantics></math></td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T4.22.2.2"><math alttext="k^{\prime}=32" class="ltx_Math" display="inline" id="S4.T4.22.2.2.m1.1"><semantics id="S4.T4.22.2.2.m1.1a"><mrow id="S4.T4.22.2.2.m1.1.1" xref="S4.T4.22.2.2.m1.1.1.cmml"><msup id="S4.T4.22.2.2.m1.1.1.2" xref="S4.T4.22.2.2.m1.1.1.2.cmml"><mi id="S4.T4.22.2.2.m1.1.1.2.2" xref="S4.T4.22.2.2.m1.1.1.2.2.cmml">k</mi><mo id="S4.T4.22.2.2.m1.1.1.2.3" xref="S4.T4.22.2.2.m1.1.1.2.3.cmml">′</mo></msup><mo id="S4.T4.22.2.2.m1.1.1.1" xref="S4.T4.22.2.2.m1.1.1.1.cmml">=</mo><mn id="S4.T4.22.2.2.m1.1.1.3" xref="S4.T4.22.2.2.m1.1.1.3.cmml">32</mn></mrow><annotation-xml encoding="MathML-Content" id="S4.T4.22.2.2.m1.1b"><apply id="S4.T4.22.2.2.m1.1.1.cmml" xref="S4.T4.22.2.2.m1.1.1"><eq id="S4.T4.22.2.2.m1.1.1.1.cmml" xref="S4.T4.22.2.2.m1.1.1.1"></eq><apply id="S4.T4.22.2.2.m1.1.1.2.cmml" xref="S4.T4.22.2.2.m1.1.1.2"><csymbol cd="ambiguous" id="S4.T4.22.2.2.m1.1.1.2.1.cmml" xref="S4.T4.22.2.2.m1.1.1.2">superscript</csymbol><ci id="S4.T4.22.2.2.m1.1.1.2.2.cmml" xref="S4.T4.22.2.2.m1.1.1.2.2">𝑘</ci><ci id="S4.T4.22.2.2.m1.1.1.2.3.cmml" xref="S4.T4.22.2.2.m1.1.1.2.3">′</ci></apply><cn id="S4.T4.22.2.2.m1.1.1.3.cmml" type="integer" xref="S4.T4.22.2.2.m1.1.1.3">32</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.T4.22.2.2.m1.1c">k^{\prime}=32</annotation><annotation encoding="application/x-llamapun" id="S4.T4.22.2.2.m1.1d">italic_k start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT = 32</annotation></semantics></math></td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T4.23.3.3"><math alttext="k^{\prime}=64" class="ltx_Math" display="inline" id="S4.T4.23.3.3.m1.1"><semantics id="S4.T4.23.3.3.m1.1a"><mrow id="S4.T4.23.3.3.m1.1.1" xref="S4.T4.23.3.3.m1.1.1.cmml"><msup id="S4.T4.23.3.3.m1.1.1.2" xref="S4.T4.23.3.3.m1.1.1.2.cmml"><mi id="S4.T4.23.3.3.m1.1.1.2.2" xref="S4.T4.23.3.3.m1.1.1.2.2.cmml">k</mi><mo id="S4.T4.23.3.3.m1.1.1.2.3" xref="S4.T4.23.3.3.m1.1.1.2.3.cmml">′</mo></msup><mo id="S4.T4.23.3.3.m1.1.1.1" xref="S4.T4.23.3.3.m1.1.1.1.cmml">=</mo><mn id="S4.T4.23.3.3.m1.1.1.3" xref="S4.T4.23.3.3.m1.1.1.3.cmml">64</mn></mrow><annotation-xml encoding="MathML-Content" id="S4.T4.23.3.3.m1.1b"><apply id="S4.T4.23.3.3.m1.1.1.cmml" xref="S4.T4.23.3.3.m1.1.1"><eq id="S4.T4.23.3.3.m1.1.1.1.cmml" xref="S4.T4.23.3.3.m1.1.1.1"></eq><apply id="S4.T4.23.3.3.m1.1.1.2.cmml" xref="S4.T4.23.3.3.m1.1.1.2"><csymbol cd="ambiguous" id="S4.T4.23.3.3.m1.1.1.2.1.cmml" xref="S4.T4.23.3.3.m1.1.1.2">superscript</csymbol><ci id="S4.T4.23.3.3.m1.1.1.2.2.cmml" xref="S4.T4.23.3.3.m1.1.1.2.2">𝑘</ci><ci id="S4.T4.23.3.3.m1.1.1.2.3.cmml" xref="S4.T4.23.3.3.m1.1.1.2.3">′</ci></apply><cn id="S4.T4.23.3.3.m1.1.1.3.cmml" type="integer" xref="S4.T4.23.3.3.m1.1.1.3">64</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.T4.23.3.3.m1.1c">k^{\prime}=64</annotation><annotation encoding="application/x-llamapun" id="S4.T4.23.3.3.m1.1d">italic_k start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT = 64</annotation></semantics></math></td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T4.24.4.4"><math alttext="k^{\prime}=128" class="ltx_Math" display="inline" id="S4.T4.24.4.4.m1.1"><semantics id="S4.T4.24.4.4.m1.1a"><mrow id="S4.T4.24.4.4.m1.1.1" xref="S4.T4.24.4.4.m1.1.1.cmml"><msup id="S4.T4.24.4.4.m1.1.1.2" xref="S4.T4.24.4.4.m1.1.1.2.cmml"><mi id="S4.T4.24.4.4.m1.1.1.2.2" xref="S4.T4.24.4.4.m1.1.1.2.2.cmml">k</mi><mo id="S4.T4.24.4.4.m1.1.1.2.3" xref="S4.T4.24.4.4.m1.1.1.2.3.cmml">′</mo></msup><mo id="S4.T4.24.4.4.m1.1.1.1" xref="S4.T4.24.4.4.m1.1.1.1.cmml">=</mo><mn id="S4.T4.24.4.4.m1.1.1.3" xref="S4.T4.24.4.4.m1.1.1.3.cmml">128</mn></mrow><annotation-xml encoding="MathML-Content" id="S4.T4.24.4.4.m1.1b"><apply id="S4.T4.24.4.4.m1.1.1.cmml" xref="S4.T4.24.4.4.m1.1.1"><eq id="S4.T4.24.4.4.m1.1.1.1.cmml" xref="S4.T4.24.4.4.m1.1.1.1"></eq><apply id="S4.T4.24.4.4.m1.1.1.2.cmml" xref="S4.T4.24.4.4.m1.1.1.2"><csymbol cd="ambiguous" id="S4.T4.24.4.4.m1.1.1.2.1.cmml" xref="S4.T4.24.4.4.m1.1.1.2">superscript</csymbol><ci id="S4.T4.24.4.4.m1.1.1.2.2.cmml" xref="S4.T4.24.4.4.m1.1.1.2.2">𝑘</ci><ci id="S4.T4.24.4.4.m1.1.1.2.3.cmml" xref="S4.T4.24.4.4.m1.1.1.2.3">′</ci></apply><cn id="S4.T4.24.4.4.m1.1.1.3.cmml" type="integer" xref="S4.T4.24.4.4.m1.1.1.3">128</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.T4.24.4.4.m1.1c">k^{\prime}=128</annotation><annotation encoding="application/x-llamapun" id="S4.T4.24.4.4.m1.1d">italic_k start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT = 128</annotation></semantics></math></td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T4.25.5.5"><math alttext="k^{\prime}=256" class="ltx_Math" display="inline" id="S4.T4.25.5.5.m1.1"><semantics id="S4.T4.25.5.5.m1.1a"><mrow id="S4.T4.25.5.5.m1.1.1" xref="S4.T4.25.5.5.m1.1.1.cmml"><msup id="S4.T4.25.5.5.m1.1.1.2" xref="S4.T4.25.5.5.m1.1.1.2.cmml"><mi id="S4.T4.25.5.5.m1.1.1.2.2" xref="S4.T4.25.5.5.m1.1.1.2.2.cmml">k</mi><mo id="S4.T4.25.5.5.m1.1.1.2.3" xref="S4.T4.25.5.5.m1.1.1.2.3.cmml">′</mo></msup><mo id="S4.T4.25.5.5.m1.1.1.1" xref="S4.T4.25.5.5.m1.1.1.1.cmml">=</mo><mn id="S4.T4.25.5.5.m1.1.1.3" xref="S4.T4.25.5.5.m1.1.1.3.cmml">256</mn></mrow><annotation-xml encoding="MathML-Content" id="S4.T4.25.5.5.m1.1b"><apply id="S4.T4.25.5.5.m1.1.1.cmml" xref="S4.T4.25.5.5.m1.1.1"><eq id="S4.T4.25.5.5.m1.1.1.1.cmml" xref="S4.T4.25.5.5.m1.1.1.1"></eq><apply id="S4.T4.25.5.5.m1.1.1.2.cmml" xref="S4.T4.25.5.5.m1.1.1.2"><csymbol cd="ambiguous" id="S4.T4.25.5.5.m1.1.1.2.1.cmml" xref="S4.T4.25.5.5.m1.1.1.2">superscript</csymbol><ci id="S4.T4.25.5.5.m1.1.1.2.2.cmml" xref="S4.T4.25.5.5.m1.1.1.2.2">𝑘</ci><ci id="S4.T4.25.5.5.m1.1.1.2.3.cmml" xref="S4.T4.25.5.5.m1.1.1.2.3">′</ci></apply><cn id="S4.T4.25.5.5.m1.1.1.3.cmml" type="integer" xref="S4.T4.25.5.5.m1.1.1.3">256</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.T4.25.5.5.m1.1c">k^{\prime}=256</annotation><annotation encoding="application/x-llamapun" id="S4.T4.25.5.5.m1.1d">italic_k start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT = 256</annotation></semantics></math></td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T4.26.6.6"><math alttext="k^{\prime}=384" class="ltx_Math" display="inline" id="S4.T4.26.6.6.m1.1"><semantics id="S4.T4.26.6.6.m1.1a"><mrow id="S4.T4.26.6.6.m1.1.1" xref="S4.T4.26.6.6.m1.1.1.cmml"><msup id="S4.T4.26.6.6.m1.1.1.2" xref="S4.T4.26.6.6.m1.1.1.2.cmml"><mi id="S4.T4.26.6.6.m1.1.1.2.2" xref="S4.T4.26.6.6.m1.1.1.2.2.cmml">k</mi><mo id="S4.T4.26.6.6.m1.1.1.2.3" xref="S4.T4.26.6.6.m1.1.1.2.3.cmml">′</mo></msup><mo id="S4.T4.26.6.6.m1.1.1.1" xref="S4.T4.26.6.6.m1.1.1.1.cmml">=</mo><mn id="S4.T4.26.6.6.m1.1.1.3" xref="S4.T4.26.6.6.m1.1.1.3.cmml">384</mn></mrow><annotation-xml encoding="MathML-Content" id="S4.T4.26.6.6.m1.1b"><apply id="S4.T4.26.6.6.m1.1.1.cmml" xref="S4.T4.26.6.6.m1.1.1"><eq id="S4.T4.26.6.6.m1.1.1.1.cmml" xref="S4.T4.26.6.6.m1.1.1.1"></eq><apply id="S4.T4.26.6.6.m1.1.1.2.cmml" xref="S4.T4.26.6.6.m1.1.1.2"><csymbol cd="ambiguous" id="S4.T4.26.6.6.m1.1.1.2.1.cmml" xref="S4.T4.26.6.6.m1.1.1.2">superscript</csymbol><ci id="S4.T4.26.6.6.m1.1.1.2.2.cmml" xref="S4.T4.26.6.6.m1.1.1.2.2">𝑘</ci><ci id="S4.T4.26.6.6.m1.1.1.2.3.cmml" xref="S4.T4.26.6.6.m1.1.1.2.3">′</ci></apply><cn id="S4.T4.26.6.6.m1.1.1.3.cmml" type="integer" xref="S4.T4.26.6.6.m1.1.1.3">384</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.T4.26.6.6.m1.1c">k^{\prime}=384</annotation><annotation encoding="application/x-llamapun" id="S4.T4.26.6.6.m1.1d">italic_k start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT = 384</annotation></semantics></math></td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T4.27.7.7"><math alttext="k^{\prime}=512" class="ltx_Math" display="inline" id="S4.T4.27.7.7.m1.1"><semantics id="S4.T4.27.7.7.m1.1a"><mrow id="S4.T4.27.7.7.m1.1.1" xref="S4.T4.27.7.7.m1.1.1.cmml"><msup id="S4.T4.27.7.7.m1.1.1.2" xref="S4.T4.27.7.7.m1.1.1.2.cmml"><mi id="S4.T4.27.7.7.m1.1.1.2.2" xref="S4.T4.27.7.7.m1.1.1.2.2.cmml">k</mi><mo id="S4.T4.27.7.7.m1.1.1.2.3" xref="S4.T4.27.7.7.m1.1.1.2.3.cmml">′</mo></msup><mo id="S4.T4.27.7.7.m1.1.1.1" xref="S4.T4.27.7.7.m1.1.1.1.cmml">=</mo><mn id="S4.T4.27.7.7.m1.1.1.3" xref="S4.T4.27.7.7.m1.1.1.3.cmml">512</mn></mrow><annotation-xml encoding="MathML-Content" id="S4.T4.27.7.7.m1.1b"><apply id="S4.T4.27.7.7.m1.1.1.cmml" xref="S4.T4.27.7.7.m1.1.1"><eq id="S4.T4.27.7.7.m1.1.1.1.cmml" xref="S4.T4.27.7.7.m1.1.1.1"></eq><apply id="S4.T4.27.7.7.m1.1.1.2.cmml" xref="S4.T4.27.7.7.m1.1.1.2"><csymbol cd="ambiguous" id="S4.T4.27.7.7.m1.1.1.2.1.cmml" xref="S4.T4.27.7.7.m1.1.1.2">superscript</csymbol><ci id="S4.T4.27.7.7.m1.1.1.2.2.cmml" xref="S4.T4.27.7.7.m1.1.1.2.2">𝑘</ci><ci id="S4.T4.27.7.7.m1.1.1.2.3.cmml" xref="S4.T4.27.7.7.m1.1.1.2.3">′</ci></apply><cn id="S4.T4.27.7.7.m1.1.1.3.cmml" type="integer" xref="S4.T4.27.7.7.m1.1.1.3">512</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.T4.27.7.7.m1.1c">k^{\prime}=512</annotation><annotation encoding="application/x-llamapun" id="S4.T4.27.7.7.m1.1d">italic_k start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT = 512</annotation></semantics></math></td>
</tr>
<tr class="ltx_tr" id="S4.T4.34.15">
<td class="ltx_td ltx_align_center ltx_border_l ltx_border_r ltx_border_t" id="S4.T4.34.15.1" rowspan="2"><span class="ltx_text" id="S4.T4.34.15.1.1"><span class="ltx_text" id="S4.T4.34.15.1.1.1"></span> <span class="ltx_text" id="S4.T4.34.15.1.1.2">
<span class="ltx_tabular ltx_align_middle" id="S4.T4.34.15.1.1.2.1">
<span class="ltx_tr" id="S4.T4.34.15.1.1.2.1.1">
<span class="ltx_td ltx_align_center" id="S4.T4.34.15.1.1.2.1.1.1">Pre-training</span></span>
<span class="ltx_tr" id="S4.T4.34.15.1.1.2.1.2">
<span class="ltx_td ltx_align_center" id="S4.T4.34.15.1.1.2.1.2.1">Performance</span></span>
</span></span> <span class="ltx_text" id="S4.T4.34.15.1.1.3"></span></span></td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T4.34.15.2">Top1 Accuracy</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T4.34.15.3">51.87%</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T4.34.15.4">56.43%</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T4.34.15.5">56.63%</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T4.34.15.6">56.77%</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T4.34.15.7">56.86%</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T4.34.15.8">56.89%</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T4.34.15.9">56.92%</td>
</tr>
<tr class="ltx_tr" id="S4.T4.34.16">
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T4.34.16.1">Top32 Intersection</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T4.34.16.2">19.24</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T4.34.16.3">19.24</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T4.34.16.4">24.13</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T4.34.16.5">26.94</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T4.34.16.6">28.72</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T4.34.16.7">29.26</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T4.34.16.8">29.93</td>
</tr>
<tr class="ltx_tr" id="S4.T4.34.14">
<td class="ltx_td ltx_align_center ltx_border_l ltx_border_r ltx_border_tt" colspan="2" id="S4.T4.34.14.8">HiRE-Q for Softmax (int4)</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_tt" id="S4.T4.28.8.1"><math alttext="k^{\prime}=\textrm{None}" class="ltx_Math" display="inline" id="S4.T4.28.8.1.m1.1"><semantics id="S4.T4.28.8.1.m1.1a"><mrow id="S4.T4.28.8.1.m1.1.1" xref="S4.T4.28.8.1.m1.1.1.cmml"><msup id="S4.T4.28.8.1.m1.1.1.2" xref="S4.T4.28.8.1.m1.1.1.2.cmml"><mi id="S4.T4.28.8.1.m1.1.1.2.2" xref="S4.T4.28.8.1.m1.1.1.2.2.cmml">k</mi><mo id="S4.T4.28.8.1.m1.1.1.2.3" xref="S4.T4.28.8.1.m1.1.1.2.3.cmml">′</mo></msup><mo id="S4.T4.28.8.1.m1.1.1.1" xref="S4.T4.28.8.1.m1.1.1.1.cmml">=</mo><mtext id="S4.T4.28.8.1.m1.1.1.3" xref="S4.T4.28.8.1.m1.1.1.3a.cmml">None</mtext></mrow><annotation-xml encoding="MathML-Content" id="S4.T4.28.8.1.m1.1b"><apply id="S4.T4.28.8.1.m1.1.1.cmml" xref="S4.T4.28.8.1.m1.1.1"><eq id="S4.T4.28.8.1.m1.1.1.1.cmml" xref="S4.T4.28.8.1.m1.1.1.1"></eq><apply id="S4.T4.28.8.1.m1.1.1.2.cmml" xref="S4.T4.28.8.1.m1.1.1.2"><csymbol cd="ambiguous" id="S4.T4.28.8.1.m1.1.1.2.1.cmml" xref="S4.T4.28.8.1.m1.1.1.2">superscript</csymbol><ci id="S4.T4.28.8.1.m1.1.1.2.2.cmml" xref="S4.T4.28.8.1.m1.1.1.2.2">𝑘</ci><ci id="S4.T4.28.8.1.m1.1.1.2.3.cmml" xref="S4.T4.28.8.1.m1.1.1.2.3">′</ci></apply><ci id="S4.T4.28.8.1.m1.1.1.3a.cmml" xref="S4.T4.28.8.1.m1.1.1.3"><mtext id="S4.T4.28.8.1.m1.1.1.3.cmml" xref="S4.T4.28.8.1.m1.1.1.3">None</mtext></ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.T4.28.8.1.m1.1c">k^{\prime}=\textrm{None}</annotation><annotation encoding="application/x-llamapun" id="S4.T4.28.8.1.m1.1d">italic_k start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT = None</annotation></semantics></math></td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_tt" id="S4.T4.29.9.2"><math alttext="k^{\prime}=2" class="ltx_Math" display="inline" id="S4.T4.29.9.2.m1.1"><semantics id="S4.T4.29.9.2.m1.1a"><mrow id="S4.T4.29.9.2.m1.1.1" xref="S4.T4.29.9.2.m1.1.1.cmml"><msup id="S4.T4.29.9.2.m1.1.1.2" xref="S4.T4.29.9.2.m1.1.1.2.cmml"><mi id="S4.T4.29.9.2.m1.1.1.2.2" xref="S4.T4.29.9.2.m1.1.1.2.2.cmml">k</mi><mo id="S4.T4.29.9.2.m1.1.1.2.3" xref="S4.T4.29.9.2.m1.1.1.2.3.cmml">′</mo></msup><mo id="S4.T4.29.9.2.m1.1.1.1" xref="S4.T4.29.9.2.m1.1.1.1.cmml">=</mo><mn id="S4.T4.29.9.2.m1.1.1.3" xref="S4.T4.29.9.2.m1.1.1.3.cmml">2</mn></mrow><annotation-xml encoding="MathML-Content" id="S4.T4.29.9.2.m1.1b"><apply id="S4.T4.29.9.2.m1.1.1.cmml" xref="S4.T4.29.9.2.m1.1.1"><eq id="S4.T4.29.9.2.m1.1.1.1.cmml" xref="S4.T4.29.9.2.m1.1.1.1"></eq><apply id="S4.T4.29.9.2.m1.1.1.2.cmml" xref="S4.T4.29.9.2.m1.1.1.2"><csymbol cd="ambiguous" id="S4.T4.29.9.2.m1.1.1.2.1.cmml" xref="S4.T4.29.9.2.m1.1.1.2">superscript</csymbol><ci id="S4.T4.29.9.2.m1.1.1.2.2.cmml" xref="S4.T4.29.9.2.m1.1.1.2.2">𝑘</ci><ci id="S4.T4.29.9.2.m1.1.1.2.3.cmml" xref="S4.T4.29.9.2.m1.1.1.2.3">′</ci></apply><cn id="S4.T4.29.9.2.m1.1.1.3.cmml" type="integer" xref="S4.T4.29.9.2.m1.1.1.3">2</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.T4.29.9.2.m1.1c">k^{\prime}=2</annotation><annotation encoding="application/x-llamapun" id="S4.T4.29.9.2.m1.1d">italic_k start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT = 2</annotation></semantics></math></td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_tt" id="S4.T4.30.10.3"><math alttext="k^{\prime}=4" class="ltx_Math" display="inline" id="S4.T4.30.10.3.m1.1"><semantics id="S4.T4.30.10.3.m1.1a"><mrow id="S4.T4.30.10.3.m1.1.1" xref="S4.T4.30.10.3.m1.1.1.cmml"><msup id="S4.T4.30.10.3.m1.1.1.2" xref="S4.T4.30.10.3.m1.1.1.2.cmml"><mi id="S4.T4.30.10.3.m1.1.1.2.2" xref="S4.T4.30.10.3.m1.1.1.2.2.cmml">k</mi><mo id="S4.T4.30.10.3.m1.1.1.2.3" xref="S4.T4.30.10.3.m1.1.1.2.3.cmml">′</mo></msup><mo id="S4.T4.30.10.3.m1.1.1.1" xref="S4.T4.30.10.3.m1.1.1.1.cmml">=</mo><mn id="S4.T4.30.10.3.m1.1.1.3" xref="S4.T4.30.10.3.m1.1.1.3.cmml">4</mn></mrow><annotation-xml encoding="MathML-Content" id="S4.T4.30.10.3.m1.1b"><apply id="S4.T4.30.10.3.m1.1.1.cmml" xref="S4.T4.30.10.3.m1.1.1"><eq id="S4.T4.30.10.3.m1.1.1.1.cmml" xref="S4.T4.30.10.3.m1.1.1.1"></eq><apply id="S4.T4.30.10.3.m1.1.1.2.cmml" xref="S4.T4.30.10.3.m1.1.1.2"><csymbol cd="ambiguous" id="S4.T4.30.10.3.m1.1.1.2.1.cmml" xref="S4.T4.30.10.3.m1.1.1.2">superscript</csymbol><ci id="S4.T4.30.10.3.m1.1.1.2.2.cmml" xref="S4.T4.30.10.3.m1.1.1.2.2">𝑘</ci><ci id="S4.T4.30.10.3.m1.1.1.2.3.cmml" xref="S4.T4.30.10.3.m1.1.1.2.3">′</ci></apply><cn id="S4.T4.30.10.3.m1.1.1.3.cmml" type="integer" xref="S4.T4.30.10.3.m1.1.1.3">4</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.T4.30.10.3.m1.1c">k^{\prime}=4</annotation><annotation encoding="application/x-llamapun" id="S4.T4.30.10.3.m1.1d">italic_k start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT = 4</annotation></semantics></math></td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_tt" id="S4.T4.31.11.4"><math alttext="k^{\prime}=8" class="ltx_Math" display="inline" id="S4.T4.31.11.4.m1.1"><semantics id="S4.T4.31.11.4.m1.1a"><mrow id="S4.T4.31.11.4.m1.1.1" xref="S4.T4.31.11.4.m1.1.1.cmml"><msup id="S4.T4.31.11.4.m1.1.1.2" xref="S4.T4.31.11.4.m1.1.1.2.cmml"><mi id="S4.T4.31.11.4.m1.1.1.2.2" xref="S4.T4.31.11.4.m1.1.1.2.2.cmml">k</mi><mo id="S4.T4.31.11.4.m1.1.1.2.3" xref="S4.T4.31.11.4.m1.1.1.2.3.cmml">′</mo></msup><mo id="S4.T4.31.11.4.m1.1.1.1" xref="S4.T4.31.11.4.m1.1.1.1.cmml">=</mo><mn id="S4.T4.31.11.4.m1.1.1.3" xref="S4.T4.31.11.4.m1.1.1.3.cmml">8</mn></mrow><annotation-xml encoding="MathML-Content" id="S4.T4.31.11.4.m1.1b"><apply id="S4.T4.31.11.4.m1.1.1.cmml" xref="S4.T4.31.11.4.m1.1.1"><eq id="S4.T4.31.11.4.m1.1.1.1.cmml" xref="S4.T4.31.11.4.m1.1.1.1"></eq><apply id="S4.T4.31.11.4.m1.1.1.2.cmml" xref="S4.T4.31.11.4.m1.1.1.2"><csymbol cd="ambiguous" id="S4.T4.31.11.4.m1.1.1.2.1.cmml" xref="S4.T4.31.11.4.m1.1.1.2">superscript</csymbol><ci id="S4.T4.31.11.4.m1.1.1.2.2.cmml" xref="S4.T4.31.11.4.m1.1.1.2.2">𝑘</ci><ci id="S4.T4.31.11.4.m1.1.1.2.3.cmml" xref="S4.T4.31.11.4.m1.1.1.2.3">′</ci></apply><cn id="S4.T4.31.11.4.m1.1.1.3.cmml" type="integer" xref="S4.T4.31.11.4.m1.1.1.3">8</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.T4.31.11.4.m1.1c">k^{\prime}=8</annotation><annotation encoding="application/x-llamapun" id="S4.T4.31.11.4.m1.1d">italic_k start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT = 8</annotation></semantics></math></td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_tt" id="S4.T4.32.12.5"><math alttext="k^{\prime}=32" class="ltx_Math" display="inline" id="S4.T4.32.12.5.m1.1"><semantics id="S4.T4.32.12.5.m1.1a"><mrow id="S4.T4.32.12.5.m1.1.1" xref="S4.T4.32.12.5.m1.1.1.cmml"><msup id="S4.T4.32.12.5.m1.1.1.2" xref="S4.T4.32.12.5.m1.1.1.2.cmml"><mi id="S4.T4.32.12.5.m1.1.1.2.2" xref="S4.T4.32.12.5.m1.1.1.2.2.cmml">k</mi><mo id="S4.T4.32.12.5.m1.1.1.2.3" xref="S4.T4.32.12.5.m1.1.1.2.3.cmml">′</mo></msup><mo id="S4.T4.32.12.5.m1.1.1.1" xref="S4.T4.32.12.5.m1.1.1.1.cmml">=</mo><mn id="S4.T4.32.12.5.m1.1.1.3" xref="S4.T4.32.12.5.m1.1.1.3.cmml">32</mn></mrow><annotation-xml encoding="MathML-Content" id="S4.T4.32.12.5.m1.1b"><apply id="S4.T4.32.12.5.m1.1.1.cmml" xref="S4.T4.32.12.5.m1.1.1"><eq id="S4.T4.32.12.5.m1.1.1.1.cmml" xref="S4.T4.32.12.5.m1.1.1.1"></eq><apply id="S4.T4.32.12.5.m1.1.1.2.cmml" xref="S4.T4.32.12.5.m1.1.1.2"><csymbol cd="ambiguous" id="S4.T4.32.12.5.m1.1.1.2.1.cmml" xref="S4.T4.32.12.5.m1.1.1.2">superscript</csymbol><ci id="S4.T4.32.12.5.m1.1.1.2.2.cmml" xref="S4.T4.32.12.5.m1.1.1.2.2">𝑘</ci><ci id="S4.T4.32.12.5.m1.1.1.2.3.cmml" xref="S4.T4.32.12.5.m1.1.1.2.3">′</ci></apply><cn id="S4.T4.32.12.5.m1.1.1.3.cmml" type="integer" xref="S4.T4.32.12.5.m1.1.1.3">32</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.T4.32.12.5.m1.1c">k^{\prime}=32</annotation><annotation encoding="application/x-llamapun" id="S4.T4.32.12.5.m1.1d">italic_k start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT = 32</annotation></semantics></math></td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_tt" id="S4.T4.33.13.6"><math alttext="k^{\prime}=64" class="ltx_Math" display="inline" id="S4.T4.33.13.6.m1.1"><semantics id="S4.T4.33.13.6.m1.1a"><mrow id="S4.T4.33.13.6.m1.1.1" xref="S4.T4.33.13.6.m1.1.1.cmml"><msup id="S4.T4.33.13.6.m1.1.1.2" xref="S4.T4.33.13.6.m1.1.1.2.cmml"><mi id="S4.T4.33.13.6.m1.1.1.2.2" xref="S4.T4.33.13.6.m1.1.1.2.2.cmml">k</mi><mo id="S4.T4.33.13.6.m1.1.1.2.3" xref="S4.T4.33.13.6.m1.1.1.2.3.cmml">′</mo></msup><mo id="S4.T4.33.13.6.m1.1.1.1" xref="S4.T4.33.13.6.m1.1.1.1.cmml">=</mo><mn id="S4.T4.33.13.6.m1.1.1.3" xref="S4.T4.33.13.6.m1.1.1.3.cmml">64</mn></mrow><annotation-xml encoding="MathML-Content" id="S4.T4.33.13.6.m1.1b"><apply id="S4.T4.33.13.6.m1.1.1.cmml" xref="S4.T4.33.13.6.m1.1.1"><eq id="S4.T4.33.13.6.m1.1.1.1.cmml" xref="S4.T4.33.13.6.m1.1.1.1"></eq><apply id="S4.T4.33.13.6.m1.1.1.2.cmml" xref="S4.T4.33.13.6.m1.1.1.2"><csymbol cd="ambiguous" id="S4.T4.33.13.6.m1.1.1.2.1.cmml" xref="S4.T4.33.13.6.m1.1.1.2">superscript</csymbol><ci id="S4.T4.33.13.6.m1.1.1.2.2.cmml" xref="S4.T4.33.13.6.m1.1.1.2.2">𝑘</ci><ci id="S4.T4.33.13.6.m1.1.1.2.3.cmml" xref="S4.T4.33.13.6.m1.1.1.2.3">′</ci></apply><cn id="S4.T4.33.13.6.m1.1.1.3.cmml" type="integer" xref="S4.T4.33.13.6.m1.1.1.3">64</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.T4.33.13.6.m1.1c">k^{\prime}=64</annotation><annotation encoding="application/x-llamapun" id="S4.T4.33.13.6.m1.1d">italic_k start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT = 64</annotation></semantics></math></td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_tt" id="S4.T4.34.14.7"><math alttext="k^{\prime}=128" class="ltx_Math" display="inline" id="S4.T4.34.14.7.m1.1"><semantics id="S4.T4.34.14.7.m1.1a"><mrow id="S4.T4.34.14.7.m1.1.1" xref="S4.T4.34.14.7.m1.1.1.cmml"><msup id="S4.T4.34.14.7.m1.1.1.2" xref="S4.T4.34.14.7.m1.1.1.2.cmml"><mi id="S4.T4.34.14.7.m1.1.1.2.2" xref="S4.T4.34.14.7.m1.1.1.2.2.cmml">k</mi><mo id="S4.T4.34.14.7.m1.1.1.2.3" xref="S4.T4.34.14.7.m1.1.1.2.3.cmml">′</mo></msup><mo id="S4.T4.34.14.7.m1.1.1.1" xref="S4.T4.34.14.7.m1.1.1.1.cmml">=</mo><mn id="S4.T4.34.14.7.m1.1.1.3" xref="S4.T4.34.14.7.m1.1.1.3.cmml">128</mn></mrow><annotation-xml encoding="MathML-Content" id="S4.T4.34.14.7.m1.1b"><apply id="S4.T4.34.14.7.m1.1.1.cmml" xref="S4.T4.34.14.7.m1.1.1"><eq id="S4.T4.34.14.7.m1.1.1.1.cmml" xref="S4.T4.34.14.7.m1.1.1.1"></eq><apply id="S4.T4.34.14.7.m1.1.1.2.cmml" xref="S4.T4.34.14.7.m1.1.1.2"><csymbol cd="ambiguous" id="S4.T4.34.14.7.m1.1.1.2.1.cmml" xref="S4.T4.34.14.7.m1.1.1.2">superscript</csymbol><ci id="S4.T4.34.14.7.m1.1.1.2.2.cmml" xref="S4.T4.34.14.7.m1.1.1.2.2">𝑘</ci><ci id="S4.T4.34.14.7.m1.1.1.2.3.cmml" xref="S4.T4.34.14.7.m1.1.1.2.3">′</ci></apply><cn id="S4.T4.34.14.7.m1.1.1.3.cmml" type="integer" xref="S4.T4.34.14.7.m1.1.1.3">128</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.T4.34.14.7.m1.1c">k^{\prime}=128</annotation><annotation encoding="application/x-llamapun" id="S4.T4.34.14.7.m1.1d">italic_k start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT = 128</annotation></semantics></math></td>
</tr>
<tr class="ltx_tr" id="S4.T4.34.17">
<td class="ltx_td ltx_align_center ltx_border_b ltx_border_l ltx_border_r ltx_border_t" id="S4.T4.34.17.1" rowspan="2"><span class="ltx_text" id="S4.T4.34.17.1.1"><span class="ltx_text" id="S4.T4.34.17.1.1.1"></span> <span class="ltx_text" id="S4.T4.34.17.1.1.2">
<span class="ltx_tabular ltx_align_middle" id="S4.T4.34.17.1.1.2.1">
<span class="ltx_tr" id="S4.T4.34.17.1.1.2.1.1">
<span class="ltx_td ltx_align_center" id="S4.T4.34.17.1.1.2.1.1.1">Pre-training</span></span>
<span class="ltx_tr" id="S4.T4.34.17.1.1.2.1.2">
<span class="ltx_td ltx_align_center" id="S4.T4.34.17.1.1.2.1.2.1">Performance</span></span>
</span></span> <span class="ltx_text" id="S4.T4.34.17.1.1.3"></span></span></td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T4.34.17.2">Top1 Accuracy</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T4.34.17.3">55.94%</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T4.34.17.4">56.76%</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T4.34.17.5">56.94%</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T4.34.17.6">56.98%</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T4.34.17.7">56.99%</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T4.34.17.8">56.99%</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T4.34.17.9">56.99%</td>
</tr>
<tr class="ltx_tr" id="S4.T4.34.18">
<td class="ltx_td ltx_align_center ltx_border_b ltx_border_r ltx_border_t" id="S4.T4.34.18.1">Top32 Intersection</td>
<td class="ltx_td ltx_align_center ltx_border_b ltx_border_r ltx_border_t" id="S4.T4.34.18.2">27.68</td>
<td class="ltx_td ltx_align_center ltx_border_b ltx_border_r ltx_border_t" id="S4.T4.34.18.3">1.98</td>
<td class="ltx_td ltx_align_center ltx_border_b ltx_border_r ltx_border_t" id="S4.T4.34.18.4">3.96</td>
<td class="ltx_td ltx_align_center ltx_border_b ltx_border_r ltx_border_t" id="S4.T4.34.18.5">7.90</td>
<td class="ltx_td ltx_align_center ltx_border_b ltx_border_r ltx_border_t" id="S4.T4.34.18.6">27.68</td>
<td class="ltx_td ltx_align_center ltx_border_b ltx_border_r ltx_border_t" id="S4.T4.34.18.7">30.86</td>
<td class="ltx_td ltx_align_center ltx_border_b ltx_border_r ltx_border_t" id="S4.T4.34.18.8">31.30</td>
</tr>
</table>
</figure>
<div class="ltx_para" id="S4.SS3.p5">
<p class="ltx_p" id="S4.SS3.p5.11">Consider Algorithm <a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#alg1" title="Algorithm 1 ‣ 3.2.1 Solving equation 5 accurately and efficiently ‣ 3.2 HiRE: Overall Approach ‣ 3 Main Ideas ‣ HiRE: High Recall Approximate Top-𝑘 Estimation for Efficient LLM Inference"><span class="ltx_text ltx_ref_tag">1</span></a> and equation <a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#S3.E5" title="5 ‣ 3.1 Problem Setup ‣ 3 Main Ideas ‣ HiRE: High Recall Approximate Top-𝑘 Estimation for Efficient LLM Inference"><span class="ltx_text ltx_ref_tag">5</span></a>. We define Recall as the intersection between the set of elements, <math alttext="S^{\prime}" class="ltx_Math" display="inline" id="S4.SS3.p5.1.m1.1"><semantics id="S4.SS3.p5.1.m1.1a"><msup id="S4.SS3.p5.1.m1.1.1" xref="S4.SS3.p5.1.m1.1.1.cmml"><mi id="S4.SS3.p5.1.m1.1.1.2" xref="S4.SS3.p5.1.m1.1.1.2.cmml">S</mi><mo id="S4.SS3.p5.1.m1.1.1.3" xref="S4.SS3.p5.1.m1.1.1.3.cmml">′</mo></msup><annotation-xml encoding="MathML-Content" id="S4.SS3.p5.1.m1.1b"><apply id="S4.SS3.p5.1.m1.1.1.cmml" xref="S4.SS3.p5.1.m1.1.1"><csymbol cd="ambiguous" id="S4.SS3.p5.1.m1.1.1.1.cmml" xref="S4.SS3.p5.1.m1.1.1">superscript</csymbol><ci id="S4.SS3.p5.1.m1.1.1.2.cmml" xref="S4.SS3.p5.1.m1.1.1.2">𝑆</ci><ci id="S4.SS3.p5.1.m1.1.1.3.cmml" xref="S4.SS3.p5.1.m1.1.1.3">′</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS3.p5.1.m1.1c">S^{\prime}</annotation><annotation encoding="application/x-llamapun" id="S4.SS3.p5.1.m1.1d">italic_S start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT</annotation></semantics></math> computed using <math alttext="{\mathbf{Z}_{\textrm{approx}}}" class="ltx_Math" display="inline" id="S4.SS3.p5.2.m2.1"><semantics id="S4.SS3.p5.2.m2.1a"><msub id="S4.SS3.p5.2.m2.1.1" xref="S4.SS3.p5.2.m2.1.1.cmml"><mi id="S4.SS3.p5.2.m2.1.1.2" xref="S4.SS3.p5.2.m2.1.1.2.cmml">𝐙</mi><mtext id="S4.SS3.p5.2.m2.1.1.3" xref="S4.SS3.p5.2.m2.1.1.3a.cmml">approx</mtext></msub><annotation-xml encoding="MathML-Content" id="S4.SS3.p5.2.m2.1b"><apply id="S4.SS3.p5.2.m2.1.1.cmml" xref="S4.SS3.p5.2.m2.1.1"><csymbol cd="ambiguous" id="S4.SS3.p5.2.m2.1.1.1.cmml" xref="S4.SS3.p5.2.m2.1.1">subscript</csymbol><ci id="S4.SS3.p5.2.m2.1.1.2.cmml" xref="S4.SS3.p5.2.m2.1.1.2">𝐙</ci><ci id="S4.SS3.p5.2.m2.1.1.3a.cmml" xref="S4.SS3.p5.2.m2.1.1.3"><mtext id="S4.SS3.p5.2.m2.1.1.3.cmml" mathsize="70%" xref="S4.SS3.p5.2.m2.1.1.3">approx</mtext></ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS3.p5.2.m2.1c">{\mathbf{Z}_{\textrm{approx}}}</annotation><annotation encoding="application/x-llamapun" id="S4.SS3.p5.2.m2.1d">bold_Z start_POSTSUBSCRIPT approx end_POSTSUBSCRIPT</annotation></semantics></math> matrix and <math alttext="S" class="ltx_Math" display="inline" id="S4.SS3.p5.3.m3.1"><semantics id="S4.SS3.p5.3.m3.1a"><mi id="S4.SS3.p5.3.m3.1.1" xref="S4.SS3.p5.3.m3.1.1.cmml">S</mi><annotation-xml encoding="MathML-Content" id="S4.SS3.p5.3.m3.1b"><ci id="S4.SS3.p5.3.m3.1.1.cmml" xref="S4.SS3.p5.3.m3.1.1">𝑆</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.SS3.p5.3.m3.1c">S</annotation><annotation encoding="application/x-llamapun" id="S4.SS3.p5.3.m3.1d">italic_S</annotation></semantics></math> using <math alttext="{\mathbf{Z}}" class="ltx_Math" display="inline" id="S4.SS3.p5.4.m4.1"><semantics id="S4.SS3.p5.4.m4.1a"><mi id="S4.SS3.p5.4.m4.1.1" xref="S4.SS3.p5.4.m4.1.1.cmml">𝐙</mi><annotation-xml encoding="MathML-Content" id="S4.SS3.p5.4.m4.1b"><ci id="S4.SS3.p5.4.m4.1.1.cmml" xref="S4.SS3.p5.4.m4.1.1">𝐙</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.SS3.p5.4.m4.1c">{\mathbf{Z}}</annotation><annotation encoding="application/x-llamapun" id="S4.SS3.p5.4.m4.1d">bold_Z</annotation></semantics></math> matrix. In case of Softmax, we compute the intersection between <math alttext="S^{\prime}" class="ltx_Math" display="inline" id="S4.SS3.p5.5.m5.1"><semantics id="S4.SS3.p5.5.m5.1a"><msup id="S4.SS3.p5.5.m5.1.1" xref="S4.SS3.p5.5.m5.1.1.cmml"><mi id="S4.SS3.p5.5.m5.1.1.2" xref="S4.SS3.p5.5.m5.1.1.2.cmml">S</mi><mo id="S4.SS3.p5.5.m5.1.1.3" xref="S4.SS3.p5.5.m5.1.1.3.cmml">′</mo></msup><annotation-xml encoding="MathML-Content" id="S4.SS3.p5.5.m5.1b"><apply id="S4.SS3.p5.5.m5.1.1.cmml" xref="S4.SS3.p5.5.m5.1.1"><csymbol cd="ambiguous" id="S4.SS3.p5.5.m5.1.1.1.cmml" xref="S4.SS3.p5.5.m5.1.1">superscript</csymbol><ci id="S4.SS3.p5.5.m5.1.1.2.cmml" xref="S4.SS3.p5.5.m5.1.1.2">𝑆</ci><ci id="S4.SS3.p5.5.m5.1.1.3.cmml" xref="S4.SS3.p5.5.m5.1.1.3">′</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS3.p5.5.m5.1c">S^{\prime}</annotation><annotation encoding="application/x-llamapun" id="S4.SS3.p5.5.m5.1d">italic_S start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT</annotation></semantics></math> and <math alttext="S" class="ltx_Math" display="inline" id="S4.SS3.p5.6.m6.1"><semantics id="S4.SS3.p5.6.m6.1a"><mi id="S4.SS3.p5.6.m6.1.1" xref="S4.SS3.p5.6.m6.1.1.cmml">S</mi><annotation-xml encoding="MathML-Content" id="S4.SS3.p5.6.m6.1b"><ci id="S4.SS3.p5.6.m6.1.1.cmml" xref="S4.SS3.p5.6.m6.1.1">𝑆</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.SS3.p5.6.m6.1c">S</annotation><annotation encoding="application/x-llamapun" id="S4.SS3.p5.6.m6.1d">italic_S</annotation></semantics></math> for both HiRE-LR and HiRE-Q in Table <a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#S4.T4" title="Table 4 ‣ 4.3 Results ‣ 4 Experiments ‣ HiRE: High Recall Approximate Top-𝑘 Estimation for Efficient LLM Inference"><span class="ltx_text ltx_ref_tag">4</span></a>. We see a systematic increase of recall with increase in <math alttext="k^{\prime}" class="ltx_Math" display="inline" id="S4.SS3.p5.7.m7.1"><semantics id="S4.SS3.p5.7.m7.1a"><msup id="S4.SS3.p5.7.m7.1.1" xref="S4.SS3.p5.7.m7.1.1.cmml"><mi id="S4.SS3.p5.7.m7.1.1.2" xref="S4.SS3.p5.7.m7.1.1.2.cmml">k</mi><mo id="S4.SS3.p5.7.m7.1.1.3" xref="S4.SS3.p5.7.m7.1.1.3.cmml">′</mo></msup><annotation-xml encoding="MathML-Content" id="S4.SS3.p5.7.m7.1b"><apply id="S4.SS3.p5.7.m7.1.1.cmml" xref="S4.SS3.p5.7.m7.1.1"><csymbol cd="ambiguous" id="S4.SS3.p5.7.m7.1.1.1.cmml" xref="S4.SS3.p5.7.m7.1.1">superscript</csymbol><ci id="S4.SS3.p5.7.m7.1.1.2.cmml" xref="S4.SS3.p5.7.m7.1.1.2">𝑘</ci><ci id="S4.SS3.p5.7.m7.1.1.3.cmml" xref="S4.SS3.p5.7.m7.1.1.3">′</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS3.p5.7.m7.1c">k^{\prime}</annotation><annotation encoding="application/x-llamapun" id="S4.SS3.p5.7.m7.1d">italic_k start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT</annotation></semantics></math> of the algorithm.
In case of <math alttext="\mathcal{M}_{\textrm{ffn}}" class="ltx_Math" display="inline" id="S4.SS3.p5.8.m8.1"><semantics id="S4.SS3.p5.8.m8.1a"><msub id="S4.SS3.p5.8.m8.1.1" xref="S4.SS3.p5.8.m8.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S4.SS3.p5.8.m8.1.1.2" xref="S4.SS3.p5.8.m8.1.1.2.cmml">ℳ</mi><mtext id="S4.SS3.p5.8.m8.1.1.3" xref="S4.SS3.p5.8.m8.1.1.3a.cmml">ffn</mtext></msub><annotation-xml encoding="MathML-Content" id="S4.SS3.p5.8.m8.1b"><apply id="S4.SS3.p5.8.m8.1.1.cmml" xref="S4.SS3.p5.8.m8.1.1"><csymbol cd="ambiguous" id="S4.SS3.p5.8.m8.1.1.1.cmml" xref="S4.SS3.p5.8.m8.1.1">subscript</csymbol><ci id="S4.SS3.p5.8.m8.1.1.2.cmml" xref="S4.SS3.p5.8.m8.1.1.2">ℳ</ci><ci id="S4.SS3.p5.8.m8.1.1.3a.cmml" xref="S4.SS3.p5.8.m8.1.1.3"><mtext id="S4.SS3.p5.8.m8.1.1.3.cmml" mathsize="70%" xref="S4.SS3.p5.8.m8.1.1.3">ffn</mtext></ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS3.p5.8.m8.1c">\mathcal{M}_{\textrm{ffn}}</annotation><annotation encoding="application/x-llamapun" id="S4.SS3.p5.8.m8.1d">caligraphic_M start_POSTSUBSCRIPT ffn end_POSTSUBSCRIPT</annotation></semantics></math>, we evaluate models with different (<math alttext="k^{\prime}" class="ltx_Math" display="inline" id="S4.SS3.p5.9.m9.1"><semantics id="S4.SS3.p5.9.m9.1a"><msup id="S4.SS3.p5.9.m9.1.1" xref="S4.SS3.p5.9.m9.1.1.cmml"><mi id="S4.SS3.p5.9.m9.1.1.2" xref="S4.SS3.p5.9.m9.1.1.2.cmml">k</mi><mo id="S4.SS3.p5.9.m9.1.1.3" xref="S4.SS3.p5.9.m9.1.1.3.cmml">′</mo></msup><annotation-xml encoding="MathML-Content" id="S4.SS3.p5.9.m9.1b"><apply id="S4.SS3.p5.9.m9.1.1.cmml" xref="S4.SS3.p5.9.m9.1.1"><csymbol cd="ambiguous" id="S4.SS3.p5.9.m9.1.1.1.cmml" xref="S4.SS3.p5.9.m9.1.1">superscript</csymbol><ci id="S4.SS3.p5.9.m9.1.1.2.cmml" xref="S4.SS3.p5.9.m9.1.1.2">𝑘</ci><ci id="S4.SS3.p5.9.m9.1.1.3.cmml" xref="S4.SS3.p5.9.m9.1.1.3">′</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS3.p5.9.m9.1c">k^{\prime}</annotation><annotation encoding="application/x-llamapun" id="S4.SS3.p5.9.m9.1d">italic_k start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT</annotation></semantics></math>, <math alttext="k" class="ltx_Math" display="inline" id="S4.SS3.p5.10.m10.1"><semantics id="S4.SS3.p5.10.m10.1a"><mi id="S4.SS3.p5.10.m10.1.1" xref="S4.SS3.p5.10.m10.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="S4.SS3.p5.10.m10.1b"><ci id="S4.SS3.p5.10.m10.1.1.cmml" xref="S4.SS3.p5.10.m10.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.SS3.p5.10.m10.1c">k</annotation><annotation encoding="application/x-llamapun" id="S4.SS3.p5.10.m10.1d">italic_k</annotation></semantics></math>) pairs to study the importance of high <em class="ltx_emph ltx_font_italic" id="S4.SS3.p5.11.1">recall</em> in pretraining metrics.
From Table <a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#A2.T6" title="Table 6 ‣ Appendix B Additional Results ‣ HiRE: High Recall Approximate Top-𝑘 Estimation for Efficient LLM Inference"><span class="ltx_text ltx_ref_tag">6</span></a>, we observe that, as we increase <math alttext="k^{\prime}" class="ltx_Math" display="inline" id="S4.SS3.p5.11.m11.1"><semantics id="S4.SS3.p5.11.m11.1a"><msup id="S4.SS3.p5.11.m11.1.1" xref="S4.SS3.p5.11.m11.1.1.cmml"><mi id="S4.SS3.p5.11.m11.1.1.2" xref="S4.SS3.p5.11.m11.1.1.2.cmml">k</mi><mo id="S4.SS3.p5.11.m11.1.1.3" xref="S4.SS3.p5.11.m11.1.1.3.cmml">′</mo></msup><annotation-xml encoding="MathML-Content" id="S4.SS3.p5.11.m11.1b"><apply id="S4.SS3.p5.11.m11.1.1.cmml" xref="S4.SS3.p5.11.m11.1.1"><csymbol cd="ambiguous" id="S4.SS3.p5.11.m11.1.1.1.cmml" xref="S4.SS3.p5.11.m11.1.1">superscript</csymbol><ci id="S4.SS3.p5.11.m11.1.1.2.cmml" xref="S4.SS3.p5.11.m11.1.1.2">𝑘</ci><ci id="S4.SS3.p5.11.m11.1.1.3.cmml" xref="S4.SS3.p5.11.m11.1.1.3">′</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS3.p5.11.m11.1c">k^{\prime}</annotation><annotation encoding="application/x-llamapun" id="S4.SS3.p5.11.m11.1d">italic_k start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT</annotation></semantics></math>, the model shows an improvement, further signifying the importance of high recall.
</p>
</div>
<div class="ltx_para" id="S4.SS3.p6">
<p class="ltx_p" id="S4.SS3.p6.1"><span class="ltx_text ltx_font_bold" id="S4.SS3.p6.1.1">Importance of learned projections in </span>HiRE<span class="ltx_text ltx_font_bold" id="S4.SS3.p6.1.2">-</span>LR: While HiRE-Q is much easier to implement since it does not require any training, the potential for gains is limited due to the inherent nature of quantization. On the other hand, HiRE-LR has the potential to deliver larger latency improvements, but requires retraining as discussed in Section <a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#S4.SS1" title="4.1 Training details ‣ 4 Experiments ‣ HiRE: High Recall Approximate Top-𝑘 Estimation for Efficient LLM Inference"><span class="ltx_text ltx_ref_tag">4.1</span></a>. In this section, we explore whether random projections can be directly used instead of learning them. Table <a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#A2.T7" title="Table 7 ‣ Appendix B Additional Results ‣ HiRE: High Recall Approximate Top-𝑘 Estimation for Efficient LLM Inference"><span class="ltx_text ltx_ref_tag">7</span></a> in Appendix <a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#A2" title="Appendix B Additional Results ‣ HiRE: High Recall Approximate Top-𝑘 Estimation for Efficient LLM Inference"><span class="ltx_text ltx_ref_tag">B</span></a> demonstrates that random projections can lead to as much as <math alttext="10\%" class="ltx_Math" display="inline" id="S4.SS3.p6.1.m1.1"><semantics id="S4.SS3.p6.1.m1.1a"><mrow id="S4.SS3.p6.1.m1.1.1" xref="S4.SS3.p6.1.m1.1.1.cmml"><mn id="S4.SS3.p6.1.m1.1.1.2" xref="S4.SS3.p6.1.m1.1.1.2.cmml">10</mn><mo id="S4.SS3.p6.1.m1.1.1.1" xref="S4.SS3.p6.1.m1.1.1.1.cmml">%</mo></mrow><annotation-xml encoding="MathML-Content" id="S4.SS3.p6.1.m1.1b"><apply id="S4.SS3.p6.1.m1.1.1.cmml" xref="S4.SS3.p6.1.m1.1.1"><csymbol cd="latexml" id="S4.SS3.p6.1.m1.1.1.1.cmml" xref="S4.SS3.p6.1.m1.1.1.1">percent</csymbol><cn id="S4.SS3.p6.1.m1.1.1.2.cmml" type="integer" xref="S4.SS3.p6.1.m1.1.1.2">10</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS3.p6.1.m1.1c">10\%</annotation><annotation encoding="application/x-llamapun" id="S4.SS3.p6.1.m1.1d">10 %</annotation></semantics></math> reduction in downstream evaluation accuracy at similar rank justifying our approach of learned low-rank projections.</p>
</div>
<div class="ltx_para" id="S4.SS3.p7">
<p class="ltx_p" id="S4.SS3.p7.1"><span class="ltx_text ltx_font_bold" id="S4.SS3.p7.1.1">Location of sparse layers</span>: In all the results so far, we have modified only the odd FFN layers to be sparse (equation <a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#S3.E6" title="6 ‣ 3.4 HiRE-FFN: Efficient FFN using HiRE ‣ 3 Main Ideas ‣ HiRE: High Recall Approximate Top-𝑘 Estimation for Efficient LLM Inference"><span class="ltx_text ltx_ref_tag">6</span></a>), while the remaining were dense (equation <a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#S3.E3" title="3 ‣ 3.1 Problem Setup ‣ 3 Main Ideas ‣ HiRE: High Recall Approximate Top-𝑘 Estimation for Efficient LLM Inference"><span class="ltx_text ltx_ref_tag">3</span></a>). In Table <a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#A2.T8" title="Table 8 ‣ Appendix B Additional Results ‣ HiRE: High Recall Approximate Top-𝑘 Estimation for Efficient LLM Inference"><span class="ltx_text ltx_ref_tag">8</span></a>, we present results for different choices of sparse layers, which demonstrate that modifying all the layers to be sparse leads to substantial drop in accuracy, and the location of sparse layers makes an effect on the overall accuracy. It is interesting to identify the optimal selection of sparse layers.</p>
</div>
<figure class="ltx_table" id="S4.T5">
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_table">Table 5: </span>Commonpath Experimental Results: Static sparsity denotes the percentage of feedforward neurons used by all tokens i.e. commonpath while Adaptive Sparsity denotes the percentage of neurons activated by feedforward neurons not in commonpath.</figcaption>
<div class="ltx_inline-block ltx_align_center ltx_transformed_outer" id="S4.T5.3" style="width:433.6pt;height:288.1pt;vertical-align:-0.0pt;"><span class="ltx_transformed_inner" style="transform:translate(81.4pt,-54.1pt) scale(1.60056250599485,1.60056250599485) ;">
<table class="ltx_tabular ltx_align_middle" id="S4.T5.3.3">
<tr class="ltx_tr" id="S4.T5.3.3.4">
<td class="ltx_td ltx_border_l ltx_border_r ltx_border_t" colspan="2" id="S4.T5.3.3.4.1"></td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T5.3.3.4.2">Baseline</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T5.3.3.4.3">Sparse</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T5.3.3.4.4">CommonPath</td>
</tr>
<tr class="ltx_tr" id="S4.T5.3.3.5">
<td class="ltx_td ltx_align_center ltx_border_l ltx_border_r ltx_border_t" id="S4.T5.3.3.5.1" rowspan="2"><span class="ltx_text" id="S4.T5.3.3.5.1.1"><span class="ltx_text" id="S4.T5.3.3.5.1.1.1"></span> <span class="ltx_text" id="S4.T5.3.3.5.1.1.2">
<span class="ltx_tabular ltx_align_middle" id="S4.T5.3.3.5.1.1.2.1">
<span class="ltx_tr" id="S4.T5.3.3.5.1.1.2.1.1">
<span class="ltx_td ltx_align_center" id="S4.T5.3.3.5.1.1.2.1.1.1">Sparsity</span></span>
</span></span> <span class="ltx_text" id="S4.T5.3.3.5.1.1.3"></span></span></td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T5.3.3.5.2">Static Sparsity</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T5.3.3.5.3">100%</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T5.3.3.5.4">0%</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T5.3.3.5.5">16.66%</td>
</tr>
<tr class="ltx_tr" id="S4.T5.3.3.6">
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T5.3.3.6.1">Adaptive Sparsity</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T5.3.3.6.2">NA</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T5.3.3.6.3">5.55%</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T5.3.3.6.4">3.33%</td>
</tr>
<tr class="ltx_tr" id="S4.T5.3.3.7">
<td class="ltx_td ltx_align_center ltx_border_l ltx_border_r ltx_border_tt" id="S4.T5.3.3.7.1" rowspan="2"><span class="ltx_text" id="S4.T5.3.3.7.1.1"><span class="ltx_text" id="S4.T5.3.3.7.1.1.1"></span> <span class="ltx_text" id="S4.T5.3.3.7.1.1.2">
<span class="ltx_tabular ltx_align_middle" id="S4.T5.3.3.7.1.1.2.1">
<span class="ltx_tr" id="S4.T5.3.3.7.1.1.2.1.1">
<span class="ltx_td ltx_align_center" id="S4.T5.3.3.7.1.1.2.1.1.1">Pre-training</span></span>
<span class="ltx_tr" id="S4.T5.3.3.7.1.1.2.1.2">
<span class="ltx_td ltx_align_center" id="S4.T5.3.3.7.1.1.2.1.2.1">Performance</span></span>
</span></span> <span class="ltx_text" id="S4.T5.3.3.7.1.1.3"></span></span></td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_tt" id="S4.T5.3.3.7.2">Top1 Accuracy</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_tt" id="S4.T5.3.3.7.3">57.15%</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_tt" id="S4.T5.3.3.7.4">57.03%</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_tt" id="S4.T5.3.3.7.5">57.03%</td>
</tr>
<tr class="ltx_tr" id="S4.T5.3.3.8">
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T5.3.3.8.1">Perplexity</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T5.3.3.8.2">2.045</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T5.3.3.8.3">2.056</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T5.3.3.8.4">2.055</td>
</tr>
<tr class="ltx_tr" id="S4.T5.3.3.9">
<td class="ltx_td ltx_align_center ltx_border_l ltx_border_r ltx_border_tt" id="S4.T5.3.3.9.1" rowspan="4"><span class="ltx_text" id="S4.T5.3.3.9.1.1"><span class="ltx_text" id="S4.T5.3.3.9.1.1.1"></span> <span class="ltx_text" id="S4.T5.3.3.9.1.1.2">
<span class="ltx_tabular ltx_align_middle" id="S4.T5.3.3.9.1.1.2.1">
<span class="ltx_tr" id="S4.T5.3.3.9.1.1.2.1.1">
<span class="ltx_td ltx_align_center" id="S4.T5.3.3.9.1.1.2.1.1.1">Downstream</span></span>
<span class="ltx_tr" id="S4.T5.3.3.9.1.1.2.1.2">
<span class="ltx_td ltx_align_center" id="S4.T5.3.3.9.1.1.2.1.2.1">Performance</span></span>
</span></span> <span class="ltx_text" id="S4.T5.3.3.9.1.1.3"></span></span></td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_tt" id="S4.T5.3.3.9.2">MT</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_tt" id="S4.T5.3.3.9.3">47.92</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_tt" id="S4.T5.3.3.9.4">46.95</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_tt" id="S4.T5.3.3.9.5">46.93</td>
</tr>
<tr class="ltx_tr" id="S4.T5.3.3.10">
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T5.3.3.10.1">SuperGLUE</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T5.3.3.10.2">62.07</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T5.3.3.10.3">62.49</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T5.3.3.10.4">61.66</td>
</tr>
<tr class="ltx_tr" id="S4.T5.3.3.11">
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T5.3.3.11.1">Q &amp; A</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T5.3.3.11.2">29.65</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T5.3.3.11.3">30.88</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T5.3.3.11.4">29.94</td>
</tr>
<tr class="ltx_tr" id="S4.T5.3.3.12">
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T5.3.3.12.1">Disc. Tasks</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T5.3.3.12.2">51.69</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T5.3.3.12.3">51.14</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T5.3.3.12.4">51.14</td>
</tr>
<tr class="ltx_tr" id="S4.T5.3.3.3">
<td class="ltx_td ltx_border_b ltx_border_l ltx_border_r ltx_border_tt" id="S4.T5.3.3.3.4"></td>
<td class="ltx_td ltx_align_center ltx_border_b ltx_border_r ltx_border_tt" id="S4.T5.3.3.3.5"><em class="ltx_emph ltx_font_italic" id="S4.T5.3.3.3.5.1">Speedup</em></td>
<td class="ltx_td ltx_align_center ltx_border_b ltx_border_r ltx_border_tt" id="S4.T5.1.1.1.1">1.0<math alttext="\times" class="ltx_Math" display="inline" id="S4.T5.1.1.1.1.m1.1"><semantics id="S4.T5.1.1.1.1.m1.1a"><mo id="S4.T5.1.1.1.1.m1.1.1" xref="S4.T5.1.1.1.1.m1.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S4.T5.1.1.1.1.m1.1b"><times id="S4.T5.1.1.1.1.m1.1.1.cmml" xref="S4.T5.1.1.1.1.m1.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S4.T5.1.1.1.1.m1.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S4.T5.1.1.1.1.m1.1d">×</annotation></semantics></math>
</td>
<td class="ltx_td ltx_align_center ltx_border_b ltx_border_r ltx_border_tt" id="S4.T5.2.2.2.2">1.16 <math alttext="\times" class="ltx_Math" display="inline" id="S4.T5.2.2.2.2.m1.1"><semantics id="S4.T5.2.2.2.2.m1.1a"><mo id="S4.T5.2.2.2.2.m1.1.1" xref="S4.T5.2.2.2.2.m1.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S4.T5.2.2.2.2.m1.1b"><times id="S4.T5.2.2.2.2.m1.1.1.cmml" xref="S4.T5.2.2.2.2.m1.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S4.T5.2.2.2.2.m1.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S4.T5.2.2.2.2.m1.1d">×</annotation></semantics></math>
</td>
<td class="ltx_td ltx_align_center ltx_border_b ltx_border_r ltx_border_tt" id="S4.T5.3.3.3.3">1.22<math alttext="\times" class="ltx_Math" display="inline" id="S4.T5.3.3.3.3.m1.1"><semantics id="S4.T5.3.3.3.3.m1.1a"><mo id="S4.T5.3.3.3.3.m1.1.1" xref="S4.T5.3.3.3.3.m1.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S4.T5.3.3.3.3.m1.1b"><times id="S4.T5.3.3.3.3.m1.1.1.cmml" xref="S4.T5.3.3.3.3.m1.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S4.T5.3.3.3.3.m1.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S4.T5.3.3.3.3.m1.1d">×</annotation></semantics></math>
</td>
</tr>
</table>
</span></div>
</figure>
<div class="ltx_para" id="S4.SS3.p8">
<p class="ltx_p" id="S4.SS3.p8.2"><span class="ltx_text ltx_font_bold" id="S4.SS3.p8.2.1">Common path for increasing sparsity further</span>:
We now present results demonstrating the utility of a common path, to further enhance activation sparsity as described in Section <a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#S3.SS4.SSS1" title="3.4.1 Enhancing sparsity further by exploiting static and dynamic activation overlap ‣ 3.4 HiRE-FFN: Efficient FFN using HiRE ‣ 3 Main Ideas ‣ HiRE: High Recall Approximate Top-𝑘 Estimation for Efficient LLM Inference"><span class="ltx_text ltx_ref_tag">3.4.1</span></a>, equation <a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#S3.E7" title="7 ‣ Static overlap ‣ 3.4.1 Enhancing sparsity further by exploiting static and dynamic activation overlap ‣ 3.4 HiRE-FFN: Efficient FFN using HiRE ‣ 3 Main Ideas ‣ HiRE: High Recall Approximate Top-𝑘 Estimation for Efficient LLM Inference"><span class="ltx_text ltx_ref_tag">7</span></a>. The results, presented in Table <a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#S4.T5" title="Table 5 ‣ 4.3 Results ‣ 4 Experiments ‣ HiRE: High Recall Approximate Top-𝑘 Estimation for Efficient LLM Inference"><span class="ltx_text ltx_ref_tag">5</span></a> show that our commonpath technique is indeed able to improve dynamic sparsity by <math alttext="2\%" class="ltx_Math" display="inline" id="S4.SS3.p8.1.m1.1"><semantics id="S4.SS3.p8.1.m1.1a"><mrow id="S4.SS3.p8.1.m1.1.1" xref="S4.SS3.p8.1.m1.1.1.cmml"><mn id="S4.SS3.p8.1.m1.1.1.2" xref="S4.SS3.p8.1.m1.1.1.2.cmml">2</mn><mo id="S4.SS3.p8.1.m1.1.1.1" xref="S4.SS3.p8.1.m1.1.1.1.cmml">%</mo></mrow><annotation-xml encoding="MathML-Content" id="S4.SS3.p8.1.m1.1b"><apply id="S4.SS3.p8.1.m1.1.1.cmml" xref="S4.SS3.p8.1.m1.1.1"><csymbol cd="latexml" id="S4.SS3.p8.1.m1.1.1.1.cmml" xref="S4.SS3.p8.1.m1.1.1.1">percent</csymbol><cn id="S4.SS3.p8.1.m1.1.1.2.cmml" type="integer" xref="S4.SS3.p8.1.m1.1.1.2">2</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS3.p8.1.m1.1c">2\%</annotation><annotation encoding="application/x-llamapun" id="S4.SS3.p8.1.m1.1d">2 %</annotation></semantics></math> while still maintaining accuracy, which leads to about <math alttext="6\%" class="ltx_Math" display="inline" id="S4.SS3.p8.2.m2.1"><semantics id="S4.SS3.p8.2.m2.1a"><mrow id="S4.SS3.p8.2.m2.1.1" xref="S4.SS3.p8.2.m2.1.1.cmml"><mn id="S4.SS3.p8.2.m2.1.1.2" xref="S4.SS3.p8.2.m2.1.1.2.cmml">6</mn><mo id="S4.SS3.p8.2.m2.1.1.1" xref="S4.SS3.p8.2.m2.1.1.1.cmml">%</mo></mrow><annotation-xml encoding="MathML-Content" id="S4.SS3.p8.2.m2.1b"><apply id="S4.SS3.p8.2.m2.1.1.cmml" xref="S4.SS3.p8.2.m2.1.1"><csymbol cd="latexml" id="S4.SS3.p8.2.m2.1.1.1.cmml" xref="S4.SS3.p8.2.m2.1.1.1">percent</csymbol><cn id="S4.SS3.p8.2.m2.1.1.2.cmml" type="integer" xref="S4.SS3.p8.2.m2.1.1.2">6</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS3.p8.2.m2.1c">6\%</annotation><annotation encoding="application/x-llamapun" id="S4.SS3.p8.2.m2.1d">6 %</annotation></semantics></math> lower latency.
</p>
</div>
<figure class="ltx_figure" id="S4.F2"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_landscape" height="134" id="S4.F2.g1" src="extracted/5409158/figures/adaptivesparsity.png" width="299"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure">Figure 2: </span>Dynamic overlap of top-<math alttext="k" class="ltx_Math" display="inline" id="S4.F2.9.m1.1"><semantics id="S4.F2.9.m1.1b"><mi id="S4.F2.9.m1.1.1" xref="S4.F2.9.m1.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="S4.F2.9.m1.1c"><ci id="S4.F2.9.m1.1.1.cmml" xref="S4.F2.9.m1.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.F2.9.m1.1d">k</annotation><annotation encoding="application/x-llamapun" id="S4.F2.9.m1.1e">italic_k</annotation></semantics></math> activations across related responses while generating <math alttext="4" class="ltx_Math" display="inline" id="S4.F2.10.m2.1"><semantics id="S4.F2.10.m2.1b"><mn id="S4.F2.10.m2.1.1" xref="S4.F2.10.m2.1.1.cmml">4</mn><annotation-xml encoding="MathML-Content" id="S4.F2.10.m2.1c"><cn id="S4.F2.10.m2.1.1.cmml" type="integer" xref="S4.F2.10.m2.1.1">4</cn></annotation-xml><annotation encoding="application/x-tex" id="S4.F2.10.m2.1d">4</annotation><annotation encoding="application/x-llamapun" id="S4.F2.10.m2.1e">4</annotation></semantics></math> parallel samples for the same query. On x-axis is the size of union of top-<math alttext="k" class="ltx_Math" display="inline" id="S4.F2.11.m3.1"><semantics id="S4.F2.11.m3.1b"><mi id="S4.F2.11.m3.1.1" xref="S4.F2.11.m3.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="S4.F2.11.m3.1c"><ci id="S4.F2.11.m3.1.1.cmml" xref="S4.F2.11.m3.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.F2.11.m3.1d">k</annotation><annotation encoding="application/x-llamapun" id="S4.F2.11.m3.1e">italic_k</annotation></semantics></math> activations across <math alttext="4" class="ltx_Math" display="inline" id="S4.F2.12.m4.1"><semantics id="S4.F2.12.m4.1b"><mn id="S4.F2.12.m4.1.1" xref="S4.F2.12.m4.1.1.cmml">4</mn><annotation-xml encoding="MathML-Content" id="S4.F2.12.m4.1c"><cn id="S4.F2.12.m4.1.1.cmml" type="integer" xref="S4.F2.12.m4.1.1">4</cn></annotation-xml><annotation encoding="application/x-tex" id="S4.F2.12.m4.1d">4</annotation><annotation encoding="application/x-llamapun" id="S4.F2.12.m4.1e">4</annotation></semantics></math> generations divided by <math alttext="4k" class="ltx_Math" display="inline" id="S4.F2.13.m5.1"><semantics id="S4.F2.13.m5.1b"><mrow id="S4.F2.13.m5.1.1" xref="S4.F2.13.m5.1.1.cmml"><mn id="S4.F2.13.m5.1.1.2" xref="S4.F2.13.m5.1.1.2.cmml">4</mn><mo id="S4.F2.13.m5.1.1.1" xref="S4.F2.13.m5.1.1.1.cmml">⁢</mo><mi id="S4.F2.13.m5.1.1.3" xref="S4.F2.13.m5.1.1.3.cmml">k</mi></mrow><annotation-xml encoding="MathML-Content" id="S4.F2.13.m5.1c"><apply id="S4.F2.13.m5.1.1.cmml" xref="S4.F2.13.m5.1.1"><times id="S4.F2.13.m5.1.1.1.cmml" xref="S4.F2.13.m5.1.1.1"></times><cn id="S4.F2.13.m5.1.1.2.cmml" type="integer" xref="S4.F2.13.m5.1.1.2">4</cn><ci id="S4.F2.13.m5.1.1.3.cmml" xref="S4.F2.13.m5.1.1.3">𝑘</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.F2.13.m5.1d">4k</annotation><annotation encoding="application/x-llamapun" id="S4.F2.13.m5.1e">4 italic_k</annotation></semantics></math>, for <math alttext="k=(0.05)*m" class="ltx_Math" display="inline" id="S4.F2.14.m6.1"><semantics id="S4.F2.14.m6.1b"><mrow id="S4.F2.14.m6.1.2" xref="S4.F2.14.m6.1.2.cmml"><mi id="S4.F2.14.m6.1.2.2" xref="S4.F2.14.m6.1.2.2.cmml">k</mi><mo id="S4.F2.14.m6.1.2.1" xref="S4.F2.14.m6.1.2.1.cmml">=</mo><mrow id="S4.F2.14.m6.1.2.3" xref="S4.F2.14.m6.1.2.3.cmml"><mrow id="S4.F2.14.m6.1.2.3.2.2" xref="S4.F2.14.m6.1.2.3.cmml"><mo id="S4.F2.14.m6.1.2.3.2.2.1" stretchy="false" xref="S4.F2.14.m6.1.2.3.cmml">(</mo><mn id="S4.F2.14.m6.1.1" xref="S4.F2.14.m6.1.1.cmml">0.05</mn><mo id="S4.F2.14.m6.1.2.3.2.2.2" rspace="0.055em" stretchy="false" xref="S4.F2.14.m6.1.2.3.cmml">)</mo></mrow><mo id="S4.F2.14.m6.1.2.3.1" rspace="0.222em" xref="S4.F2.14.m6.1.2.3.1.cmml">*</mo><mi id="S4.F2.14.m6.1.2.3.3" xref="S4.F2.14.m6.1.2.3.3.cmml">m</mi></mrow></mrow><annotation-xml encoding="MathML-Content" id="S4.F2.14.m6.1c"><apply id="S4.F2.14.m6.1.2.cmml" xref="S4.F2.14.m6.1.2"><eq id="S4.F2.14.m6.1.2.1.cmml" xref="S4.F2.14.m6.1.2.1"></eq><ci id="S4.F2.14.m6.1.2.2.cmml" xref="S4.F2.14.m6.1.2.2">𝑘</ci><apply id="S4.F2.14.m6.1.2.3.cmml" xref="S4.F2.14.m6.1.2.3"><times id="S4.F2.14.m6.1.2.3.1.cmml" xref="S4.F2.14.m6.1.2.3.1"></times><cn id="S4.F2.14.m6.1.1.cmml" type="float" xref="S4.F2.14.m6.1.1">0.05</cn><ci id="S4.F2.14.m6.1.2.3.3.cmml" xref="S4.F2.14.m6.1.2.3.3">𝑚</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.F2.14.m6.1d">k=(0.05)*m</annotation><annotation encoding="application/x-llamapun" id="S4.F2.14.m6.1e">italic_k = ( 0.05 ) * italic_m</annotation></semantics></math>. As we can see, there is substantial fraction of mass away from <math alttext="1" class="ltx_Math" display="inline" id="S4.F2.15.m7.1"><semantics id="S4.F2.15.m7.1b"><mn id="S4.F2.15.m7.1.1" xref="S4.F2.15.m7.1.1.cmml">1</mn><annotation-xml encoding="MathML-Content" id="S4.F2.15.m7.1c"><cn id="S4.F2.15.m7.1.1.cmml" type="integer" xref="S4.F2.15.m7.1.1">1</cn></annotation-xml><annotation encoding="application/x-tex" id="S4.F2.15.m7.1d">1</annotation><annotation encoding="application/x-llamapun" id="S4.F2.15.m7.1e">1</annotation></semantics></math>, suggesting that the top-<math alttext="k" class="ltx_Math" display="inline" id="S4.F2.16.m8.1"><semantics id="S4.F2.16.m8.1b"><mi id="S4.F2.16.m8.1.1" xref="S4.F2.16.m8.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="S4.F2.16.m8.1c"><ci id="S4.F2.16.m8.1.1.cmml" xref="S4.F2.16.m8.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.F2.16.m8.1d">k</annotation><annotation encoding="application/x-llamapun" id="S4.F2.16.m8.1e">italic_k</annotation></semantics></math> activations of related responses have high overlap, which can yield further latency improvements with HiRE.</figcaption>
</figure>
<div class="ltx_para" id="S4.SS3.p9">
<p class="ltx_p" id="S4.SS3.p9.1"><span class="ltx_text ltx_font_bold" id="S4.SS3.p9.1.1">Exploiting activation overlap for larger num samples with adaptive sparsity</span>:
It has been shown that generating multiple diverse responses for a single query, and subsequent ranking aids in selecting the most suitable output <cite class="ltx_cite ltx_citemacro_citep">(Mudgal et al., <a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#bib.bib40" title="">2023</a>)</cite>. We hypothesize that such responses share significant overlap in their non-zero neural activations, offering potential for enhancing effective sparsity in FFN layers. This is supported empirically (Figure <a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#S4.F2" title="Figure 2 ‣ 4.3 Results ‣ 4 Experiments ‣ HiRE: High Recall Approximate Top-𝑘 Estimation for Efficient LLM Inference"><span class="ltx_text ltx_ref_tag">2</span></a>), where the union of non-zero activations across multiple responses is consistently smaller than the sum of number of individual response activations.

</p>
</div>
</section>
</section>
<section class="ltx_section" id="Sx1">
<h2 class="ltx_title ltx_title_section">Broader Impact Statement</h2>
<div class="ltx_para" id="Sx1.p1">
<p class="ltx_p" id="Sx1.p1.1">We expect utilizing HiRE can lead to more energy efficient large model inference. Beyond that there are potential societal consequences of helping large models become more accessible, none which we feel must be specifically highlighted here.</p>
</div>
</section>
<section class="ltx_bibliography" id="bib">
<h2 class="ltx_title ltx_title_bibliography">References</h2>
<ul class="ltx_biblist">
<li class="ltx_bibitem" id="bib.bib1">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Ahmadian et al. (2023)</span>
<span class="ltx_bibblock">
Ahmadian, A., Dash, S., Chen, H., Venkitesh, B., Gou, S., Blunsom, P., Ustun, A., and Hooker, S.

</span>
<span class="ltx_bibblock">Intriguing properties of quantization at scale.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib1.1.1">ArXiv</em>, abs/2305.19268, 2023.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://api.semanticscholar.org/CorpusID:258967189" title="">https://api.semanticscholar.org/CorpusID:258967189</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib2">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Alizadeh et al. (2023)</span>
<span class="ltx_bibblock">
Alizadeh, K., Mirzadeh, I., Belenko, D., Khatamifard, K., Cho, M., Del Mundo, C. C., Rastegari, M., and Farajtabar, M.

</span>
<span class="ltx_bibblock">Llm in a flash: Efficient large language model inference with limited memory.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib2.1.1">arXiv preprint arXiv:2312.11514</em>, 2023.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib3">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Aminabadi et al. (2022)</span>
<span class="ltx_bibblock">
Aminabadi, R. Y., Rajbhandari, S., Awan, A. A., Li, C., Li, D., Zheng, E., Ruwase, O., Smith, S., Zhang, M., Rasley, J., et al.

</span>
<span class="ltx_bibblock">Deepspeed-inference: enabling efficient inference of transformer models at unprecedented scale.

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib3.1.1">SC22: International Conference for High Performance Computing, Networking, Storage and Analysis</em>, pp.  1–15. IEEE, 2022.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib4">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Anil et al. (2023)</span>
<span class="ltx_bibblock">
Anil, R., Dai, A. M., Firat, O., Johnson, M., Lepikhin, D., Passos, A., Shakeri, S., Taropa, E., Bailey, P., Chen, Z., Chu, E., Clark, J. H., Shafey, L. E., Huang, Y., Meier-Hellstern, K., Mishra, G., Moreira, E., Omernick, M., Robinson, K., Ruder, S., Tay, Y., Xiao, K., Xu, Y., Zhang, Y., Ábrego, G. H., Ahn, J., Austin, J., Barham, P., Botha, J. A., Bradbury, J., Brahma, S., Brooks, K., Catasta, M., Cheng, Y., Cherry, C., Choquette-Choo, C. A., Chowdhery, A., Crepy, C., Dave, S., Dehghani, M., Dev, S., Devlin, J., Díaz, M., Du, N., Dyer, E., Feinberg, V., Feng, F., Fienber, V., Freitag, M., Garcia, X., Gehrmann, S., Gonzalez, L., and et al.

</span>
<span class="ltx_bibblock">Palm 2 technical report.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib4.1.1">CoRR</em>, abs/2305.10403, 2023.

</span>
<span class="ltx_bibblock">doi: <a class="ltx_ref ltx_Url" href="10.48550/ARXIV.2305.10403" title="">10.48550/ARXIV.2305.10403</a>.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://doi.org/10.48550/arXiv.2305.10403" title="">https://doi.org/10.48550/arXiv.2305.10403</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib5">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Bae et al. (2023)</span>
<span class="ltx_bibblock">
Bae, S., Ko, J., Song, H., and Yun, S.-Y.

</span>
<span class="ltx_bibblock">Fast and robust early-exiting framework for autoregressive language models with synchronized parallel decoding.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib5.1.1">arXiv preprint arXiv:2310.05424</em>, 2023.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib6">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Baykal et al. (2023)</span>
<span class="ltx_bibblock">
Baykal, C., Cutler, D., Dikkala, N., Ghosh, N., Panigrahy, R., and Wang, X.

</span>
<span class="ltx_bibblock">Alternating updates for efficient transformers.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib6.1.1">arXiv preprint arXiv:2301.13310</em>, 2023.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib7">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Berant et al. (2013)</span>
<span class="ltx_bibblock">
Berant, J., Chou, A., Frostig, R., and Liang, P.

</span>
<span class="ltx_bibblock">Semantic parsing on freebase from question-answer pairs.

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib7.1.1">Proceedings of the 2013 Conference on Empirical Methods in Natural Language Processing, EMNLP 2013, 18-21 October 2013, Grand Hyatt Seattle, Seattle, Washington, USA, A meeting of SIGDAT, a Special Interest Group of the ACL</em>, pp.  1533–1544. ACL, 2013.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://aclanthology.org/D13-1160/" title="">https://aclanthology.org/D13-1160/</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib8">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Bisk et al. (2020)</span>
<span class="ltx_bibblock">
Bisk, Y., Zellers, R., Bras, R. L., Gao, J., and Choi, Y.

</span>
<span class="ltx_bibblock">PIQA: reasoning about physical commonsense in natural language.

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib8.1.1">The Thirty-Fourth AAAI Conference on Artificial Intelligence, AAAI 2020, The Thirty-Second Innovative Applications of Artificial Intelligence Conference, IAAI 2020, The Tenth AAAI Symposium on Educational Advances in Artificial Intelligence, EAAI 2020, New York, NY, USA, February 7-12, 2020</em>, pp.  7432–7439. AAAI Press, 2020.

</span>
<span class="ltx_bibblock">doi: <a class="ltx_ref ltx_Url" href="10.1609/AAAI.V34I05.6239" title="">10.1609/AAAI.V34I05.6239</a>.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://doi.org/10.1609/aaai.v34i05.6239" title="">https://doi.org/10.1609/aaai.v34i05.6239</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib9">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Bojar et al. (2014)</span>
<span class="ltx_bibblock">
Bojar, O., Buck, C., Federmann, C., Haddow, B., Koehn, P., Leveling, J., Monz, C., Pecina, P., Post, M., Saint-Amand, H., et al.

</span>
<span class="ltx_bibblock">Findings of the 2014 workshop on statistical machine translation.

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib9.1.1">Proceedings of the ninth workshop on statistical machine translation</em>, pp.  12–58, 2014.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib10">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Clark et al. (2019)</span>
<span class="ltx_bibblock">
Clark, C., Lee, K., Chang, M., Kwiatkowski, T., Collins, M., and Toutanova, K.

</span>
<span class="ltx_bibblock">Boolq: Exploring the surprising difficulty of natural yes/no questions.

</span>
<span class="ltx_bibblock">In Burstein, J., Doran, C., and Solorio, T. (eds.), <em class="ltx_emph ltx_font_italic" id="bib.bib10.1.1">Proceedings of the 2019 Conference of the North American Chapter of the Association for Computational Linguistics: Human Language Technologies, NAACL-HLT 2019, Minneapolis, MN, USA, June 2-7, 2019, Volume 1 (Long and Short Papers)</em>, pp.  2924–2936. Association for Computational Linguistics, 2019.

</span>
<span class="ltx_bibblock">doi: <a class="ltx_ref ltx_Url" href="10.18653/V1/N19-1300" title="">10.18653/V1/N19-1300</a>.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://doi.org/10.18653/v1/n19-1300" title="">https://doi.org/10.18653/v1/n19-1300</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib11">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Clark et al. (2020)</span>
<span class="ltx_bibblock">
Clark, J. H., Choi, E., Collins, M., Garrette, D., Kwiatkowski, T., Nikolaev, V., and Palomaki, J.

</span>
<span class="ltx_bibblock">Tydi qa: A benchmark for information-seeking question answering in ty pologically di verse languages.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib11.1.1">Transactions of the Association for Computational Linguistics</em>, 8:454–470, 2020.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib12">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Clark et al. (2018)</span>
<span class="ltx_bibblock">
Clark, P., Cowhey, I., Etzioni, O., Khot, T., Sabharwal, A., Schoenick, C., and Tafjord, O.

</span>
<span class="ltx_bibblock">Think you have solved question answering? try arc, the AI2 reasoning challenge.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib12.1.1">CoRR</em>, abs/1803.05457, 2018.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="http://arxiv.org/abs/1803.05457" title="">http://arxiv.org/abs/1803.05457</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib13">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">(13)</span>
<span class="ltx_bibblock">
Cloud, G.

</span>
<span class="ltx_bibblock">Cloud tpu v5e inference.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://cloud.google.com/tpu/docs/v5e-inference" title="">https://cloud.google.com/tpu/docs/v5e-inference</a>.

</span>
<span class="ltx_bibblock">Accessed on Feb 1, 2024.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib14">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Csordás et al. (2023)</span>
<span class="ltx_bibblock">
Csordás, R., Irie, K., and Schmidhuber, J.

</span>
<span class="ltx_bibblock">Approximating two-layer feedforward networks for efficient transformers.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib14.1.1">arXiv preprint arXiv:2310.10837</em>, 2023.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib15">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">de Marneffe et al. (2019)</span>
<span class="ltx_bibblock">
de Marneffe, M.-C., Simons, M., and Tonhauser, J.

</span>
<span class="ltx_bibblock">The commitmentbank: Investigating projection in naturally occurring discourse.

</span>
<span class="ltx_bibblock">2019.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://api.semanticscholar.org/CorpusID:203595067" title="">https://api.semanticscholar.org/CorpusID:203595067</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib16">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Dong et al. (2023)</span>
<span class="ltx_bibblock">
Dong, H., Chen, B., and Chi, Y.

</span>
<span class="ltx_bibblock">Towards structured sparsity in transformers for efficient inference.

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib16.1.1">Workshop on Efficient Systems for Foundation Models, at ICML2023</em>, 2023.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib17">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Du et al. (2022)</span>
<span class="ltx_bibblock">
Du, N., Huang, Y., Dai, A. M., Tong, S., Lepikhin, D., Xu, Y., Krikun, M., Zhou, Y., Yu, A. W., Firat, O., et al.

</span>
<span class="ltx_bibblock">Glam: Efficient scaling of language models with mixture-of-experts.

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib17.1.1">International Conference on Machine Learning</em>, pp.  5547–5569. PMLR, 2022.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib18">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Gale et al. (2020)</span>
<span class="ltx_bibblock">
Gale, T., Zaharia, M., Young, C., and Elsen, E.

</span>
<span class="ltx_bibblock">Sparse gpu kernels for deep learning.

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib18.1.1">SC20: International Conference for High Performance Computing, Networking, Storage and Analysis</em>, pp.  1–14. IEEE, 2020.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib19">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Grimaldi et al. (2023)</span>
<span class="ltx_bibblock">
Grimaldi, M., Ganji, D. C., Lazarevich, I., and Sah, S.

</span>
<span class="ltx_bibblock">Accelerating deep neural networks via semi-structured activation sparsity.

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib19.1.1">Proceedings of the IEEE/CVF International Conference on Computer Vision</em>, pp.  1179–1188, 2023.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib20">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Gu &amp; Dao (2023)</span>
<span class="ltx_bibblock">
Gu, A. and Dao, T.

</span>
<span class="ltx_bibblock">Mamba: Linear-time sequence modeling with selective state spaces.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib20.1.1">arXiv preprint arXiv:2312.00752</em>, 2023.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib21">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Han et al. (2015)</span>
<span class="ltx_bibblock">
Han, S., Mao, H., and Dally, W. J.

</span>
<span class="ltx_bibblock">Deep compression: Compressing deep neural networks with pruning, trained quantization and huffman coding.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib21.1.1">arXiv preprint arXiv:1510.00149</em>, 2015.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib22">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">He et al. (2023)</span>
<span class="ltx_bibblock">
He, Z., Zhong, Z., Cai, T., Lee, J. D., and He, D.

</span>
<span class="ltx_bibblock">Rest: Retrieval-based speculative decoding.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib22.1.1">arXiv preprint arXiv:2311.08252</em>, 2023.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib23">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Jaiswal et al. (2023)</span>
<span class="ltx_bibblock">
Jaiswal, A., Gan, Z., Du, X., Zhang, B., Wang, Z., and Yang, Y.

</span>
<span class="ltx_bibblock">Compressing llms: The truth is rarely pure and never simple.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib23.1.1">arXiv preprint arXiv:2310.01382</em>, 2023.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib24">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Jaszczur et al. (2021)</span>
<span class="ltx_bibblock">
Jaszczur, S., Chowdhery, A., Mohiuddin, A., Kaiser, L., Gajewski, W., Michalewski, H., and Kanerva, J.

</span>
<span class="ltx_bibblock">Sparse is enough in scaling transformers.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib24.1.1">Advances in Neural Information Processing Systems</em>, 34:9895–9907, 2021.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib25">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Joshi et al. (2017)</span>
<span class="ltx_bibblock">
Joshi, M., Choi, E., Weld, D. S., and Zettlemoyer, L.

</span>
<span class="ltx_bibblock">Triviaqa: A large scale distantly supervised challenge dataset for reading comprehension.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib25.1.1">arXiv preprint arXiv:1705.03551</em>, 2017.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib26">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Khashabi et al. (2018)</span>
<span class="ltx_bibblock">
Khashabi, D., Chaturvedi, S., Roth, M., Upadhyay, S., and Roth, D.

</span>
<span class="ltx_bibblock">Looking beyond the surface: A challenge set for reading comprehension over multiple sentences.

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib26.1.1">Proceedings of the 2018 Conference of the North American Chapter of the Association for Computational Linguistics: Human Language Technologies, Volume 1 (Long Papers)</em>, pp.  252–262, 2018.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib27">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Kwiatkowski et al. (2019)</span>
<span class="ltx_bibblock">
Kwiatkowski, T., Palomaki, J., Redfield, O., Collins, M., Parikh, A., Alberti, C., Epstein, D., Polosukhin, I., Devlin, J., Lee, K., et al.

</span>
<span class="ltx_bibblock">Natural questions: a benchmark for question answering research.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib27.1.1">Transactions of the Association for Computational Linguistics</em>, 7:453–466, 2019.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib28">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Lai et al. (2017)</span>
<span class="ltx_bibblock">
Lai, G., Xie, Q., Liu, H., Yang, Y., and Hovy, E. H.

</span>
<span class="ltx_bibblock">RACE: large-scale reading comprehension dataset from examinations.

</span>
<span class="ltx_bibblock">In Palmer, M., Hwa, R., and Riedel, S. (eds.), <em class="ltx_emph ltx_font_italic" id="bib.bib28.1.1">Proceedings of the 2017 Conference on Empirical Methods in Natural Language Processing, EMNLP 2017, Copenhagen, Denmark, September 9-11, 2017</em>, pp.  785–794. Association for Computational Linguistics, 2017.

</span>
<span class="ltx_bibblock">doi: <a class="ltx_ref ltx_Url" href="10.18653/V1/D17-1082" title="">10.18653/V1/D17-1082</a>.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://doi.org/10.18653/v1/d17-1082" title="">https://doi.org/10.18653/v1/d17-1082</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib29">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Levesque et al. (2012)</span>
<span class="ltx_bibblock">
Levesque, H., Davis, E., and Morgenstern, L.

</span>
<span class="ltx_bibblock">The winograd schema challenge.

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib29.1.1">Thirteenth international conference on the principles of knowledge representation and reasoning</em>, 2012.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib30">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Leviathan et al. (2023)</span>
<span class="ltx_bibblock">
Leviathan, Y., Kalman, M., and Matias, Y.

</span>
<span class="ltx_bibblock">Fast inference from transformers via speculative decoding.

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib30.1.1">International Conference on Machine Learning</em>, pp.  19274–19286. PMLR, 2023.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib31">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Li et al. (2023)</span>
<span class="ltx_bibblock">
Li, L., Li, Q., Zhang, B., and Chu, X.

</span>
<span class="ltx_bibblock">Norm tweaking: High-performance low-bit quantization of large language models.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib31.1.1">arXiv preprint arXiv:2309.02784</em>, 2023.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib32">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Li et al. (2022)</span>
<span class="ltx_bibblock">
Li, Z., You, C., Bhojanapalli, S., Li, D., Rawat, A. S., Reddi, S. J., Ye, K., Chern, F., Yu, F., Guo, R., et al.

</span>
<span class="ltx_bibblock">The lazy neuron phenomenon: On emergence of activation sparsity in transformers.

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib32.1.1">The Eleventh International Conference on Learning Representations</em>, 2022.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib33">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Liang et al. (2021)</span>
<span class="ltx_bibblock">
Liang, K. J., Hao, W., Shen, D., Zhou, Y., Chen, W., Chen, C., and Carin, L.

</span>
<span class="ltx_bibblock">Mixkd: Towards efficient distillation of large-scale language models.

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib33.1.1">9th International Conference on Learning Representations, ICLR 2021, Virtual Event, Austria, May 3-7, 2021</em>. OpenReview.net, 2021.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://openreview.net/forum?id=UFGEelJkLu5" title="">https://openreview.net/forum?id=UFGEelJkLu5</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib34">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Lin et al. (2023)</span>
<span class="ltx_bibblock">
Lin, J., Tang, J., Tang, H., Yang, S., Dang, X., and Han, S.

</span>
<span class="ltx_bibblock">Awq: Activation-aware weight quantization for llm compression and acceleration.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib34.1.1">arXiv preprint arXiv:2306.00978</em>, 2023.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib35">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Liu et al. (2023)</span>
<span class="ltx_bibblock">
Liu, Z., Wang, J., Dao, T., Zhou, T., Yuan, B., Song, Z., Shrivastava, A., Zhang, C., Tian, Y., Re, C., et al.

</span>
<span class="ltx_bibblock">Deja vu: Contextual sparsity for efficient llms at inference time.

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib35.1.1">International Conference on Machine Learning</em>, pp.  22137–22176. PMLR, 2023.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib36">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Madaan et al. (2023)</span>
<span class="ltx_bibblock">
Madaan, L., Bhojanapalli, S., Jain, H., and Jain, P.

</span>
<span class="ltx_bibblock">Treeformer: Dense gradient trees for efficient attention computation.

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib36.1.1">The Eleventh International Conference on Learning Representations, ICLR 2023, Kigali, Rwanda, May 1-5, 2023</em>. OpenReview.net, 2023.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://openreview.net/pdf?id=DWn1TEb2fK" title="">https://openreview.net/pdf?id=DWn1TEb2fK</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib37">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Mihaylov et al. (2018)</span>
<span class="ltx_bibblock">
Mihaylov, T., Clark, P., Khot, T., and Sabharwal, A.

</span>
<span class="ltx_bibblock">Can a suit of armor conduct electricity? A new dataset for open book question answering.

</span>
<span class="ltx_bibblock">In Riloff, E., Chiang, D., Hockenmaier, J., and Tsujii, J. (eds.), <em class="ltx_emph ltx_font_italic" id="bib.bib37.1.1">Proceedings of the 2018 Conference on Empirical Methods in Natural Language Processing, Brussels, Belgium, October 31 - November 4, 2018</em>, pp.  2381–2391. Association for Computational Linguistics, 2018.

</span>
<span class="ltx_bibblock">doi: <a class="ltx_ref ltx_Url" href="10.18653/V1/D18-1260" title="">10.18653/V1/D18-1260</a>.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://doi.org/10.18653/v1/d18-1260" title="">https://doi.org/10.18653/v1/d18-1260</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib38">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Mirzadeh et al. (2023)</span>
<span class="ltx_bibblock">
Mirzadeh, I., Alizadeh, K., Mehta, S., Del Mundo, C. C., Tuzel, O., Samei, G., Rastegari, M., and Farajtabar, M.

</span>
<span class="ltx_bibblock">Relu strikes back: Exploiting activation sparsity in large language models.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib38.1.1">arXiv preprint arXiv:2310.04564</em>, 2023.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib39">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Mostafazadeh et al. (2016)</span>
<span class="ltx_bibblock">
Mostafazadeh, N., Chambers, N., He, X., Parikh, D., Batra, D., Vanderwende, L., Kohli, P., and Allen, J. F.

</span>
<span class="ltx_bibblock">A corpus and evaluation framework for deeper understanding of commonsense stories.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib39.1.1">CoRR</em>, abs/1604.01696, 2016.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="http://arxiv.org/abs/1604.01696" title="">http://arxiv.org/abs/1604.01696</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib40">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Mudgal et al. (2023)</span>
<span class="ltx_bibblock">
Mudgal, S., Lee, J., Ganapathy, H., Li, Y., Wang, T., Huang, Y., Chen, Z., Cheng, H., Collins, M., Strohman, T., Chen, J., Beutel, A., and Beirami, A.

</span>
<span class="ltx_bibblock">Controlled decoding from language models.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib40.1.1">CoRR</em>, abs/2310.17022, 2023.

</span>
<span class="ltx_bibblock">doi: <a class="ltx_ref ltx_Url" href="10.48550/ARXIV.2310.17022" title="">10.48550/ARXIV.2310.17022</a>.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://doi.org/10.48550/arXiv.2310.17022" title="">https://doi.org/10.48550/arXiv.2310.17022</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib41">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Nie et al. (2020)</span>
<span class="ltx_bibblock">
Nie, Y., Williams, A., Dinan, E., Bansal, M., Weston, J., and Kiela, D.

</span>
<span class="ltx_bibblock">Adversarial NLI: A new benchmark for natural language understanding.

</span>
<span class="ltx_bibblock">In Jurafsky, D., Chai, J., Schluter, N., and Tetreault, J. R. (eds.), <em class="ltx_emph ltx_font_italic" id="bib.bib41.1.1">Proceedings of the 58th Annual Meeting of the Association for Computational Linguistics, ACL 2020, Online, July 5-10, 2020</em>, pp.  4885–4901. Association for Computational Linguistics, 2020.

</span>
<span class="ltx_bibblock">doi: <a class="ltx_ref ltx_Url" href="10.18653/V1/2020.ACL-MAIN.441" title="">10.18653/V1/2020.ACL-MAIN.441</a>.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://doi.org/10.18653/v1/2020.acl-main.441" title="">https://doi.org/10.18653/v1/2020.acl-main.441</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib42">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Patterson et al. (2021)</span>
<span class="ltx_bibblock">
Patterson, D., Gonzalez, J., Le, Q., Liang, C., Munguia, L.-M., Rothchild, D., So, D., Texier, M., and Dean, J.

</span>
<span class="ltx_bibblock">Carbon emissions and large neural network training.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib42.1.1">arXiv preprint arXiv:2104.10350</em>, 2021.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib43">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Pilehvar &amp; Camacho-Collados (2019)</span>
<span class="ltx_bibblock">
Pilehvar, M. T. and Camacho-Collados, J.

</span>
<span class="ltx_bibblock">Wic: the word-in-context dataset for evaluating context-sensitive meaning representations.

</span>
<span class="ltx_bibblock">In Burstein, J., Doran, C., and Solorio, T. (eds.), <em class="ltx_emph ltx_font_italic" id="bib.bib43.1.1">Proceedings of the 2019 Conference of the North American Chapter of the Association for Computational Linguistics: Human Language Technologies, NAACL-HLT 2019, Minneapolis, MN, USA, June 2-7, 2019, Volume 1 (Long and Short Papers)</em>, pp.  1267–1273. Association for Computational Linguistics, 2019.

</span>
<span class="ltx_bibblock">doi: <a class="ltx_ref ltx_Url" href="10.18653/V1/N19-1128" title="">10.18653/V1/N19-1128</a>.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://doi.org/10.18653/v1/n19-1128" title="">https://doi.org/10.18653/v1/n19-1128</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib44">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Piórczyński et al. (2023)</span>
<span class="ltx_bibblock">
Piórczyński, M., Szatkowski, F., Bałazy, K., and Wójcik, B.

</span>
<span class="ltx_bibblock">Exploiting transformer activation sparsity with dynamic inference.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib44.1.1">arXiv preprint arXiv:2310.04361</em>, 2023.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib45">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Pope et al. (2023)</span>
<span class="ltx_bibblock">
Pope, R., Douglas, S., Chowdhery, A., Devlin, J., Bradbury, J., Heek, J., Xiao, K., Agrawal, S., and Dean, J.

</span>
<span class="ltx_bibblock">Efficiently scaling transformer inference.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib45.1.1">Proceedings of Machine Learning and Systems</em>, 5, 2023.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib46">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Popović (2015)</span>
<span class="ltx_bibblock">
Popović, M.

</span>
<span class="ltx_bibblock">chrf: character n-gram f-score for automatic mt evaluation.

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib46.1.1">Proceedings of the tenth workshop on statistical machine translation</em>, pp.  392–395, 2015.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib47">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Rajpurkar et al. (2018)</span>
<span class="ltx_bibblock">
Rajpurkar, P., Jia, R., and Liang, P.

</span>
<span class="ltx_bibblock">Know what you don’t know: Unanswerable questions for squad.

</span>
<span class="ltx_bibblock">In Gurevych, I. and Miyao, Y. (eds.), <em class="ltx_emph ltx_font_italic" id="bib.bib47.1.1">Proceedings of the 56th Annual Meeting of the Association for Computational Linguistics, ACL 2018, Melbourne, Australia, July 15-20, 2018, Volume 2: Short Papers</em>, pp.  784–789. Association for Computational Linguistics, 2018.

</span>
<span class="ltx_bibblock">doi: <a class="ltx_ref ltx_Url" href="10.18653/V1/P18-2124" title="">10.18653/V1/P18-2124</a>.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://aclanthology.org/P18-2124/" title="">https://aclanthology.org/P18-2124/</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib48">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Roemmele et al. (2011)</span>
<span class="ltx_bibblock">
Roemmele, M., Bejan, C. A., and Gordon, A. S.

</span>
<span class="ltx_bibblock">Choice of plausible alternatives: An evaluation of commonsense causal reasoning.

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib48.1.1">Logical Formalizations of Commonsense Reasoning, Papers from the 2011 AAAI Spring Symposium, Technical Report SS-11-06, Stanford, California, USA, March 21-23, 2011</em>. AAAI, 2011.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="http://www.aaai.org/ocs/index.php/SSS/SSS11/paper/view/2418" title="">http://www.aaai.org/ocs/index.php/SSS/SSS11/paper/view/2418</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib49">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Sakaguchi et al. (2021)</span>
<span class="ltx_bibblock">
Sakaguchi, K., Bras, R. L., Bhagavatula, C., and Choi, Y.

</span>
<span class="ltx_bibblock">Winogrande: An adversarial winograd schema challenge at scale.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib49.1.1">Communications of the ACM</em>, 64(9):99–106, 2021.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib50">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Sheng et al. (2023)</span>
<span class="ltx_bibblock">
Sheng, Y., Zheng, L., Yuan, B., Li, Z., Ryabinin, M., Chen, B., Liang, P., Ré, C., Stoica, I., and Zhang, C.

</span>
<span class="ltx_bibblock">Flexgen: High-throughput generative inference of large language models with a single gpu.

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib50.1.1">International Conference on Machine Learning</em>, pp.  31094–31116. PMLR, 2023.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib51">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Song et al. (2023)</span>
<span class="ltx_bibblock">
Song, Y., Mi, Z., Xie, H., and Chen, H.

</span>
<span class="ltx_bibblock">Powerinfer: Fast large language model serving with a consumer-grade gpu.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib51.1.1">arXiv preprint arXiv:2312.12456</em>, 2023.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib52">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Stern et al. (2018)</span>
<span class="ltx_bibblock">
Stern, M., Shazeer, N., and Uszkoreit, J.

</span>
<span class="ltx_bibblock">Blockwise parallel decoding for deep autoregressive models.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib52.1.1">Advances in Neural Information Processing Systems</em>, 31, 2018.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib53">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Vaswani et al. (2017)</span>
<span class="ltx_bibblock">
Vaswani, A., Shazeer, N., Parmar, N., Uszkoreit, J., Jones, L., Gomez, A. N., Kaiser, Ł., and Polosukhin, I.

</span>
<span class="ltx_bibblock">Attention is all you need.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib53.1.1">Advances in neural information processing systems</em>, 30, 2017.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib54">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Wang et al. (2019)</span>
<span class="ltx_bibblock">
Wang, A., Pruksachatkun, Y., Nangia, N., Singh, A., Michael, J., Hill, F., Levy, O., and Bowman, S. R.

</span>
<span class="ltx_bibblock">Superglue: A stickier benchmark for general-purpose language understanding systems.

</span>
<span class="ltx_bibblock">In Wallach, H. M., Larochelle, H., Beygelzimer, A., d’Alché-Buc, F., Fox, E. B., and Garnett, R. (eds.), <em class="ltx_emph ltx_font_italic" id="bib.bib54.1.1">Advances in Neural Information Processing Systems 32: Annual Conference on Neural Information Processing Systems 2019, NeurIPS 2019, December 8-14, 2019, Vancouver, BC, Canada</em>, pp.  3261–3275, 2019.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://proceedings.neurips.cc/paper/2019/hash/4496bf24afe7fab6f046bf4923da8de6-Abstract.html" title="">https://proceedings.neurips.cc/paper/2019/hash/4496bf24afe7fab6f046bf4923da8de6-Abstract.html</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib55">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Wang et al. (2021)</span>
<span class="ltx_bibblock">
Wang, H., Zhang, Z., and Han, S.

</span>
<span class="ltx_bibblock">Spatten: Efficient sparse attention architecture with cascade token and head pruning.

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib55.1.1">2021 IEEE International Symposium on High-Performance Computer Architecture (HPCA)</em>, pp.  97–110. IEEE, 2021.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib56">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Xia et al. (2023)</span>
<span class="ltx_bibblock">
Xia, H., Zheng, Z., Li, Y., Zhuang, D., Zhou, Z., Qiu, X., Li, Y., Lin, W., and Song, S. L.

</span>
<span class="ltx_bibblock">Flash-llm: Enabling cost-effective and highly-efficient large generative model inference with unstructured sparsity.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib56.1.1">arXiv preprint arXiv:2309.10285</em>, 2023.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib57">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Yi et al. (2023)</span>
<span class="ltx_bibblock">
Yi, R., Guo, L., Wei, S., Zhou, A., Wang, S., and Xu, M.

</span>
<span class="ltx_bibblock">Edgemoe: Fast on-device inference of moe-based large language models.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib57.1.1">arXiv preprint arXiv:2308.14352</em>, 2023.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib58">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Zellers et al. (2019)</span>
<span class="ltx_bibblock">
Zellers, R., Holtzman, A., Bisk, Y., Farhadi, A., and Choi, Y.

</span>
<span class="ltx_bibblock">Hellaswag: Can a machine really finish your sentence?

</span>
<span class="ltx_bibblock">In Korhonen, A., Traum, D. R., and Màrquez, L. (eds.), <em class="ltx_emph ltx_font_italic" id="bib.bib58.1.1">Proceedings of the 57th Conference of the Association for Computational Linguistics, ACL 2019, Florence, Italy, July 28- August 2, 2019, Volume 1: Long Papers</em>, pp.  4791–4800. Association for Computational Linguistics, 2019.

</span>
<span class="ltx_bibblock">doi: <a class="ltx_ref ltx_Url" href="10.18653/V1/P19-1472" title="">10.18653/V1/P19-1472</a>.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://doi.org/10.18653/v1/p19-1472" title="">https://doi.org/10.18653/v1/p19-1472</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib59">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Zeng et al. (2023)</span>
<span class="ltx_bibblock">
Zeng, Z., Davies, M., Pulijala, P., Sankaralingam, K., and Singh, V.

</span>
<span class="ltx_bibblock">Lookupffn: making transformers compute-lite for cpu inference.

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib59.1.1">International Conference on Machine Learning</em>, pp.  40707–40718. PMLR, 2023.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib60">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Zerva et al. (2022)</span>
<span class="ltx_bibblock">
Zerva, C., Blain, F., Rei, R., Lertvittayakumjorn, P., de Souza, J. G. C., Eger, S., Kanojia, D., Alves, D. M., Orasan, C., Fomicheva, M., Martins, A. F. T., and Specia, L.

</span>
<span class="ltx_bibblock">Findings of the WMT 2022 shared task on quality estimation.

</span>
<span class="ltx_bibblock">In Koehn, P., Barrault, L., Bojar, O., Bougares, F., Chatterjee, R., Costa-jussà, M. R., Federmann, C., Fishel, M., Fraser, A., Freitag, M., Graham, Y., Grundkiewicz, R., Guzman, P., Haddow, B., Huck, M., Jimeno-Yepes, A., Kocmi, T., Martins, A., Morishita, M., Monz, C., Nagata, M., Nakazawa, T., Negri, M., Névéol, A., Neves, M., Popel, M., Turchi, M., and Zampieri, M. (eds.), <em class="ltx_emph ltx_font_italic" id="bib.bib60.1.1">Proceedings of the Seventh Conference on Machine Translation, WMT 2022, Abu Dhabi, United Arab Emirates (Hybrid), December 7-8, 2022</em>, pp.  69–99. Association for Computational Linguistics, 2022.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://aclanthology.org/2022.wmt-1.3" title="">https://aclanthology.org/2022.wmt-1.3</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib61">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Zhang et al. (2018)</span>
<span class="ltx_bibblock">
Zhang, S., Liu, X., Liu, J., Gao, J., Duh, K., and Durme, B. V.

</span>
<span class="ltx_bibblock">Record: Bridging the gap between human and machine commonsense reading comprehension.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib61.1.1">CoRR</em>, abs/1810.12885, 2018.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="http://arxiv.org/abs/1810.12885" title="">http://arxiv.org/abs/1810.12885</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib62">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Zhao et al. (2023)</span>
<span class="ltx_bibblock">
Zhao, Y., Lin, C.-Y., Zhu, K., Ye, Z., Chen, L., Zheng, S., Ceze, L., Krishnamurthy, A., Chen, T., and Kasikci, B.

</span>
<span class="ltx_bibblock">Atom: Low-bit quantization for efficient and accurate llm serving.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib62.1.1">arXiv preprint arXiv:2310.19102</em>, 2023.

</span>
</li>
</ul>
</section>
<div class="ltx_pagination ltx_role_newpage"></div>
<section class="ltx_appendix" id="A1">
<h2 class="ltx_title ltx_title_appendix">
<span class="ltx_tag ltx_tag_appendix">Appendix A </span>Dataset details</h2>
<div class="ltx_para" id="A1.p1">
<ol class="ltx_enumerate" id="A1.I1">
<li class="ltx_item" id="A1.I1.i1" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">1.</span>
<div class="ltx_para" id="A1.I1.i1.p1">
<p class="ltx_p" id="A1.I1.i1.p1.1"><span class="ltx_text ltx_font_bold" id="A1.I1.i1.p1.1.1">Machine Translation</span>: We use English-French tasks from WMT14 <cite class="ltx_cite ltx_citemacro_citep">(Bojar et al., <a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#bib.bib9" title="">2014</a>)</cite> and German-French tasks from WMT22 <cite class="ltx_cite ltx_citemacro_citep">(Zerva et al., <a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#bib.bib60" title="">2022</a>)</cite></p>
</div>
</li>
<li class="ltx_item" id="A1.I1.i2" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">2.</span>
<div class="ltx_para" id="A1.I1.i2.p1">
<p class="ltx_p" id="A1.I1.i2.p1.1"><span class="ltx_text ltx_font_bold" id="A1.I1.i2.p1.1.1">SuperGLUE Benchmark</span>: We use multiple SuperGLUE <cite class="ltx_cite ltx_citemacro_citep">(Wang et al., <a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#bib.bib54" title="">2019</a>)</cite> tasks such as BoolQ <cite class="ltx_cite ltx_citemacro_citep">(Clark et al., <a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#bib.bib10" title="">2019</a>)</cite>, CommitmentBank <cite class="ltx_cite ltx_citemacro_citep">(de Marneffe et al., <a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#bib.bib15" title="">2019</a>)</cite>, Choice of Plausible Alternatives <cite class="ltx_cite ltx_citemacro_citep">(Roemmele et al., <a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#bib.bib48" title="">2011</a>)</cite>, Multi Sentence Reading Comprehension <cite class="ltx_cite ltx_citemacro_citep">(Khashabi et al., <a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#bib.bib26" title="">2018</a>)</cite>, Recognizing Textual Entailment, Words in Context <cite class="ltx_cite ltx_citemacro_citep">(Pilehvar &amp; Camacho-Collados, <a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#bib.bib43" title="">2019</a>)</cite>, Winograd Schema Challenge <cite class="ltx_cite ltx_citemacro_citep">(Levesque et al., <a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#bib.bib29" title="">2012</a>)</cite> and Reading Comprehension with Commonsense Reasoning (ReCoRD) <cite class="ltx_cite ltx_citemacro_citep">(Zhang et al., <a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#bib.bib61" title="">2018</a>)</cite>.</p>
</div>
</li>
<li class="ltx_item" id="A1.I1.i3" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">3.</span>
<div class="ltx_para" id="A1.I1.i3.p1">
<p class="ltx_p" id="A1.I1.i3.p1.1"><span class="ltx_text ltx_font_bold" id="A1.I1.i3.p1.1.1">Question Answering</span>: We use SQuADv2 <cite class="ltx_cite ltx_citemacro_citep">(Rajpurkar et al., <a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#bib.bib47" title="">2018</a>)</cite>, TriviaQA <cite class="ltx_cite ltx_citemacro_citep">(Joshi et al., <a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#bib.bib25" title="">2017</a>)</cite>, NaturalQuestions <cite class="ltx_cite ltx_citemacro_citep">(Kwiatkowski et al., <a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#bib.bib27" title="">2019</a>)</cite>, WebQuestions <cite class="ltx_cite ltx_citemacro_citep">(Berant et al., <a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#bib.bib7" title="">2013</a>)</cite> and TyDiQA-English <cite class="ltx_cite ltx_citemacro_citep">(Clark et al., <a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#bib.bib11" title="">2020</a>)</cite>.</p>
</div>
</li>
<li class="ltx_item" id="A1.I1.i4" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">4.</span>
<div class="ltx_para" id="A1.I1.i4.p1">
<p class="ltx_p" id="A1.I1.i4.p1.1"><span class="ltx_text ltx_font_bold" id="A1.I1.i4.p1.1.1">Discriminative Tasks</span>: We use additional tasks to evaluate <em class="ltx_emph ltx_font_italic" id="A1.I1.i4.p1.1.2">commonsense reasoning</em> (ARC <cite class="ltx_cite ltx_citemacro_citep">(Clark et al., <a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#bib.bib12" title="">2018</a>)</cite>, HellaSwag <cite class="ltx_cite ltx_citemacro_citep">(Zellers et al., <a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#bib.bib58" title="">2019</a>)</cite>, WinoGrande <cite class="ltx_cite ltx_citemacro_citep">(Sakaguchi et al., <a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#bib.bib49" title="">2021</a>)</cite>, PIQA <cite class="ltx_cite ltx_citemacro_citep">(Bisk et al., <a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#bib.bib8" title="">2020</a>)</cite> and Story Cloze <cite class="ltx_cite ltx_citemacro_citep">(Mostafazadeh et al., <a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#bib.bib39" title="">2016</a>)</cite>), <em class="ltx_emph ltx_font_italic" id="A1.I1.i4.p1.1.3">question answering</em> (RACE, <cite class="ltx_cite ltx_citemacro_citep">(Lai et al., <a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#bib.bib28" title="">2017</a>)</cite> and OpenBookQA <cite class="ltx_cite ltx_citemacro_citep">(Mihaylov et al., <a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#bib.bib37" title="">2018</a>)</cite>) and <em class="ltx_emph ltx_font_italic" id="A1.I1.i4.p1.1.4">Textual Entailment</em> (ANLI <cite class="ltx_cite ltx_citemacro_citep">(Nie et al., <a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#bib.bib41" title="">2020</a>)</cite>).</p>
</div>
</li>
</ol>
</div>
</section>
<section class="ltx_appendix" id="A2">
<h2 class="ltx_title ltx_title_appendix">
<span class="ltx_tag ltx_tag_appendix">Appendix B </span>Additional Results</h2>
<figure class="ltx_figure" id="A2.F3"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_landscape" height="229" id="A2.F3.g1" src="extracted/5409158/figures/group_sparsity.png" width="568"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure">Figure 3: </span>Efficiency of memory transfer vs group sizes: For a tensor of dimension <math alttext="n\times g\times d" class="ltx_Math" display="inline" id="A2.F3.7.m1.1"><semantics id="A2.F3.7.m1.1b"><mrow id="A2.F3.7.m1.1.1" xref="A2.F3.7.m1.1.1.cmml"><mi id="A2.F3.7.m1.1.1.2" xref="A2.F3.7.m1.1.1.2.cmml">n</mi><mo id="A2.F3.7.m1.1.1.1" lspace="0.222em" rspace="0.222em" xref="A2.F3.7.m1.1.1.1.cmml">×</mo><mi id="A2.F3.7.m1.1.1.3" xref="A2.F3.7.m1.1.1.3.cmml">g</mi><mo id="A2.F3.7.m1.1.1.1b" lspace="0.222em" rspace="0.222em" xref="A2.F3.7.m1.1.1.1.cmml">×</mo><mi id="A2.F3.7.m1.1.1.4" xref="A2.F3.7.m1.1.1.4.cmml">d</mi></mrow><annotation-xml encoding="MathML-Content" id="A2.F3.7.m1.1c"><apply id="A2.F3.7.m1.1.1.cmml" xref="A2.F3.7.m1.1.1"><times id="A2.F3.7.m1.1.1.1.cmml" xref="A2.F3.7.m1.1.1.1"></times><ci id="A2.F3.7.m1.1.1.2.cmml" xref="A2.F3.7.m1.1.1.2">𝑛</ci><ci id="A2.F3.7.m1.1.1.3.cmml" xref="A2.F3.7.m1.1.1.3">𝑔</ci><ci id="A2.F3.7.m1.1.1.4.cmml" xref="A2.F3.7.m1.1.1.4">𝑑</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="A2.F3.7.m1.1d">n\times g\times d</annotation><annotation encoding="application/x-llamapun" id="A2.F3.7.m1.1e">italic_n × italic_g × italic_d</annotation></semantics></math>, which we consider as <math alttext="n" class="ltx_Math" display="inline" id="A2.F3.8.m2.1"><semantics id="A2.F3.8.m2.1b"><mi id="A2.F3.8.m2.1.1" xref="A2.F3.8.m2.1.1.cmml">n</mi><annotation-xml encoding="MathML-Content" id="A2.F3.8.m2.1c"><ci id="A2.F3.8.m2.1.1.cmml" xref="A2.F3.8.m2.1.1">𝑛</ci></annotation-xml><annotation encoding="application/x-tex" id="A2.F3.8.m2.1d">n</annotation><annotation encoding="application/x-llamapun" id="A2.F3.8.m2.1e">italic_n</annotation></semantics></math> groups, each with <math alttext="g" class="ltx_Math" display="inline" id="A2.F3.9.m3.1"><semantics id="A2.F3.9.m3.1b"><mi id="A2.F3.9.m3.1.1" xref="A2.F3.9.m3.1.1.cmml">g</mi><annotation-xml encoding="MathML-Content" id="A2.F3.9.m3.1c"><ci id="A2.F3.9.m3.1.1.cmml" xref="A2.F3.9.m3.1.1">𝑔</ci></annotation-xml><annotation encoding="application/x-tex" id="A2.F3.9.m3.1d">g</annotation><annotation encoding="application/x-llamapun" id="A2.F3.9.m3.1e">italic_g</annotation></semantics></math> vectors of dimension <math alttext="d" class="ltx_Math" display="inline" id="A2.F3.10.m4.1"><semantics id="A2.F3.10.m4.1b"><mi id="A2.F3.10.m4.1.1" xref="A2.F3.10.m4.1.1.cmml">d</mi><annotation-xml encoding="MathML-Content" id="A2.F3.10.m4.1c"><ci id="A2.F3.10.m4.1.1.cmml" xref="A2.F3.10.m4.1.1">𝑑</ci></annotation-xml><annotation encoding="application/x-tex" id="A2.F3.10.m4.1d">d</annotation><annotation encoding="application/x-llamapun" id="A2.F3.10.m4.1e">italic_d</annotation></semantics></math>, we plot the efficiency of transferring a random (non-contiguous) subset of groups from HBM to cache as we vary the group size <math alttext="g" class="ltx_Math" display="inline" id="A2.F3.11.m5.1"><semantics id="A2.F3.11.m5.1b"><mi id="A2.F3.11.m5.1.1" xref="A2.F3.11.m5.1.1.cmml">g</mi><annotation-xml encoding="MathML-Content" id="A2.F3.11.m5.1c"><ci id="A2.F3.11.m5.1.1.cmml" xref="A2.F3.11.m5.1.1">𝑔</ci></annotation-xml><annotation encoding="application/x-tex" id="A2.F3.11.m5.1d">g</annotation><annotation encoding="application/x-llamapun" id="A2.F3.11.m5.1e">italic_g</annotation></semantics></math> on the x-axis. Efficiency is defined as the time taken by the sparse operation divided by the time taken by an equivalent dense operation moving the same number of bytes. The numbers are computed for Cloud TPUv5e. As is clear from the figure, even small group sizes such as <math alttext="8" class="ltx_Math" display="inline" id="A2.F3.12.m6.1"><semantics id="A2.F3.12.m6.1b"><mn id="A2.F3.12.m6.1.1" xref="A2.F3.12.m6.1.1.cmml">8</mn><annotation-xml encoding="MathML-Content" id="A2.F3.12.m6.1c"><cn id="A2.F3.12.m6.1.1.cmml" type="integer" xref="A2.F3.12.m6.1.1">8</cn></annotation-xml><annotation encoding="application/x-tex" id="A2.F3.12.m6.1d">8</annotation><annotation encoding="application/x-llamapun" id="A2.F3.12.m6.1e">8</annotation></semantics></math> lead to very high efficiency, motivating the group sparse structure in our feedforward layers.</figcaption>
</figure>
<figure class="ltx_table" id="A2.T6">
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_table">Table 6: </span>Do we need to recall more elements than <math alttext="k" class="ltx_Math" display="inline" id="A2.T6.13.m1.1"><semantics id="A2.T6.13.m1.1b"><mi id="A2.T6.13.m1.1.1" xref="A2.T6.13.m1.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="A2.T6.13.m1.1c"><ci id="A2.T6.13.m1.1.1.cmml" xref="A2.T6.13.m1.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="A2.T6.13.m1.1d">k</annotation><annotation encoding="application/x-llamapun" id="A2.T6.13.m1.1e">italic_k</annotation></semantics></math> in HiRE-FFN?: Each column contains pretraining metrics for the HiRE-FFN model by using various values of <math alttext="k^{\prime}" class="ltx_Math" display="inline" id="A2.T6.14.m2.1"><semantics id="A2.T6.14.m2.1b"><msup id="A2.T6.14.m2.1.1" xref="A2.T6.14.m2.1.1.cmml"><mi id="A2.T6.14.m2.1.1.2" xref="A2.T6.14.m2.1.1.2.cmml">k</mi><mo id="A2.T6.14.m2.1.1.3" xref="A2.T6.14.m2.1.1.3.cmml">′</mo></msup><annotation-xml encoding="MathML-Content" id="A2.T6.14.m2.1c"><apply id="A2.T6.14.m2.1.1.cmml" xref="A2.T6.14.m2.1.1"><csymbol cd="ambiguous" id="A2.T6.14.m2.1.1.1.cmml" xref="A2.T6.14.m2.1.1">superscript</csymbol><ci id="A2.T6.14.m2.1.1.2.cmml" xref="A2.T6.14.m2.1.1.2">𝑘</ci><ci id="A2.T6.14.m2.1.1.3.cmml" xref="A2.T6.14.m2.1.1.3">′</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="A2.T6.14.m2.1d">k^{\prime}</annotation><annotation encoding="application/x-llamapun" id="A2.T6.14.m2.1e">italic_k start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT</annotation></semantics></math> and <math alttext="k" class="ltx_Math" display="inline" id="A2.T6.15.m3.1"><semantics id="A2.T6.15.m3.1b"><mi id="A2.T6.15.m3.1.1" xref="A2.T6.15.m3.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="A2.T6.15.m3.1c"><ci id="A2.T6.15.m3.1.1.cmml" xref="A2.T6.15.m3.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="A2.T6.15.m3.1d">k</annotation><annotation encoding="application/x-llamapun" id="A2.T6.15.m3.1e">italic_k</annotation></semantics></math> (indicated in the table as <math alttext="(k^{\prime},k)" class="ltx_Math" display="inline" id="A2.T6.16.m4.2"><semantics id="A2.T6.16.m4.2b"><mrow id="A2.T6.16.m4.2.2.1" xref="A2.T6.16.m4.2.2.2.cmml"><mo id="A2.T6.16.m4.2.2.1.2" stretchy="false" xref="A2.T6.16.m4.2.2.2.cmml">(</mo><msup id="A2.T6.16.m4.2.2.1.1" xref="A2.T6.16.m4.2.2.1.1.cmml"><mi id="A2.T6.16.m4.2.2.1.1.2" xref="A2.T6.16.m4.2.2.1.1.2.cmml">k</mi><mo id="A2.T6.16.m4.2.2.1.1.3" xref="A2.T6.16.m4.2.2.1.1.3.cmml">′</mo></msup><mo id="A2.T6.16.m4.2.2.1.3" xref="A2.T6.16.m4.2.2.2.cmml">,</mo><mi id="A2.T6.16.m4.1.1" xref="A2.T6.16.m4.1.1.cmml">k</mi><mo id="A2.T6.16.m4.2.2.1.4" stretchy="false" xref="A2.T6.16.m4.2.2.2.cmml">)</mo></mrow><annotation-xml encoding="MathML-Content" id="A2.T6.16.m4.2c"><interval closure="open" id="A2.T6.16.m4.2.2.2.cmml" xref="A2.T6.16.m4.2.2.1"><apply id="A2.T6.16.m4.2.2.1.1.cmml" xref="A2.T6.16.m4.2.2.1.1"><csymbol cd="ambiguous" id="A2.T6.16.m4.2.2.1.1.1.cmml" xref="A2.T6.16.m4.2.2.1.1">superscript</csymbol><ci id="A2.T6.16.m4.2.2.1.1.2.cmml" xref="A2.T6.16.m4.2.2.1.1.2">𝑘</ci><ci id="A2.T6.16.m4.2.2.1.1.3.cmml" xref="A2.T6.16.m4.2.2.1.1.3">′</ci></apply><ci id="A2.T6.16.m4.1.1.cmml" xref="A2.T6.16.m4.1.1">𝑘</ci></interval></annotation-xml><annotation encoding="application/x-tex" id="A2.T6.16.m4.2d">(k^{\prime},k)</annotation><annotation encoding="application/x-llamapun" id="A2.T6.16.m4.2e">( italic_k start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT , italic_k )</annotation></semantics></math>), in comparison with the dense baseline model <math alttext="\mathcal{M}_{\textrm{base}}" class="ltx_Math" display="inline" id="A2.T6.17.m5.1"><semantics id="A2.T6.17.m5.1b"><msub id="A2.T6.17.m5.1.1" xref="A2.T6.17.m5.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="A2.T6.17.m5.1.1.2" xref="A2.T6.17.m5.1.1.2.cmml">ℳ</mi><mtext id="A2.T6.17.m5.1.1.3" xref="A2.T6.17.m5.1.1.3a.cmml">base</mtext></msub><annotation-xml encoding="MathML-Content" id="A2.T6.17.m5.1c"><apply id="A2.T6.17.m5.1.1.cmml" xref="A2.T6.17.m5.1.1"><csymbol cd="ambiguous" id="A2.T6.17.m5.1.1.1.cmml" xref="A2.T6.17.m5.1.1">subscript</csymbol><ci id="A2.T6.17.m5.1.1.2.cmml" xref="A2.T6.17.m5.1.1.2">ℳ</ci><ci id="A2.T6.17.m5.1.1.3a.cmml" xref="A2.T6.17.m5.1.1.3"><mtext id="A2.T6.17.m5.1.1.3.cmml" mathsize="70%" xref="A2.T6.17.m5.1.1.3">base</mtext></ci></apply></annotation-xml><annotation encoding="application/x-tex" id="A2.T6.17.m5.1d">\mathcal{M}_{\textrm{base}}</annotation><annotation encoding="application/x-llamapun" id="A2.T6.17.m5.1e">caligraphic_M start_POSTSUBSCRIPT base end_POSTSUBSCRIPT</annotation></semantics></math>. <span class="ltx_text ltx_font_italic" id="A2.T6.26.1">Full</span> denotes <math alttext="k^{\prime}" class="ltx_Math" display="inline" id="A2.T6.18.m6.1"><semantics id="A2.T6.18.m6.1b"><msup id="A2.T6.18.m6.1.1" xref="A2.T6.18.m6.1.1.cmml"><mi id="A2.T6.18.m6.1.1.2" xref="A2.T6.18.m6.1.1.2.cmml">k</mi><mo id="A2.T6.18.m6.1.1.3" xref="A2.T6.18.m6.1.1.3.cmml">′</mo></msup><annotation-xml encoding="MathML-Content" id="A2.T6.18.m6.1c"><apply id="A2.T6.18.m6.1.1.cmml" xref="A2.T6.18.m6.1.1"><csymbol cd="ambiguous" id="A2.T6.18.m6.1.1.1.cmml" xref="A2.T6.18.m6.1.1">superscript</csymbol><ci id="A2.T6.18.m6.1.1.2.cmml" xref="A2.T6.18.m6.1.1.2">𝑘</ci><ci id="A2.T6.18.m6.1.1.3.cmml" xref="A2.T6.18.m6.1.1.3">′</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="A2.T6.18.m6.1d">k^{\prime}</annotation><annotation encoding="application/x-llamapun" id="A2.T6.18.m6.1e">italic_k start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT</annotation></semantics></math>=<math alttext="m" class="ltx_Math" display="inline" id="A2.T6.19.m7.1"><semantics id="A2.T6.19.m7.1b"><mi id="A2.T6.19.m7.1.1" xref="A2.T6.19.m7.1.1.cmml">m</mi><annotation-xml encoding="MathML-Content" id="A2.T6.19.m7.1c"><ci id="A2.T6.19.m7.1.1.cmml" xref="A2.T6.19.m7.1.1">𝑚</ci></annotation-xml><annotation encoding="application/x-tex" id="A2.T6.19.m7.1d">m</annotation><annotation encoding="application/x-llamapun" id="A2.T6.19.m7.1e">italic_m</annotation></semantics></math> where <math alttext="m" class="ltx_Math" display="inline" id="A2.T6.20.m8.1"><semantics id="A2.T6.20.m8.1b"><mi id="A2.T6.20.m8.1.1" xref="A2.T6.20.m8.1.1.cmml">m</mi><annotation-xml encoding="MathML-Content" id="A2.T6.20.m8.1c"><ci id="A2.T6.20.m8.1.1.cmml" xref="A2.T6.20.m8.1.1">𝑚</ci></annotation-xml><annotation encoding="application/x-tex" id="A2.T6.20.m8.1d">m</annotation><annotation encoding="application/x-llamapun" id="A2.T6.20.m8.1e">italic_m</annotation></semantics></math> is the total number of hidden units. Baseline refers to dense model trained without the top-<math alttext="k" class="ltx_Math" display="inline" id="A2.T6.21.m9.1"><semantics id="A2.T6.21.m9.1b"><mi id="A2.T6.21.m9.1.1" xref="A2.T6.21.m9.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="A2.T6.21.m9.1c"><ci id="A2.T6.21.m9.1.1.cmml" xref="A2.T6.21.m9.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="A2.T6.21.m9.1d">k</annotation><annotation encoding="application/x-llamapun" id="A2.T6.21.m9.1e">italic_k</annotation></semantics></math> operation. As we can see from the results, using a larger <math alttext="k^{\prime}" class="ltx_Math" display="inline" id="A2.T6.22.m10.1"><semantics id="A2.T6.22.m10.1b"><msup id="A2.T6.22.m10.1.1" xref="A2.T6.22.m10.1.1.cmml"><mi id="A2.T6.22.m10.1.1.2" xref="A2.T6.22.m10.1.1.2.cmml">k</mi><mo id="A2.T6.22.m10.1.1.3" xref="A2.T6.22.m10.1.1.3.cmml">′</mo></msup><annotation-xml encoding="MathML-Content" id="A2.T6.22.m10.1c"><apply id="A2.T6.22.m10.1.1.cmml" xref="A2.T6.22.m10.1.1"><csymbol cd="ambiguous" id="A2.T6.22.m10.1.1.1.cmml" xref="A2.T6.22.m10.1.1">superscript</csymbol><ci id="A2.T6.22.m10.1.1.2.cmml" xref="A2.T6.22.m10.1.1.2">𝑘</ci><ci id="A2.T6.22.m10.1.1.3.cmml" xref="A2.T6.22.m10.1.1.3">′</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="A2.T6.22.m10.1d">k^{\prime}</annotation><annotation encoding="application/x-llamapun" id="A2.T6.22.m10.1e">italic_k start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT</annotation></semantics></math> compared to <math alttext="k" class="ltx_Math" display="inline" id="A2.T6.23.m11.1"><semantics id="A2.T6.23.m11.1b"><mi id="A2.T6.23.m11.1.1" xref="A2.T6.23.m11.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="A2.T6.23.m11.1c"><ci id="A2.T6.23.m11.1.1.cmml" xref="A2.T6.23.m11.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="A2.T6.23.m11.1d">k</annotation><annotation encoding="application/x-llamapun" id="A2.T6.23.m11.1e">italic_k</annotation></semantics></math> is critical for bridging the quality gap between the dense and top-<math alttext="k" class="ltx_Math" display="inline" id="A2.T6.24.m12.1"><semantics id="A2.T6.24.m12.1b"><mi id="A2.T6.24.m12.1.1" xref="A2.T6.24.m12.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="A2.T6.24.m12.1c"><ci id="A2.T6.24.m12.1.1.cmml" xref="A2.T6.24.m12.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="A2.T6.24.m12.1d">k</annotation><annotation encoding="application/x-llamapun" id="A2.T6.24.m12.1e">italic_k</annotation></semantics></math> models.</figcaption>
<table class="ltx_tabular ltx_centering ltx_align_middle" id="A2.T6.27">
<tr class="ltx_tr" id="A2.T6.27.1">
<td class="ltx_td ltx_border_l ltx_border_r ltx_border_t" colspan="2" id="A2.T6.27.1.1"></td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="A2.T6.27.1.2">(128, 128)</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="A2.T6.27.1.3">(192, 128)</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="A2.T6.27.1.4">(256, 128)</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="A2.T6.27.1.5">(Full, 128)</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="A2.T6.27.1.6">Baseline</td>
</tr>
<tr class="ltx_tr" id="A2.T6.27.2">
<td class="ltx_td ltx_align_center ltx_border_b ltx_border_l ltx_border_r ltx_border_t" id="A2.T6.27.2.1" rowspan="2"><span class="ltx_text" id="A2.T6.27.2.1.1"><span class="ltx_text" id="A2.T6.27.2.1.1.1"></span> <span class="ltx_text" id="A2.T6.27.2.1.1.2">
<span class="ltx_tabular ltx_align_middle" id="A2.T6.27.2.1.1.2.1">
<span class="ltx_tr" id="A2.T6.27.2.1.1.2.1.1">
<span class="ltx_td ltx_align_center" id="A2.T6.27.2.1.1.2.1.1.1">Pre-training</span></span>
<span class="ltx_tr" id="A2.T6.27.2.1.1.2.1.2">
<span class="ltx_td ltx_align_center" id="A2.T6.27.2.1.1.2.1.2.1">Performance</span></span>
</span></span> <span class="ltx_text" id="A2.T6.27.2.1.1.3"></span></span></td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="A2.T6.27.2.2">Top1 Accuracy</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="A2.T6.27.2.3">56.81%</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="A2.T6.27.2.4">56.96%</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="A2.T6.27.2.5">57.03%</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="A2.T6.27.2.6">57.05%</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="A2.T6.27.2.7">57.15%</td>
</tr>
<tr class="ltx_tr" id="A2.T6.27.3">
<td class="ltx_td ltx_align_center ltx_border_b ltx_border_r ltx_border_t" id="A2.T6.27.3.1">Perplexity</td>
<td class="ltx_td ltx_align_center ltx_border_b ltx_border_r ltx_border_t" id="A2.T6.27.3.2">2.071</td>
<td class="ltx_td ltx_align_center ltx_border_b ltx_border_r ltx_border_t" id="A2.T6.27.3.3">2.06</td>
<td class="ltx_td ltx_align_center ltx_border_b ltx_border_r ltx_border_t" id="A2.T6.27.3.4">2.056</td>
<td class="ltx_td ltx_align_center ltx_border_b ltx_border_r ltx_border_t" id="A2.T6.27.3.5">2.054</td>
<td class="ltx_td ltx_align_center ltx_border_b ltx_border_r ltx_border_t" id="A2.T6.27.3.6">2.045</td>
</tr>
</table>
</figure>
<figure class="ltx_table" id="A2.T7">
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_table">Table 7: </span>Importance of learned low rank matrix. This table presents the pretraining metrics by using random vs learned low rank projection. As we can see, learning the projection matrix is crucial for maintaining quality.</figcaption>
<table class="ltx_tabular ltx_centering ltx_align_middle" id="A2.T7.1">
<tr class="ltx_tr" id="A2.T7.1.1">
<td class="ltx_td ltx_border_l ltx_border_r ltx_border_t" colspan="2" id="A2.T7.1.1.1"></td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="A2.T7.1.1.2" rowspan="2"><span class="ltx_text" id="A2.T7.1.1.2.1">Baseline</span></td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="A2.T7.1.1.3">Trained, k=384</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" colspan="4" id="A2.T7.1.1.4">Random, k=384</td>
</tr>
<tr class="ltx_tr" id="A2.T7.1.2">
<td class="ltx_td ltx_border_l ltx_border_r" colspan="2" id="A2.T7.1.2.1"></td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="A2.T7.1.2.2">r=25%</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="A2.T7.1.2.3">r=25%</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="A2.T7.1.2.4">r=33%</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="A2.T7.1.2.5">r=50%</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="A2.T7.1.2.6">r=66%</td>
</tr>
<tr class="ltx_tr" id="A2.T7.1.3">
<td class="ltx_td ltx_align_center ltx_border_b ltx_border_l ltx_border_r ltx_border_t" id="A2.T7.1.3.1" rowspan="2"><span class="ltx_text" id="A2.T7.1.3.1.1"><span class="ltx_text" id="A2.T7.1.3.1.1.1"></span> <span class="ltx_text" id="A2.T7.1.3.1.1.2">
<span class="ltx_tabular ltx_align_middle" id="A2.T7.1.3.1.1.2.1">
<span class="ltx_tr" id="A2.T7.1.3.1.1.2.1.1">
<span class="ltx_td ltx_align_center" id="A2.T7.1.3.1.1.2.1.1.1">Pre-training</span></span>
<span class="ltx_tr" id="A2.T7.1.3.1.1.2.1.2">
<span class="ltx_td ltx_align_center" id="A2.T7.1.3.1.1.2.1.2.1">Performance</span></span>
</span></span> <span class="ltx_text" id="A2.T7.1.3.1.1.3"></span></span></td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="A2.T7.1.3.2">Top1 Accuracy</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="A2.T7.1.3.3">57.40%</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="A2.T7.1.3.4">57.29%</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="A2.T7.1.3.5">46.78%</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="A2.T7.1.3.6">49.26%</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="A2.T7.1.3.7">54.02%</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="A2.T7.1.3.8">55.81%</td>
</tr>
<tr class="ltx_tr" id="A2.T7.1.4">
<td class="ltx_td ltx_align_center ltx_border_b ltx_border_r ltx_border_t" id="A2.T7.1.4.1">Top32 Intersection</td>
<td class="ltx_td ltx_align_center ltx_border_b ltx_border_r ltx_border_t" id="A2.T7.1.4.2">32.0</td>
<td class="ltx_td ltx_align_center ltx_border_b ltx_border_r ltx_border_t" id="A2.T7.1.4.3">29.26</td>
<td class="ltx_td ltx_align_center ltx_border_b ltx_border_r ltx_border_t" id="A2.T7.1.4.4">15.53</td>
<td class="ltx_td ltx_align_center ltx_border_b ltx_border_r ltx_border_t" id="A2.T7.1.4.5">18.42</td>
<td class="ltx_td ltx_align_center ltx_border_b ltx_border_r ltx_border_t" id="A2.T7.1.4.6">24.21</td>
<td class="ltx_td ltx_align_center ltx_border_b ltx_border_r ltx_border_t" id="A2.T7.1.4.7">26.89</td>
</tr>
</table>
</figure>
<figure class="ltx_table" id="A2.T8">
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_table">Table 8: </span>Ablation on architectures: We train models with multiple sparse FFN layer configurations and evaluate with approximate <math alttext="k^{\prime}" class="ltx_Math" display="inline" id="A2.T8.9.m1.1"><semantics id="A2.T8.9.m1.1b"><msup id="A2.T8.9.m1.1.1" xref="A2.T8.9.m1.1.1.cmml"><mi id="A2.T8.9.m1.1.1.2" xref="A2.T8.9.m1.1.1.2.cmml">k</mi><mo id="A2.T8.9.m1.1.1.3" xref="A2.T8.9.m1.1.1.3.cmml">′</mo></msup><annotation-xml encoding="MathML-Content" id="A2.T8.9.m1.1c"><apply id="A2.T8.9.m1.1.1.cmml" xref="A2.T8.9.m1.1.1"><csymbol cd="ambiguous" id="A2.T8.9.m1.1.1.1.cmml" xref="A2.T8.9.m1.1.1">superscript</csymbol><ci id="A2.T8.9.m1.1.1.2.cmml" xref="A2.T8.9.m1.1.1.2">𝑘</ci><ci id="A2.T8.9.m1.1.1.3.cmml" xref="A2.T8.9.m1.1.1.3">′</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="A2.T8.9.m1.1d">k^{\prime}</annotation><annotation encoding="application/x-llamapun" id="A2.T8.9.m1.1e">italic_k start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT</annotation></semantics></math> = 256 and <math alttext="k" class="ltx_Math" display="inline" id="A2.T8.10.m2.1"><semantics id="A2.T8.10.m2.1b"><mi id="A2.T8.10.m2.1.1" xref="A2.T8.10.m2.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="A2.T8.10.m2.1c"><ci id="A2.T8.10.m2.1.1.cmml" xref="A2.T8.10.m2.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="A2.T8.10.m2.1d">k</annotation><annotation encoding="application/x-llamapun" id="A2.T8.10.m2.1e">italic_k</annotation></semantics></math> = 128 for all models. <math alttext="L" class="ltx_Math" display="inline" id="A2.T8.11.m3.1"><semantics id="A2.T8.11.m3.1b"><mi id="A2.T8.11.m3.1.1" xref="A2.T8.11.m3.1.1.cmml">L</mi><annotation-xml encoding="MathML-Content" id="A2.T8.11.m3.1c"><ci id="A2.T8.11.m3.1.1.cmml" xref="A2.T8.11.m3.1.1">𝐿</ci></annotation-xml><annotation encoding="application/x-tex" id="A2.T8.11.m3.1d">L</annotation><annotation encoding="application/x-llamapun" id="A2.T8.11.m3.1e">italic_L</annotation></semantics></math>, <math alttext="D" class="ltx_Math" display="inline" id="A2.T8.12.m4.1"><semantics id="A2.T8.12.m4.1b"><mi id="A2.T8.12.m4.1.1" xref="A2.T8.12.m4.1.1.cmml">D</mi><annotation-xml encoding="MathML-Content" id="A2.T8.12.m4.1c"><ci id="A2.T8.12.m4.1.1.cmml" xref="A2.T8.12.m4.1.1">𝐷</ci></annotation-xml><annotation encoding="application/x-tex" id="A2.T8.12.m4.1d">D</annotation><annotation encoding="application/x-llamapun" id="A2.T8.12.m4.1e">italic_D</annotation></semantics></math> and <math alttext="S" class="ltx_Math" display="inline" id="A2.T8.13.m5.1"><semantics id="A2.T8.13.m5.1b"><mi id="A2.T8.13.m5.1.1" xref="A2.T8.13.m5.1.1.cmml">S</mi><annotation-xml encoding="MathML-Content" id="A2.T8.13.m5.1c"><ci id="A2.T8.13.m5.1.1.cmml" xref="A2.T8.13.m5.1.1">𝑆</ci></annotation-xml><annotation encoding="application/x-tex" id="A2.T8.13.m5.1d">S</annotation><annotation encoding="application/x-llamapun" id="A2.T8.13.m5.1e">italic_S</annotation></semantics></math> denote the number of layers in the model, dense layer (equation <a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#S3.E3" title="3 ‣ 3.1 Problem Setup ‣ 3 Main Ideas ‣ HiRE: High Recall Approximate Top-𝑘 Estimation for Efficient LLM Inference"><span class="ltx_text ltx_ref_tag">3</span></a>) and sparse layer (equation <a class="ltx_ref" href="https://arxiv.org/html/2402.09360v1#S3.E6" title="6 ‣ 3.4 HiRE-FFN: Efficient FFN using HiRE ‣ 3 Main Ideas ‣ HiRE: High Recall Approximate Top-𝑘 Estimation for Efficient LLM Inference"><span class="ltx_text ltx_ref_tag">6</span></a>) respectively. <math alttext="(D,S)" class="ltx_Math" display="inline" id="A2.T8.14.m6.2"><semantics id="A2.T8.14.m6.2b"><mrow id="A2.T8.14.m6.2.3.2" xref="A2.T8.14.m6.2.3.1.cmml"><mo id="A2.T8.14.m6.2.3.2.1" stretchy="false" xref="A2.T8.14.m6.2.3.1.cmml">(</mo><mi id="A2.T8.14.m6.1.1" xref="A2.T8.14.m6.1.1.cmml">D</mi><mo id="A2.T8.14.m6.2.3.2.2" xref="A2.T8.14.m6.2.3.1.cmml">,</mo><mi id="A2.T8.14.m6.2.2" xref="A2.T8.14.m6.2.2.cmml">S</mi><mo id="A2.T8.14.m6.2.3.2.3" stretchy="false" xref="A2.T8.14.m6.2.3.1.cmml">)</mo></mrow><annotation-xml encoding="MathML-Content" id="A2.T8.14.m6.2c"><interval closure="open" id="A2.T8.14.m6.2.3.1.cmml" xref="A2.T8.14.m6.2.3.2"><ci id="A2.T8.14.m6.1.1.cmml" xref="A2.T8.14.m6.1.1">𝐷</ci><ci id="A2.T8.14.m6.2.2.cmml" xref="A2.T8.14.m6.2.2">𝑆</ci></interval></annotation-xml><annotation encoding="application/x-tex" id="A2.T8.14.m6.2d">(D,S)</annotation><annotation encoding="application/x-llamapun" id="A2.T8.14.m6.2e">( italic_D , italic_S )</annotation></semantics></math> means alternating dense and sparse layers, while Last<math alttext="L/2" class="ltx_Math" display="inline" id="A2.T8.15.m7.1"><semantics id="A2.T8.15.m7.1b"><mrow id="A2.T8.15.m7.1.1" xref="A2.T8.15.m7.1.1.cmml"><mi id="A2.T8.15.m7.1.1.2" xref="A2.T8.15.m7.1.1.2.cmml">L</mi><mo id="A2.T8.15.m7.1.1.1" xref="A2.T8.15.m7.1.1.1.cmml">/</mo><mn id="A2.T8.15.m7.1.1.3" xref="A2.T8.15.m7.1.1.3.cmml">2</mn></mrow><annotation-xml encoding="MathML-Content" id="A2.T8.15.m7.1c"><apply id="A2.T8.15.m7.1.1.cmml" xref="A2.T8.15.m7.1.1"><divide id="A2.T8.15.m7.1.1.1.cmml" xref="A2.T8.15.m7.1.1.1"></divide><ci id="A2.T8.15.m7.1.1.2.cmml" xref="A2.T8.15.m7.1.1.2">𝐿</ci><cn id="A2.T8.15.m7.1.1.3.cmml" type="integer" xref="A2.T8.15.m7.1.1.3">2</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="A2.T8.15.m7.1d">L/2</annotation><annotation encoding="application/x-llamapun" id="A2.T8.15.m7.1e">italic_L / 2</annotation></semantics></math> refers to the final <math alttext="L/2" class="ltx_Math" display="inline" id="A2.T8.16.m8.1"><semantics id="A2.T8.16.m8.1b"><mrow id="A2.T8.16.m8.1.1" xref="A2.T8.16.m8.1.1.cmml"><mi id="A2.T8.16.m8.1.1.2" xref="A2.T8.16.m8.1.1.2.cmml">L</mi><mo id="A2.T8.16.m8.1.1.1" xref="A2.T8.16.m8.1.1.1.cmml">/</mo><mn id="A2.T8.16.m8.1.1.3" xref="A2.T8.16.m8.1.1.3.cmml">2</mn></mrow><annotation-xml encoding="MathML-Content" id="A2.T8.16.m8.1c"><apply id="A2.T8.16.m8.1.1.cmml" xref="A2.T8.16.m8.1.1"><divide id="A2.T8.16.m8.1.1.1.cmml" xref="A2.T8.16.m8.1.1.1"></divide><ci id="A2.T8.16.m8.1.1.2.cmml" xref="A2.T8.16.m8.1.1.2">𝐿</ci><cn id="A2.T8.16.m8.1.1.3.cmml" type="integer" xref="A2.T8.16.m8.1.1.3">2</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="A2.T8.16.m8.1d">L/2</annotation><annotation encoding="application/x-llamapun" id="A2.T8.16.m8.1e">italic_L / 2</annotation></semantics></math> layers being sparse and the remaining being dense.</figcaption>
<table class="ltx_tabular ltx_centering ltx_align_middle" id="A2.T8.26">
<tr class="ltx_tr" id="A2.T8.26.10">
<td class="ltx_td ltx_border_l ltx_border_r ltx_border_t" colspan="2" id="A2.T8.26.10.11"></td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="A2.T8.26.10.12">Baseline</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="A2.T8.19.3.3">(<math alttext="D" class="ltx_Math" display="inline" id="A2.T8.17.1.1.m1.1"><semantics id="A2.T8.17.1.1.m1.1a"><mi id="A2.T8.17.1.1.m1.1.1" xref="A2.T8.17.1.1.m1.1.1.cmml">D</mi><annotation-xml encoding="MathML-Content" id="A2.T8.17.1.1.m1.1b"><ci id="A2.T8.17.1.1.m1.1.1.cmml" xref="A2.T8.17.1.1.m1.1.1">𝐷</ci></annotation-xml><annotation encoding="application/x-tex" id="A2.T8.17.1.1.m1.1c">D</annotation><annotation encoding="application/x-llamapun" id="A2.T8.17.1.1.m1.1d">italic_D</annotation></semantics></math> <math alttext="S" class="ltx_Math" display="inline" id="A2.T8.18.2.2.m2.1"><semantics id="A2.T8.18.2.2.m2.1a"><mi id="A2.T8.18.2.2.m2.1.1" xref="A2.T8.18.2.2.m2.1.1.cmml">S</mi><annotation-xml encoding="MathML-Content" id="A2.T8.18.2.2.m2.1b"><ci id="A2.T8.18.2.2.m2.1.1.cmml" xref="A2.T8.18.2.2.m2.1.1">𝑆</ci></annotation-xml><annotation encoding="application/x-tex" id="A2.T8.18.2.2.m2.1c">S</annotation><annotation encoding="application/x-llamapun" id="A2.T8.18.2.2.m2.1d">italic_S</annotation></semantics></math>) x <math alttext="L/2" class="ltx_Math" display="inline" id="A2.T8.19.3.3.m3.1"><semantics id="A2.T8.19.3.3.m3.1a"><mrow id="A2.T8.19.3.3.m3.1.1" xref="A2.T8.19.3.3.m3.1.1.cmml"><mi id="A2.T8.19.3.3.m3.1.1.2" xref="A2.T8.19.3.3.m3.1.1.2.cmml">L</mi><mo id="A2.T8.19.3.3.m3.1.1.1" xref="A2.T8.19.3.3.m3.1.1.1.cmml">/</mo><mn id="A2.T8.19.3.3.m3.1.1.3" xref="A2.T8.19.3.3.m3.1.1.3.cmml">2</mn></mrow><annotation-xml encoding="MathML-Content" id="A2.T8.19.3.3.m3.1b"><apply id="A2.T8.19.3.3.m3.1.1.cmml" xref="A2.T8.19.3.3.m3.1.1"><divide id="A2.T8.19.3.3.m3.1.1.1.cmml" xref="A2.T8.19.3.3.m3.1.1.1"></divide><ci id="A2.T8.19.3.3.m3.1.1.2.cmml" xref="A2.T8.19.3.3.m3.1.1.2">𝐿</ci><cn id="A2.T8.19.3.3.m3.1.1.3.cmml" type="integer" xref="A2.T8.19.3.3.m3.1.1.3">2</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="A2.T8.19.3.3.m3.1c">L/2</annotation><annotation encoding="application/x-llamapun" id="A2.T8.19.3.3.m3.1d">italic_L / 2</annotation></semantics></math>
</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="A2.T8.20.4.4">Last <math alttext="L/2" class="ltx_Math" display="inline" id="A2.T8.20.4.4.m1.1"><semantics id="A2.T8.20.4.4.m1.1a"><mrow id="A2.T8.20.4.4.m1.1.1" xref="A2.T8.20.4.4.m1.1.1.cmml"><mi id="A2.T8.20.4.4.m1.1.1.2" xref="A2.T8.20.4.4.m1.1.1.2.cmml">L</mi><mo id="A2.T8.20.4.4.m1.1.1.1" xref="A2.T8.20.4.4.m1.1.1.1.cmml">/</mo><mn id="A2.T8.20.4.4.m1.1.1.3" xref="A2.T8.20.4.4.m1.1.1.3.cmml">2</mn></mrow><annotation-xml encoding="MathML-Content" id="A2.T8.20.4.4.m1.1b"><apply id="A2.T8.20.4.4.m1.1.1.cmml" xref="A2.T8.20.4.4.m1.1.1"><divide id="A2.T8.20.4.4.m1.1.1.1.cmml" xref="A2.T8.20.4.4.m1.1.1.1"></divide><ci id="A2.T8.20.4.4.m1.1.1.2.cmml" xref="A2.T8.20.4.4.m1.1.1.2">𝐿</ci><cn id="A2.T8.20.4.4.m1.1.1.3.cmml" type="integer" xref="A2.T8.20.4.4.m1.1.1.3">2</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="A2.T8.20.4.4.m1.1c">L/2</annotation><annotation encoding="application/x-llamapun" id="A2.T8.20.4.4.m1.1d">italic_L / 2</annotation></semantics></math>
</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="A2.T8.24.8.8">(<math alttext="D" class="ltx_Math" display="inline" id="A2.T8.21.5.5.m1.1"><semantics id="A2.T8.21.5.5.m1.1a"><mi id="A2.T8.21.5.5.m1.1.1" xref="A2.T8.21.5.5.m1.1.1.cmml">D</mi><annotation-xml encoding="MathML-Content" id="A2.T8.21.5.5.m1.1b"><ci id="A2.T8.21.5.5.m1.1.1.cmml" xref="A2.T8.21.5.5.m1.1.1">𝐷</ci></annotation-xml><annotation encoding="application/x-tex" id="A2.T8.21.5.5.m1.1c">D</annotation><annotation encoding="application/x-llamapun" id="A2.T8.21.5.5.m1.1d">italic_D</annotation></semantics></math> <math alttext="S" class="ltx_Math" display="inline" id="A2.T8.22.6.6.m2.1"><semantics id="A2.T8.22.6.6.m2.1a"><mi id="A2.T8.22.6.6.m2.1.1" xref="A2.T8.22.6.6.m2.1.1.cmml">S</mi><annotation-xml encoding="MathML-Content" id="A2.T8.22.6.6.m2.1b"><ci id="A2.T8.22.6.6.m2.1.1.cmml" xref="A2.T8.22.6.6.m2.1.1">𝑆</ci></annotation-xml><annotation encoding="application/x-tex" id="A2.T8.22.6.6.m2.1c">S</annotation><annotation encoding="application/x-llamapun" id="A2.T8.22.6.6.m2.1d">italic_S</annotation></semantics></math> <math alttext="S" class="ltx_Math" display="inline" id="A2.T8.23.7.7.m3.1"><semantics id="A2.T8.23.7.7.m3.1a"><mi id="A2.T8.23.7.7.m3.1.1" xref="A2.T8.23.7.7.m3.1.1.cmml">S</mi><annotation-xml encoding="MathML-Content" id="A2.T8.23.7.7.m3.1b"><ci id="A2.T8.23.7.7.m3.1.1.cmml" xref="A2.T8.23.7.7.m3.1.1">𝑆</ci></annotation-xml><annotation encoding="application/x-tex" id="A2.T8.23.7.7.m3.1c">S</annotation><annotation encoding="application/x-llamapun" id="A2.T8.23.7.7.m3.1d">italic_S</annotation></semantics></math>) x <math alttext="L/3" class="ltx_Math" display="inline" id="A2.T8.24.8.8.m4.1"><semantics id="A2.T8.24.8.8.m4.1a"><mrow id="A2.T8.24.8.8.m4.1.1" xref="A2.T8.24.8.8.m4.1.1.cmml"><mi id="A2.T8.24.8.8.m4.1.1.2" xref="A2.T8.24.8.8.m4.1.1.2.cmml">L</mi><mo id="A2.T8.24.8.8.m4.1.1.1" xref="A2.T8.24.8.8.m4.1.1.1.cmml">/</mo><mn id="A2.T8.24.8.8.m4.1.1.3" xref="A2.T8.24.8.8.m4.1.1.3.cmml">3</mn></mrow><annotation-xml encoding="MathML-Content" id="A2.T8.24.8.8.m4.1b"><apply id="A2.T8.24.8.8.m4.1.1.cmml" xref="A2.T8.24.8.8.m4.1.1"><divide id="A2.T8.24.8.8.m4.1.1.1.cmml" xref="A2.T8.24.8.8.m4.1.1.1"></divide><ci id="A2.T8.24.8.8.m4.1.1.2.cmml" xref="A2.T8.24.8.8.m4.1.1.2">𝐿</ci><cn id="A2.T8.24.8.8.m4.1.1.3.cmml" type="integer" xref="A2.T8.24.8.8.m4.1.1.3">3</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="A2.T8.24.8.8.m4.1c">L/3</annotation><annotation encoding="application/x-llamapun" id="A2.T8.24.8.8.m4.1d">italic_L / 3</annotation></semantics></math>
</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="A2.T8.25.9.9">Last <math alttext="2L/3" class="ltx_Math" display="inline" id="A2.T8.25.9.9.m1.1"><semantics id="A2.T8.25.9.9.m1.1a"><mrow id="A2.T8.25.9.9.m1.1.1" xref="A2.T8.25.9.9.m1.1.1.cmml"><mrow id="A2.T8.25.9.9.m1.1.1.2" xref="A2.T8.25.9.9.m1.1.1.2.cmml"><mn id="A2.T8.25.9.9.m1.1.1.2.2" xref="A2.T8.25.9.9.m1.1.1.2.2.cmml">2</mn><mo id="A2.T8.25.9.9.m1.1.1.2.1" xref="A2.T8.25.9.9.m1.1.1.2.1.cmml">⁢</mo><mi id="A2.T8.25.9.9.m1.1.1.2.3" xref="A2.T8.25.9.9.m1.1.1.2.3.cmml">L</mi></mrow><mo id="A2.T8.25.9.9.m1.1.1.1" xref="A2.T8.25.9.9.m1.1.1.1.cmml">/</mo><mn id="A2.T8.25.9.9.m1.1.1.3" xref="A2.T8.25.9.9.m1.1.1.3.cmml">3</mn></mrow><annotation-xml encoding="MathML-Content" id="A2.T8.25.9.9.m1.1b"><apply id="A2.T8.25.9.9.m1.1.1.cmml" xref="A2.T8.25.9.9.m1.1.1"><divide id="A2.T8.25.9.9.m1.1.1.1.cmml" xref="A2.T8.25.9.9.m1.1.1.1"></divide><apply id="A2.T8.25.9.9.m1.1.1.2.cmml" xref="A2.T8.25.9.9.m1.1.1.2"><times id="A2.T8.25.9.9.m1.1.1.2.1.cmml" xref="A2.T8.25.9.9.m1.1.1.2.1"></times><cn id="A2.T8.25.9.9.m1.1.1.2.2.cmml" type="integer" xref="A2.T8.25.9.9.m1.1.1.2.2">2</cn><ci id="A2.T8.25.9.9.m1.1.1.2.3.cmml" xref="A2.T8.25.9.9.m1.1.1.2.3">𝐿</ci></apply><cn id="A2.T8.25.9.9.m1.1.1.3.cmml" type="integer" xref="A2.T8.25.9.9.m1.1.1.3">3</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="A2.T8.25.9.9.m1.1c">2L/3</annotation><annotation encoding="application/x-llamapun" id="A2.T8.25.9.9.m1.1d">2 italic_L / 3</annotation></semantics></math>
</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="A2.T8.26.10.10">
<math alttext="L" class="ltx_Math" display="inline" id="A2.T8.26.10.10.m1.1"><semantics id="A2.T8.26.10.10.m1.1a"><mi id="A2.T8.26.10.10.m1.1.1" xref="A2.T8.26.10.10.m1.1.1.cmml">L</mi><annotation-xml encoding="MathML-Content" id="A2.T8.26.10.10.m1.1b"><ci id="A2.T8.26.10.10.m1.1.1.cmml" xref="A2.T8.26.10.10.m1.1.1">𝐿</ci></annotation-xml><annotation encoding="application/x-tex" id="A2.T8.26.10.10.m1.1c">L</annotation><annotation encoding="application/x-llamapun" id="A2.T8.26.10.10.m1.1d">italic_L</annotation></semantics></math> layers</td>
</tr>
<tr class="ltx_tr" id="A2.T8.26.11">
<td class="ltx_td ltx_align_center ltx_border_l ltx_border_r ltx_border_t" id="A2.T8.26.11.1" rowspan="2"><span class="ltx_text" id="A2.T8.26.11.1.1"><span class="ltx_text" id="A2.T8.26.11.1.1.1"></span> <span class="ltx_text" id="A2.T8.26.11.1.1.2">
<span class="ltx_tabular ltx_align_middle" id="A2.T8.26.11.1.1.2.1">
<span class="ltx_tr" id="A2.T8.26.11.1.1.2.1.1">
<span class="ltx_td ltx_align_center" id="A2.T8.26.11.1.1.2.1.1.1">Pre-training</span></span>
<span class="ltx_tr" id="A2.T8.26.11.1.1.2.1.2">
<span class="ltx_td ltx_align_center" id="A2.T8.26.11.1.1.2.1.2.1">Performance</span></span>
</span></span> <span class="ltx_text" id="A2.T8.26.11.1.1.3"></span></span></td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="A2.T8.26.11.2">Top1 Accuracy</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="A2.T8.26.11.3">57.15%</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="A2.T8.26.11.4">57.03%</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="A2.T8.26.11.5">57.03%</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="A2.T8.26.11.6">56.84%</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="A2.T8.26.11.7">56.83%</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="A2.T8.26.11.8">56.24%</td>
</tr>
<tr class="ltx_tr" id="A2.T8.26.12">
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="A2.T8.26.12.1">Perplexity</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="A2.T8.26.12.2">2.045</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="A2.T8.26.12.3">2.056</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="A2.T8.26.12.4">2.058</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="A2.T8.26.12.5">2.069</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="A2.T8.26.12.6">2.071</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="A2.T8.26.12.7">2.108</td>
</tr>
<tr class="ltx_tr" id="A2.T8.26.13">
<td class="ltx_td ltx_align_center ltx_border_l ltx_border_r ltx_border_tt" id="A2.T8.26.13.1" rowspan="4"><span class="ltx_text" id="A2.T8.26.13.1.1"><span class="ltx_text" id="A2.T8.26.13.1.1.1"></span> <span class="ltx_text" id="A2.T8.26.13.1.1.2">
<span class="ltx_tabular ltx_align_middle" id="A2.T8.26.13.1.1.2.1">
<span class="ltx_tr" id="A2.T8.26.13.1.1.2.1.1">
<span class="ltx_td ltx_align_center" id="A2.T8.26.13.1.1.2.1.1.1">Downstream</span></span>
<span class="ltx_tr" id="A2.T8.26.13.1.1.2.1.2">
<span class="ltx_td ltx_align_center" id="A2.T8.26.13.1.1.2.1.2.1">Performance</span></span>
</span></span> <span class="ltx_text" id="A2.T8.26.13.1.1.3"></span></span></td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_tt" id="A2.T8.26.13.2">Machine Translation</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_tt" id="A2.T8.26.13.3">47.92</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_tt" id="A2.T8.26.13.4">46.95</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_tt" id="A2.T8.26.13.5">46.35</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_tt" id="A2.T8.26.13.6">46.17</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_tt" id="A2.T8.26.13.7">45.83</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_tt" id="A2.T8.26.13.8">44.35</td>
</tr>
<tr class="ltx_tr" id="A2.T8.26.14">
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="A2.T8.26.14.1">SuperGLUE Benchmark</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="A2.T8.26.14.2">62.07</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="A2.T8.26.14.3">62.49</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="A2.T8.26.14.4">60.43</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="A2.T8.26.14.5">59.37</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="A2.T8.26.14.6">60.74</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="A2.T8.26.14.7">59.3</td>
</tr>
<tr class="ltx_tr" id="A2.T8.26.15">
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="A2.T8.26.15.1">Question Answering</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="A2.T8.26.15.2">29.65</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="A2.T8.26.15.3">30.88</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="A2.T8.26.15.4">29.86</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="A2.T8.26.15.5">28.88</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="A2.T8.26.15.6">29.09</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="A2.T8.26.15.7">27.51</td>
</tr>
<tr class="ltx_tr" id="A2.T8.26.16">
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="A2.T8.26.16.1">Discriminative Tasks</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="A2.T8.26.16.2">51.69</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="A2.T8.26.16.3">51.14</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="A2.T8.26.16.4">50.99</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="A2.T8.26.16.5">50.37</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="A2.T8.26.16.6">50.8</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="A2.T8.26.16.7">49.65</td>
</tr>
<tr class="ltx_tr" id="A2.T8.26.17">
<td class="ltx_td ltx_border_b ltx_border_l ltx_border_r ltx_border_tt" id="A2.T8.26.17.1"></td>
<td class="ltx_td ltx_align_center ltx_border_b ltx_border_r ltx_border_tt" id="A2.T8.26.17.2"><em class="ltx_emph ltx_font_italic" id="A2.T8.26.17.2.1">Speedup</em></td>
<td class="ltx_td ltx_align_center ltx_border_b ltx_border_r ltx_border_tt" id="A2.T8.26.17.3">1.0x</td>
<td class="ltx_td ltx_align_center ltx_border_b ltx_border_r ltx_border_tt" id="A2.T8.26.17.4">1.16x</td>
<td class="ltx_td ltx_align_center ltx_border_b ltx_border_r ltx_border_tt" id="A2.T8.26.17.5">1.18x</td>
<td class="ltx_td ltx_align_center ltx_border_b ltx_border_r ltx_border_tt" id="A2.T8.26.17.6">1.17x</td>
<td class="ltx_td ltx_align_center ltx_border_b ltx_border_r ltx_border_tt" id="A2.T8.26.17.7">1.18x</td>
<td class="ltx_td ltx_align_center ltx_border_b ltx_border_r ltx_border_tt" id="A2.T8.26.17.8">1.44x</td>
</tr>
</table>
</figure>
<div class="ltx_pagination ltx_role_newpage"></div>
</section>
</article>
</div>
<footer class="ltx_page_footer">
<div class="ltx_page_logo">Generated  on Wed Feb 14 18:00:25 2024 by <a class="ltx_LaTeXML_logo" href="http://dlmf.nist.gov/LaTeXML/"><span style="letter-spacing:-0.2em; margin-right:0.1em;">L<span style="font-size:70%;position:relative; bottom:2.2pt;">A</span>T<span style="position:relative; bottom:-0.4ex;">E</span></span><span class="ltx_font_smallcaps">xml</span><img alt="[LOGO]" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAAOCAYAAAD5YeaVAAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9wKExQZLWTEaOUAAAAddEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIFRoZSBHSU1Q72QlbgAAAdpJREFUKM9tkL+L2nAARz9fPZNCKFapUn8kyI0e4iRHSR1Kb8ng0lJw6FYHFwv2LwhOpcWxTjeUunYqOmqd6hEoRDhtDWdA8ApRYsSUCDHNt5ul13vz4w0vWCgUnnEc975arX6ORqN3VqtVZbfbTQC4uEHANM3jSqXymFI6yWazP2KxWAXAL9zCUa1Wy2tXVxheKA9YNoR8Pt+aTqe4FVVVvz05O6MBhqUIBGk8Hn8HAOVy+T+XLJfLS4ZhTiRJgqIoVBRFIoric47jPnmeB1mW/9rr9ZpSSn3Lsmir1fJZlqWlUonKsvwWwD8ymc/nXwVBeLjf7xEKhdBut9Hr9WgmkyGEkJwsy5eHG5vN5g0AKIoCAEgkEkin0wQAfN9/cXPdheu6P33fBwB4ngcAcByHJpPJl+fn54mD3Gg0NrquXxeLRQAAwzAYj8cwTZPwPH9/sVg8PXweDAauqqr2cDjEer1GJBLBZDJBs9mE4zjwfZ85lAGg2+06hmGgXq+j3+/DsixYlgVN03a9Xu8jgCNCyIegIAgx13Vfd7vdu+FweG8YRkjXdWy329+dTgeSJD3ieZ7RNO0VAXAPwDEAO5VKndi2fWrb9jWl9Esul6PZbDY9Go1OZ7PZ9z/lyuD3OozU2wAAAABJRU5ErkJggg=="/></a>
</div></footer>
</div>
</body>
</html>
